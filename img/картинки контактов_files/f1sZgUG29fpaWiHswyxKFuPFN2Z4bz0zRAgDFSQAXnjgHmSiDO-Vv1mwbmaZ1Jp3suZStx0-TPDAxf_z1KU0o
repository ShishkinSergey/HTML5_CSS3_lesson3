if(window.jQuery&&window.bemhtml){!function(t){var e=function(){return"_"}.toString().indexOf("_")>-1,i=function(){},n=Object.create||function(t){var e=function(){};return e.prototype=t,new e},s=Object.keys,o=t.extend,r=Array.isArray,a=t.isFunction,h=!0,c={toString:""};for(var l in c)c.hasOwnProperty(l)&&(h=!1);var u=h?["toString","valueOf"]:null;function d(i,n,o){for(var r,c,l=function(t){var e=s(t);if(h)for(var i,n=0;i=u[n++];)t.hasOwnProperty(i)&&e.push(i);return e}(o),d=0,p=l.length;d<p;)"__self"!==(r=l[d++])&&(c=o[r],a(c)&&(!e||c.toString().indexOf(".__base")>-1)?n[r]=function(e,s){var o=function(){var t=this.__base;this.__base=o.__base;var e=s.apply(this,arguments);return this.__base=t,e};return o.__base=i[e]||("__constructor"===e?n.__self.__parent:t.noop),o}(r,c):n[r]=c)}function p(e,i){for(var n,s=1;n=e[s++];)i?a(n)?t.inheritSelf(i,n.prototype,n):t.inheritSelf(i,n):i=a(n)?t.inherit(e[0],n.prototype,n):t.inherit(e[0],n);return i||e[0]}t.inherit=function(){var t=arguments,e=r(t[0]),s=e||a(t[0]),h=s?e?p(t[0]):t[0]:i,c=t[s?1:0]||{},l=t[s?2:1],u=c.__constructor||s&&h.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:s?function(){return h.apply(this,arguments)}:function(){};if(!s)return u.prototype=c,u.prototype.__self=u.prototype.constructor=u,o(u,l);o(u,h),u.__parent=h;var f=h.prototype,m=u.prototype=n(f);return m.__self=m.constructor=u,c&&d(f,m,c),l&&d(h,u,l),u},t.inheritSelf=function(){var t=arguments,e=r(t[0])?p(t[0],t[0][0]):t[0],i=t[1],n=t[2],s=e.prototype;return i&&d(s,s,i),n&&d(e,e,n),e},t.inherit.self=t.inheritSelf}(jQuery),function(t){var e=0,i="__"+Number(new Date),n=function(){return"uniq"+ ++e};t.identify=function(t,e){if(!t)return n();var s="uniqueID"in t?"uniqueID":i;return e||s in t?t[s]:t[s]=n()}}(jQuery),function(t){var e="__"+Number(new Date)+"storage",i=function(e,i){return t.identify(e)+(i?t.identify(i):"")},n={buildEventName:function(t){return t},on:function(n,s,o,r,a){if("string"==typeof n){t.isFunction(s)&&(r=o,o=s,s=void 0);for(var h,c=i(o,r),l=this[e]||(this[e]={}),u=n.split(" "),d=0;n=u[d++];)if(!(c in(h=l[n=this.buildEventName(n)]||(l[n]={ids:{},list:{}})).ids)){var p=h.list,f={fn:o,data:s,ctx:r,special:a};p.last?(p.last.next=f,f.prev=p.last):p.first=f,h.ids[c]=p.last=f}}else{var m=this;t.each(n,function(t,e){m.on(t,e,s,a)})}return this},onFirst:function(t,e,i,n){return this.on(t,e,i,n,{one:!0})},un:function(n,s,o){if("string"==typeof n||void 0===n){var r=this[e];if(r)if(n){for(var a,h=n.split(" "),c=0;n=h[c++];)if(a=r[n=this.buildEventName(n)])if(s){var l=i(s,o),u=a.ids;if(l in u){var d=a.list,p=u[l],f=p.prev,m=p.next;f?f.next=m:p===d.first&&(d.first=m),m?m.prev=f:p===d.last&&(d.last=f),delete u[l]}}else delete this[e][n]}else delete this[e]}else{var _=this;o=s,t.each(n,function(t,e){_.un(t,e,o)})}return this},trigger:function(i,n){var s=this[e],o="string"==typeof i,r=o?i:i.type,a=this.buildEventName(r);if(o||(i.type=a,i.target||(i.target=this)),s&&(s=s[a])){var h,c=s.list.first;for(c&&o&&((i=t.Event(a)).target=this);c;)i.data=c.data,void 0!==(h=c.fn.call(c.ctx||this,i,n))&&(i.result=h,!1===h&&(i.preventDefault(),i.stopPropagation())),c.special&&c.special.one&&this.un(r,c.fn,c.ctx),c=c.next}return this}};t.observable=t.inherit(n,n)}(jQuery),function(){var t=Array.prototype.slice;Function.prototype.bind||(Function.prototype.bind=function(e){var i=this,n=t.call(arguments,1);return function(){return i.apply(e,n.concat(t.call(arguments)))}})}(),function(t,e){var i=[],n=t.inherit,s=t.isFunction,o=Function.prototype.call.bind(Object.prototype.hasOwnProperty),r={},a={};function h(t,e,i){return(t?"__elem_"+t:"")+"__mod"+(e?"_"+e:"")+(i?"_"+i:"")}function c(t,e,i){var n,r,a;if(s(t))e[h(i,"*","*")]=t;else for(n in t)if(o(t,n))if(a=t[n],s(a))e[h(i,n,"*")]=a;else for(r in a)o(a,r)&&(e[h(i,n,r)]=a[r])}function l(t){var e;if(t.onSetMod&&(c(t.onSetMod,t),delete t.onSetMod),t.onElemSetMod){for(e in t.onElemSetMod)o(t.onElemSetMod,e)&&c(t.onElemSetMod[e],t,e);delete t.onElemSetMod}}this.BEM=n(t.observable,{__constructor:function(t,e,i){var n=this;n._modCache=t||{},n._processingMods={},n._params=e,n.params=null,!1!==i?n._init():n.afterCurrentEvent(function(){n._init()})},_init:function(){return this._initing||this.hasMod("js","inited")||(this._initing=!0,this.params||(this.params=t.extend(this.getDefaultParams(),this._params),delete this._params),this.setMod("js","inited"),delete this._initing,this.hasMod("js","inited")&&this.trigger("init")),this},changeThis:function(t,e){return t.bind(e||this)},afterCurrentEvent:function(t,e){this.__self.afterCurrentEvent(t.bind(e||this))},on:function(e,i,n,s){return"object"==typeof e&&(t.isFunction(i)||t.isFunction(n))&&(e=this.__self._buildModEventName(e)),this.__base.apply(this,arguments)},un:function(e,i,n){return"object"==typeof e&&t.isFunction(i)&&(e=this.__self._buildModEventName(e)),this.__base.apply(this,arguments)},trigger:function(e,i){var n=!0;return"object"!=typeof e||e instanceof t.Event||(n="js"===e.modName||this.hasMod("js"),e=this.__self._buildModEventName(e)),n&&(this.__base(e=this.buildEvent(e),i),this._trigger(e,i)),this},_trigger:function(t,e){this.__self.trigger(t,e)},buildEvent:function(e){return"string"==typeof e&&(e=t.Event(e)),e.block=this,e},hasMod:function(t,e,i){var n=arguments.length,s=!1;1==n?(i="",e=t,t=void 0,s=!0):2==n&&("string"==typeof t?(i=e,e=t,t=void 0):(i="",s=!0));var o=this.getMod(t,e)===i;return s?!o:o},getMod:function(t,e){var i=typeof t;if("string"===i||"undefined"===i){e=t||e;var n=this._modCache;return e in n?n[e]:n[e]=this._extractModVal(e)}return this._getElemMod(e,t)},_getElemMod:function(t,e,i){return this._extractModVal(t,e,i)},getMods:function(t){var e=t&&"string"!=typeof t,i=this._modCache,n=[].slice.call(arguments,e?1:0);return n.length?n.reduce(function(t,e){return e in i&&(t[e]=i[e]),t},{}):i},setMod:function(e,i,n){void 0===n&&("string"==typeof e?(n=void 0===i||i,i=e,e=void 0):n=!0);var s=this;if(!e||e[0]){!1===n||null===n?n="":!0!==n&&(n=n.toString());var o=(e&&e[0]?t.identify(e[0]):"")+"_"+i;if(this._processingMods[o])return s;var r,a=e?s._getElemMod(i,e,r=s.__self._extractElemNameFrom(e)):s.getMod(i);if(a===n)return s;this._processingMods[o]=!0;var h=!0,c=[i,n,a];e&&c.unshift(e),[["*","*"],[i,"*"],[i,n]].forEach(function(t){h=!1!==s._callModFn(r,t[0],t[1],c)&&h}),!e&&h&&(s._modCache[i]=n),h&&s._afterSetMod(i,n,a,e,r),delete this._processingMods[o]}return s},_afterSetMod:function(t,e,i,n,s){var o={modName:t,modVal:e,oldModVal:i};n&&(o.elem=n),this.trigger({modName:t,modVal:"*",elem:s},o).trigger({modName:t,modVal:e,elem:s},o)},toggleMod:function(t,e,i,n,s){"string"==typeof t&&(s=n,n=i,i=e,e=t,t=void 0),void 0===n?n="":"boolean"==typeof n&&(s=n,n="");var o=this.getMod(t,e);return(o==i||o==n)&&this.setMod(t,e,"boolean"==typeof s?s?i:n:this.hasMod(t,e,i)?n:i),this},delMod:function(t,e){return e||(e=t,t=void 0),this.setMod(t,e,"")},_callModFn:function(t,e,i,n){var s=h(t,e,i);return this[s]?this[s].apply(this,n):void 0},_extractModVal:function(t,e){return""},channel:function(t,e){return this.__self.channel(t,e)},getDefaultParams:function(){return{}},del:function(t){var e=[].slice.call(arguments);return"string"==typeof t&&e.unshift(this),this.__self.del.apply(this.__self,e),this},destruct:function(){var t={modName:"js",modVal:"",oldModVal:"inited"};this.trigger({modName:t.modName,modVal:t.modVal},t)}},t.extend(this.BEM,{_name:"i-bem",blocks:r,decl:function(e,i,o){"string"==typeof e?e={block:e}:e.name&&(e.block=e.name),l(i||(i={}));var a,h,c=r[e.baseBlock||e.block]||this;if(e.modName){var u=(a=e.modName,(h=e.modVal)?Array.isArray(h)?function(t){for(var e=0,i=h.length;e<i;)if(t.hasMod(a,h[e++]))return!0;return!1}:function(t){return t.hasMod(a,h)}:function(t){return t.hasMod(a)});t.each(i,function(t,e){s(e)&&(i[t]=function(){var n;if(u(this))n=e;else{var s=c.prototype[t];s&&s!==i[t]&&(n=this.__base)}return n?n.apply(this,arguments):void 0})})}if(o&&"boolean"==typeof o.live){var d=o.live;o.live=function(){return d}}var p,f=c;return e.baseMix&&(f=[f],e.baseMix.forEach(function(t){f.push(r[t])})),e.block==c._name?(p=n.self(f,i,o))._processLive(!0):((p=r[e.block]=n(f,i,o))._name=e.block,delete p._liveInitable),p},declMix:function(t,e,i){return l(e||(e={})),t=r[t]=n(e,i)},_processLive:function(t){return!1},create:function(t,e){return"string"==typeof t&&(t={block:t}),new r[t.block](t.mods,e)},getName:function(){return this._name},on:function(e,i,n,s){return"object"==typeof e&&(t.isFunction(i)||t.isFunction(n))&&(e=this._buildModEventName(e)),this.__base.apply(this,arguments)},un:function(e,i,n){return"object"==typeof e&&t.isFunction(i)&&(e=this._buildModEventName(e)),this.__base.apply(this,arguments)},_buildModEventName:function(t){var e="_"+t.modName+"_"+(!1===t.modVal?"":t.modVal);return t.elem&&(e="__"+t.elem+e),e},_extractElemNameFrom:function(t){},afterCurrentEvent:function(t,e){1==i.push({fn:t,ctx:e})&&setTimeout(this._runAfterCurrentEventFns,0)},_runAfterCurrentEventFns:function(){var t=i.length;t&&i.splice(0,t).forEach(function(t){t.fn.call(t.ctx||this)},this)},changeThis:function(t,e){return t.bind(e||this)},del:function(t){var e="string"==typeof t,i=e?0:1,n=arguments.length;for(e&&(t=this);i<n;)delete t[arguments[i++]];return this},channel:function(e,i){if("boolean"==typeof e&&(i=e,e=void 0),e||(e="default"),!i)return a[e]||(a[e]=new t.observable);a[e]&&(a[e].un(),delete a[e])}}))}(jQuery),function(t,e,i){var n,s="_",o="__";function r(t){var e=typeof t;return"string"===e||"number"===e||"boolean"===e}function a(t,e,i){null!=e&&!1!==e&&(i.push(s,t),!0!==e&&i.push(s,e))}function h(t,e,i,n){n.push(t),a(e,i,n)}function c(t,e,i,s,r){h(t,n,n,r),r.push(o,e),a(i,s,r)}t.INTERNAL={NAME_PATTERN:"[a-zA-Z0-9-]+",MOD_DELIM:s,ELEM_DELIM:o,buildModPostfix:function(t,e,i){var n=i||[];return a(t,e,n),i?n:n.join("")},buildClass:function(t,e,i,s,o){if(r(i)?r(s)||(o=s,s=i,i=e,e=n):void 0!==i?(o=i,i=n):e&&"string"!=typeof e&&(o=e,e=n),!e&&void 0===i&&!o)return t;var a=o||[];return e?c(t,e,i,s,a):h(t,i,s,a),o?a:a.join("")},buildClasses:function(t,i,n,s){i&&"string"!=typeof i&&(s=n,n=i,i=void 0);var o=s||[];return i?c(t,i,void 0,void 0,o):h(t,void 0,void 0,o),n&&e.each(n,function(e,n){n&&(o.push(" "),i?c(t,i,e,n,o):h(t,e,n,o))}),s?o:o.join("")}}}(BEM,jQuery),function(t,e,i){var n=e(window),s=e(document),o={},r={},a={},h={},c={},l=t.blocks,u=t.INTERNAL,d=u.NAME_PATTERN,p=u.MOD_DELIM,f=u.ELEM_DELIM,m=RegExp("[^"+p+"]"+p+"("+d+")(?:"+p+"("+d+"))?$"),_=u.buildModPostfix,g=u.buildClass,b=Array.prototype.slice,v=Array.prototype.reverse;function y(t,n,s,a,h){"boolean"==typeof s&&(h=a,a=s,s=i);var c=n[0];if(!c||c.dataset===i||"react"!==c.dataset.lego){var u=(s=M(s||E(c)[t],c,t)).uniqId;if(r[u])return r[u]._init();o[u]=o[u]?o[u].add(n):n;var d=c.parentNode;d&&11!==d.nodeType||e.unique(o[u]);var p=l[t]||C.decl(t,{},{live:!0});if(!(p._liveInitable=Boolean(p._processLive()))||a||!1===s.live){a&&n.addClass("i-bem");var f=new p(o[u],s,Boolean(a));return delete o[u],h&&h.apply(f,b.call(arguments,4)),f}}}function M(t,i,n,s){(t||(t={})).uniqId||(t.uniqId=(t.id?n+"-id-"+t.id:e.identify())+(s||e.identify()));var o=e.identify(i),r=a[o]||(a[o]={});return r[n]||(r[n]=t),t}function k(t,e,i){var n=t.find(e);return i?n:n.add(t.filter(e))}function E(t){var i=e.identify(t);return a[i]||(a[i]=w(t))}function w(t){var e,i=t.getAttribute("data-bem");return i?JSON.parse(i):e?e():{}}function B(t){delete a[e.identify(t)]}function S(t,e){1===t.domElem.length?t.destruct(!0):t.domElem=t.domElem.not(e)}e.fn.bem=function(t,e){return y(t,this,e,!0)};var C=t.DOM=t.decl("i-bem__dom",{__constructor:function(t,i,n){this.domElem=t,this._eventNameCache={},this._elemCache={},this._blockInsideCache={},r[this._uniqId=i.uniqId||e.identify(this)]=this,this._needSpecialUnbind=!1,this.__base(null,i,n)},findBlocksInside:function(t,e){return this._findBlocks("find",t,e)},findBlockInside:function(t,e){var i=this._buildBlockCacheKey(t,e),n=this._findBlocks("find",t,e,!0);return this._blockInsideCache[i]=n,n},blockInside:function(t,e){var i=this._buildBlockCacheKey(t,e),n=this._blockInsideCache[i];return n||(n=this.findBlockInside(t,e)),n},dropBlockInsideCache:function(t,e){t||e?this._blockInsideCache[this._buildBlockCacheKey(t,e)]=null:this._blockInsideCache={}},_buildBlockCacheKey:function(t,e){e||(e=t,t="");var i="string"==typeof e?e:g(e.block,e.modName,e.modVal);return("string"==typeof t?t:t.__bemElemName)+":"+i},findBlocksOutside:function(t,e){return this._findBlocks("parents",t,e)},findBlockOutside:function(t,e){return this._findBlocks("closest",t,e)[0]||null},findBlocksOn:function(t,e){return this._findBlocks("",t,e)},findBlockOn:function(t,e){return this._findBlocks("",t,e,!0)},_findBlocks:function(t,n,s,o){if(!this.domElem)return o?null:[];s||(s=n,n=i);var r=n?"string"==typeof n?this.findElem(n):n:this.domElem,a="string"==typeof s,h=a?s:s.block||s.blockName,c="."+(a?h:g(h,s.modName,s.modVal))+(o?":first":""),l=r.filter(c);if(t&&(l=l.add(r[t](c))),o)return l[0]?y(h,l.eq(0),!0):null;var u=[],d={};return e.each(l,function(t,i){var n=y(h,e(i),!0);d[n._uniqId]||(d[n._uniqId]=!0,u.push(n))}),u},bindToDomElem:function(t,n,s,o){e.isFunction(s)&&(o=s,s=i);var r=this,a=function(t){return(t.data||(t.data={})).domElem=e(this),o.apply(r,arguments)};return o?t.bind(r._buildEventName(n),s,(a.guid=o.guid=o.guid||e.guid++,a)):e.each(n,function(e,i){r.bindToDomElem(t,e,s,i)}),r},bindToDoc:function(t,e,i){return this._needSpecialUnbind=!0,this.bindToDomElem(s,t,e,i)},bindToWin:function(t,s,o){return e.isFunction(s)&&(o=s,s=i),this._needSpecialUnbind=!0,this.bindToDomElem(n,t,s,o)},bindTo:function(t,i,n,s){switch(arguments.length){case 3:e.isFunction(n)&&(s=n,"object"==typeof i&&(n=i,i=t,t=this.domElem));break;case 2:e.isFunction(i)?(s=i,i=t,t=this.domElem):"string"==typeof t||t instanceof e||(n=i,i=t,t=this.domElem);break;case 1:i=t,t=this.domElem}return"string"==typeof t&&(t=this.elem(t)),this.bindToDomElem(t,i,n,s)},unbindFromDomElem:function(t,e,i){return t.unbind(this._buildEventName(e),i),this},unbindFromDoc:function(t,e){return this.unbindFromDomElem(s,t,e)},unbindFromWin:function(t,e){return this.unbindFromDomElem(n,t,e)},unbindFrom:function(t,i,n){var s=arguments.length;return 1===s?(i=t,t=this.domElem):2===s&&e.isFunction(i)?(n=i,i=t,t=this.domElem):"string"==typeof t&&(t=this.elem(t)),this.unbindFromDomElem(t,i,n)},_buildEventName:function(t){var e=this;return t.indexOf(" ")>1?t.split(" ").map(function(t){return e._buildOneEventName(t)}).join(" "):e._buildOneEventName(t)},_buildOneEventName:function(t){var e=this._eventNameCache;if(t in e)return e[t];var i="."+this._uniqId;if(-1===t.indexOf("."))return e[t]=t+i,e[t];var n=".bem_"+this.__self._name;return e[t]=t.split(".").map(function(t,e){return 0===e?t+n:n+"_"+t}).join("")+i,e[t]},_trigger:function(t,e){this.__base.apply(this,arguments),this._ctxTrigger(t,e)},_ctxTrigger:function(t,i){var n=this,s=h[n.__self._buildCtxEventName(t.type)],o={};s&&n.domElem.each(function(){for(var r=this,a=s.counter;r&&a;){var h=e.identify(r,!0);if(h){if(o[h])break;var c=s.ctxs[h];c&&(e.each(c,function(e,s){s.fn.call(s.ctx||n,t,i)}),a--),o[h]=!0}r=r.parentNode}})},getMods:function(t){var e=t&&"string"!=typeof t,n=this._modCache,s=[].slice.call(arguments,e?1:0),o=this._extractMods(s,e?t:i);return e||(s.length?s.forEach(function(t){n[t]=o[t]}):n=o),o},setMod:function(t,i,n){if(t&&void 0!==n&&t.length>1){var s=this;return t.each(function(){var o=e(this);o.__bemElemName=t.__bemElemName,s.setMod(o,i,n)}),s}return this.__base(t,i,n)},_extractModVal:function(t,e,i){var n,s=(e||this.domElem)[0];return s&&(n=s.getAttribute("class").match(this.__self._buildModValRE(t,i||e))),n?n[2]||!0:""},_extractMods:function(t,e){var i={},n=!t.length,s=0;return((e||this.domElem).eq(0).attr("class").match(this.__self._buildModValRE("("+(n?d:t.join("|"))+")",e,"g"))||[]).forEach(function(t){var e=t.match(m);i[e[1]]=e[2]||!0,++s}),s<t.length&&t.forEach(function(t){t in i||(i[t]="")}),i},_afterSetMod:function(t,i,n,s,o){if(this._isDestructing)return this.__base.apply(this,arguments);var r=this.__self,a=r._buildModClassPrefix(t,o),h=r._buildModValRE(t,o,"g"),c=""===i||!1===i;(s||this.domElem).each(function(){var t=e(this),s=t.attr("class"),o=a;!0!==i&&(o+=p+i),(!0===n?h.test(s):(" "+s).indexOf(" "+a+p)>-1)?t.attr("class",s.replace(h,c?"":"$1"+o)):c||t.addClass(o)}),o&&this.dropElemCache(o,t,n).dropElemCache(o,t,i),this.__base.apply(this,arguments)},findElem:function(t,e,i,n){arguments.length%2?(n=i,i=e,e=t,t=this.domElem):"string"==typeof t&&(t=this.findElem(t)),e=e.split(" ");var s=this.__self.getName(),o=_(i,n),r=[],a=e.map(function(t){return r.push("."+g(s,t,i,n)),t+o}),h=1===a.length,c=k(t,r.join(","));return t===this.domElem&&r.forEach(function(t,i){(this._elemCache[a[i]]=h?c:c.filter(t)).__bemElemName=e[i]},this),c},_elem:function(t,e,i){return this._elemCache[t+_(e,i)]||this.findElem(t,e,i)},elem:function(t,i,n){if(2===arguments.length&&(n=!0),i&&"string"!=typeof i)return i.__bemElemName=t,i;if(t.indexOf(" ")<0)return this._elem(t,i,n);var s=e([]);return t.split(" ").forEach(function(t){s=s.add(this._elem(t,i,n))},this),s},dropElemCache:function(t,e,i){if(t){var n=_(e,i);t.indexOf(" ")<0?delete this._elemCache[t+n]:t.split(" ").forEach(function(t){delete this._elemCache[t+n]},this)}else this._elemCache={};return this},elemParams:function(t){var e;return"string"==typeof t?(e=t,t=this.elem(t)):e=this.__self._extractElemNameFrom(t),w(t[0])[g(this.__self.getName(),e)]||{}},elemify:function(t,i){return(t=e(t)).__bemElemName=i,t},containsDomElem:function(t){var e=!1;return this.domElem.each(function(){return!(e=t.parents().andSelf().index(this)>-1)}),e},buildSelector:function(t,e,i){return this.__self.buildSelector(t,e,i)},destruct:function(t){var i=this.__self;this._isDestructing||(this._isDestructing=!0,this._needSpecialUnbind&&i.doc.add(i.win).unbind("."+this._uniqId),this.dropElemCache().domElem.each(function(t,i){var n=E(i);e.each(n,function(t,e){var n=r[e.uniqId];n?n._isDestructing||S(n,i):delete o[e.uniqId]}),B(i)}),t||this.domElem.remove(),this.__base(),delete r[this.un()._uniqId],delete this.domElem,delete this._elemCache)}},{scope:null,doc:s,win:n,html:e(document.documentElement),_processLive:function(t){var e=this._liveInitable;if("live"in this&&void 0===e^t){e=!1!==this.live();var i=this.getName(),n=this.live;this.live=function(){return this.getName()===i?e:n.apply(this,arguments)}}return e},init:function(t,i,n){!t||e.isFunction(t)?(n=i,i=t,t=s):"string"==typeof t&&(t=e(t));var o=e.identify();return k(t,".i-bem").each(function(){!function(t,i){var n=t[0];e.each(E(n),function(s,o){M(o,n,s,i);var a=r[o.uniqId];a?a.domElem.index(n)<0&&(a.domElem=a.domElem.add(t),e.extend(a._params,o)):y(s,t,o)})}(e(this),o)}),i&&this.afterCurrentEvent(function(){i.call(n||this,t)}),this._runAfterCurrentEventFns(),t},destruct:function(t,n,s){"boolean"!=typeof t&&(s=n,n=t,t=i),n&&(v.call(k(n,".i-bem",s)).each(function(t,i){var n=E(this);e.each(n,function(t,e){if(e.uniqId){var n=r[e.uniqId];n?S(n,i):delete o[e.uniqId]}}),B(this)}),t||(s?n.empty():n.remove()))},update:function(t,e,i,n){return this.destruct(t,!0),this.init(t.html(e),i,n)},replace:function(t,i){return this.destruct(!0,t),this.init(e(i).replaceAll(t))},append:function(t,i){return this.init(e(i).appendTo(t))},prepend:function(t,i){return this.init(e(i).prependTo(t))},before:function(t,i){return this.init(e(i).insertBefore(t))},after:function(t,i){return this.init(e(i).insertAfter(t))},_buildCtxEventName:function(t){return this._name+":"+t},_liveClassBind:function(t,i,n,o){var r=this;if(i.indexOf(" ")>-1)i.split(" ").forEach(function(e){r._liveClassBind(t,e,n,o)});else{var a=c[i],h=e.identify(n);a||(a=c[i]={},s.bind(i,r._liveClassTrigger.bind(r))),h in(a=a[t]||(a[t]={uniqIds:{},fns:[]})).uniqIds||(a.fns.push({uniqId:h,fn:r._buildLiveEventFn(n,o)}),a.uniqIds[h]=a.fns.length-1)}return this},_liveClassUnbind:function(t,i,n){var s=c[i];if(s)if(n){if(s=s[t]){var o=e.identify(n);if(o in s.uniqIds){var r=s.uniqIds[o],a=s.fns.length-1;for(s.fns.splice(r,1);r<a;)s.uniqIds[s.fns[r++].uniqId]=r-1;delete s.uniqIds[o]}}}else delete s[t];return this},_liveClassTrigger:function(t){var i=c[t.type];if(i){var n=t.target,s=Object.keys(i);do{for(var o,r=" "+n.className+" ",a=0;o=s[a++];)if(-1!==r.indexOf(" "+o+" ")){for(var h=!1,l=i[o].fns,u=0;u<l.length;u++)!1===l[u].fn.apply(e(n),arguments)&&(h=!0);if(h&&t.preventDefault(),h||t.isPropagationStopped())return;s.splice(--a,1)}}while(s.length&&(n=n.parentNode))}},_buildLiveEventFn:function(t,i){var n=this;return function(s){var o=[n._name,((s.data||(s.data={})).domElem=e(this)).closest(n.buildSelector()),!0],r=y.apply(null,i?o.concat([t,s]):o);if(r&&!i&&t)return t.apply(r,arguments)}},liveInitOnEvent:function(t,e,i){return this.liveBindTo(t,e,i,!0)},liveBindTo:function(t,n,s,o){n&&!e.isFunction(n)||(s=n,n=t,t=i),t&&"string"!=typeof t||(t={elem:t}),t.elemName&&(t.elem=t.elemName);var r=this;return t.elem&&t.elem.indexOf(" ")>0?(t.elem.split(" ").forEach(function(e){r._liveClassBind(g(r._name,e,t.modName,t.modVal),n,s,o)}),r):r._liveClassBind(g(r._name,t.elem,t.modName,t.modVal),n,s,o)},liveUnbindFrom:function(t,n,s){n&&!e.isFunction(n)||(s=n,n=t,t=i);var o=this;return t&&t.indexOf(" ")>1?(t.split(" ").forEach(function(t){o._liveClassUnbind(g(o._name,t),n,s)}),o):o._liveClassUnbind(g(o._name,t),n,s)},_liveInitOnBlockEvent:function(t,e,i,n){var s=this._name;return l[e].on(t,function(t){if(t.block.domElem){var e=arguments,o=t.block[n](s);i&&o.forEach(function(t){i.apply(t,e)})}}),this},liveInitOnBlockEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksOn")},liveInitOnBlockInsideEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksOutside")},on:function(t,e,i,n,s){return t.jquery?this._liveCtxBind(t,e,i,n,s):this.__base(t,e,i,n,s)},un:function(t,e,i,n){return t.jquery?this._liveCtxUnbind(t,e,i,n):this.__base(t,e,i)},liveCtxBind:function(t,e,i,n,s){return this._liveCtxBind(t,e,i,n,s)},_liveCtxBind:function(t,n,s,o,r){var a=this;if("object"==typeof n&&(e.isFunction(s)||e.isFunction(o))&&(n=this._buildModEventName(n)),"string"==typeof n)if(e.isFunction(s)&&(r=o,o=s,s=i),n.indexOf(" ")>-1)n.split(" ").forEach(function(e){a._liveCtxBind(t,e,s,o,r)});else{var c=a._buildCtxEventName(n),l=h[c]||(h[c]={counter:0,ctxs:{}});t.each(function(){var t=e.identify(this),i=l.ctxs[t];i||(i=l.ctxs[t]={},++l.counter),i[e.identify(o)+(r?e.identify(r):"")]={fn:o,data:s,ctx:r}})}else e.each(n,function(e,i){a._liveCtxBind(t,e,i,s)});return a},liveCtxUnbind:function(t,e,i,n){return this._liveCtxUnbind(t,e,i,n)},_liveCtxUnbind:function(t,i,n,s){"object"==typeof i&&e.isFunction(n)&&(i=this._buildModEventName(i));var o=h[i=this._buildCtxEventName(i)];return o&&(t.each(function(){var t,i=e.identify(this,!0);i&&(t=o.ctxs[i])&&(n&&delete t[e.identify(n)+(s?e.identify(s):"")],n&&!e.isEmptyObject(t)||(o.counter--,delete o.ctxs[i]))}),o.counter||delete h[i]),this},_extractElemNameFrom:function(t){if(t.__bemElemName)return t.__bemElemName;var e=t.eq(0).attr("class").match(this._buildElemNameRE());return e?e[1]:i},extractParams:w,_buildModClassPrefix:function(t,e){return this._name+(e?f+("string"==typeof e?e:this._extractElemNameFrom(e)):"")+p+t},_buildModValRE:function(t,e,i){return new RegExp("(\\s|^)"+this._buildModClassPrefix(t,e)+"(?:"+p+"("+d+"))?(?=\\s|$)",i)},_buildElemNameRE:function(){return new RegExp(this._name+f+"("+d+")(?:\\s|$)")},buildSelector:function(t,e,i){return"."+g(this._name,t,e,i)},getBlockByUniqId:function(t){return r[t]},getWindowSize:function(){return{width:n.width(),height:n.height()}}});e(function(){t.DOM.scope=e("body")})}(BEM,jQuery),BEM.decl("i-bem__dom",{},{liveInitOnBlockInit:function(t,e){return this.liveInitOnBlockEvent("init",t,e)},liveInitOnBlockOutsideEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksInside")},liveInitOnChannelEvent:function(t,e,i){return this._liveInitOnEmitterEvent(BEM.channel(t),e,i)},liveInitOnDomlessBlockEvent:function(t,e,i){return this._liveInitOnEmitterEvent(BEM.blocks[t],e,i)},liveInitOnReactBusEvent:function(t,e){return Ya&&Ya.reactBus&&this._liveInitOnEmitterEvent(Ya.reactBus,t,e),this},_liveInitOnEmitterEvent:function(t,e,i){var n=this.buildSelector(),s=this.getName();return t.on(e,function(){var t=$(n);if(t.length){var e=arguments;t.each(function(t,n){var o=$(n).bem(s);"function"==typeof i&&i.apply(o,e)})}}),this},liveInitOnBlockInsideElemEvent:function(t,e,i,n){var s=this.buildSelector(t);return this.liveInitOnBlockInsideEvent(e,i,function(t){"function"==typeof n&&t.target.domElem.parents(s).length>0&&n.apply(this,arguments)})},liveInitOnBlockElemEvent:function(t,e,i,n){var s=this.buildSelector(t);return this.liveInitOnBlockInsideEvent(e,i,function(t){"function"==typeof n&&t.target.domElem.is(s)&&n.apply(this,arguments)})},liveBindToWin:function(t,e){return this._liveInitOnEmitterEvent(this.win,t,e)},liveBindToDoc:function(t,e){return this._liveInitOnEmitterEvent(this.doc,t,e)}}),function(t){var e=t(window),i=s(),n=o();function s(){return window.innerHeight|0+e.outerHeight()}function o(){return window.innerWidth|0+e.outerWidth()}(t.event.special.resize||(t.event.special.resize={})).preDispatch=function(t){var e=s(),r=o();if(n===r&&i===e)return!1;i=e,n=r}}(jQuery),function(){var t=!1,e=[];BEM.channel("i-bem").on("init",function(){t=!0;for(var i=0;i<e.length;i++)e[i]()}),BEM.decl("i-bem__dom",{},{decl:function(t,e,i){var n=this.__base.apply(this,arguments);if("string"==typeof t)return n;if(i&&!1===i.liveMod){var s=t.block||t.name;t.modVal?this._liveModList.push({block:s,selector:".i-bem."+BEM.INTERNAL.buildClass(s,t.modName,t.modVal)}):this._liveModList.unshift({block:s,selector:'.i-bem[class*="'+BEM.INTERNAL.buildClass(s,t.modName,!0)+'"]'})}return n},_liveModList:[],ready:function(i){t?i():e.push(i)},_initAdvanced:function(){BEM.channel("i-bem").trigger("start-init"),this.init();for(var t=this._liveModList,e=0;e<t.length;e++){var i=t[e],n=$(i.selector);n.length&&n.each(function(t,e){$(e).bem(i.block)})}BEM.channel("i-bem").trigger("init")}})}(),$(function(){BEM.afterCurrentEvent(function(){BEM.DOM._initAdvanced()})}),jQuery.cookie=function(t,e,i){if(void 0===e){var n=null;if(document.cookie&&""!=document.cookie)for(var s=document.cookie.split(";"),o=0;o<s.length;o++){var r=jQuery.trim(s[o]);if(r.substring(0,t.length+1)==t+"="){n=decodeURIComponent(r.substring(t.length+1));break}}return n}i=i||{},null===e&&(e="",i.expires=-1);var a,h="";i.expires&&("number"==typeof i.expires||i.expires.toUTCString)&&("number"==typeof i.expires?(a=new Date).setTime(a.getTime()+24*i.expires*60*60*1e3):a=i.expires,h="; expires="+a.toUTCString());var c=i.path?"; path="+i.path:"",l=i.domain?"; domain="+i.domain:"",u=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),h,c,l,u].join("")},function(t){var e={"%D0":"%D0%A0","%C0":"%D0%90","%C1":"%D0%91","%C2":"%D0%92","%C3":"%D0%93","%C4":"%D0%94","%C5":"%D0%95","%A8":"%D0%81","%C6":"%D0%96","%C7":"%D0%97","%C8":"%D0%98","%C9":"%D0%99","%CA":"%D0%9A","%CB":"%D0%9B","%CC":"%D0%9C","%CD":"%D0%9D","%CE":"%D0%9E","%CF":"%D0%9F","%D1":"%D0%A1","%D2":"%D0%A2","%D3":"%D0%A3","%D4":"%D0%A4","%D5":"%D0%A5","%D6":"%D0%A6","%D7":"%D0%A7","%D8":"%D0%A8","%D9":"%D0%A9","%DA":"%D0%AA","%DB":"%D0%AB","%DC":"%D0%AC","%DD":"%D0%AD","%DE":"%D0%AE","%DF":"%D0%AF","%E0":"%D0%B0","%E1":"%D0%B1","%E2":"%D0%B2","%E3":"%D0%B3","%E4":"%D0%B4","%E5":"%D0%B5","%B8":"%D1%91","%E6":"%D0%B6","%E7":"%D0%B7","%E8":"%D0%B8","%E9":"%D0%B9","%EA":"%D0%BA","%EB":"%D0%BB","%EC":"%D0%BC","%ED":"%D0%BD","%EE":"%D0%BE","%EF":"%D0%BF","%F0":"%D1%80","%F1":"%D1%81","%F2":"%D1%82","%F3":"%D1%83","%F4":"%D1%84","%F5":"%D1%85","%F6":"%D1%86","%F7":"%D1%87","%F8":"%D1%88","%F9":"%D1%89","%FA":"%D1%8A","%FB":"%D1%8B","%FC":"%D1%8C","%FD":"%D1%8D","%FE":"%D1%8E","%FF":"%D1%8F"};function i(t,i){var n="";try{n=t(i)}catch(s){try{n=t(function(t){return t.replace(/%.{2}/g,function(t){return e[t]||t})}(i))}catch(t){n=i}}return n}jQuery.extend({decodeURI:function(t){return i(decodeURI,t)},decodeURIComponent:function(t){return i(decodeURIComponent,t)}})}(),BEM.DOM.decl("i-global",{onSetMod:{js:{inited:function(){this.del(this.__self._params=$.extend({},this.params),"uniqId","name");var t=this.__self._params;t["passport-msg"]||(t["passport-msg"]=t.id),void 0===t["show-counters"]&&(t["show-counters"]=Math.round(100*Math.random())<=t["show-counters-percent"]),t.locale=t.lang,window.BEMHTML&&BEMHTML.apply({block:"i-global",params:t})}}},getDefaultParams:function(){return{id:"",login:this.__self.getCookie("yandex_login")&&$.cookie("yandex_login")||"",yandexuid:$.cookie("yandexuid"),lang:"ru",tld:"ru",retpath:encodeURI($.decodeURI(location.href)),"passport-host":"https://passport.yandex.ru","pass-host":"https://pass.yandex.ru","social-host":"https://social.yandex.ru","lego-path":"/lego","show-counters-percent":100}}},{param:function(t,e){if(void 0===e)return(this._params||{})[t];this._params&&(this._params[t]=e)},getCookie:function(t){var e=document.cookie;if(e.length<1)return!1;var i=e.indexOf(t+"=");if(-1===i)return!1;i+=t.length+1;var n=e.indexOf(";",i);return decodeURIComponent(-1===n?e.substring(i):e.substring(i,n))}}),BEM.DOM.decl("i-global",{},{setParams:function(t){this._params=this._params||{},$.extend(!0,this._params,t)},getBlockParams:function(t,e){var i=$(t).data("bem");return!!i&&i[e]}}),BEM.DOM.decl("i-global",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._reactBusConnected=!1,BEM.channel("i-react-bus").on("loaded",this.reactBusLoaded,this),this.reactBusLoaded()}}},reactBusLoaded:function(){window.Ya&&window.Ya.reactBus&&!this._reactBusConnected&&(this._reactBusConnected=!0,Ya.reactBus.emit("i-global:update",this.__self.getParams),Ya.reactBus.on("i-global:get-params",function(t){"function"==typeof t&&t(this.__self.getParams())},this))}},{setParams:function(t){var e=this.__base.apply(this,arguments);return this._params=this._params||{},window.Ya.reactBus&&window.Ya.reactBus.emit("i-global:update",this._params),e},getParams:function(){return this._params=this._params||{}}}),BEM.decl("i-global__utils",{},{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",base64Encode:function(t,e){e=e||1e6;var i,n,s,o,r,a,h,c="",l=0;for(t=this._utf8_encode(t,3*e/4|0);l<t.length;)o=(i=t.charCodeAt(l++))>>2,r=(3&i)<<4|(n=t.charCodeAt(l++))>>4,a=(15&n)<<2|(s=t.charCodeAt(l++))>>6,h=63&s,isNaN(n)?a=h=64:isNaN(s)&&(h=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(h);return c},_utf8_encode:function(t,e){t=t.replace(/\r\n/g,"\n");for(var i,n="",s=0;s<t.length;s++){var o=t.charCodeAt(s);if(o<128?i=String.fromCharCode(o):o>127&&o<2048?(i=String.fromCharCode(o>>6|192),i+=String.fromCharCode(63&o|128)):(i=String.fromCharCode(o>>12|224),i+=String.fromCharCode(o>>6&63|128),i+=String.fromCharCode(63&o|128)),n.length+i.length>e)break;n+=i}return n},decodeEntities:function(t){return t.replace(/&(lt|gt|quot|apos|amp);/g,function(t,e){return{lt:"<",gt:">",quot:'"',apos:"'",amp:"&"}[e]})},ampUnescape:function(t){return"string"==typeof t?t.replace(/\&amp;/g,"&"):""},ampUnescapeInHTMLContent:function(t){return"string"==typeof t?t.replace(/(>[^<]+&amp;[^>]+<)/g,this.ampUnescape):""}}),BEM.DOM.decl("i-global",{},{getFlag:function(t){var e=this.param("expFlags");return e||(e=this.getBlockParams(this.buildSelector(),this.getName()).expFlags||{},this.setParams({expFlags:e})),e[t]}}),BEM.decl("offline-request",{_isOnline:!0,_initOffline:function(){this._isOnline=this.__self.isOnline(),this.bindEvents()},bindEvents:function(){this.__base.apply(this,arguments),this._onOnline=this._onOnline.bind(this),this._onOffline=this._onOffline.bind(this),window.addEventListener("online",this._onOnline),window.addEventListener("offline",this._onOffline)},unbindEvents:function(){window.removeEventListener("online",this._onOnline),window.removeEventListener("offline",this._onOffline),this.__base.apply(this,arguments)},_onOnline:function(){this._isOnline=!0,this._onChangeNetworkStatus(!0)},_onOffline:function(){this._isOnline=!1,this._onChangeNetworkStatus(!1)},_onChangeNetworkStatus:$.noop},{_isOnlineDetectAllowed:void 0!==window.navigator.onLine,isOnline:function(){return!this._isOnlineDetectAllowed||window.navigator.onLine}}),BEM.decl({block:"counter",baseBlock:"offline-request"},{_dict:{}}),function(){var t={all:"136",auto:"227",action:"689",any:"146",ajax:"1201",big:"148",bing:"568",black:"201",blocks:"3626",blue:"198",bottom:"668",bw:"666",cbir:"1031",ces:"1057",clear:"477",click:"882",clipart:"758",close:"486",color:"169",commercial:"2043",contacts:"1802",copyright:"1305",collections:"2177",customize:"178",cyan:"197",demotivator:"760",duplicates:"269",empty:"233",face:"276",facebook:"520",fade:"1059",favorite:"1084",filter:"220",filters:"618",format:"675",fotki:"174",fresh:"598",fullscreen:"665",gif:"677",google:"66",gray:"733",green:"196",grid:"3223",horizontal:"672",image:"8",images:"277",imgclick:"835",index:"629",iorient:"671",isize:"145",jpg:"676",keyboard:"492",large:"157",lineart:"759",likeness:"2929",list:"436",medium:"149",message:"1304",moderate:"681",more:"75",less:"585",mouse:"491",navig:"208",new:"228",next:"407",normal:"141",nps:"1056",odnoklassniki:"526",off:"11",on:"10",open:"842",orange:"194",othersize:"924",p0:"85",p1:"86",p10:"95",p11:"96",p12:"97",p13:"98",p14:"99",p15:"100",p16:"101",p17:"102",p18:"103",p19:"104",p2:"87",p20:"105",p3:"88",p4:"89",p5:"90",p6:"91",p7:"92",p8:"93",p9:"94",page:"143",partner:"1219",photo:"275",photostock:"3076",picsearch:"173",pinterest:"1009",play:"331",png:"679",polaroid:"3998",prev:"406",preview:"670",promo:"714",price:"2506",red:"193",related_query:"391",result:"884",results:"241",save:"691",shown:"3780",scroll:"768",search:"153","search-by-image":"1277",serp:"471",share:"599",shop:"1055",show:"487",hide:"1656",similar:"469",site:"202",sitelink:"1789",slideshow:"479",small:"150",soo:"65",stripe:"707",square:"674",stop:"529",tags:"2092",thumb:"184",top:"77",twitter:"521",type:"76",upload_photo:"209",url:"13",user:"538",vertical:"673",violet:"199",visiblefresh:"639",vkontakte:"496",wallpaper:"158",wallpaper_category:"1129",week:"796",white:"200",yellow:"195",video:"231",maps:"23",market:"4",market_offers:"500",music:"56",load:"1724",loaded:"1007",ads:"991",categories:"1429",submit:"297",width:"1473",height:"1474",time:"207",timing:"1033",hover:"858",abuse:"1436",sticky:"1578",pad:"1667",perf:"2096",footer:"295",default_search:"1620",popular:"1465",popup_close:"1781",popup:"1544",success:"2052",reject:"2464",porno:"1499",error:"1030",install:"705",inline_home_set:"1918",incut:"1073",behavioral:"1999",context:"60",item:"22",title:"82",link:"513",button:"440",direct:"155",direct_gallery:"2056",browser_yandex:"935",disk:"1032",discard:"2737",disclaimer:"2538",radio:"1079",mobile:"1006",mobile_browsers_ipad:"1013",mobile_browsers_android:"1014",thmb_speed:"1045",wp:"895",element:"1518",set:"1920",inline_set:"1651",home:"1319",inline_home:"1870",vb:"1921",inline_vb:"1652",middle:"2028",head:"175",header:"183",login:"290",login_input:"2343",suggest:"695",mail:"176",drag:"778",size:"506",crop:"2754",reset:"3236",cancel:"1478",related:"1108",rim:"2593",point:"849",is_visible:"397",onboarding:"2045",yes:"1176",no:"1177",querysearch:"955",start:"2154",desktop:"2048",bundles:"2960","load-ajax-error":"2961",end:"1428",my:"2189",lenta:"1217",theme:"1066",like:"1240",add:"160",card:"875",tvonline:"2984",schemaorg:"2998",smartbanner:"1602",tech:"690",ocr:"2363",copy:"1276",translate:"575","qr-code":"855","object-answer":"1155",othersizes:"923",toggle:"237",panel:"843",recognize:"3997",text:"232",ugc:"2139",rating:"1348",answer:"1534",resolve:"2928",send:"2574",scroll_top:"3737",input:"1173",landing:"1865","image-snippet":"793",meta:"156",file:"2958",readmore:"1867"};"undefined"!=typeof BEM&&BEM.decl({block:"counter",baseBlock:"offline-request"},{_dict:t}),"undefined"!=typeof exports&&(exports.dict=t)}(),BEM.decl("counter",{HIT_DELAY:200,onSetMod:{js:{inited:function(){window.Ya=window.Ya||{},window.Ya.counter=this,window.c=this,window.w=this.w,window.cp=this.cp,window.rc=this.redir}}},_onChangeNetworkStatus:function(t){var e;if(t&&this._countersCache)for(var i in this._countersCache)this._countersCache.hasOwnProperty(i)&&"error"===this._countersCache[i].status&&((e=this._countersCache[i]).status="pending",this._req(e.params))},_getExtParams:function(t){var e=BEM.blocks.location.getInstance().getState(),i=BEM.blocks["i-global"],n=t&&t.path&&this.getPath(t.path),s=i.param("counterParams")||{},o=s.click,r={};return n&&(0===n.indexOf("690")&&(o=s.tech),0!==n.indexOf("690.2096")&&0!==n.indexOf("690.1033")&&0!==n.indexOf("690.1201")||(o=s.perf),o&&(r=$.extend(o,r))),i.param("isYandexApp")&&(r.uuid=BEM.blocks.utils.get(e,"params.uuid.0")),t&&"iweb"===t.dtype&&"origin"===i.param("metaReferrerContent")&&!i.getFlag("mm_referrer_origin_disable_iweb")&&(r.ref=encodeURIComponent(e.url)),r.cts=t&&t.cts?t.cts:Date.now(),r},redir:function(t,e){var i=t.href;e=e.replace(/=8(?=&|$)/,"=0"),t.href=e,BEM.blocks["i-global"].param("isIntegrationTest")||setTimeout(function(){t.href=i},500),window.c.addMetrikaCookie(t)},w:function(t,e,i){var n=window.Ya.counter;e&&n.hit({path:e,vars:n._getVars(i),dtype:"iweb"},t)},wHitDelayed:function(t,e,i){setTimeout(function(){c.w(t,e,i)},this.HIT_DELAY)},cp:function(t,e){t.path&&(t.dtype="stred",window.Ya.counter.hit(t,e))},cpHitDelayed:function(t,e){setTimeout(function(){c.cp(t,e)},this.HIT_DELAY)},hit:function(t,e){var i,n=e&&(e.onclick||e.ondblclick);if(n&&"object"==typeof(i=n())&&$.extend(t,i.counter__params),$.extend(t,this._getExtParams(t)),t.path){t.path=this.getPath(t.path);var s=this.getUrl(t,e);t.resultUrl=s,t.href=e&&e.href,t.reqid=t.reqid||this.getReqId(e),this.log(t),this.makeReq(s)}"iweb"===t.dtype&&(e||t.redirUrl)&&this.addMetrikaCookie(e,t.redirUrl)},hitDelayed:function(t,e){t&&(t.cts=t.cts||Date.now()),setTimeout(function(){c.hit(t,e)},this.HIT_DELAY)},log:function(t){BEM.blocks.counter.debug("counter",{pid:t.pid,cid:t.cid,url:t.resultUrl,path:t.path,decoded:this.getHumanText(t.path),vars:t.vars,href:t.href,reqid:t.reqid,referer:location.href})},makeReq:function(t){var e={id:this.__self._reqNum++,status:"pending",params:{url:t,cache:!0,dataType:"script"}};this._req(e.params)},_req:function(t){$.ajax(t)},getUrl:function(t,e){var i=$.extend({rnd:BEM.blocks.utils.getRnd(2),yuid:this.getUid(),reqid:t.reqid||this.getReqId(e),serpid:t.serpid||this.getSerpId()},t),n=this.stringifyParams(i,"/");return[location.protocol,"//",this.getClickHost(),"/","jclck","/",n,"/*",this._getAsterixData(e)].join("")},_getVars:function(t){return"object"==typeof t?this.stringifyParams(t,","):t},getReqId:function(t){var e,i=BEM.blocks["i-global"],n=i.param("reqid")||i.param("serpid")||"";return t&&((e=$(t).closest(".counter__reqid")).length?BEM.DOM.extractParams(e[0]).counter__reqid:{}).reqid||n},getSerpId:function(){return BEM.blocks["i-global"].param("serpid")},getUid:function(){return BEM.blocks["i-global"].param("yandexuid")},getClickHost:function(){return BEM.blocks["i-global"].param("click-host")},_getAsterixData:function(t){var e=t&&t.href?t.href:location.href;return 0===e.indexOf("//")?location.protocol+e:"/"===e.charAt(0)?location.origin+e:e},stringifyParams:function(t,e){e=e||"&";var i,n=[],s=/\//g;return Object.keys(t).forEach(function(e){void 0!==(i=t[e])&&""!==i&&null!==i&&n.push(e+"="+String(i).replace(s,"%2F"))},this),n.join(e)},getPath:function(t){return"/"===t[0]&&this._dict&&this._decodePath(t)||t},_decodePath:function(t){var e=t.split("/").slice(1),i=this._dict;return i&&e.length&&e.map(function(t){return i[t]||t}).join(".")},decodeBlockstatKey:function(t){var e;return Object.keys(this._dict).some(function(i){if(this._dict[i]===t)return e=i,!0},this),e||t},getHumanText:function(t){return"/"+t.split(".").map(this.decodeBlockstatKey.bind(this)).join("/")},_getMetrikaCookieHostname:function(t){var e=t.hostname;return e.match(/^(www\.)?yandex\.(ru|kz|by|ua|com|com\.tr|net|fr)$/)?e+t.pathname:e},_getMetrikaCookieSource:function(t){var e=document.location,i=(e.search.match(/[?&]text=([^&]*)/)||[])[1];if(!t||!t.hostname)return"";i||(i=""),i=decodeURIComponent(i);var n=this._getMetrikaCookieHostname(t),s=BEM.blocks["i-global"].param("reqid");return[i,n,e.pathname,s].map(encodeURIComponent).join(":")},_getMetrikaCookieSourceFromRedir:function(t){var e=BEM.blocks.uri.parse(t);return this._getMetrikaCookieSource({hostname:e.host(),pathname:e.path()})},addMetrikaCookie:function(t,e){var i=BEM.blocks["i-global"],n="";if(("origin"===i.param("metaReferrerContent")||i.getFlag("mm_metrika_cookie_apps"))&&(n=e?this._getMetrikaCookieSourceFromRedir(e):this._getMetrikaCookieSource(t))){var s=Date.now(),o=new Date(6e5+s).toUTCString(),r=i.param("enableSamesiteSc");document.cookie="sc_"+s+"="+n+";path=/watch;domain=."+location.hostname.replace(/^www\./,"")+";expires="+o+(r?";SameSite=None":"")+";secure"}}},{_reqNum:0,debug:function(t,e){var i=BEM.blocks["i-global"].param("counterDebug");i&&(e=e||"","undefined"!=typeof console&&"function"==typeof console.info&&(console.group("Счётчик "+t),"table"===i&&"function"==typeof console.table&&"object"==typeof e?(console.info("params:"),console.table(e)):console.info("params:",e),console.groupEnd("Счётчик "+t)),window.mm||(window.mm={}),window.mm.counters||(window.mm.counters=[]),window.mm.counters.push({name:t,params:e}))}}),BEM.create("counter"),BEM.decl("counter",{_getExtParams:function(t){var e=this.__base.apply(this,arguments);return BEM.blocks["i-global"].extendCounterParams(e),e},getReqId:function(t){var e=this.__base.apply(this,arguments),i=BEM.blocks.utils.get(t,"0.className");return i&&BEM.DOM.extractParams(t[0])[i.split(" ")[0]].reqid||e}},{convertVarsToString:function(t){t||(t={});for(var e=Object.keys(t),i="",n=0,s=e.length;n<s;n++)n>0&&(i+=","),i+="-"+e[n]+"="+t[e[n]];return i}}),BEM.decl("uri",{onSetMod:{js:{inited:function(){var t=this;["protocol","host","port","path","anchor"].forEach(function(e){t[e]=function(t){return void 0!==t?(this.uriParts[e]=t,this):this.uriParts[e]}})}}},encode:function(t){return encodeURIComponent(t)},decode:function(t){try{t=decodeURIComponent(t)}catch(e){try{t=decodeURIComponent(this.convert(t))}catch(t){}}return t},convert:function(t){var e={"%D0":"%D0%A0","%C0":"%D0%90","%C1":"%D0%91","%C2":"%D0%92","%C3":"%D0%93","%C4":"%D0%94","%C5":"%D0%95","%A8":"%D0%81","%C6":"%D0%96","%C7":"%D0%97","%C8":"%D0%98","%C9":"%D0%99","%CA":"%D0%9A","%CB":"%D0%9B","%CC":"%D0%9C","%CD":"%D0%9D","%CE":"%D0%9E","%CF":"%D0%9F","%D1":"%D0%A1","%D2":"%D0%A2","%D3":"%D0%A3","%D4":"%D0%A4","%D5":"%D0%A5","%D6":"%D0%A6","%D7":"%D0%A7","%D8":"%D0%A8","%D9":"%D0%A9","%DA":"%D0%AA","%DB":"%D0%AB","%DC":"%D0%AC","%DD":"%D0%AD","%DE":"%D0%AE","%DF":"%D0%AF","%E0":"%D0%B0","%E1":"%D0%B1","%E2":"%D0%B2","%E3":"%D0%B3","%E4":"%D0%B4","%E5":"%D0%B5","%B8":"%D1%91","%E6":"%D0%B6","%E7":"%D0%B7","%E8":"%D0%B8","%E9":"%D0%B9","%EA":"%D0%BA","%EB":"%D0%BB","%EC":"%D0%BC","%ED":"%D0%BD","%EE":"%D0%BE","%EF":"%D0%BF","%F0":"%D1%80","%F1":"%D1%81","%F2":"%D1%82","%F3":"%D1%83","%F4":"%D1%84","%F5":"%D1%85","%F6":"%D1%86","%F7":"%D1%87","%F8":"%D1%88","%F9":"%D1%89","%FA":"%D1%8A","%FB":"%D1%8B","%FC":"%D1%8C","%FD":"%D1%8D","%FE":"%D1%8E","%FF":"%D1%8F"};return t=t.replace(/%.{2}/g,function(t){return e[t]||t})},normalize:function(t){return(t||"").replace(/\+/g,"%20")},parseUri:function(t){var e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)(?::(\d+|(?=:)))?:?)((((?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t||""),i={};return["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"].forEach(function(t,n){i[t]=e[n]||""}),i},parseQuery:function(t){var e,i,n,s,o,r={};if("string"!=typeof t||""===t)return r;for(i=t.replace("?","").split("&"),e=0;e<i.length;e++)n=[(n=i[e].split("=")).shift(),void 0!==n[0]?n.join("="):null],s=this.decode(n[0]),o=n[1]||""===n[1]?this.decode(n[1]):null,r[s]?(o||""===o)&&r[s].push(o):r[s]=null===o?[]:[o];return r},query:function(t){var e="";void 0!==t&&(this.queryParams=this.parseQuery(t));var i=this.queryParams,n=this;return Object.keys(i).forEach(function(t,s){s>0&&(e+="&"),"object"!=typeof i[t]||i[t].length?i[t].forEach(function(i,s){s>0&&(e+="&"),e+=n.encode(t)+"="+n.encode(i)}):e+=t}),e.length>0?"?"+e:e},getParam:function(t){return this.queryParams[t]},deleteParam:function(t,e){var i=[];return void 0!==e&&((this.queryParams[t]||[]).forEach(function(t){t!==e&&i.push(t)}),this.queryParams[t]=i),void 0!==e&&0!==i.length||delete this.queryParams[t],this},addParam:function(t,e){return this.queryParams[t]=(this.queryParams[t]||[]).concat(e),this},replaceParam:function(t,e,i){return this.deleteParam(t,i).addParam(t,e)},scheme:function(){var t="";return this.protocol()?(t+=this.protocol(),this.protocol().indexOf(":")!==this.protocol().length-1&&(t+=":"),t+="//"):this.host()&&(t+="//"),t},origin:function(){var t=this.scheme();return this.host()&&(t+=this.host(),this.port()&&(t+=":"+this.port())),t},getRoot:function(){var t=this.origin();return this.path()&&(t+=this.path().replace(/\/[^\/]*$/,"")),t},pathParts:function(){return this.path().split("/")},toString:function(){var t=this.origin();return this.path()?0!==this.path().indexOf("/")&&"/"!==t[t.length-1]?t+="/"+this.path():t+=this.path():this.host()&&(this.query().toString()||this.anchor())&&(t+="/"),this.query().toString()&&(0!==this.query().toString().indexOf("?")&&(t+="?"),t+=this.query().toString()),this.anchor()&&(0!==this.anchor().indexOf("#")&&(t+="#"),t+=this.anchor()),t},build:function(){var t="";return t+=this.protocol()?this.protocol():window.location.protocol,t+=t.indexOf(":")!==t.length-1?"://":"//",t+=this.host()?this.host():window.location.hostname,this.port()?t+=":"+this.port():!this.host()&&window.location.hostname&&(t+=":"+window.location.port),this.path()?t+=this.path():this.host()?t+="/":t+=window.location.pathname,this.query()&&(0!==this.query().indexOf("?")&&(t+="?"),t+=this.query()),this.anchor()&&(0!==this.anchor().indexOf("#")&&(t+="#"),t+=this.anchor()),t}},{parse:function(t){var e=BEM.create({block:"uri"});return e.uriParts=e.parseUri(e.normalize(t)),e.queryParams=e.parseQuery(e.uriParts.query),e},normalize:function(t){return this.parse(t).toString()}}),BEM.decl("uri",{},{_validUrlRegEx:new RegExp("^(?:(?:https?|ftp)://)(?:(?:(?:xn--)?(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:xn--)?(:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:xn--)?(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/[^\\s]*)?"),_acceptableUrlRegEx:/\S+\.\S{2,}/,setParam:function(t,e,i){void 0===i&&(i=e,e=t,t=BEM.blocks.location.getInstance().getState().url);var n=this.parse(t);return BEM.blocks.utils.isEmpty(i)?n.deleteParam(e).toString():n.queryParams[e]?n.replaceParam(e,i).toString():n.addParam(e,i).toString()},setParams:function(t,e){"object"==typeof t&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parse(t);return BEM.blocks.utils.forOwn(e,function(t,e){void 0===t?i.deleteParam(e):i.queryParams[e]?i.replaceParam(e,t):i.addParam(e,t)}),i.toString()},delParams:function(t,e){void 0===e&&Array.isArray(t)&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parse(t);return"string"==typeof e&&i.deleteParam(e),Array.isArray(e)&&e.forEach(function(t){i.deleteParam(t)}),i.toString()},filterParams:function(t,e){void 0===e&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parseParams(t);for(var n in i)i.hasOwnProperty(n)&&(e.call(this,n,i[n],t)||(t=this.delParams(t,n)));return t},buildRelativeUrl:function(t,e){return void 0===e&&"object"==typeof t&&(e=t,t=BEM.blocks.location.getInstance().getState().url),!e||BEM.blocks.utils.isEmpty(e)?t:(e=Array.isArray(e)?[].concat(e):$.extend({},e),e=$.param(e,!0),BEM.blocks.uri.normalize(t+"?"+e))},parseParams:function(t){return void 0===t&&(t=BEM.blocks.location.getInstance().getState().url),this.parse(this.clearHashSymbol(t)).queryParams},getFlatParams:function(t){var e=this.parseParams(t),i={};return BEM.blocks.utils.forOwn(e,function(t,e){i[e]=1===t.length?t[0]:t}),i},clearHashSymbol:function(t){return BEM.blocks.utils.isEmpty(t)&&(t=BEM.blocks.location.getInstance().getState().url),t.replace(/[^\/]*\/?#!\//,"")},getPath:function(t){return this.parse(t).path()},isValid:function(t){return this._validUrlRegEx.test(t)},isAcceptable:function(t){return this._acceptableUrlRegEx.test(t)},getParamValue:function(t,e){void 0===e&&(e=t,t=BEM.blocks.location.getInstance().getState().url);var i=this.parse(t).getParam(e);return"string"==typeof i?i:Array.isArray(i)?i[0]:void 0}}),BEM.blocks.utils=function(){throw new Error("This is static block")},BEM.blocks.utils.getRnd=function(t){return(new Date).getTime()+Math.floor(Math.random()*Math.pow(10,t))},BEM.blocks.utils.memoize=function(t){var e;return function(){return e||(e=t.apply(this)),e}},BEM.blocks.utils.forOwn=function(t,e,i){var n;for(n in t)if(t.hasOwnProperty(n)&&void 0!==e.call(i,t[n],n,t))return},BEM.blocks.utils.get=function(t,e,i){if(null===t||void 0===t||"string"!=typeof e)return i;var n,s=e.split("."),o=t,r=s.length;for(n=0;n<r;n++)if(null===(o=o[s[n]])||void 0===o)return i;return o},BEM.blocks.utils.escape=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},BEM.blocks.utils.unescape=function(t){return String(t).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},BEM.blocks.utils.isEmpty=function(t){if(null===t||void 0===t)return!0;if(t.length>0)return!1;if(0===t.length)return!0;for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0},BEM.blocks.utils.getPassportUrl=function(t,e){var i=BEM.blocks["i-global"].param("passport-host")+(BEM.blocks["i-global"].param("login")?"/passport?mode=passport":"/auth"),n=Math.floor(1e4*Math.random()),s=BEM.blocks.location.getInstance().getUri().replaceParam("ncrnd",n);return e&&Object.keys(e).forEach(function(t){s.replaceParam(t,e[t])}),BEM.blocks.uri.setParams(i,$.extend({retpath:s.toString()},t))},BEM.blocks.utils.EMAIL_PATTERN=/[^@]+@[^.]+\..{2,}/i,BEM.blocks.utils.isValidEmail=function(t){return this.EMAIL_PATTERN.test(t)},BEM.blocks.utils.getHash=function(t){var e=0;if(0===t.length)return e;for(var i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e&=e;return Math.abs(e)},Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,i=Object(this),n=i.length>>>0,s=arguments[1],o=0;o<n;o++)if(e=i[o],t.call(s,e,o,i))return e}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t){"use strict";if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var s=Object.keys(Object(n)),o=0,r=s.length;o<r;o++){var a=s[o],h=Object.getOwnPropertyDescriptor(n,a);void 0!==h&&h.enumerable&&(e[a]=n[a])}}return e}}),Number.isNaN||(Number.isNaN=function(t){return"number"==typeof t&&isNaN(t)}),BEM.DOM.decl("i-global",{},{extendCounterParams:function(t){switch(t||(t={}),this.param("page")){case"index":t.service="portal.yandex";break;case"search":t.service="images.yandex";break;case"search-by-image":case"cbir-products":case"similar":case"ocr":t.service="cbir.yandex";break;default:t.service="yandex"}return this.param("isYandexApp")?t.ui="webmobileapp.yandex":this.param("tablet")?t.ui=encodeURIComponent("images.yandex/pad"):this.param("mobile")?t.ui=encodeURIComponent("images.yandex/touch"):t.ui="images.yandex",t}}),function(){var t;function e(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16)})}function i(t){return decodeURIComponent(t)}BEM.decl("i-cookie",{defaultExpires:Math.round(new Date/1e3)+604800,getExpirationDate:function(t){return Math.round(Date.now()/1e3+24*t*60*60)},getDefaultParams:function(){return{yp:{expires:new Date("Tue Jan 1 00:00:00 2038"),domain:".yandex."+BEM.blocks["i-global"].param("tld"),path:"/"},ys:{domain:".yandex."+BEM.blocks["i-global"].param("tld"),path:"/"}}},ypRead:function(){for(var t=$.cookie("yp"),e=t?t.split("#"):[],n=new Date/1e3,s={},o=0,r=e.length;o<r;o++){var a=e[o].split("."),h=a[0],c=a[1],l=a.slice(2).join(".");h>n&&(s[c]={value:i(l),expires:h})}return s},ypWrite:function(t){for(var i,n=[],s=0,o=Object.keys(t),r=o.length;s<r;s++)i=t[o[s]],n.push([i.expires,o[s],!1===i.encode?i.value:e(i.value)].join("."));$.cookie.set("yp",n.join("#"),this.params.yp)},ypRemove:function(t){var e=this.ypRead();t&&e[t]&&(delete e[t],this.ypWrite(e))},yp:function(t,e,i){var n={};"object"==typeof t&&(t=(n=t).name,e=n.value,i=n.expires);var s=this.ypRead(),o=s[t];return void 0===e?o&&o.value:(o||(o={}),o.value=e,o.expires=i||o.expires||this.defaultExpires,o.encode=n.encode,s[t]=o,this.ypWrite(s))},ysRead:function(){var t=$.cookie("ys"),e={};return(t?t.split("#"):[]).forEach(function(t){var n=t.split("."),s=n[0],o=n.slice(1).join(".");e[s]=i(o)}),e},ysWrite:function(t){for(var i=[],n=0,s=Object.keys(t),o=s.length;n<o;n++)i.push([s[n],e(t[s[n]])].join("."));$.cookie.set("ys",i.join("#"),this.params.ys)},ys:function(t,e){var i=this.ysRead();return e?(i[t]=e,this.ysWrite(i)):i[t]}},{get:function(){return t||(t=BEM.create("i-cookie"))}})}(),jQuery.cookie=function(){var t=function(e,i,n){if(void 0===i){var s=t.get(e);return s?decodeURIComponent(s):null}t.set(e,encodeURIComponent(i),n)};return $.extend(t,{get:function(t){return this.getAll()[t]},getAll:function(){for(var t=this.readCookie(),e=t?t.split("; "):[],i={},n=0;n<e.length;n++){var s=e[n].split("="),o=s[0],r=s.slice(1).join("=");'"'===r.charAt(0)&&(r=r.slice(1,-1)),i[o]=r}return i},set:function(t,e,i){var n,s;i||(i={}),"number"==typeof(n=i.expires)&&(n=new Date(Date.now()+24*n*60*60*1e3)),s=[t,"=",e,n&&"; expires="+n.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure?"; secure":""].join(""),this.writeCookie(s)},remove:function(t){this.set(t,"",{expires:-1})},readCookie:function(){return document.cookie},writeCookie:function(t){document.cookie=t}}),t}(),Ya.reactBus=Ya.reactBus||function(){var t=function(){var t={exports:{}};function e(){}return e.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var n=this;function s(){n.off(t,s),e.apply(i,arguments)}return s._=e,this.on(t,s,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,s=i.length;n<s;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],s=[];if(n&&e)for(var o=0,r=n.length;o<r;o++)n[o].fn!==e&&n[o].fn._!==e&&s.push(n[o]);return s.length?i[t]=s:delete i[t],this}},t.exports=e,t.exports.TinyEmitter=e,t.exports}();return(0,{reactBus:function(t){var e=[],i=t.emit,n=!1;return t.emit=function(){return e.push(Array.prototype.slice.call(arguments)),t},BEM.DOM.ready(function(){if(window.BEM&&!n)return n=!0,t.emit=i,e.forEach(function(e){t.emit.apply(t,e)}),e.length=0,!0}),t}}.reactBus)(new t)}(),BEM.channel("i-react-bus").trigger("loaded"),function(t,e){var i={};/msie|trident/i.test(e)?i.ie=parseInt(e.split(/msie|rv:/i)[1],10):-1!==e.indexOf("Opera")?i.opera=parseInt(e.split(/Version\//i)[1],10):"undefined"!=typeof InstallTrigger&&-1!==e.indexOf("Firefox")&&(i.firefox=parseInt(e.split(/Firefox\//)[1],10));var n,s={},o={};(n=e.match(/Windows\sPhone[^\d]*\s([\d.]+)/))?s.wp=n[1]:(n=e.match(/Android\s+([\d.]+)/))?s.android=n[1]:e.match(/\sHTC[\s_].*AppleWebKit/)?s.android="2.3":(n=e.match(/iPhone\sOS\s([\d_]+)/))?(s.ios=n[1].replace(/_/g,"."),o.iphone=!0):(n=e.match(/iPad.*OS\s([\d_]+)/))?(s.ios=n[1].replace(/_/g,"."),o.ipad=!0):(n=e.match(/Bada\/([\d.]+)/))?s.bada=n[1]:(n=e.match(/MSIE\s9/))?s.wp="7.5":s.other=!0,BEM.DOM.decl("i-ua",{onSetMod:{js:{inited:function(){var t=this.__self,e="other";["ios","android","bada","wp","opera"].some(function(i){return t[i]&&(e=i)}),this.setMod("platform",e)}}},setVersion:function(){var t=this.parseVersion();t&&(this.setMod(t.platform,t.major),this.setMod(t.platform+"-subversion",t.subversion))},parseVersion:function(){if(this.__self.ios||this.__self.android){var t=(this.__self.ios||this.__self.android).split("."),e=t.shift(),i=t.join("-");return{platform:this.getMod("platform"),major:e,subversion:i}}}},{ios:s.ios,iphone:o.iphone,ipad:o.ipad,android:s.android,bada:s.bada,wp:s.wp,other:s.other,ua:e,ie:i.ie,opera:i.opera,firefox:i.firefox})}(window,navigator.userAgent||""),function(){var t,e;BEM.decl("i-ua",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.__self.wp&&this.afterCurrentEvent(function(){var t=document.querySelector("html"),e=t.getAttribute("class").replace("i-ua_inlinesvg_no","i-ua_inlinesvg_yes");t.setAttribute("class",e)})}}}},{canUseCSSAnimation:function(){var t=document.createElement("div"),e="Webkit Moz O ms Khtml".split(" ");if(void 0!==t.style.animationName)return!0;for(var i=0;i<e.length;i++)if(void 0!==t.style[e[i]+"AnimationName"])return!0;return!1},hasHistoryAPI:Boolean(window.history&&history.pushState),canUseAjax:function(){return void 0===t&&(t="function"==typeof(window.History||window.history||{}).replaceState&&this.isCookieEnabled()),t},isCookieEnabled:function(){if(void 0===e){var t=Math.random().toString(16).slice(2);document.cookie=t+"=1",e=document.cookie.indexOf(t)>=0,document.cookie=t+"=;expires="+new Date(0).toGMTString()}return e},getTransitionEndEvent:BEM.blocks.utils.memoize(function(){var t={webkitTransition:"webkitTransitionEnd",OTransition:"otransitionend",mozTransition:"transitionend",transition:"transitionend"};for(var e in t)if(t.hasOwnProperty(e)&&void 0!==document.body.style[e])return t[e];return"transitionend"}),isPointerEventsAvailable:BEM.blocks.utils.memoize(function(){return void 0!==document.body.style.pointerEvents}),isCopySupported:function(){return void 0===this._isCopySupported&&(this._isCopySupported="getSelection"in window&&"queryCommandSupported"in document&&"execCommand"in document&&document.queryCommandSupported("copy")),this._isCopySupported},getConnectionType:function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return t?t.type:""},isYandexAppIos:function(){return/YaApp_iOS/.test(navigator.userAgent)},isYandexAppAndroid:function(){return/YandexSearch/.test(navigator.userAgent)},isFirefox:"undefined"!=typeof InstallTrigger})}(),BEM.DOM.decl("i-ua",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._detectIE11()}}},_detectIE11:function(){11===BEM.blocks["i-ua"].ie&&this.setMod("browser","ie11")}}),function(t,e){var i,n={},s={},o={},r={},a=t.innerWidth>t.innerHeight;e.match(/Android\s+([\d.]+)/)?(i=e.match(/Android\s+([\d.]+)/),n.android=i[1]):e.match(/\sHTC[\s_].*AppleWebKit/)?n.android="2.3":e.match(/iPhone\sOS\s([\d_]+)/)?(i=e.match(/iPhone\sOS\s([\d_]+)/),n.ios=i[1].replace(/_/g,"."),o.iphone=!0):e.match(/iPad.*OS\s([\d_]+)/)?(i=e.match(/iPad.*OS\s([\d_]+)/),n.ios=i[1].replace(/_/g,"."),o.ipad=!0):e.match(/Bada\/([\d.]+)/)?(i=e.match(/Bada\/([\d.]+)/),n.bada=i[1]):e.match(/Windows\sPhone[^\d]*\s([\d.]+)/)?(i=e.match(/Windows\sPhone[^\d]*\s([\d.]+)/),n.wp=i[1]):e.match(/MSIE\s9/)?n.wp="7.5":n.other=!0,e.match(/\s(CrMo|Chrome)\/([\d.]+)/)&&(i=e.match(/\s(CrMo|Chrome)\/([\d.]+)/),s.chrome=i[2]),BEM.decl("i-ua",{onSetMod:{js:function(){this.__base.apply(this,arguments);var t=this.__self;this.setMod("platform",t.ios?"ios":t.android?"android":t.bada?"bada":t.wp?"wp":t.opera?"opera":"other").setMod("ios",t.ios?parseInt(t.ios,10):"").setMod("android",t.android?parseInt(t.android,10):"")}}},{ua:e,ios:n.ios,iphone:o.iphone,ipad:o.ipad,android:n.android,bada:n.bada,wp:n.wp,other:n.other,chrome:s.chrome,screenSize:screen.width>320?"large":screen.width<320?"small":"normal",connection:r.connection,flash:r.flash,video:r.video,svg:r.svg,width:t.innerWidth,height:t.innerHeight,landscape:a})}(window,navigator.userAgent),function(t){var e=t.documentElement.style;BEM.DOM.decl("i-ua",{},{objectFit:"objectFit"in e||"OObjectFit"in e})}(document),function(t){var e=1,i=!1;if("deviceXDPI"in screen&&"logicalXDPI"in screen?e=screen.deviceXDPI/screen.logicalXDPI:"devicePixelRatio"in t&&(e=t.devicePixelRatio),"function"==typeof t.matchMedia){i=t.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 124dpi)").matches}else i=e>=1.3;BEM.DOM.decl("i-ua",{},{dpr:e,hiDpi:i})}(window),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.findBlocks(),this.bindEvents(),this._loadAsyncBundles(),BEM.blocks["i-global"].setParams({hasHistoryAPI:Boolean(window.history&&history.pushState)})}}},findBlocks:$.noop,bindEvents:function(){return this.bindToWin("blur",$.throttle(function(){this.trigger("blur")},150,this)),this.bindToWin("resize orientationchange",$.throttle(this._onResize,200,this)),this.bindToWin("resize orientationchange",$.debounce(this._onResize,800)),this.bindToWin("scroll",$.throttle(this._onDomScroll,200,this)),this},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onResize:function(){this.trigger("resize")},_onDomScroll:function(){var t=this;window.requestAnimationFrame(function(){t.trigger("scroll")})},getSeo:function(){return this.params.seo},_loadAsyncBundles:function(){BEM.blocks["i-global"].param("pushBundleAsyncOnInit").forEach(function(t){BEM.blocks["i-bundle-async"].load(t)})},updateTitle:function(t){var e=document.createElement("i");e.innerHTML=t,document.title=e.firstChild&&e.firstChild.nodeValue||e.nodeValue||""},_getFilterParams:$.noop},{getInstance:function(){return this._instance||(this._instance=BEM.DOM.scope.bem("b-page")),this._instance}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.findBlocks(),BEM.blocks["i-global"].param("isPumpkin")&&BEM.blocks.header.getSearch().fill(BEM.blocks.uri.getParamValue("text"))}}},findBlocks:function(){return this._header=this.findBlockInside("header"),this._headerHeight=0,this._header&&(this._headerHeight=this._header.getHeight()),this},bindEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["i-global"].param("mobile")&&this.bindToWin("touchmove",$.throttle(this._onTouchMove,200,this)),this},_onTouchMove:function(){this.trigger("touchmove")},_getCachedTabs:function(){return this.tabsNavigation||this._getTabs()},_getTabs:function(){return this.tabsNavigation=this.findBlockInside("tabs-navigation"),this.tabsNavigation}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._initAtom(),window.Ya.reactBus&&window.Ya.reactBus.on("images-viewer:beforeOpen",this._beforePaneOpen,this).on("images-viewer:beforeClose",this._beforePaneClose,this)}}},unbindEvents:function(){return this.__base.apply(this,arguments),window.Ya.reactBus.off("images-viewer:beforeOpen",this._beforePaneOpen).off("images-viewer:beforeClose",this._beforePaneClose),this},_initAtom:function(){this.params.isDistributionNeeded&&!BEM.blocks["i-global"].param("isPumpkin")&&BEM.blocks.atom.initStripe({zIndex:50})},_beforePaneOpen:function(){var t=this._getCachedTabs(),e=this.blockInside({block:"fade",modName:"region",modVal:"main"});return t&&t.hide(),e&&(e.coverTabs(),e.coverHeader()),this.delMod("scroll"),this._saveSerpListWidth(),this.disableScroll(),this},_saveSerpListWidth:function(){this._serpListWidthBeforeOpenPane=this._getSerpListWidth()},_getSerpListWidth:function(){var t=this.findBlockInside("serp-list");return t&&t.domElem?t.domElem.width():null},_beforePaneClose:function(t){var e=this._getCachedTabs(),i=this.blockInside({block:"fade",modName:"region",modVal:"main"});e&&this._getCachedTabs().show(),i&&i.coverPageLayout();var n=this._getSerpListWidth();return this.enableScroll(),BEM.blocks["navigation-controller"].get().scroll("down"),n&&this._serpListWidthBeforeOpenPane!==n&&this.findBlockInside("serp-list").reFitAllItems(),this},_getFilterParams:function(){var t=this.__base.apply(this,arguments)||[],e=BEM.blocks.location.getInstance().getState()||{};return t.push("p","ogl_url","rlt_url","img_url","pos","rpt","parent-reqid"),"b-page_type_similar"===e.block&&t.push("text","cbir_id"),t},findBlocks:function(){return this.__base.apply(this,arguments),this.cbirIntent=this.findBlockInside("cbir-intent"),this}},{forceOperaRepaint:function(){var t=document.body.style;t.position="static",setTimeout(function(){t.position="relative"},1)}}),function(t){if(!t)throw new Error("Rum: interface is not included");if(!t.enabled)return t.getSetting=function(){return""},t.getVarsList=function(){return[]},void(t.getResourceTimings=t.pushConnectionTypeTo=t.pushTimingTo=t.normalize=t.sendCounter=t.sendDelta=t.sendTimeMark=t.sendResTiming=t.sendTTI=t.makeSubPage=t.sendFirstPaint=t.sendHeroElement=function(){});t.getVarsList=function(){var e=t._vars;return Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t]).replace(/\*/g,"%2A")})},t.setVars=function(e){Object.keys(e).forEach(function(i){t._vars[i]=e[i]}),L(),R()};var e,i,n="690.1033",s="690.2096.207",o="690.2096.2877",r="690.2096.2044",a="690.2096.2748",h="690.2096.2335.1822",c="690.2096.361",l="690.2096.4004",u=10,d=3e3,p=2e4,f={connectEnd:2116,connectStart:2114,decodedBodySize:2886,domComplete:2124,domContentLoadedEventEnd:2131,domContentLoadedEventStart:2123,domInteractive:2770,domLoading:2769,domainLookupEnd:2113,domainLookupStart:2112,duration:2136,encodedBodySize:2887,entryType:2888,fetchStart:2111,initiatorType:2889,loadEventEnd:2126,loadEventStart:2125,nextHopProtocol:2890,redirectCount:1385,redirectEnd:2110,redirectStart:2109,requestStart:2117,responseEnd:2120,responseStart:2119,secureConnectionStart:2115,startTime:2322,transferSize:2323,type:76,unloadEventEnd:2128,unloadEventStart:2127,workerStart:2137},m={visible:1,hidden:2,prerender:3},_={bluetooth:2064,cellular:2065,ethernet:2066,none:1229,wifi:2067,wimax:2068,other:861,unknown:836,0:836,1:2066,2:2067,3:2070,4:2071,5:2768},g={"first-paint":2793,"first-contentful-paint":2794},b=Object.keys(g).length,v=t.getTime,y=window.PerformanceObserver,M=window.performance||{},k=M.timing||{},E=M.navigation||{},w=navigator.connection,B={},S={},C=t._deltaMarks,I=document.createElement("link"),D=document.createElement("a"),P="function"==typeof M.getEntriesByType,x=k.navigationStart,T=k.responseStart-x,O=k.domainLookupStart-x;if(L(),R(),t.ajaxStart=0,t.ajaxComplete=0,y)try{new y(function(t,i){var n=t.getEntriesByType("navigation")[0];if(n){i&&i.disconnect();var s=[];lt(s,n),at(s),dt("690.2096.2892",e.concat(s))}}).observe({entryTypes:["navigation"]})}catch(t){}function L(){e=t.getVarsList().concat("1042="+encodeURIComponent(navigator.userAgent))}function R(){i=e.concat(["143.2129="+x,"143.2112="+O,"143.2119="+T])}function A(){removeEventListener("DOMContentLoaded",A),removeEventListener("load",A),x&&setTimeout(function(){t.sendTimeMark=U,t.sendResTiming=W,t.timeEnd=z;for(var i=t._defRes;i.length;){var n=i.shift();W(n[0],n[1])}for(var s=t._defTimes;s.length;){var o=s.shift();U(o[0],o[1],!1,o[2])}Object.keys(C).forEach(function(t){H(t)}),N(),function e(){if(P&&(t.getSetting("forceFirstPaintTimeSending")||!t.isVisibilityChanged())){for(var i=M.getEntriesByType("paint"),n=0;n<i.length;n++){var s=i[n],o=g[s.name];o&&!j[s.name]&&(j[s.name]=!0,q++,U("1926."+o,s.startTime))}if(q<b)try{new y(function(t,i){e(),i&&i.disconnect()}).observe({entryTypes:["paint"]})}catch(t){}}}(),t.getSetting("sendStaticLocation")&&function(){if(window.YaStaticRegion)dt(h,e.concat("1822="+encodeURIComponent(window.YaStaticRegion)));else{var i=document.createElement("script"),n=t.getSetting("crossOrigin");i.src="https://yandex.ru/images/_crpd/hmiK28s06/3a2294DBBNSc/f1sZgUG29fpaWiHswyxKFuIQU4c4rqzjdZh3BVQA6DvEnyRA",i.async=!0,null!==n&&(i.crossOrigin=n),i.onload=function(){var t=window.YaStaticRegion;t&&dt(h,e.concat("1822="+t))},document.head.appendChild(i)}}(),rt(),P&&("complete"===document.readyState?($(),K(),J(),tt(),st()):(addEventListener("load",$),addEventListener("load",K),addEventListener("load",J),addEventListener("load",tt),addEventListener("load",st)))},0)}function N(){var i=k.domContentLoadedEventStart,s=k.domContentLoadedEventEnd;if(0!==i||0!==s){var o=function(){if(t.getSetting("forceFirstPaintTimeSending")||!t.isVisibilityChanged()){if(window.chrome&&"function"==typeof window.chrome.loadTimes){var e=window.chrome.loadTimes();return e&&e.firstPaintTime?1e3*e.firstPaintTime:0}return k.msFirstPaint?k.msFirstPaint:void 0}}(),r=e.concat(["2129="+x,"1036="+(k.domainLookupStart-x),"1037="+(k.domainLookupEnd-k.domainLookupStart),"1038="+(k.connectEnd-k.connectStart),k.secureConnectionStart&&"1383="+(k.connectEnd-k.secureConnectionStart),"1039="+(k.responseStart-k.connectEnd),"1040="+(k.responseEnd-k.responseStart),"1040.906="+(k.responseEnd-k.domainLookupStart),"1310.2084="+(k.domLoading-k.responseStart),"1310.2085="+(k.domInteractive-k.responseStart),"1310.1309="+(s-i),"1310.1007="+(i-k.responseStart),"2299="+history.length,navigator.deviceMemory&&"3140="+navigator.deviceMemory,navigator.hardwareConcurrency&&"3141="+navigator.hardwareConcurrency]);t.mark("1039 ttfb",k.responseStart-k.connectEnd),t.mark("1310.1007 dom.loaded",k.domContentLoadedEventStart-k.responseStart),o&&(r.push("2130="+(o-x),"1041="+(o-k.responseStart),"1041.906="+(o-k.domainLookupStart)),t.mark("1041.906 ttfp",o-k.domainLookupStart)),Object.keys(f).forEach(function(t){t in k&&k[t]&&r.push(f[t]+"="+ut(k[t],x))}),t.vsStart?(r.push("1484="+(m[t.vsStart]||2771)),t.vsChanged&&r.push("1484.719=1")):r.push("1484="+m.visible),E&&(E.redirectCount&&r.push("1384.1385="+E.redirectCount),1!==E.type&&2!==E.type||r.push("770.76="+E.type)),at(r),dt(n,r,["dtype=stred","pid=1","cid=72202"])}else setTimeout(N,50)}"loading"===document.readyState?(addEventListener("DOMContentLoaded",A),addEventListener("load",A)):A();var F,j={},q=0;function U(e,i,n,o){void 0===i&&(i=v()),void 0!==n&&!0!==n||t.mark(e,i);var r=ct(e);if(r.push("207="+ut(i)),V(r,o)){dt(s,r),B[e]=B[e]||[],B[e].push(i);var a=t._markListeners[e];a&&a.length&&a.forEach(function(t){t(i)})}}function V(t,e){if(e){if(e.isCanceled&&e.isCanceled())return!1;Object.keys(e).forEach(function(i){"function"!=typeof e[i]&&t.push(i+"="+e[i])})}return!0}function z(t,e){var i=C[t];i&&0!==i.length&&(i.push(v(),e),H(t))}function H(e,i,n){var s,r,a,h=C[e];if(void 0!==i?s=(r=t.getTime())-i:h&&(s=h[0],r=h[1],a=h[2]),void 0!==s&&void 0!==r){var c=ct(e);c.push("207.2154="+ut(s),"207.1428="+ut(r),"2877="+ut(r-s)),V(c,n)&&V(c,a)&&(dt(o,c),delete C[e])}}function W(t,e){ht(e,function(i){if(i){var n=ct(t);n.push("13="+encodeURIComponent(e)),lt(n,i[0]),dt(r,n)}})}function $(){if(removeEventListener("load",$),P){var t=M.getEntriesByType("resource").reduce(function(t,e){var i,n=e.name.match(/^https?:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return n&&((i=n[1])in t||(t[i]={count:0,size:0}),t[i].count++,e.transferSize&&(t[i].size+=e.transferSize)),t},{}),i="2748=";Object.keys(t).forEach(function(e){i+=e+"!"+t[e].count+"!"+(t[e].size||"")+";"}),dt(a,e.concat(i))}}t.getTimeMarks=function(){return B};var Y=0;function K(){if(removeEventListener("load",K),y){G(M.getEntriesByType("navigation")),G(M.getEntriesByType("resource"));var e=new y(function(t){G(t.getEntries())});try{e.observe({entryTypes:["resource","navigation"]})}catch(t){}var i=t.getSetting("sendTrafficWithInterval");i||null===i||(i=15e3),i&&(F=setInterval(X,i)),addEventListener("beforeunload",X)}}function G(t){if(t&&t.length)for(var e=S,i=0;i<t.length;i++){var n=Q(t[i]);if(n){var s=n.domain+"-"+n.extension,o=e[s]=e[s]||{count:0,size:0};o.count++,o.size+=n.size}}}function Q(t){var e=t.transferSize;if(null==e)return null;D.href=t.name;var i=D.pathname;if(0===i.indexOf("/clck"))return null;var n=i.lastIndexOf("."),s="";return-1!=n&&i.lastIndexOf("/")<n&&i.length-n<=5&&(s=i.slice(n+1)),{size:e,domain:D.hostname,extension:s}}function X(){var t=Ya.Rum.getSetting("maxTrafficCounters")||250;if(Y>=t)return clearInterval(F);for(var i=Object.keys(S),n="",s=0;s<i.length;s++){var o=i[s],r=S[o];n+=encodeURIComponent(o)+"!"+r.count+"!"+r.size+";"}if(n.length){Y++;var a=e.concat(["d="+n,"t="+ut(Ya.Rum.getTime())]);dt(c,a)}S={},Y>=t&&clearInterval(F)}function J(){if(removeEventListener("load",J),y){var t=new y(function(e){var i=e.getEntries()[0];i&&(H("first-input",i.processingStart-i.startTime),t.disconnect())});try{t.observe({type:"first-input",buffered:!0})}catch(t){}}}var Z=0;function tt(){if(removeEventListener("load",tt),y){var t=new y(function(t){for(var e=t.getEntries(),i=0;i<e.length;i++){var n=e[i];n.hadRecentInput||(Z+=n.value)}});try{t.observe({type:"layout-shift",buffered:!0})}catch(t){}addEventListener("visibilitychange",function e(){if("hidden"===document.visibilityState){removeEventListener("visibilitychange",e);try{"function"==typeof t.takeRecords&&t.takeRecords(),t.disconnect()}catch(t){}et()}}),addEventListener("beforeunload",et)}}function et(){if(null!=Z){var t=Math.round(1e6*Z)/1e6;dt(l,e.concat("s="+t)),Z=null}}var it=null,nt=!1;function st(){if(removeEventListener("load",st),y){var t=new y(function(t){for(var e=t.getEntries(),i=0;i<e.length;i++){var n=e[i];it=n.renderTime||n.loadTime}nt||(U("largest-loading-elem-paint",it),nt=!0)});try{t.observe({type:"largest-contentful-paint",buffered:!0})}catch(t){}addEventListener("visibilitychange",function e(){if("hidden"===document.visibilityState){removeEventListener("visibilitychange",e);try{"function"==typeof t.takeRecords&&t.takeRecords(),t.disconnect()}catch(t){}ot()}}),addEventListener("beforeunload",ot)}}function ot(){null!=it&&(U("largest-contentful-paint",it),it=null)}function rt(e,i,n){if(t._tti){var s=v(),o=function(t,e,o){var r={2796.2797:function(t,e){return t=t||[],e=e||0,t.filter(function(t){return t.startTime-e>=-50}).map(function(t){var e=t.name?t.name.split("-").map(function(t){return t[0]}).join(""):"u",i=Math.floor(t.startTime);return e+"-"+i+"-"+Math.floor(i+t.duration)}).join(".")}(o,i),689.2322:ut(s)};n&&Object.keys(n).forEach(function(t){r[t]=n[t]}),U(t||"2795",e,!0,r)},r=function(){var n,a=i||s,h=v(),c=t._tti.events||[],l=c.length;0!==l&&(n=c[l-1],a=Math.max(a,Math.floor(n.startTime+n.duration))),h-a>=d?o(e,a,c):h-a>=p?o(e,(i||s)+p,c):setTimeout(r,1e3)};r()}}function at(t){w&&t.push("2437="+(_[w.type]||2771),w.downlinkMax&&"2439="+w.downlinkMax,w.effectiveType&&"2870="+w.effectiveType)}function ht(t,e){if(!P)return e(null);I.href=t;var i=I.href,n=0,s=100;setTimeout(function t(){var o=M.getEntriesByName(i);if(o.length)return e(o);n++<u?(setTimeout(t,s),s+=s):e(null)},0)}function ct(e){return i.concat(["1701="+e,t.ajaxStart&&"1201.2154="+ut(t.ajaxStart),t.ajaxComplete&&"1201.2052="+ut(t.ajaxComplete)])}function lt(t,e){Object.keys(f).forEach(function(i){if(i in e){var n=e[i];(n||0===n)&&t.push(f[i]+"="+ut(n))}})}function ut(t,e){return"string"==typeof t?encodeURIComponent(t):Math.round(1e3*(t-(e||0)))/1e3}function dt(e,i,n,s){var o=encodeURIComponent(window.YaStaticRegion||"unknown");i.push("-cdn="+o);var r=i.filter(Boolean).join(","),a=s?{href:s}:null;t.send(a,e,r,null,null,null,n)}t.sendTTI=rt,t.sendFirstPaint=function(t){window.requestAnimationFrame?requestAnimationFrame(function(){U("2130",t)}):U("2130",t)},t.sendHeroElement=function(t){U("2876",t)},t._subpages={},t.makeSubPage=function(e,i){var n=t._subpages[e];t._subpages[e]=void 0===n?n=0:++n;var s=!1;return{689.2322:ut(void 0!==i?i:Ya.Rum.getTime()),2924:e,2925:n,isCanceled:function(){return s},cancel:function(){s=!0}}},t.getResourceTimings=ht,t.pushConnectionTypeTo=at,t.pushTimingTo=lt,t.normalize=ut,t.sendCounter=dt,t.sendDelta=H,t.sendTrafficData=X,t.finalizeLayoutShiftScore=et,t.finalizeLargestContentfulPaint=ot}(Ya.Rum),BEM.decl("rum__bem-ajax",{onSetMod:{js:function(){var t=this;this._requests={},BEM.channel("ajax").on({ajaxAction:function(){t._actionTime=Ya.Rum.getTime(),Ya.Rum.sendTrafficData(),Ya.Rum.finalizeLayoutShiftScore(),Ya.Rum.finalizeLargestContentfulPaint()},successCallbacksStarted:function(){t._renderStart=Ya.Rum.getTime()},successCallbacksFinished:function(){t._renderStart&&(t._renderDuration=Ya.Rum.getTime()-t._renderStart,t._renderStart=null)}}),BEM.DOM.doc.on({ajaxSend:this._onSend.bind(this),ajaxSuccess:this._onSuccess.bind(this),ajaxError:this._onError.bind(this),ajaxComplete:this._onComplete.bind(this)})}},_getRequestTracker:function(t){return this._requests[$.identify(t)]},_onSend:function(t,e,i){i=i||{},this._shouldTrackRequest(i)&&(this._requests[$.identify(e)]=new Ya.Rum.AjaxPerf({xhr:e,url:i.url,actionTime:this._actionTime}),this._actionTime=null)},_onSuccess:function(t,e,i,n){if(n&&n.error){var s=this._getRequestTracker(e);s&&s.onRequestError("Handled: "+n.error)}},_onError:function(t,e,i,n){var s=this._getRequestTracker(e);s&&s.onRequestError(n)},_onComplete:function(t,e){var i=this._getRequestTracker(e);i&&(i.onRequestComplete(),this._renderDuration&&i.onRenderComplete(this._renderDuration),delete this._requests[$.identify(e)],this._renderDuration=null,this.afterCurrentEvent(function(){i.send()}))},_shouldTrackRequest:function(t){var e=BEM.blocks.uri.parse(t.url),i=e.queryParams;return this._validateUrl(e)&&i.ajax&&!(i.rpt||i.filter)},_validateUrl:function(t){return!1}},{getInstance:function(){return this._instance||(this._instance=BEM.create("rum__bem-ajax"))}}),BEM.decl("rum__bem-ajax",{_validateUrl:function(t){var e=t.toString(),i=BEM.blocks.location.getInstance(),n={url:e,path:t.path(),params:t.queryParams};return"b-page_type_search"===i.detectBlock(n)&&e.indexOf("serp-list_infinite_yes")>-1}}),BEM.DOM.decl("extra-content",{appendContent:function(t){BEM.DOM.append(this.domElem,$(t).children())},setMetadata:function(t){this._metadata=t},getMetadata:function(){return this._metadata||this.params.metadata}},{getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance}}),BEM.decl("i-bundle-async",{},{_bundles:{},load:function(t){var e,i,n=this,s=BEM.channel("bundle-loaded");return this._bundles[t]?(s.trigger(t),this._bundles[t]):(i=$.Deferred(),(e=BEM.blocks["i-global"].param("pushBundleAsyncUrls"))[t]?($.getJSON(e[t]).done(function(e){var n=BEM.blocks["i-global"].param("nonce"),s=[];e.css&&s.push('<style data-bundle_s="'+t+'">'+e.css+"</style>"),e.js&&s.push('<script data-bundle_s="'+t+'" nonce="'+n+'">'+e.js+"<\/script>"),BEM.DOM.append(BEM.DOM.scope,s.join("")),i.resolve()}).fail(function(){n._onError(i,t)}),this._bundles[t]=i.promise(),this._bundles[t].then(function(){s.trigger(t)}),this._bundles[t]):(this._onError(i,t),i))},_onError:function(t,e){c.hitDelayed({dtype:"iweb",reqid:BEM.blocks["i-global"].param("reqid"),path:"/"+BEM.blocks["i-global"].param("project")+"/bundles/load-ajax-error",vars:window.Ya.counter.stringifyParams({17:e},",")}),t.reject()}}),BEM.DOM.decl("i-global-post",{onSetMod:{js:{inited:function(){BEM.blocks["i-global"].setParams(this.params.data)}}}}),function(){var t={},e=5e3,i="csp.yandex.net",n="web4",s="690.1893.1894",o="ru";function r(){var t;try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t||"undefined"==typeof XMLHttpRequest||(t=new XMLHttpRequest),t}function a(t){this.cspUrl=t.cspUrl||"//"+(t.cspHost||i)+"/csp",this.reqid=t.reqid,this.login=t.login,this.yandexuid=t.yandexuid,this.checkTimeout=t.checkTimeout||e,this.checkTimeoutId=null,this.from=t.from||n,this.counter=t.counter||s,this.tld=t.tld||o,this.domainExact=t.domainExact||["yandex."+this.tld,"yastatic.net","yandex.st"],this.domainSuffix=t.domainSuffix||[".yandex."+this.tld,".yandex.net",".yandex.ru"],this.onSendError=t.onSendError,this._onReady=function(t){"withCredentials"in r()&&this.check()}.bind(this);var a,h=document.cookie;return this.login||(a=h.match(/(?:^|;)\s*yandex_login\s*=\s*([^;]+)/))&&(this.login=a[1].trim()),this.yandexuid||(a=h.match(/(?:^|;)\s*yandexuid\s*=\s*([^;]+)/))&&(this.yandexuid=a[1].trim()),this}a.prototype.start=function(){return document.addEventListener("DOMContentLoaded",this._onReady,!1),this},a.prototype.stop=function(){return this._removeListener(),document.removeEventListener("DOMContentLoaded",this._onReady),this},a.prototype._removeListener=function(){this.checkTimeoutId&&(this.removeListenerCallback(),clearTimeout(this.checkTimeoutId))},a.prototype.check=function(){var t=document.documentElement,e=function(t){var e=t.target,i=e.nodeName.toLowerCase();"script"!==i&&"object"!==i||this._detect(e)}.bind(this);return this._detectByElem("script"),this._detectByElem("object"),t.addEventListener("load",e,!0),this.removeListenerCallback=function(){t.removeEventListener("load",e,!0)},this._removeListener(),this.checkTimeoutId=setTimeout(this.removeListenerCallback,this.checkTimeout),this},a.prototype._detectByElem=function(t){for(var e,i=document.getElementsByTagName(t),n=0;n<i.length;n++)(e=i[n]).src&&this._detect(e)},a.prototype._detect=function(t){if(!t.checked){t.checked=!0;var e=t.src;this._filterSrc(e)&&this._send(e)}},a.prototype._filterSrc=function(t){var e=/^(?:(?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(?:\/\/)?(?:(?:[^:@\/]*(?::[^:@\/]*)?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)/.exec(t||"")[1];return this.domainExact.every(function(t){return t!==e})&&this.domainSuffix.every(function(t){return t=t.replace(/\./g,"\\."),!new RegExp(t+"$").test(e)})},a.prototype._send=function(t){var e=r(),i="from="+encodeURIComponent(this.from)+"&path="+encodeURIComponent(this.counter)+"&reqid="+encodeURIComponent(this.reqid)+"&url="+encodeURIComponent(t)+"&yandex_login="+encodeURIComponent(this.login)+"&yandexuid="+encodeURIComponent(this.yandexuid);e.open("POST",this.cspUrl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===e.readyState&&200!==e.status&&this.onSendError&&this.onSendError(e.status,e.responseText)}.bind(this),e.send(i)},t.exports=a,BEM.DOM.decl("detect-scripts",{onSetMod:{js:{inited:function(){var e=BEM.blocks["i-global"],i=this.params;i.login=e.param("login"),i.yandexuid=e.param("yandexuid"),i.reqid=e.param("reqid"),i.tld=e.param("tld"),this._detectScripts=new t.exports(i),this._detectScripts.check()}}}})}(),BEM.decl("collections-controller",{},{_cache:{},_getCache:function(t){return this._cache[t]||null},_setCache:function(t,e,i){var n=this._cache[t]||{},s=this._cacheBoardTypes||{};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);i&&(s[i.sourceType]=i.boardId),this._cache[t]=n,this._cacheBoardTypes=s},hasCachedState:function(t){var e=this._getCache(t);return Boolean(e)&&("isSaved"in e||"isFavorite"in e)},hasCollectionCard:function(t){var e=this._getCache(t);return Boolean(e&&(e.isSaved||e.isFavorite))},markAsSaved:function(t){this._setCache(t,{isSaved:!0})}}),BEM.decl("i-url-controller",{},{passedParams:["ncrnd","rdrnd","nojs","numdoc","i-m-a-hacker","l10n","family","yandex_login","yandexuid","time","noredirect","noredirect_com","lr","nocache","waitall","sbh","dbgwzr","srcskip","srcask","srcrwr","metahost","relev","rearr","pron","snip","no-tests","test-id","test-tag","exp_confs","exp_flags","flag","category","popular_category","promo","from","tld","rdpass","suggest-uri","disable","qa-project","qa-field","qa-functionality","qa-element","qa-test-id","qa-run-id","videoapp","counterDebug","patch","conditional_patch","cache_whitelist","login","distr_source","distr_path","distr_vars","timeout","waitall","ui","uuid","appsearch_header","for_serp_iframe","tpid","testRunId"],rejectedParams:["uinfo","viewport","suggest_reqid","json_dump","parent-reqid","photo-upload","fbc"],setCurrent:function(t){return this._current=t,this},setNext:function(t){return this._next=t,this},build:function(){return this.fillNextParams().fillCurrentParams().buildURL()},fillNextParams:function(){var t=this._next,e=t.url||location.href,i=this.rejectedParams;return t.path=t.path||BEM.blocks.uri.getPath(BEM.blocks.uri.clearHashSymbol(e)),t.params=$.extend({},BEM.blocks.uri.parseParams(e),t.params),t.params=Object.keys(t.params).reduce(function(e,n){var s=t.params[n];return-1===i.indexOf(n)&&null!==s&&(e[n]=s),e},{}),this},fillCurrentParams:function(){var t,e=this._next.params,i=this._current.params;return this.passedParams.forEach(function(n){e[n]||(t=i[n])&&(e[n]=t)}),BEM.blocks["i-global"].param("filterIsForced")&&(e.family="yes"),this},buildURL:function(){var t=this._next;return t.url=BEM.blocks.uri.buildRelativeUrl(t.path,t.params),this},mergePassedUrlParams:function(){var t=[].slice.call(arguments),e={};return BEM.blocks.utils.forOwn(BEM.blocks.location.getInstance().getState().params,function(t,i){-1!==this.passedParams.indexOf(i)&&(e[i]=t)},this),BEM.blocks["i-global"].param("filterIsForced")&&(e.family="yes"),BEM.blocks["i-global"].param("isYandexApp")&&(e.service=BEM.blocks["i-global"].param("id")+".yandex"),Object.assign.apply(Object,[e].concat(t)),e},addPassedParams:function(t){this.passedParams.push(t)},delPassedParams:function(t){for(var e=[],i=0;i<this.passedParams.length;i++)this.passedParams[i]!==t&&e.push(this.passedParams[i]);this.passedParams=e}}),BEM.decl("location",{onSetMod:{js:{inited:function(){this._history=BEM.blocks.history.getInstance(),this._syncState(),this._history.on("statechange",this.changeThis(this._onStateChange))}}},_onStateChange:function(){this._syncState(),this._state.referer!==BEM.blocks.uri.normalize(window.location.href)&&!1!==this._state.trigger&&(this.trigger("change",this._state),this._state.block&&this.channel(this._state.block).trigger("change"))},_syncState:function(){var t=this._history.state,e=BEM.blocks.uri.parse(t.url);return this._state=$.extend({},t.data,{referer:this._state&&this._state.url,url:e.build(),hostname:e.host(),path:e.path(),params:e.queryParams}),this},change:function(t){var e=BEM.blocks.uri.parse(t.url);if(t.url&&delete t.params,t.url=e.build(),t.params){var i=BEM.blocks.uri.parse(),n=t.forceParams?t.params:$.extend({},this._state.params,t.params);Object.keys(n).forEach(function(t){i.addParam(t,n[t])}),t.url=i.build()}!1===t.trigger||(t.trigger=!0);try{this._history.changeState(!1===t.history?"replace":"push",{data:t,url:t.url})}catch(e){if("SecurityError"===e.name)throw e;"undefined"!=typeof console&&console.error,window.location.assign(t.url)}},getState:function(){return $.extend(!0,{},this._state)},getUri:function(){return BEM.blocks.uri.parse(this._state.url)},getReferer:function(){return this._state.referer}},{_instance:null,getInstance:function(){return this._instance||(this._instance=BEM.create("location"))}}),BEM.decl("location",{CHANGE_DEBOUNCE:600,onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.changeDebounced=$.debounce(this.change,this.CHANGE_DEBOUNCE,this),this.fillBlock(this.getOriginalState()),this._isChangeByYandexAppsAPI()&&this.setMod("yandex-apps-api",!0)}}},_isChangeByYandexAppsAPI:function(){var t=BEM.blocks["i-global"].param("isYandexApp"),e=BEM.blocks["i-global"].param("isHeaderDisabled");return t&&e},_onStateChange:function(){this.__base.apply(this,arguments),!1!==this._state.trigger&&this._state.block&&this.trigger(this._state.block,this._state)},_syncState:function(){this.__base.apply(this,arguments),this.fillBlock(this.getOriginalState())},getOriginalState:function(){return this._state},change:function(t,e,i){e&&e.preventDefault&&e.preventDefault(),this.fillURL(t,i),this._isChangeByAssign(t)?window.location.assign(t.url):this.__base.apply(this,arguments)},_isChangeByAssign:function(t){var e,i;return!!t.reload||(i=BEM.blocks["i-global"].param("isPumpkin"),e=!1!==t.trigger,!(!i||!e))},fillURL:function(t,e){BEM.blocks["i-url-controller"].setCurrent(this.getState()).setNext(t,e).build()},fillBlock:function(t){return t.block||(t.block=this.detectBlock(t)),this},getParamValue:function(t){var e=this._state.params[t];return e&&e[0]},hasParam:function(t,e){var i=this._state.params[t];return!!i&&(e?-1!==i.indexOf(e):Boolean(i[0]))}}),BEM.decl("location",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),window.Ya&&window.Ya.reactBus&&window.Ya.reactBus.on("location:change",function(t){this.__self.getInstance().change({url:t.url},t.event)},this)}}},_isChangeByYandexAppsAPI:function(){var t=this.__base.apply(this,arguments);return t=t&&-1===location.search.indexOf("service=cbir.yandex")}}),BEM.decl("location",{detectBlock:function(t){var e,i,n=t.path;return i=$(".i-global").bem("i-global").params.router.index,!t.params.rpt||"imageinfo"!==t.params.rpt[0]&&"imageview"!==t.params.rpt[0]?t.params.rpt&&"imagelike"===t.params.rpt[0]||t.params.like?e="b-page_type_similar":-1!==n.indexOf("search")?e="b-page_type_search":"/"!==n&&n!==i||(e="b-page_type_index"):e="b-page_type_search-by-image",e}}),BEM.decl("history",{onSetMod:{js:{inited:function(){if(!this.hasMod("provider"))throw new Error("Use BEM.blocks['history'].getInstance() instead of BEM.create('history')");this._resetUrl().bindEvents().syncState()}}},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},pushState:function(t,e,i){return this.changeState("push",this.normalizeState(t,e,i))},replaceState:function(t,e,i){return this.changeState("replace",this.normalizeState(t,e,i))},bindEvents:function(){return this},_resetUrl:function(){return this},_removeHashbang:function(t){var e=BEM.blocks.uri,i=e.parse(t);if(""===i.anchor())return t;var n=e.parse(i.anchor().replace(/^!/,""));return i.anchor(""),i.query(n.query()),i.build()},unbindEvents:function(){return this},syncState:function(){return this.state=this.normalizeState(void 0,document.title,window.location.href),this},normalizeState:function(t,e,i){return{data:null===t?void 0:t,title:e,url:i}},changeState:function(t,e){try{window.location.assign(e.url)}catch(t){}}},{hasNativeAPI:function(){return window.history&&"pushState"in window.history},_instance:null,getInstance:function(){return this._instance||(this._instance=BEM.create({block:"history",mods:{provider:this.hasNativeAPI()?"history-api":"hashchange"}}))}}),BEM.decl({block:"history",modName:"provider",modVal:"history-api"},{_onPopState:function(t){var e=t.originalEvent.state;null!==e&&(this.state=this.normalizeState(e,document.title,window.location.href),this.state.data&&delete this.state.data.trigger,this.trigger("statechange",this.state))},bindEvents:function(){return this.__base.apply(this,arguments),BEM.DOM.win.on("popstate",this.changeThis(this._onPopState)),this},unbindEvents:function(){return this.__base.apply(this,arguments),BEM.DOM.win.off("popstate",this._onPopState),this},_resetUrl:function(){return BEM.blocks.uri.parse(window.location.href).anchor()&&window.history.replaceState({},document.title,this._removeHashbang(window.location.href)),this},syncState:function(){var t=window.history.state;return null!==t&&void 0!==t||window.history.replaceState({},document.title,window.location.href),null!==this.state&&void 0!==this.state||(this.state=this.normalizeState(void 0,document.title,window.location.href)),this},changeState:function(t,e){return window.history[t+"State"](e.data,e.title||document.title,e.url),this.state=e,this.trigger("statechange",{state:e,nativeApi:!0}),this}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{onSetMod:{js:{inited:function(){this._location=BEM.blocks.location.getInstance(),this.findBlockOn("i-global"),this.__base.apply(this,arguments),this._cacheKey=this.buildCacheKey()}},type:function(t,e){this.__base.apply(this,arguments),this.findBlockInside("page-layout").setMod("page",e)}},bindEvents:function(){this.__base.apply(this,arguments),this.on("contentLoad",this._onContentLoad).on("change",this._onChange),BEM.DOM.blocks["suggest2-counter"]&&BEM.DOM.blocks["suggest2-counter"].on("submit",this._onSuggest2CounterSubmit,this)},unbindEvents:function(){this.__base.apply(this,arguments),BEM.DOM.blocks["suggest2-counter"]&&BEM.DOM.blocks["suggest2-counter"].un("submit",this._onSuggest2CounterSubmit,this)},_onContentLoad:function(t,e){this.__base.apply(this,arguments),this.trigger("beforeContentUpdate"),BEM.DOM.update(this.findElem("content"),e.html),this.trigger("contentLoaded",e)},_addPushbundleTestViewToReq:function(t){return BEM.blocks["i-global"].getFlag("pushbundle_test_view")&&t.push({name:"pushbundle__get-pushbundle-test-view-ajax",callback:this._onPushbundleTestViewLoaded}),t},_onPushbundleTestViewLoaded:function(t){BEM.DOM.append(this.domElem,t.html)},load:function(t){this.trigger("load:start");var e=BEM.create("i-request_type_bem",{url:t.url,cache:t.cache,ctx:this});return this._getCommonAjaxBlocks(t).forEach(function(t){e.block(t.name,t.callback)}),this.trigger("beforeContentLoad"),e.on("beforeCallback",function(){this.setMod("type",t.type)},this),this.showFade(),this._currentRequest=e.get(this.prepareParams(t.params),this._requestCallback.bind(this,t.type)),this},_getCommonAjaxBlocks:function(t){var e=[{name:"i-global__params:ajax",callback:this.updateGlobalParams},{name:"suggest2-history",callback:function(t){this.trigger("suggestHistoryReceived",t)}}];return Array.isArray(t.blocks)&&(e=e.concat(t.blocks)),e.push({name:"content_type_"+t.type,callback:function(e){this._contentLoadCallback(e,t.type)}},{name:"serp-controller",callback:this.updateSerpParams}),e=this._addPushbundleTestViewToReq(e)},_contentLoadCallback:function(t,e){t.page=e,this.trigger("contentLoad",t)},_requestCallback:function(t){this.trigger("change",{type:t}),this.hideFade()},updateSeoInformation:function(t){this.updateTitle(t.title),$("meta[name=keywords]").attr("content",t.keywords),$("meta[name=description]").attr("content",t.description),this.params.seo.shareTitle=t.shareTitle},_onChange:function(){},buildCacheKey:function(){var t=this._location.getState();return[t.block?t.block:"",t.type?t.type:"",BEM.blocks.uri.delParams(t.url,this._getFilterParams())].join("_")},checkCacheKey:function(){var t=this.buildCacheKey();return this._cacheKey!==t&&(this._cacheKey=t,!0)},resetCacheKey:function(){return this.buildCacheKey()+"_"+Math.floor(1e4*Math.random())},updateCacheKey:function(){this._cacheKey=this.buildCacheKey()},updateGlobalParams:function(t){BEM.blocks["i-global"].setParams(t.params),this.updateSeoInformation(t.params.seo)},_onSuggest2CounterSubmit:function(t,e){this.suggestReqID=e.suggest_reqid},prepareParams:function(t){return t.suggest_reqid=this.suggestReqID||BEM.blocks["i-global"].param("suggest_reqid"),t},updateSerpParams:function(t){var e,i=BEM.blocks["serp-controller"].get(),n=t.params.mods;for(e in $.extend(i.params,t.params),n)n.hasOwnProperty(e)&&i.setMod(e,n[e])},_selectFade:function(){return this._fade||(this._fade=this.findBlockInside({block:"fade",modName:"region",modVal:"main"})),this._fade},showFade:function(){this._startedFade||(this._startedFade=this._selectFade()),this._startedFade&&this._startedFade.setMod("progress","yes")},hideFade:function(){this._startedFade&&(this._startedFade.delMod("progress"),this._startedFade=null)}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{_getCommonAjaxBlocks:function(t){var e=this.__base.apply(this,arguments);return e.push({name:"cookies_ajax",callback:this.updateCookies}),e},_contentLoadCallback:function(t){this.__base.apply(this,arguments),this._getTabs()},updateCookies:function(t){BEM.blocks.cookies.save(t.params.cookies)}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{prepareParams:function(){var t=this.__base.apply(this,arguments);return t.uinfo=BEM.blocks["i-userinfo"].get().getUserInfo(),t["source-serpid"]=BEM.blocks["i-global"].param("serpid"),t}}),BEM.DOM.decl({block:"b-page",modName:"ajax",modVal:"yes"},{findBlocks:function(){return this.headFilter=this.findBlockInside("head-filter"),this.__base.apply(this,arguments)},bindEvents:function(){return this.headFilter&&this.headFilter.on("saved",this._onHeadFilterSaved,this),BEM.blocks["i-cbir-controller"].on("fade",this.showFade,this).on("unfade",this.hideFade,this),this.__base.apply(this,arguments)},unbindEvents:function(){return this.headFilter&&this.headFilter.un("saved",this._onHeadFilterSaved,this),BEM.blocks["i-cbir-controller"].un("fade",this.showFade,this).un("unfade",this.hideFade,this),this.__base.apply(this,arguments)},_onHeadFilterSaved:function(){this.showFade()},updateGlobalParams:function(t){this.__base.apply(this,arguments),this.trigger("warning",t.params)},_delayMethod:function(t,e){var i=BEM.blocks["i-global"].param("lags"),n=i&&i.delay;n?setTimeout(function(){t.apply(this,e)}.bind(this),n):t.apply(this,e)},_onContentLoad:function(){this._delayMethod(this.__base,arguments)},_requestCallback:function(){this._delayMethod(this.__base,arguments)},loadPage:function(t,e){this.load({type:e,url:BEM.blocks["i-global"].param("router").search,params:t.params,blocks:[{name:"cbir-intent__image-link",callback:function(t){this.trigger("cbir-intent:loaded",t)}}]})}}),function(t,e,i){var n={bubbles:!1,cancelable:!1,view:null,detail:null,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null,buttons:0,pointerId:0,width:0,height:0,pressure:0,tiltX:0,tiltY:0,pointerType:"",hwTimestamp:0,isPrimary:!1,target:null,currentTarget:null,which:0,pageX:0,pageY:0,timeStamp:0},s=Object.keys(n),o=s.map(function(t){return n[t]}),r=s.length,a=!1,h=[0,1,4,2];try{a=1===new MouseEvent("test",{buttons:1}).buttons}catch(t){}function c(t,e){var i={},n=t.originalEvent||{};e||(e={});for(var c,l=0;l<r;l++)i[c=s[l]]=e[c]||t[c]||n[c]||o[l];return i.x=i.clientX,i.y=i.clientY,i.pressure=i.pressure||(i.buttons?.5:0),i.buttons||a||(i.buttons=h[i.which]||0),i.originalEvent=t.originalEvent||null,e.preventDefault?i.preventDefault=function(){e.preventDefault(),t.preventDefault()}:(i.preventDefault=function(){t.preventDefault()},i._preventScroll=function(){}),i}var l=t.Map&&t.Map.prototype.forEach?new t.Map:{array:[],size:0,set:function(t,e){if(void 0===e)return this.delete(t);this.has(t)||this.size++,this.array[t]=e},has:function(t){return void 0!==this.array[t]},delete:function(t){this.has(t)&&(delete this.array[t],this.size--)},get:function(t){return this.array[t]},clear:function(){this.array.length=0,this.size=0},forEach:function(t,e){return this.array.forEach(function(i,n){t.call(e,i,n,this)},this)}},u={eventMap:{},captureInfo:{},eventSourceList:[],registerSource:function(t,e){var i=e.events;i&&(i.forEach(function(t){e[t]&&(this.eventMap[t]=e[t].bind(e))},this),this.eventSourceList.push(e))},register:function(t){for(var e,i=this.eventSourceList.length,n=0;n<i&&(e=this.eventSourceList[n]);n++)e.register.call(e,t)},unregister:function(t){for(var e,i=this.eventSourceList.length,n=0;n<i&&(e=this.eventSourceList[n]);n++)e.unregister.call(e,t)},contains:function(t,e){return!!t.contains&&t.contains(e)},getCommonAncestor:function(t,i){for(;t&&t!==e.documentElement;){if(t.contains&&t.contains(i))return t;t=t.parentNode}return null},down:function(t){t.bubbles=!0,this.fireEvent("pointerdown",t)},move:function(t){t.bubbles=!0,this.fireEvent("pointermove",t)},up:function(t){t.bubbles=!0,this.fireEvent("pointerup",t)},enter:function(t){var e=[],i=t.target,n=this.getCommonAncestor(i,t.relatedTarget);for(t.bubbles=!1;i&&i!==n;)e.push(i),i=i.parentNode;for(;e.length;)t.target=e.pop(),this.fireEvent("pointerenter",t)},leave:function(t){var e=[],i=t.target,n=this.getCommonAncestor(i,t.relatedTarget);for(t.bubbles=!1;i&&i!==n;)e.push(i),i=i.parentNode;for(;e.length;)t.target=e.shift(),this.fireEvent("pointerleave",t)},over:function(t){t.bubbles=!0,this.fireEvent("pointerover",t)},out:function(t){t.bubbles=!0,this.fireEvent("pointerout",t)},cancel:function(t){t.bubbles=!0,this.fireEvent("pointercancel",t)},leaveOut:function(t){this.out(t),this.contains(t.target,t.relatedTarget)||this.leave(t)},enterOver:function(t){this.over(t),this.contains(t.target,t.relatedTarget)||this.enter(t)},listen:function(t,e){e.forEach(function(e){this.addEvent(t,e)},this)},unlisten:function(t,e){e.forEach(function(e){this.removeEvent(t,e)},this)},addEvent:function(t,e){i(t).on(e,this.boundHandler)},removeEvent:function(t,e){i(t).off(e,this.boundHandler)},eventHandler:function(t){var e=this.eventMap[t.type];e&&e(t,t.originalEvent)},makeEvent:function(t,e){this.captureInfo[e.pointerId]&&(e.relatedTarget=null);var n=function(t,e){var n=i.Event(t),s=e.preventDefault,o=n.preventDefault.bind(n);return jQuery.extend(n,e),n.preventDefault=function(){s(),o()},n}(t,e);return n._target=n._target||e.target,n},fireEvent:function(t,e){var i=this.makeEvent(t,e);return this.dispatchEvent(i)},getTarget:function(t){return this.captureInfo[t.pointerId]||t._target},setCapture:function(t,n){this.captureInfo[t]&&this.releaseCapture(t),this.captureInfo[t]=n,this.implicitRelease=this.releaseCapture.bind(this,t),i(e).on("pointerup pointercancel",this.implicitRelease),this.asyncDispatchEvent(i.Event("gotpointercapture",{bubbles:!0,cancelable:!1,pointerId:t,_target:n}))},releaseCapture:function(t){var n=this.captureInfo[t];n&&(this.captureInfo[t]=void 0,i(e).off("pointerup pointercancel",this.implicitRelease),this.asyncDispatchEvent(i.Event("lostpointercapture",{bubbles:!0,cancelable:!1,pointerId:t,_target:n})))},dispatchEvent:function(t){var e=this.getTarget(t);if(e)return i.event.trigger(t,null,e,!t.bubbles)},asyncDispatchEvent:function(e){(t.requestAnimationFrame||setTimeout)(this.dispatchEvent.bind(this,e))}};u.boundHandler=u.eventHandler.bind(u);var d,p,f={POINTER_ID:1,POINTER_TYPE:"mouse",DEDUP_DIST:25,events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(t){u.listen(t,this.events)},unregister:function(t){u.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(t){for(var e,i=this.lastTouches,n=t.clientX,s=t.clientY,o=0,r=i.length;o<r&&(e=i[o]);o++){var a=Math.abs(n-e.x),h=Math.abs(s-e.y);if(a<=this.DEDUP_DIST&&h<=this.DEDUP_DIST)return!0}},prepareEvent:function(t){return c(t,{pointerId:this.POINTER_ID,isPrimary:!0,pointerType:this.POINTER_TYPE})},mousedown:function(t){this.isEventSimulatedFromTouch(t)||(l.has(this.POINTER_ID)&&this.cancel(t),l.set(this.POINTER_ID,t),u.down(this.prepareEvent(t)))},mousemove:function(t){this.isEventSimulatedFromTouch(t)||u.move(this.prepareEvent(t))},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=l.get(this.POINTER_ID);e&&e.button===t.button&&(u.up(this.prepareEvent(t)),this.cleanupMouse())}},mouseover:function(t){this.isEventSimulatedFromTouch(t)||u.enterOver(this.prepareEvent(t))},mouseout:function(t){this.isEventSimulatedFromTouch(t)||u.leaveOut(this.prepareEvent(t))},cancel:function(t){u.cancel(this.prepareEvent(t)),this.cleanupMouse()},cleanupMouse:function(){l.delete(this.POINTER_ID)}},m={POINTER_TYPE:"touch",DEDUP_TIMEOUT:2500,CLICK_COUNT_TIMEOUT:200,events:["touchstart","touchmove","touchend","touchcancel"],register:function(t){u.listen(t,this.events)},unregister:function(t){u.unlisten(t,this.events)},firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){(0===l.size||1===l.size&&l.has(1))&&(this.firstTouch=t.identifier,this.firstTouchTarget=t.target,this.scrolling=!1,this.firstXY={X:t.clientX,Y:t.clientY},this.cancelResetClickCount())},removePrimaryPointer:function(t){t.isPrimary&&(this.firstTouch=null,this.firstTouchTarget=null,this.firstXY=null,this.shouldScrollCache=void 0,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var t=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(t,this.CLICK_COUNT_TIMEOUT)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(t){return"touchstart"===t||"touchmove"===t?1:0},findTarget:function(t){return e.elementFromPoint(t.clientX,t.clientY)},touchToPointer:function(t){var e=this,n=this.currentTouchEvent,s=t.identifier+2;return c(n,i.extend({},t,{pointerId:s,target:u.captureInfo[s]||this.findTarget(t),bubbles:!0,cancelable:!0,detail:this.clickCount,button:0,buttons:this.typeToButtons(n.type),width:t.webkitRadiusX||t.radiusX||0,height:t.webkitRadiusY||t.radiusY||0,pressure:t.webkitForce||t.force||.5,isPrimary:this.isPrimaryTouch(t),pointerType:this.POINTER_TYPE,preventDefault:function(){e.scrolling=!1,e.shouldScrollCache=!1,e.firstXY=null}}))},processTouches:function(t,e){var i=t.originalEvent.changedTouches;this.currentTouchEvent=t;for(var n,s=0;s<i.length;s++)n=i[s],e.call(this,this.touchToPointer(n))},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(t){var e,i=this.scrollTypes;return t===i.EMITTER?e="none":t===i.XSCROLLER?e="X":t===i.YSCROLLER?e="Y":i.SCROLLER.exec(t)&&(e="XY"),e},shouldScroll:function(t){if(void 0!==this.shouldScrollCache)return this.shouldScrollCache;if(!this.firstXY)return!0;for(var e,i,n=this.firstTouchTarget;n&&1===n.nodeType&&null===(e=n.getAttribute("touch-action"));)n=n.parentNode;var s=this.touchActionToScrollType(e);if("none"===s)i=!1;else if("XY"===s||void 0===s)i=!0;else{var o=t.originalEvent.changedTouches[0],r=s,a="Y"===s?"X":"Y";i=Math.abs(o["client"+r]-this.firstXY[r])>=Math.abs(o["client"+a]-this.firstXY[a])}return this.shouldScrollCache=i,this.firstXY=null,this.firstTouchTarget=null,this.shouldScrollCache},findTouch:function(t,e){for(var i,n=0,s=t.length;n<s&&(i=t[n]);n++)if(i.identifier===e)return!0},vacuumTouches:function(t){var e=t.originalEvent.touches;if(l.size>=e.length){var i=[];l.forEach(function(t,n){if(1!==n&&!this.findTouch(e,n-2)){var s=t.out;i.push(s)}},this),i.forEach(this.cancelOut,this)}},touchstart:function(t){var e=t.originalEvent.changedTouches[0];this.vacuumTouches(t),this.setPrimaryTouch(e),this.dedupSynthMouse(e),this.scrolling||(this.clickCount++,this.processTouches(t,this.overDown))},overDown:function(t){l.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),u.over(t),u.enter(t),u.down(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var e=l.get(t.pointerId);if(e){var i=e.out,n=e.outTarget;u.move(t),i&&n!==t.target&&(i.relatedTarget=t.target,t.relatedTarget=n,i.target=n,t.target?(u.leaveOut(i),u.enterOver(t)):(t.target=n,t.relatedTarget=null,this.cancelOut(t))),e.out=t,e.outTarget=t.target}},touchend:function(t){this.dedupSynthMouse(t.originalEvent.changedTouches[0]),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(u.up(t),u.out(t),u.leave(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){u.cancel(t),u.out(t),u.leave(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){l.delete(t.pointerId),this.removePrimaryPointer(t)},dedupSynthMouse:function(t){var e=f.lastTouches;if(this.isPrimaryTouch(t)){var i={x:t.clientX,y:t.clientY};e.push(i);var n=function(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}.bind(null,e,i);setTimeout(n,this.DEDUP_TIMEOUT)}}},_={POINTER_TYPES:["","unavailable","touch","pen","mouse"],HAS_BITMAP_TYPE:t.MSPointerEvent&&"number"==typeof t.MSPointerEvent.MSPOINTER_TYPE_MOUSE,events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(t){u.listen(t,this.events)},unregister:function(t){u.unlisten(t,this.events)},prepareEvent:function(t){var e=c(t);return this.HAS_BITMAP_TYPE&&(e.pointerType=this.POINTER_TYPES[e.pointerType]),e},cleanup:function(t){l.delete(t)},MSPointerDown:function(t){l.set(t.originalEvent.pointerId,t),u.down(this.prepareEvent(t))},MSPointerMove:function(t){u.move(this.prepareEvent(t))},MSPointerUp:function(t){u.up(this.prepareEvent(t)),this.cleanup(t.originalEvent.pointerId)},MSPointerOut:function(t){u.leaveOut(this.prepareEvent(t))},MSPointerOver:function(t){u.enterOver(this.prepareEvent(t))},MSPointerCancel:function(t){u.cancel(this.prepareEvent(t)),this.cleanup(t.originalEvent.pointerId)},MSGotPointerCapture:function(t){u.fireEvent("gotpointercapture",this.prepareEvent(t))},MSLostPointerCapture:function(t){u.fireEvent("lostpointercapture",this.prepareEvent(t))}},g=function(t){if(!l.has(t))throw new Error("InvalidPointerId")};t.Element&&Element.prototype.setPointerCapture?(d=function(t,e){t.setPointerCapture(e)},p=function(t,e){t.releasePointerCapture(e)}):t.navigator.msPointerEnabled?(d=function(t,e){g(e),t.msSetPointerCapture(e)},p=function(t,e){g(e),t.msReleasePointerCapture(e)}):(d=function(t,e){g(e),u.setCapture(e,t)},p=function(t,e){g(e),u.releaseCapture(e,t)}),i.fn.extend({setPointerCapture:function(t){d(this[0],t)},releasePointerCapture:function(t){p(this[0],t)}}),t._pointerPolyfillInited||(t._pointerPolyfillInited=!0,t.PointerEvent?["move","down","up","over","out","enter","leave","cancel"].forEach(function(t){var e=jQuery.event.fixHooks,i="pointer"+t;e[i]||(e[i]={}),e[i].props=s.concat(e[i].props||[])}):(delete i.event.special.pointerenter,delete i.event.special.pointerleave,t.navigator.msPointerEnabled?u.registerSource("ms",_):(u.registerSource("mouse",f),void 0!==t.ontouchstart&&u.registerSource("touch",m)),u.register(document)))}(window,document,jQuery),function(t){t.event.special.pointerpress||t.each({pointerpress:"pointerdown",pointerrelease:"pointerup pointercancel"},function(e,i){function n(i){var n,s=i.type;return"mouse"===i.pointerType&&1!==i.which||(i.type=e,n=t.event.dispatch.apply(this,arguments),i.type=s),n}t.event.special[e]={setup:function(){t(this).on(i,n)},teardown:function(){t(this).off(i,n)}}})}(jQuery),$.extend({util:{}}),function(){var t=Object.prototype.toString;function e(e){return"[object Object]"===t.call(e)}function i(t,n,s){var o,r;for(o in t=Object(t),n=Object(n))"__proto__"!==o&&"prototype"!==o&&"constructor"!==o&&(void 0!==(r=s&&s(t[o],n[o],o))?t[o]=r:e(t[o])&&e(n[o])?t[o]=i(t[o],n[o],s):t[o]=n[o]);return t}$.extend($.util,{merge:i,mergeBemjson:function(t,e){return i(t,e,function(t,e,i){if("mix"===i)return[].concat(t,e)})}})}(),BEM.DOM.decl("control",{onSetMod:{focused:{yes:function(){if(this.hasMod("disabled"))return!1;this._focused||(this._focus(),this.trigger("focus"))},"":function(){this._focused&&(this._blur(),this.trigger("blur"))}},disabled:{"*":function(t,e){var i=this._getControl();i.prop("disabled",Boolean(e)).attr("aria-disabled",Boolean(e)),i.attr("tabindex",e?null:this.params._tabindex)},yes:function(){this.delMod("focused")}}},_focus:function(){this._getControl().focus()},_blur:function(){this._getControl().blur()},_getControl:function(){var t=this.elem("control");return t.length>0?t:this.domElem},_onFocusin:function(){this._focused=!0,this.trigger("focus").setMod("focused","yes").bindTo("focusout",this._onFocusout)},_onFocusout:function(){this._focused=!1,this.trigger("blur").delMod("focused").unbindFrom("focusout")},getDefaultParams:function(){return{_tabindex:this._getControl().attr("tabindex")}}},{live:function(){this.liveBindTo("focusin",function(t){this._onFocusin(t)}),parseInt(BEM.blocks["i-ua"].ios,10)>=8&&this.liveBindTo("control","focusin",function(t){t.preventDefault()})}}),BEM.DOM.decl({block:"link",baseBlock:"control"},{onSetMod:{hovered:{yes:function(){return!this.hasMod("disabled")}},pressed:{yes:function(){return!this.hasMod("disabled")}},disabled:{"":function(){this.__base.apply(this,arguments),this.domElem.attr("tabindex",this.params._tabindex)},yes:function(){this.__base.apply(this,arguments),this.domElem.attr("tabindex",-1),this.delMod("pressed")}}},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")}},{live:function(){return this.liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}),this.__base()}}),BEM.DOM.decl("link",{onSetMod:{hovered:{yes:function(){return!this.hasMod("disabled")}},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("hovered")}}},_onPointerenter:function(t){this.setMod("hovered","yes")},_onPointerleave:function(t){this.delMod("hovered")}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.hasMod("disabled")||this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}),this.__base.apply(this,arguments)}}),function(){var t=$(window),e=$(document.documentElement),i=0,n=!1;function s(){e.hasClass("pointerfocus")&&(n=!0,setTimeout(function(){n=!1}))}document.documentMode<=11?e.on("focusin",function(t){var e=t.originalEvent;!e||e.fromElement||e.relatedTarget||s()}):t.on("blur",function(){t.one("focus",s)}),e.addClass("utilityfocus").on({focusin:function(){e.toggleClass("pointerfocus",n).toggleClass("utilityfocus",!n)},keydown:function(){clearTimeout(i),n=!1},"pointerdown pointerup click":function(t){n=!0,clearTimeout(i),i=setTimeout(function(){n=!1},600)}})}(),BEM.DOM.decl({block:"link",modName:"ajax",modVal:"yes"},{_onClick:function(t){this.__base.apply(this,arguments);var e=this.domElem.attr("href");e&&(this.trigger("click",{domEvent:t}),this.isMouseDownTriggered||this.domElem.trigger("onmousedown"),BEM.blocks.location.getInstance().change($.extend({url:e},this.params),t))},_onMouseDown:function(){this.isMouseDownTriggered=!0}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo({block:"link",modName:"ajax",modVal:"yes"},"pointerclick",function(t){this._onClick(t)}),this.liveBindTo({block:"link",modName:"ajax",modVal:"yes"},"mousedown",function(){this._onMouseDown()})}}),BEM.DOM.decl({block:"link",modName:"ajax",modVal:"yes"},{_onClick:function(t){if(2!==t.which&&!t.metaKey&&!t.ctrlKey)return this.__base.apply(this,arguments)}}),function(){var t={};BEM.decl("i-request",{onSetMod:{js:{inited:function(){this._preventCache=!1}}},get:function(t,e,i,n){return $.isFunction(i)||(n=i,i=this.params.onError),this._get(t,e,i,$.extend({},this.params,n)),this},_get:function(e,i,n,s){var o=this._buildCacheKey(e,s),r=t[s.cacheGroup];s.cache&&r&&o in r.data?this.afterCurrentEvent(function(){i.call(this.params.callbackCtx,r.data[o])},this):this._do(e,i,n,s)},_do:function(t,e,i,n){},_onSuccess:function(t,e,i,n){n.cache&&!this._preventCache&&this.putToCache(n,t,i),this._preventCache=!1},_buildCacheKey:function(t,e){return"string"==typeof t?t:$.param(t)},putToCache:function(e,i,n){var s=t[e.cacheGroup]||(t[e.cacheGroup]={keys:[],data:{}});s.keys.length>=e.cacheSize&&delete s.data[s.keys.shift()];var o=this._buildCacheKey(i,e);return s.data[o]=n,s.keys.push(o),this},dropCache:function(){return delete t[this.params.cacheGroup],this},getDefaultParams:function(){return{cache:!1,cacheGroup:"default",cacheSize:100,callbackCtx:this}}},{_cache:t})}(),BEM.decl({block:"i-request_type_bem",baseBlock:"offline-request"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.blocks=[],this._addIConsoleBlock(),this._addExtraContentBlock();var t=this._prepareRequestUrl(),e={dataType:this.params.dataType,url:t,cache:this.params.cache,callbackCtx:this,traditional:!0,paramsToSettings:["traditional"]};BEM.blocks["i-global"].getFlag("disable_jsonp_cors")&&(e.dataType="json",e.crossDomain=!1),this._req=BEM.create("i-request_type_ajax",e),this._initOffline()}}},_prepareRequestUrl:function(){var t=this.params.url,e=this.params.passedParams,i=BEM.blocks.location.getInstance(),n=e.reduce(function(e,n){var s=i.getParamValue(n);return s&&-1===t.indexOf(n+"=")&&e.push(n+"="+s),e},[]);if(n.length){var s=BEM.blocks.utils.isEmpty(BEM.blocks.uri.parseParams(t))?"?":"&";t+=s+n.join("&")}return t},_initOffline:function(){this.__base.apply(this,arguments),this._requestArgsCache=null},_addIConsoleBlock:function(){BEM.blocks["i-global"].param("isYandexNet")&&this.block("i-console",this._onIConsoleSuccess,{isAjax:!0})},_onIConsoleSuccess:function(t){t&&t.html&&BEM.DOM.scope.append(t.html)},_addExtraContentBlock:function(){this.block("extra-content",this._onExtraContentSuccess)},_onExtraContentSuccess:function(t){BEM.blocks["extra-content"]&&t&&t.html&&BEM.blocks["extra-content"].getInstance().appendContent(t.html)},block:function(t,e,i,n){var s=Array.isArray(t)?t:"string"==typeof t?t.split(" "):[t];if(arguments.length<2)throw new Error("success callback is required");for(var o=0,r=s.length;o<r;o++)this.blocks.push({decl:s[o],success:e,error:"function"===$.type(i)?i:$.noop,params:n||("object"===$.type(i)?i:{}),ctx:this.params.ctx});return this},get:function(t,e,i){var n=this.params;return"function"===$.type(t)?(n.success=t,n.error=e||$.noop,t=void 0):(n.success=e||$.noop,n.error=i||$.noop),BEM.blocks["i-global"].param("isPumpkin")?(this._onError(),this):(this._get(t),this)},_get:function(t){return this.afterCurrentEvent(function(){this.trigger("beforeRequest"),this._requestArgsCache||(this._requestArgsCache=$.extend({},this._getArgs(),t)),this._isOnline?this._req.get(this._requestArgsCache,this._onSuccess,this._onError):window.Ya.Rum.logError&&window.Ya.Rum.logError({message:"i-request_type_bem: can't send request(no internet connection)",block:"i-request_type_bem",additional:{url:this._prepareRequestUrl()}})}),this},abort:function(){return this._req.abort(),this.blocks.length=0,this},_onSuccess:function(t){if(t&&"captcha"===t.type)return c.hit({dtype:"stred",pid:40,cid:72952,path:BEM.blocks["i-global"].param("project").replace("/",".")}),void window.location.assign(t.captcha["captcha-page"]);this._requestArgsCache=null,this.unbindEvents(),this._updateAssets(t),this._updateMetadata(t),this._callback("success",t)},_onError:function(t){var e={type:"error",vars:{"-url":encodeURIComponent(this._prepareRequestUrl())}};t&&0!==t.readyState&&0!==t.status&&(this._requestArgsCache=null,this.unbindEvents()),t&&t.status&&(e.vars["-status"]=t.status),t&&t.statusText&&(e.vars["-statusText"]=t.statusText),this._sendAjaxResultCounter(e),this._callback("error",t)},_updateAssets:function(t){if("object"!=typeof t||null===t)return this;var e=this._getNodesFragment(t);e&&this._appendNodesFromFragment(e),delete t.assets},_getNodesFragment:function(t){var e=t.assets&&t.assets.assets;if(e&&e.length){var i=document.createDocumentFragment();return e.forEach(function(e){var n;n="style"===e.type&&e.url?this._createStyleLinkNode(e):this._createNode(t,e),i.appendChild(n)},this),i}},_appendNodesFromFragment:function(t){return document.head.appendChild(t),this},_createNode:function(t,e){var i=e.type,n=document.createElement(i),s=BEM.blocks["i-global"].param("nonce");return e.content&&(n.textContent=e.content),s&&n.setAttribute("nonce",s),e.url&&(n.src=e.url,n.async="async","script"!==i||window.Ya.disableCrossOrigin||(n.crossOrigin=""),Ya.Rum.sendResTiming(2778,n.src)),"script"===i&&e.bundleName&&this._setBundleWaitEvents(t,n,e.bundleName),e.attrs&&Object.keys(e.attrs).forEach(function(t){n.setAttribute(t,e.attrs[t])}),n},_setBundleWaitEvents:function(t,e,i){this.__self._waitJSBundles[i]=1,e.addEventListener("load",function(){delete this.__self._waitJSBundles[i],this._callBlockWithSuccessCB(t)}.bind(this)),e.addEventListener("error",function(){c.hitDelayed({dtype:"iweb",reqid:BEM.blocks["i-global"].param("reqid"),path:"/"+BEM.blocks["i-global"].param("project")+"/bundles/load-error",vars:window.Ya.counter.stringifyParams({17:i},",")})})},_createStyleLinkNode:function(t){var e=document.createElement("link");return e.rel="stylesheet",e.href=t.url,e},_updateMetadata:function(t){if(t&&t.metadata){var e=t.metadata;BEM.blocks["i-global"].setParams({bundlesMetadata:e.bundles||e.bundlesMetadata,assetsMetadata:e.assets||e.assetsMetadata}),BEM.blocks["extra-content"]&&BEM.blocks["extra-content"].getInstance().setMetadata(e.extraContent)}},_callback:function(t,e){this.trigger("beforeCallback"),"success"!==t?this._blocksCallback(t,e):this._callBlockWithSuccessCB(e)},_callBlockWithSuccessCB:function(t){if(t&&!t.error){var e={};this.blocks.forEach(function(i,n){if(!this.blocks[n].called){var s=this._getBlockName(i.decl),o=t.blocks?t.blocks[n]:t[i.decl];this._isBlockWaitBundle(o)||(i.success.call(i.ctx,o,i.decl),this.blocks[n].called=!0,this._setSuccessData(e,t,{decl:i.decl,blockName:s,index:n}))}}.bind(this)),this.__self._requestCallbackEnabled(this.blocks)&&this.params.success.call(this.params.ctx,e)}else this._callback("error",t)},_isBlockWaitBundle:function(t){if(!t||!t.params)return!1;var e,i,n=Array.isArray(t.params.bundles)&&t.params.bundles.length;if(n)for(i=0;i<n;i++)if(e=t.params.bundles[i],this.__self._waitJSBundles[e])return!0;return!1},_blocksCallback:function(t,e){this.blocks.forEach(function(i){i[t].call(i.ctx,e,i.decl)}),this.params[t].call(this.params.ctx,e)},_setSuccessData:function(t,e,i){var n=i.blockName,s=i.index;"string"==typeof i.decl?t[n]=e.blocks[s]:(Array.isArray(t[n])||(t[n]=[]),t[n].push(e.blocks[s]))},_getBlockName:function(t){return"string"==typeof t?t:t.block},_getRequestString:function(){var t={blocks:this.blocks.map(function(t){return{block:t.decl,params:t.params,version:2}})};return t.metadata={bundles:BEM.blocks["i-global"].param("bundlesMetadata"),assets:BEM.blocks["i-global"].param("assetsMetadata")},BEM.blocks["extra-content"]&&(t.metadata.extraContent=BEM.blocks["extra-content"].getInstance().getMetadata()),t.bmt=t.metadata.bundles,t.amt=t.metadata.assets,JSON.stringify(t)},_getArgs:function(){return $.extend({format:"json",request:this._getRequestString()},"jsonp"===this.params.dataType?{yu:BEM.blocks["i-global"].param("yandexuid")}:{})},_onChangeNetworkStatus:function(t){t&&this._requestArgsCache&&this._get()},_sendAjaxResultCounter:function(t){var e={dtype:"stred",reqid:BEM.blocks["i-global"].param("reqid"),path:BEM.blocks["i-global"].param("project").replace("/",".")+".ajax."+t.type};t.vars&&(e.vars=window.Ya.counter.stringifyParams(t.vars,",")),c.hit(e)},getDefaultParams:function(){return{url:"/",dataType:BEM.blocks["i-global"].getFlag("disable_jsonp")?"json":"jsonp",passedParams:["exp_flags","conditional_patch","tpid","testRunId"],ctx:this}}},{_waitJSBundles:{},isWaitBundles:function(){return Boolean(Object.keys(this._waitJSBundles).length)},_requestCallbackEnabled:function(t){return!this.isWaitBundles()||t.every(function(t){return Boolean(t.called)})}}),BEM.decl({block:"i-request_type_bem"},{_getArgs:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["i-global"].getFlag("images_disable_cookie_yu")?t:$.extend(t,"jsonp"===this.params.dataType?{yu:$.cookie("yandexuid")}:{})}}),BEM.decl("i-request_type_bem",{_onSuccess:function(){var t=BEM.blocks["i-global"].param("lags"),e=t&&t.load,i=this.__base,n=arguments;e?setTimeout(function(){i.apply(this,n)}.bind(this),e):i.apply(this,n)}}),BEM.decl({block:"i-request_type_ajax",baseBlock:"i-request"},{onSetMod:{js:{inited:function(){this.__base(),this._requestNumber=this._number=this._preventNumber=this._retryCount=0}}},_get:function(t,e,i,n){this._number++,this._requestNumber++,this._retryCount=n.retryCount,this.__base.apply(this,arguments)},_do:function(t,e,i,n){var s=this;if(s._number>s._preventNumber){var o=arguments,r={data:n.data?$.extend({},n.data,t):t},a=s._wrapCallback(function(i,o,r){s._onSuccess(s._buildCacheKey(t,n),t,i[0],n),s._allowCallback(o,r)&&e.apply(n.callbackCtx,i)}),h=s._wrapCallback(function(t,e,r){s._allowCallback(e,r)&&(s._retryCount-- >0?setTimeout(function(){s._do.apply(s,o)},n.retryInterval):i&&i.apply(n.callbackCtx,t))});$.each(["url","dataType","timeout","type","jsonp","jsonpCallback","xhrFields","cache"].concat(n.paramsToSettings||[]),function(t,e){r[e]=n[e]}),$.ajax(r).done(a).fail(h)}},_wrapCallback:function(t){var e=this._requestNumber,i=this._number;return function(n){null!==n&&t(arguments,e,i)}},_allowCallback:function(t,e){return e>this._preventNumber&&this._requestNumber===t},_buildCacheKey:function(t,e){return"string"==typeof t?t:this.__base(t)+e.url},abort:function(){this._preventNumber=++this._number},getDefaultParams:function(){return $.extend(this.__base(),{cache:!0,type:"GET",dataType:"jsonp",timeout:2e4,retryCount:0,retryInterval:2e3})}}),BEM.decl("i-request_type_ajax",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.cacheIrrelevantParams=["yu","uinfo","viewport","rpt","_","pos"]}},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{timeout:3e5})},_get:function(t,e,i,n){if(this.params.timeout){var s,o=this._buildCacheKey(t,n),r=this.__self._cache[n.cacheGroup];n.cache&&r&&o in r.data&&(s=r.timestamps[o],(new Date).getTime()-s>this.params.timeout&&(delete r.timestamps[o],delete r.data[o],r.keys.splice(r.keys.indexOf(o),1)))}this.__base.apply(this,arguments)},_buildCacheKey:function(t,e){if("string"==typeof t)return t;for(var i=$.extend(!0,{},t),n=this.cacheIrrelevantParams,s=0,o=n.length;s<o;s++)n[s]in i&&delete i[n[s]];return void 0===i.p&&(i.p=1),$.param(i)+e.url},putToCache:function(t,e){var i=this._buildCacheKey(e,t),n=this.__self._cache,s=n[t.cacheGroup]||(n[t.cacheGroup]={keys:[],data:{},timestamps:{}});this.__base.apply(this,arguments),s.keys.length>=t.cacheSize&&delete s.timestamps[s.keys[0]],s.timestamps[i]=(new Date).getTime()}}),BEM.DOM.decl("b-page",{findBlocks:function(){return this.__base.apply(this,arguments),this._scroller=this.hasMod("use-scroller")?this.elem("scroller"):$("html,body"),this},_onUserScroll:function(){this._scroller.stop(),this.stopScrollTracking()},startScrollTracking:function(){this.isScrolling=!0,this.bindToWin("DOMMouseScroll mousewheel",$.throttle(this._onUserScroll.bind(this),100))},stopScrollTracking:function(){this.isScrolling=!1,this.unbindFromWin("DOMMouseScroll mousewheel",$.throttle(this._onUserScroll.bind(this),100))},getElementOffsetTop:function(t,e){return t.offset().top-this._headerHeight-e-20},scrollTo:function(t,e,i,n){i||(i=0);var s=t instanceof jQuery?this.getElementOffsetTop(t,i):t;return e?this.isScrolling||(this.startScrollTracking(),this._scroller.animate({scrollTop:s},e,function(){this.stopScrollTracking(),n&&n.resolve()}.bind(this))):(window.scrollTo(0,s),n&&n.resolve()),this},enableScroll:function(){this.delMod("scroll-disabled"),this.loadScroll()},disableScroll:function(){this.saveScroll(),this.setMod("scroll-disabled","yes")},loadScroll:function(){this._savedScroll&&window.scrollTo(this._savedScroll.x,this._savedScroll.y)},saveScroll:function(){this._savedScroll={x:window.scrollX,y:window.scrollY}}}),BEM.DOM.decl("b-page",{saveScroll:function(t,e){2===arguments.length?this._savedScroll={x:t,y:e}:this.__base.apply(this,arguments)}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_index",this._onPageIndex,this),this},_onPageIndex:function(t,e){this.checkCacheKey()&&this.loadIndex(e)},loadIndex:function(t){return this.load({type:"index",url:BEM.blocks["i-global"].param("router").index,params:t.params}),this}}),BEM.DOM.decl("b-page",{_onPageIndex:function(){this.__self.preventFocus=!0,this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this.__self.preventFocus=!1}),this.cbirIntent&&this.cbirIntent.prepareInputForIndex()}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_search",this._onPageSearch,this),this},_onPageSearch:$.noop,loadSearch:function(t){return this.load({type:"search",url:t.path||BEM.blocks["i-global"].param("router").search,params:t.params,blocks:this.getBlocks()}),this}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.params.shouldUpdateFilters=!BEM.blocks["i-global"].param("hasHistoryAPI"),this.__base.apply(this,arguments)}}},_onPageSearch:function(t,e){this.checkCacheKey()&&this.loadSearch(e)},getBlocks:function(){var t=[{name:"search2:ajax",callback:function(t){this.trigger("search:input:update",t)}}];return this.params.shouldUpdateFilters&&t.push({name:"advanced-search__filters",callback:this._onAdvancedSearchData}),t},_onAdvancedSearchData:function(t){this.trigger("filters:update",t)}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.shouldUpdateFilters=!0}}},getBlocks:function(){var t=this.__base.apply(this,arguments);return t.push({name:"preview__isWallpaper",callback:function(t){this.trigger("preview:update",t.params.isWallpaper)}}),t},_onAdvancedSearchData:function(t){BEM.blocks.utils.isEmpty(t.params.filters)||this._advancedSearch||(this._advancedSearch=this.findBlockInside("advanced-search")),this.__base.apply(this,arguments)},_onPageSearch:function(){this.__base.apply(this,arguments),this.cbirIntent&&this.cbirIntent.prepareInputForSearch()}}),function(t,e){if(!e.event.special.pointerclick){var i,n=void 0!==t.ontouchstart||navigator.msMaxTouchPoints>0,s=10,o=25,r=900,a=[],h=[],c=null,l=null,u="touchAction"in document.documentElement.style?function(t){return function t(e){return!(!e||e===document.documentElement)&&("manipulation"===getComputedStyle(e)["touch-action"]||t(e.parentElement))}(t)}:function(){return!1};n?(i={click:function(t){var e=Object(t.originalEvent)._sourcePoint;if(!e)return d.apply(this,arguments);e.isDefaultPrevented()&&t.preventDefault()},"pointerdown pointermove pointerleave pointercancel pointerup":function(t){var e,i,n=t.type;if("mouse"!==t.pointerType&&("pointerdown"!==n&&"pointerup"!==n||!u(t.target)))if("pointerdown"===n)l=t;else if("pointermove"===n&&l&&(l.target!==t.target||(e=l,i=t,Math.abs(e.clientX-i.clientX)>s||Math.abs(e.clientY-i.clientY)>s)))l=null;else if("pointerleave"===n||"pointercancel"===n)l=null;else if("pointerup"===n){if(function(t){if(!t.isPrimary)return;a.push(t),setTimeout(Array.prototype.shift.bind(a),r)}(t),!l)return;if(!(t.timeStamp-l.timeStamp>250))return c||(c=setTimeout(function(){c=l=null})),d.apply(this,arguments);l=null}}},["mousedown","click"].forEach(function(e){t.addEventListener(e,function(t){!function(t){var e=t.clientX,i=t.clientY,n="_compat"+t.type;if(t._sourcePoint)return;for(var s=0;s<a.length;s++){var c=a[s],l=c.target===t.target;if(!c[n]&&((l||!(Math.abs(e-c.clientX)>o||Math.abs(i-c.clientY)>o))&&(l||document.elementFromPoint(c.clientX,c.clientY)!==c.target))){t._sourcePoint=c,c[n]=t;break}}h.push(t),setTimeout(Array.prototype.shift.bind(h),r)}(t),function(t){var e=function(t){for(var e=0;e<h.length;e++)if(h[e]===t)return h[e]._sourcePoint}(t);return Boolean(e)&&e.target!==t.target}(t)&&(t.preventDefault(),t.stopPropagation())},!0)})):i={click:function(t){return d.apply(this,arguments)}},e.event.special.pointerclick={setup:function(){e(this).on(i)},teardown:function(){e(this).off(i)}}}function d(t){var i,n=t.type;return t.button||(t.type="pointerclick",i=e.event.dispatch.apply(this,arguments),t.type=n),i}}(window,jQuery),BEM.DOM.decl("popup",{getDefaultParams:function(){return{zIndexGroupLevel:0,directions:[{to:"bottom",axis:"center",tail:{axis:"center"}},{to:"top",axis:"center",tail:{axis:"center"}},{to:"right",axis:"middle",tail:{axis:"middle"}},{to:"left",axis:"middle",tail:{axis:"middle"}}],tail:{width:24.04,height:12.02,offset:{left:15,right:15,top:15,bottom:15}},duration:150}},onSetMod:{js:{inited:function(){this._cache={},this._viewport=BEM.DOM.win,this._scope=BEM.DOM.scope,this._channel=BEM.channel("popups"),this._inContainer=!1,this._isParentFixed=!1,this._owner=null,this._destructor=null,this._userPosition=null,this._parent=null,this._childs=[],this._isShown=!1,this._isHiding=!1,this._positions={},this._currPos={},this._visibilityFactor=null,this._direction=!1,this._directions={};var t=this.getDefaultParams(),e=this.params,i=this._repackDirParams(t.directions),n=e.generateDirections?this._generateDirections:e.directions,s=this._repackDirParams(n);e.tail&&(this.params.tail=this._mergeParams(t.tail,e.tail)),this._order=s.keys.map(function(t){var e=s.directions[t],n=i.directions[t];return n||(n=i.directions[e.to]),this._directions[t]=this._mergeParams(n,e,{tail:this._tailParamsHook}),t},this),this._zIndex=null,this._zIndexGroupLevel=null}},visibility:{visible:function(){this._onShown()},"":function(){this._onHidden()}}},show:function(t){var e;if(t instanceof BEM)e=t.domElem.eq(0);else if(t instanceof $)e=t;else if(!t)return;if(e){if(this._owner&&e[0]!==this._owner[0]&&this.delMod("visibility"),this._owner=e,e.length){var i="_"+this.__self.getName()+"-destructor";this._destructor=e.addClass("i-bem "+i).bem(i)}var n=this._findParent(e);n&&this.setParent(n)}else this._userPosition=t;return this.setMod("visibility","outside").repaint()},hide:function(t){if(this._isHiding)return this;if(this._isShown){var e=$.Event("before-hide");if(this.trigger(e,t),e.isDefaultPrevented())return this;if(this._isHiding=!0,this._childs.forEach(function(t){t.hide&&t.hide(),t.delMod("visible")}),this.hasMod("animate","yes")&&!this.hasMod("fade-out","no")){var i=this;return this.beforeHide(function(){i.domElem&&i.delMod("visibility")}),this}}return this.delMod("visibility")},toggle:function(t,e){return this._isShown&&!this._isHiding?this.hide(e):this.show(t||this._owner)},repaint:function(){this._moveToContainer();var t=this._pickDirection();return this.setMod("to",t.to)._show(this._positions[t.key],this._tailPos&&this._tailPos[t.key]),this},getCurrPos:function(){return this._currPos},getCurrDirection:function(){return this._direction},setScope:function(t){return this._scope=t,this._inContainer=!1,this},setContent:function(t){return BEM.DOM.update(this.elem("content"),t),this._resetDefault(),this._isShown&&this.repaint(),this},isShown:function(){return this._isShown},setParent:function(t){return this._parent=t,this._isParentFixed=t.hasMod("position","fixed"),t.addChild&&t.addChild(this),this},addChild:function(t){for(var e=this._childs,i=e.length,n=0;n<i;n++)if(e[n]._uniqId===t._uniqId)return;t.on("hide",function(){this.removeChild(t)},this),t.on("beforeClose",function(){this.afterCurrentEvent(function(){this.removeChild(t)})},this),e.push(t)},_getParentPopup:function(){return this._parent},removeChild:function(t){for(var e=this._childs,i=e.length,n=0;n<i;n++)if(e[n]._uniqId===t._uniqId)return void e.splice(n,1)},setSize:function(t){return t&&(this._resetDefault(),this.domElem.css(t),this._isShown&&!this._isHiding&&this.repaint()),this},_show:function(t,e){return this._currPos=t,e&&this.elem("tail").removeAttr("style").css(e),this.domElem.css(t),(!this._isShown||this._isHiding)&&this.hasMod("animate","yes")&&!this.hasMod("fade-in","no")&&this.afterShow(),this._isHiding=!1,this.setMod("visibility","visible"),this},_onShown:function(){this._isShown||this._bindCompatibility(),this.bindToDoc("keydown",function(t){t.which===BEM.blocks.keycodes.ESC&&0===this._childs.length&&this.hide({source:"esc-key"})}),this._attachRepaintOnResize(),this._bindFocusEvents(),this._attachUnder(),this._isShown=!0,this.hasMod("autoclosable","yes")&&this.afterCurrentEvent(function(){this.domElem&&this._enableAutoclosable()}),this.hasMod("adaptive","yes")&&this._enableAdaptive(),this._channel.on("hide",this.hide,this),this.trigger("show")},_bindCompatibility:function(){this._captureZIndex(),this.__self._visiblePopupsStack.unshift(this),this.trigger("beforeOpen")},_unbindCompatibility:function(){this.trigger("beforeClose");var t=this.__self._visiblePopupsStack;t.splice(t.indexOf(this),1),this._releaseZIndex()},_onHidden:function(){this._isShown&&this._unbindCompatibility(),this.unbindFromDoc("keydown"),this._detachRepaintOnResize(),this._unbindFocusEvents(),this.hasMod("autoclosable","yes")&&this._disableAutoclosable(),this.hasMod("adaptive","yes")&&this._disableAdaptive(),this._detachUnder(),this._cache={},this._isShown=!1,this._isHiding=!1,this._channel.un("hide"),this._returnFocus(),this.trigger("hide")},_attachRepaintOnResize:function(){window.attachEvent&&this.domElem[0].attachEvent("onresize",this.__self._enforcePageRepaint)},_detachRepaintOnResize:function(){window.detachEvent&&this.domElem[0].detachEvent("onresize",this.__self._enforcePageRepaint)},_bindFocusEvents:function(){this._lastFocused=$($.dom.getActiveElement()[0]||this._scope);var t=this.__self._getFocusable(this.elem("content"));this._firstFocusable=t.first(),this._lastFocusable=t.last(),this._skipReturnFocus=!1,0!==this._firstFocusable.length?this.bindTo(this._lastFocused,"keydown",this._onLastFocusedKeyDown).bindTo(this._firstFocusable,"keydown",this._onFirstFocusableKeyDown).bindTo(this._lastFocusable,"keydown",this._onLastFocusableKeyDown):this._skipReturnFocus=!0},_unbindFocusEvents:function(){this.unbindFrom(this._firstFocusable,"keydown"),this.unbindFrom(this._lastFocusable,"keydown"),this.unbindFrom(this._lastFocused,"keydown")},_onLastFocusedKeyDown:function(t){this._lastFocused.is(this._scope)&&!this._lastFocused.is(t.target)||t.ctrlKey||t.altKey||t.metaKey||t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this[t.shiftKey?"_lastFocusable":"_firstFocusable"].focus())},_onFirstFocusableKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||t.shiftKey&&t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._lastFocused.focus())},_onLastFocusableKeyDown:function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._lastFocused.focus())},_returnFocus:function(){(this._parent||{})._skipReturnFocus||this._skipReturnFocus||this._lastFocused.focus()},_mergeParams:function(t,e,i){var n={},s=Object.prototype.hasOwnProperty;return i||(i={}),t&&"object"==typeof t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(e).forEach(function(o){var r=s.call(i,o)?i[o].call(this,t[o],e[o]):e[o];!r||"object"!=typeof r||Array.isArray(r)?n[o]=r:t[o]?n[o]=this._mergeParams(t[o],r,i):n[o]=r},this),n},_tailParamsHook:function(t,e){return e.offset||(e.offset=this.params.tail.offset),"number"==typeof e.offset?{offset:{left:e.offset,top:e.offset}}:e},_generateDirections:function(){if(this.__self._generateDirectionsCache)return this.__self._generateDirectionsCache;for(var t=[["bottom","top"],["left","right"]],e=[["center","left","right"],["middle","top","bottom"]],i=e,n=t.length,s=[],o=0;o<n;o++)for(var r=t[o],a=r.length,h=0;h<a;h++)for(var c=e[o],l=c.length,u=0;u<l;u++)for(var d=i[o],p=d.length,f=0;f<p;f++)s.push({direction:r[h],axis:c[u],tail:{axis:d[f]}});return this.__self._generateDirectionsCache=s,s},_repackDirParams:function(t){var e,i={};return("string"==typeof t||$.isPlainObject(t))&&(t=[t]),e=t.map(function(t){if("string"==typeof t){var e=t.split("-");t={to:e[0],tail:{}},e[1]&&(t.axis=e[1]),e[2]&&(t.tail.axis=e[2])}var n=t.to;return i[n]||(i[n]=t),t.axis&&(n+="-"+t.axis),t.key=n,i[n]=t,n},this),{directions:i,keys:e}},setViewport:function(t){return this._viewport=t,this},_pickDirection:function(){var t,e=this._order,i=this.hasMod("adaptive","yes")?e.length:1;for(this._visibilityFactor=0,t=0;t<i;t++){var n=e[t],s=this._directions[n];this._resetPos(n)._pushPos(n,this._calcPos(s))._pushPos(n,this._calcOffsets(s)),this._hasTail()&&this._resetTailPos(n)._pushTailPos(n,this._calcTailPos(s))._pushTailPos(n,this._calcTailOffset(s))._pushPos(n,this._calcOffsetByTail(s)),this._pushPos(n,this._getParentOffset());var o=this._calcVisibilityFactor(s);if((o>this._visibilityFactor||!this._direction)&&(this._visibilityFactor=o,this._direction=this._directions[n],this.size=this.getPlacingSize(),100===o))break}return this._direction},_getParentOffset:function(){var t=this.domElem.offsetParent().offset();return t.left*=-1,t.top*=-1,t},_calcPos:function(t){this._calcPlacingSize(t);var e=this.getOwnerPos(),i=this.getOwnerSize(),n=this.getPlacingSize(),s=t.axis,o=this.params.position||{},r={},a=Object.prototype.hasOwnProperty;switch(t.to){case"bottom":r={top:a.call(o,"top")?o.top:e.top+i.height,left:a.call(o,"left")?o.left:this._calcLeft(s)};break;case"top":r={top:a.call(o,"top")?o.top:e.top-n.height,left:a.call(o,"left")?o.left:this._calcLeft(s)};break;case"left":r={top:a.call(o,"top")?o.top:this._calcTop(s),left:a.call(o,"left")?o.left:e.left-n.width};break;case"right":r={top:a.call(o,"top")?o.top:this._calcTop(s),left:a.call(o,"left")?o.left:e.left+i.width}}return r},_calcTop:function(t){var e=0,i=this.getPlacingSize(),n=this.getOwnerPos(),s=this.getOwnerSize();return"top"===t?e+=n.top:"middle"===t?e+=n.top+s.height/2-i.height/2:"bottom"===t&&(e+=n.top+s.height-i.height),e},_calcLeft:function(t){var e=0,i=this.getPlacingSize(),n=this.getOwnerPos(),s=this.getOwnerSize();return"left"===t?e+=n.left:"center"===t?e+=n.left+s.width/2-i.width/2:"right"===t&&(e+=n.left+s.width-i.width),e},getPlacingSize:function(){return this.getPopupSize()},_calcOffsets:function(t){var e,i=this._cache.offset||(this._cache.offset={}),n=t.key,s=t.offset;if(i[n])return i[n];if(!s)return!1;if(e={left:0,top:0},"number"==typeof s)switch(n){case"left":e.left+=s;break;case"right":e.left-=s;break;case"top":e.top+=s;break;case"bottom":e.top-=s}else s.left&&(e.left+=s.left),s.right&&(e.left-=s.right),s.top&&(e.top+=s.top),s.bottom&&(e.top-=s.bottom);return i[n]=e,e},_hasTail:function(){return 0!==this.elem("tail").length},_moveToContainer:function(t){if(t)this._inContainer=!1;else{if(this._isShown)return;t=this._parent?this._parent.domElem:this._scope}this.domElem.appendTo(t),this._inContainer=!0},_resetPos:function(t){return t?this._positions[t]=null:this._positions={},this},_pushPosTo:function(t,e,i){!1!==i&&("string"==typeof e?this._sum(t[e]||(t[e]={}),i):(i=e,Object.keys(t).forEach(function(e){this._sum(t[e],i)},this)))},_pushPos:function(t,e){return this._pushPosTo(this._positions,t,e),this},_sum:function(t,e){Object.keys(e).forEach(function(i){t[i]=(t[i]||0)+e[i]})},_getSizeOf:function(t){return{height:t.outerHeight(),width:t.outerWidth()}},getOwnerSize:function(){return this._owner?this._cache.ownerSize||(this._cache.ownerSize=this._getSizeOf(this._owner)):{height:0,width:0}},getPopupSize:function(){return this._getSizeOf(this.domElem)},_getPosOf:function(t){return t.offset()||{left:0,top:0}},getOwnerPos:function(){var t;return this._owner&&(t=this._getPosOf(this._owner),"pageYOffset"in window&&(t.top-=window.pageYOffset-(document.documentElement.scrollTop||document.body.scrollTop),t.left-=window.pageXOffset-(document.documentElement.scrollLeft||document.body.scrollLeft))),t||this._userPosition},_calcVisibilityFactor:function(t){var e,i,n=this._viewport,s=this._getSizeOf(n),o=this.getPopupSize(),r=this._positions[t.key],a=this._parent&&this._isParentFixed?this._parent.domElem.offset():{top:0,left:0},h=this.hasMod("position","fixed")?{top:0,left:0}:{top:n.scrollTop(),left:n.scrollLeft()},c=r.top+a.top-h.top,l=r.left+a.left-h.left,u=l+o.width-s.width,d=c+o.height-s.height,p={height:o.height,width:o.width},f=100;return d>0&&(p.height-=d),c<0&&(p.height+=c),l<0&&(p.width+=l),u>0&&(p.width-=u),p.height<0||p.width<0?f=0:(i=Math.abs(p.height*p.width),(e=o.height*o.width)!==i&&(f=i/e*100)),f},_findParent:function(t){var e=t.closest(".popup, .popup2");return this.findBlockOn(e,"popup")||this.findBlockOn(e,"popup2")},destruct:function(){return this._childs.forEach(function(t){t.domElem&&BEM.DOM.destruct(t.domElem)}),this.setMod("fade-out","no"),this.hide(),this._isShown&&this._unbindCompatibility(),this.__base.apply(this,arguments)},_calcZIndexGroupLevel:function(){var t=this.params.zIndexGroupLevel,e=this._getParentPopup();return e&&(t+=e._zIndexGroupLevel),this._destructor?this._destructor.findBlocksOutside("z-index-group").reduce(function(t,e){return t+Number(e.getMod("level"))},t):t},_captureZIndex:function(){null===this._zIndexGroupLevel&&(this._zIndexGroupLevel=this._calcZIndexGroupLevel());var t=this.__self._visiblePopupsZIndexes,e=this._zIndexGroupLevel,i=t[e],n=this._zIndex;return i||(i=t[e]=[(e+1)*this.__self.ZINDEX_FACTOR]),this._zIndex=i[i.length-1]+1,i.push(this._zIndex),this._zIndex!==n&&this.domElem.css("z-index",this._zIndex),this},_releaseZIndex:function(){var t=this.__self._visiblePopupsZIndexes[this._zIndexGroupLevel];return t.splice(t.indexOf(this._zIndex),1),this},_resetDefault:function(){},_calcPlacingSize:function(){}},{live:function(){this.liveBindTo("close","pointerclick",function(){this.hide({source:"close-click"})})},_visiblePopupsStack:(BEM.blocks.popup2||{})._visiblePopupsStack||[],_visiblePopupsZIndexes:(BEM.blocks.popup2||{})._visiblePopupsZIndexes||{},ZINDEX_FACTOR:1e3,_getFocusable:function(t){var e=$.data(t,"popup-getFocusable-id");e||(e=$.identify(),$.data(t,"popup-getFocusable-id",e)),e='*[data-popup-getFocusable-id="'+e+'"]';var i="a[href], link, ";return BEM.blocks["i-ua"].opera<13&&(i=""),t.find(i+'*[tabindex], button, input:not([type="hidden"]), textarea, select, menuitem').filter(function(){var t=$(this),i=!0;return!(parseInt(t.prop("tabindex"),10)<0||"hidden"===t.css("visibility"))&&($(this).parentsUntil(e).each(function(){if("none"===$(this).css("display"))return i=!1}),i)})},_enforcePageRepaint:function(){document.body.className+=""},_generateDirectionsCache:null}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.findBlockOn("share-dropdown")&&(this._isParentFixed=!0)}}}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("load:start",this._onPageChange,this)}}},destruct:function(){BEM.blocks["b-page"].un("load:start",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(){this.hide()}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.findBlockOn("sizes-popup")&&(this._isParentFixed=!0)}},visibility:{visible:function(){this.__base.apply(this,arguments),this.bindToDoc("dragover",this.hide),BEM.blocks["i-keyrouter"].on("esc",this._onEsc,this),BEM.blocks["b-page"].on("touchmove",this._onTouchMove,this),this.hasMod("type","internal")||BEM.blocks["b-page"].on("scroll",this._onPageScroll,this)},"":function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].un("touchmove",this._onTouchMove,this),BEM.blocks["i-keyrouter"].un("esc",this._onEsc,this),this.unbindFromDoc("dragover",this.hide),this.hasMod("type","internal")||BEM.blocks["b-page"].un("scroll",this._onPageScroll)}}},_onEsc:function(){this.hide()},_onTouchMove:function(t){$(t.target).closest(".popup").length||this.hide()},_pushPos:function(t,e){var i=e.top,n=e.left;return i&&"string"!=typeof i&&(e.top=Math.floor(i)),n&&(e.left=Math.floor(n)),this.__base.apply(this,arguments)},_onPageScroll:function(){this.hide()}}),BEM.decl("keycodes",{},{BACKSPACE:8,TAB:9,ENTER:13,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,is:function(t,e){return(Array.isArray(e)?e:Array.prototype.slice.call(arguments,1)).some(function(e){return this[e]===t},this)}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base.call(this);var t=this.findElem("under").first();this._underClassAttr=t.attr("class"),this.isDivEnough()?this._under=t:(t.remove(),this._under=null),this._underInPool=!1}}},isDivEnough:function(){return!0},_createUnder:function(){return $('<iframe frameBorder="0" tabindex="-1" src="about:blank"/>')},_getUnder:function(){if(this._under)return this._under;var t=this.__self._underPool.pop();return t&&(this._underInPool=!1),this._under=t,t||this._createUnder()},_attachUnder:function(){var t=this._under=this._getUnder();t.attr("class",this._underClassAttr),this.hasMod(t,"type","paranja")?t.detach().insertBefore(this.domElem).css("z-index",this._zIndex):t.prependTo(this.domElem)},_detachUnder:function(){var t=this._under;t.removeAttr("style"),this.__self._underPool.push(t.detach()),this._under=null,this._underInPool=!0},destruct:function(){var t=this.__base.apply(this,arguments);return this._underInPool&&this.__self._underPool.pop(),this._under&&this._under.remove(),t}},{_underPool:[]}),BEM.DOM.decl("popup",{isDivEnough:function(){return BEM.blocks["i-global"].param("mobile")}}),BEM.DOM.decl("popup",{onSetMod:{autoclosable:{yes:function(){this._enableAutoclosable()},"":function(){this._disableAutoclosable()}}},_enableAutoclosable:function(){if(this.domElem){var t=this._under;this.hasMod(t,"type","paranja")&&(t.is("iframe")&&(t=$([t[0].contentWindow,t[0].contentWindow.document])),this.bindTo(t,"pointerclick",function(t){t.stopPropagation(),this.hide({source:"outside-click"})}),this.bindTo(t,"pointerdown",function(){this._skipReturnFocus=!0})),this.bindTo("pointerdown pointerclick",function(){var t=this;do{t._preventHideByClick=!0,t=t._getParentPopup()}while(t)}),this.bindToDoc("pointerclick",function(t){if(this._preventHideByClick)this._preventHideByClick=null;else if(!this._isRelatedNode($(t.target))){var e=$.Event("outside-click");this.trigger(e,t),e.isDefaultPrevented()||this.hide({source:"outside-click"})}}),this.bindToDoc("pointerdown",function(){this._skipReturnFocus=!0})}},_disableAutoclosable:function(){var t=this._under;this.hasMod(t,"type","paranja")&&(t.is("iframe")&&(t=$([t[0].contentWindow,t[0].contentWindow.document])),this.unbindFrom(t,"pointerclick pointerdown")),this.unbindFromDoc("pointerclick pointerdown")},_isRelatedNode:function(t){var e=this.containsDomElem(t);if(e||(e=Boolean(this._owner)&&this.containsDomElem.call({domElem:this._owner},t)),e)return!0;var i,n=this._childs.length;for(i=0;i<n;i++)if(this.containsDomElem.call({domElem:this._childs[i].domElem},t))return!0;return!1}}),BEM.DOM.decl({block:"popup",modName:"adaptive",modVal:"yes"},{onSetMod:{adaptive:{yes:function(){this._enableAdaptive()},no:function(){this._disableAdaptive()}},"watch-scroll":{yes:function(){this._watchScroll()},no:function(){this._unwatchScroll()}}},_enableAdaptive:function(){this.afterCurrentEvent(function(){this.domElem&&this.bindToWin("resize",this.onResize)}),this._watchScroll()},_disableAdaptive:function(){this.unbindFromWin("resize")._unwatchScroll()},getScrollEvents:function(){return["scroll"]},_watchScroll:function(){this._owner&&!this.hasMod("watch-scroll","no")&&this.bindTo(this._owner.parents().add(this._viewport),this.getScrollEvents().join(" "),this.onScroll,this)},_unwatchScroll:function(){this._owner&&this.unbindFromDomElem(this._owner.parents().add(this._viewport),this.getScrollEvents().join(" "))},onResize:function(t){this._cache={},this._isShown&&!this._isHiding&&this.repaint()},onScroll:function(t){this._cache={},this._isShown&&!this._isHiding&&this.repaint()},destruct:function(){this._disableAdaptive(),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"popup",modName:"animate",modVal:"yes"},{afterShow:function(){var t=this.getCurrDirection();if(t){var e=t.to,i=this.getCurrPos(),n={opacity:1,top:i.top,left:i.left},s={opacity:0,top:i.top,left:i.left};"bottom"===e?s.top+=10:"top"===e?s.top-=10:"left"===e?s.left-=10:"right"===e&&(s.left+=10),this.domElem.stop(!0).css(s).animate(n,this.params.duration)}},beforeHide:function(t){var e=this.getCurrDirection();if(!e)return t();var i=e.to,n=this.getCurrPos(),s=this.domElem,o={top:n.top,left:n.left,opacity:0};return"bottom"===i?o.top+=10:"top"===i?o.top-=10:"left"===i?o.left-=10:"right"===i&&(o.left+=10),s.stop(!0,!0).animate(o,this.params.duration,function(){t(),s.css("opacity","")})}}),function(t){t.dom={getActiveElement:function(){return t(document.activeElement)}},t.fn.isFocused=function(){return this.is(t.dom.getActiveElement())}}(jQuery),BEM.DOM.decl({block:"popup",modName:"position",modVal:"fixed"},{addChild:function(t){this.__base.apply(this,arguments),t.setMod("watch-scroll","no")},_onFirstFocusableKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||t.shiftKey&&t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._lastFocusable.focus())},_onLastFocusableKeyDown:function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||t.which===BEM.blocks.keycodes.TAB&&(t.preventDefault(),this._firstFocusable.focus())}}),BEM.DOM.decl({block:"popup",modName:"position",modVal:"fixed"},{getOwnerPos:function(){var t=this.__base.apply(this,arguments);if(this._owner){var e=this._viewport;t.top-=e.scrollTop(),t.left-=e.scrollLeft()}return t}}),BEM.DOM.decl("nps",{getDefaultParams:function(){return{timeout:{show:1e4,hide:5e3}}},onSetMod:{js:{inited:function(){var t,e=this.params;this.cookie=BEM.blocks["i-cookie"].get(),this.isEqual=this.hasMod("equal","yes"),e.save&&this.cookie.yp(this.hasMod("cbir","yes")?"cnps":"nps",[e.rand,e.status].join(":"),e.expires),this.isClosed()||(this.findBlocks().bindEvents(),t=this.page.getMod("type"),this.hasMod("cbir","yes")?this.isCbirPages("b-page_type_"+t)&&this.show():"search"===t?this.show():this.location.on("b-page_type_search",this.show,this))}},hidden:{yes:function(){this.isClosed()||this.afterCurrentEvent(function(){this.popup.hide()})},"":function(){this.isClosed()||this.hasMod("search","yes")&&this._disable||this.hasMod("cbir","yes")&&this._disable||(this.hasMod("cbir","yes")&&this.isEqual&&this.searchPopup&&(this.searchPopup._disable=!0),this.hasMod("search","yes")&&this.isEqual&&this.cbirPopup&&(this.cbirPopup._disable=!0),this.afterCurrentEvent(function(){this.popup.show(this.popupAnchor)}))}},layout:{view:function(){this.hide()},"":function(){this.show()}}},findBlocks:function(){return this.popupAnchor=this.findBlockOutside("b-page").elem("content"),this.location=BEM.blocks.location.getInstance(),this.popup=this.findBlockOn("popup"),this.list=this.findBlockInside("radio-button"),this.button=this.findBlockInside("button"),this.question=this.elem("text"),this.page=this.findBlockOutside("b-page"),this.cbirPopup=this.page.findBlockInside({block:"nps",modName:"cbir",modVal:"yes"}),this.searchPopup=this.page.findBlockInside({block:"nps",modName:"search",modVal:"yes"}),this},bindEvents:function(){return this.button.on("click",this._onSendClick,this),this.popup.on("hide",this._onPopupHidden,this),this.list.on("clicked",this._onRadioChange,this),this.location.on("change",this._onPageChange,this),this},destruct:function(){this.button.un("click",this._onSendClick,this),this.popup.un("hide",this._onPopupHidden,this),this.list.un("clicked",this._onRadioChange,this),this.location.un("change",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(t,e){"b-page_type_search"===e.block?this.show():this.hide()},_onRadioChange:function(t,e){this.enableButton(),this.value=e},_onPopupHidden:function(){if(this.hasMod("hidden","yes"))return!1;this.hide();var t=this.getMod("type");return this.hasMod("minimized","yes")?(this.saveStatus("close"),this.hasMod("thanks","yes")||w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"close"].join("/"))):(this.minimizeNPS(),w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"small"].join("/")),this.show()),!1},_onSendClick:function(){var t=this.getMod("type");this.hasMod("minimized","yes")?(this.maximizeNPS(),this._isShown&&this.popup.repaint(),w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"normal"].join("/"))):(w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",t,"result","p"+this.value].join("/")),this.showThanks())},hide:function(){return this.setMod("hidden","yes")},show:function(){if(!this.isClosed())return this._isShown?this.delMod("hidden"):this.startPopupTimer(),this},disableButton:function(){return this.button.delMod("focused").setMod("theme","normal").setMod("disabled","yes"),this},enableButton:function(){return this.button.setMod("theme","action").delMod("disabled"),this},initPopup:function(){var t=this.page.getMod("type");return this.hasMod("search","yes")&&"search"!==t?"":this.hasMod("cbir","yes")&&!this.isCbirPages("b-page_type_"+t)?"":(this._isShown=!0,this.hasMod("layout","view")||this.show().countShow(),void(this.hasMod("minimized","yes")?this.minimizeNPS():this.maximizeNPS()))},startPopupTimer:function(){this.location.un("b-page_type_search",this.show,this),setTimeout(this.changeThis(function(){this.initPopup(),this.popup.domElem.css({bottom:-this.domElem.height()+"px"}).animate({bottom:0})}),this.params.timeout.show)},countShow:function(){return this.params.save&&w(null,["/image/new",this.hasMod("cbir","yes")?"cbir":"serp",this.getMod("type"),"show"].join("/")),this},minimizeNPS:function(){var t=this.params.i18n;return this.setMod("minimized","yes").setButtonText(t.answer).setQuestion(t.invite).enableButton().saveStatus("min")},maximizeNPS:function(){var t=this.params.i18n;return this.setMod("minimized","no").setButtonText(t.send).setQuestion(t.question).saveStatus("max"),this.value||this.disableButton(),this},showThanks:function(){var t=this.params;this.popup.hide().setMod("animate","yes"),this.setMod(this.elem("button"),"hidden","yes").setMod("minimized","yes").setMod("thanks","yes").saveStatus("close").setQuestion(t.i18n.thankyou).show(),setTimeout(this.changeThis(this.hide),t.timeout.hide)},setQuestion:function(t){return this.question.text(t),this},setButtonText:function(t){return this.button.elem("text").text(t),this},isClosed:function(){return"close"===this.params.status},saveStatus:function(t){return this.cookie.yp(this.hasMod("cbir","yes")?"cnps":"nps",[this.params.rand,t].join(":")),this.params.status=t,this}}),BEM.DOM.decl({block:"nps",modName:"cbir",modVal:"yes"},{isCbirPages:function(t){return-1!==["b-page_type_search-by-image","b-page_type_similar"].indexOf(t)},_onPageChange:function(t,e){this.isCbirPages(e.block)?this.show():this.hide()}}),BEM.DOM.decl("button",{onSetMod:{js:{inited:function(){var t=this.isDisabled(),e=this.domElem;(this._href=e.attr("href"))&&t&&e.removeAttr("href")}},disabled:function(t,e){var i=this.domElem;e&&this.delMod("hovered"),this._href&&(e?i.removeAttr("href"):i.attr("href",this._href)),this.afterCurrentEvent(function(){i&&i.prop("disabled",e)})},pressed:function(t,e){if(this.hasMod("disabled"))return!1;this.trigger(e?"press":"release")}},isDisabled:function(){return this.hasMod("disabled","yes")},url:function(t){return void 0===t?this._href:(this._href=t,this.isDisabled()||this.domElem.attr("href",t),this)},getUrl:function(){return this.url()},setUrl:function(t){return this.url(t)},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")},_onClick:function(t){this.isDisabled()?t.preventDefault():this.afterCurrentEvent(function(){this.domElem&&this.trigger("click")})}},{live:function(){this.liveBindTo("pointerclick",function(t){this._onClick(t)}).liveBindTo("pointerpress",function(t){this.isDisabled()||this._onPointerpress(t)})}}),BEM.DOM.decl("button",{onSetMod:{focused:{yes:function(){if(this.isDisabled())return!1;this.bindToWin("unload",function(){this.delMod("focused")}).bindTo("keydown",this._onKeyDown),this._isControlFocused()||this._getControl().focus(),this.trigger("focus")},"":function(){var t=BEM.blocks["i-ua"].opera<13;this.unbindFromWin("unload").unbindFrom("keydown"),(t||document.hasFocus())&&this._isControlFocused()&&this._getControl().blur(),this.trigger("blur")}},disabled:function(t,e){this.__base.apply(this,arguments),e&&(this.delMod("focused"),this.domElem.keyup())},hovered:function(t,e){if(this.isDisabled())return!1;!e&&this.delMod("pressed")},pressed:function(){return this.isDisabled()||this.setMod("focused","yes"),this.__base.apply(this,arguments)}},_getControl:function(){return this.elem("control").length&&this.elem("control")||this.domElem},_isControlFocused:function(){return this.containsDomElem($.dom.getActiveElement())},_onKeyDown:function(t){var e=BEM.blocks.keycodes,i=t.keyCode;!this._keyDowned&&e.is(i,"ENTER","SPACE")&&(this._keyDowned=!0,this.setMod("pressed","yes").bindTo("keyup",function(){this.delMod("pressed").unbindFrom("keyup"),delete this._keyDowned,i===e.SPACE&&this.domElem.attr("href")&&(document.location=this.domElem.attr("href"))}))},destruct:function(){this.delMod("focused"),this.__base.apply(this,arguments)}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.isDisabled()||this.domElem[0].contains(t.relatedTarget)||this.toggleMod("hovered","yes","pointerover"===t.type)}).liveBindTo("focusin focusout",function(t){this.toggleMod("focused","yes","focusin"===t.type)}),8===BEM.blocks["i-ua"].ie&&this.liveBindTo("mouseup mouseout",function(t){this.domElem.height()}),this.__base()}}),BEM.DOM.decl({block:"button",modName:"withFocusFix",modVal:"yes"},{onSetMod:{focused:{yes:function(){if(this.isDisabled())return!1;this.bindToWin("unload",function(){this.delMod("focused")}).bindTo("keydown",this._onKeyDown),this.trigger("focus")}}}}),BEM.DOM.decl("radiobox",{onSetMod:{js:{inited:function(){this._val=this.findElem(this.elem("radio","checked","yes"),"control").val(),this.elem("control").each(function(t,e){var i=$(e),n=this.__self._getRadioByElem(i);i.isFocused()&&this.setMod(n,"focused","yes"),i.prop("checked")&&this.setMod(n,"checked","yes")}.bind(this))}},disabled:{yes:function(){this.setMod(this.elem("radio"),"disabled","yes")},"":function(){this.delMod(this.elem("radio"),"disabled")}}},onElemSetMod:{radio:{focused:{yes:function(t){this.delMod(this.elem("radio","focused","yes"),"focused");var e=this.findElem(t,"control");e.isFocused()||e.focus(),this.afterCurrentEvent(function(){this.domElem&&this.trigger("focus",{current:t})})},"":function(t){this.afterCurrentEvent(function(){this.domElem&&this.trigger("blur",{prev:t})})}},checked:{yes:function(t){var e=this.elem("radio","checked","yes"),i=this.findElem(t,"control"),n=this._val;this._willSwitch=!0,this.delMod(e,"checked"),this._willSwitch=!1,i.prop("checked",!0),this._val=i.val(),this.trigger("change",{current:t,currentVal:this._val,prev:e,prevVal:n})},"":function(t){var e=this.findElem(t,"control"),i=this._val;e.prop("checked",!1),this._val=void 0,this._willSwitch||this.trigger("change",{current:$(),currentVal:void 0,prev:t,prevVal:i})}},hovered:function(t){return!this.isDisabled(t)},pressed:function(t){return!this.isDisabled(t)},disabled:function(t,e,i){t.find(this.buildSelector("control")).prop("disabled",i),i&&this.delMod(t,"hovered").delMod(t,"pressed")}}},isDisabled:function(t){return this.hasMod(t,"disabled","yes")},val:function(t){if(void 0===t)return this._val;var e=this;return this.elem("control").each(function(i,n){if(n.value===t)return e.setMod(e.__self._getRadioByElem($(n)),"checked","yes"),!1}),e},name:function(t){var e=this.elem("control");return arguments.length?(e.attr("name",t),this):e.attr("name")},getCurrent:function(){return this.findElem("radio","checked","yes")},uncheckAll:function(){return this.delMod(this.elem("radio","checked","yes"),"checked"),this},_onRadioEnter:function(t){this.setMod(t.data.domElem,"hovered","yes")},_onRadioLeave:function(t){this.delMod(t.data.domElem,"hovered")},_onRadioClick:function(t,e){this.isDisabled(t)||this.setMod(t,"focused","yes")},_onChange:function(t){this.setMod(this.__self._getRadioByElem(t.data.domElem),"checked","yes")},_onPointerpress:function(t){var e=t.data.domElem;this.setMod(e,"pressed","yes").bindToDoc("pointerrelease",function(){this.delMod(e,"pressed").unbindFromDoc("pointerrelease")})}},{live:function(){this.liveBindTo("radio","pointerclick",function(t){this._onRadioClick(t.data.domElem,t)}).liveBindTo("control","change",function(t){this._onChange(t)}).liveBindTo("radio","pointerover pointerout",function(t){t.data.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onRadioEnter(t):this._onRadioLeave(t))}).liveBindTo("control","focusin focusout",function(t){var e=this.__self._getRadioByElem(t.data.domElem);this.setMod(e,"focused","focusin"===t.type?"yes":""),parseInt(BEM.blocks["i-ua"].ios,10)>=8&&t.preventDefault()}).liveBindTo("radio","pointerpress",function(t){this.hasMod(t.data.domElem,"disabled")||this._onPointerpress(t)})},_getRadioByElem:function(t){return t.closest(this.buildSelector("radio"))}}),BEM.DOM.decl("radiobox",{_onRadioClick:function(t,e){this.__base.apply(this,arguments),this._onChange(e),e.preventDefault()}}),BEM.DOM.decl({block:"radio-button",baseBlock:"radiobox"},{onSetMod:{disabled:{yes:function(){this.delMod("focused"),this.__base.apply(this,arguments)}}},onElemSetMod:{radio:{pressed:{yes:function(){this.delMod(this.elem("radio","pressed","yes"),"pressed")}}}},_onPointerPress:function(t){this._pressedRadio=t.data.domElem,this.isDisabled(this._pressedRadio)||(this.setMod(this._pressedRadio,"pressed","yes"),this.bindToDoc("pointerrelease",this._onPointerRelease))},_onPointerRelease:function(t){var e=this._pressedRadio;delete this._pressedRadio,this.delMod(e,"pressed"),this.afterCurrentEvent(function(){if(this.domElem){var i=this.findElem(e,"control");i.prop("checked")||!e.is(t.target)&&!e.find(t.target).length||i.trigger("change").focus()}}),this.unbindFromDoc("pointerrelease")}},{live:function(){return this.liveBindTo("radio","pointerpress",function(t){this._onPointerPress(t)}).liveBindTo("control","focusin focusout",function(t){!this.hasMod("disabled")&&this.toggleMod("focused","yes","focusin"===t.type)}),this.__base()}}),BEM.DOM.decl({block:"radio-button",modName:"breadcrumbs",modVal:"yes"},{_onMouseEvent:function(t){var e=t.type,i=t.data.domElem,n=this.extractElemIndex(i),s=this.elem("radio").length;switch(e){case"mouseover":this.setElemsMod(s,"active","").setElemsMod(s,"checked","").setElemsMod(n,"hovered","yes").setMod(i,"checked","yes").setHint(this.extractHint(i)||this.params.hint);break;case"mouseout":this.selectedIndex||this.setActive(this.selectedIndex),this.setElemsMod(n,"hovered","").setElemsMod(s,"active","").setElemsMod(s,"checked","").setElemsMod(this.selectedIndex,"active","yes").setMod(this.selectedElem,"checked","yes").setHint(this.selectedElem&&this.extractHint(this.selectedElem)||this.params.hint);break;case"click":this.selectedIndex=n,this.selectedElem=i,this.setActive(n).setElemsMod(n,"hovered","").setMod(i,"checked","yes").setHint(this.extractHint(i)||this.params.hint),this.trigger("clicked",n)}},onElemSetMod:{radio:{checked:{yes:function(){this.delMod(this.elem("radio","checked","yes"),"checked")}}}},extractElemIndex:function(t){return this.elem("radio").index(t)+1},setElemsMod:function(t,e,i){return t&&this.setMod(this.elem("radio").slice(0,t),e,i),this},setActive:function(t){return this.setElemsMod(t,"active","yes")},setHint:function(t){return this.elem("hint").text(t||""),this},extractHint:function(t){return this.elemParams(t).hint}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("radio","click mouseover mouseout",function(t){this._onMouseEvent(t)})}}),BEM.DOM.decl("tags",{onSetMod:{js:{inited:function(){this.isResizable()&&this.bindEvents()}}},bindEvents:function(){BEM.blocks["b-page"].on("resize",this.insertMore,this)},unbindEvents:function(){BEM.blocks["b-page"].un("resize",this.insertMore,this)},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},getFullInitPromise:function(){return $.Deferred().resolve().promise()},isResizable:function(){return!this.hasMod("two-lines")},_onTagClick:function(t){var e=t.target.domElem[0].href,i=t.target.domElem.closest("."+this.__self.getName()+"__group");this.trigger("tag-click",{href:e,query:t.target.domElem.text(),pos:t.target.domElem.index(),group:i&&i.length?i.index():""})}},{live:function(){return this.liveInitOnBlockInsideEvent("click","link",function(t){this.elem("tag").is(t.target.domElem)&&this._onTagClick(t)}),!1}}),BEM.DOM.decl({block:"link",modName:"triggerable",modVal:"yes"},{},{live:function(){this.__base.apply(this,arguments),this.liveBindTo({block:"link",modName:"triggerable",modVal:"yes"},"pointerclick",function(t){this.trigger("click",{domEvent:t})})}}),BEM.DOM.decl({block:"link",modName:"target",modVal:"related-query"},{_onClick:function(t,e){this.__base.apply(this,arguments);var i=this.domElem,n=i.prop("pathname")+i.prop("search")+i.prop("hash"),s=BEM.blocks.uri.getParamValue("text"),o=BEM.blocks["i-global"].param("query"),r=BEM.blocks.uri.parse(i.prop("href")).getParam("text");r=r.length?r[0]:"",n&&r&&r!==s&&r!==o&&(t.preventDefault(),e(JSON.stringify({query:r,url:n})))}},{live:function(){var t;this.__base.apply(this,arguments),Ya&&Ya.AppsApi&&Ya.AppsApi.whenAvailable("openRelatedQuery",function(e){(t=window.YandexApplicationsAPIBackend)&&"function"==typeof t.openRelatedQuery&&"{}"===t.openRelatedQuery.toString().match(/{[^}]*}/)[0]||this.liveBindTo({block:"link",modName:"target",modVal:"related-query"},"pointerclick",function(t){this._onClick(t,e)})},this)}}),BEM.DOM.decl({block:"tags",modName:"more",modVal:!0},{_moreClickParams:{},onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.isResizable()&&(this._blockHeightUpdateInterval=setInterval(function(){this.elem("content").height()>0&&(this.insertMore(),clearInterval(this._blockHeightUpdateInterval))}.bind(this),100))}},show:{more:function(){this._removeContentMaxHeight(),this.unbindEvents()}}},destruct:function(){clearInterval(this._blockHeightUpdateInterval),this.__base.apply(this,arguments)},_onClickMore:function(){this.setMod("show","more"),this.elem("more").remove(),this.trigger("more-click",this._getMoreClickParams())},_getMoreClickParams:$.noop,insertMore:function(){for(var t=this.elem("content")[0].getBoundingClientRect().bottom,e=this.elem("tag"),i=[],n=0;n<e.length&&this._isVisibleInContainer(e[n],t);n++)i.push(e[n]);this._doInserting(i,t)},_isVisibleInContainer:function(t,e){return t.getBoundingClientRect().bottom<=e},_doInserting:function(t,e){var i=this.elem("content").height(),n=this.elem("wrapper");if(n.height()+parseInt(n.css("margin-top"))<=i)this.unbindEvents();else{this.setMod(this.elem("more"),"visible","yes");for(var s=this.elem("more")[0],o=t.length-1;o>0&&!this._tryMakeMoreVisible($(t[o]),s,e);)o--;this._isMoreInserted=!0,this._setContentMaxHeightAccordingMoreButton()}},_tryMakeMoreVisible:function(t,e,i){return t.after(e),this._isVisibleInContainer(e,i)},_setContentMaxHeightAccordingMoreButton:function(){var t=this.elem("content").offset().top,e=this.elem("more").offset().top,i=this.elem("more").outerHeight();this.elem("content").css("max-height",e-t+i)},_removeContentMaxHeight:function(){this.elem("content").css("max-height","")}},{live:function(){return this.liveBindTo("more","pointerclick",function(t){t.preventDefault(),this._onClickMore()}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"button2",baseBlock:"control"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments)}},pressed:{yes:function(){if(this.hasMod("disabled"))return!1;this.trigger("press")},"":function(){this.trigger("release")}},checked:{yes:function(){this.trigger("check").domElem.attr("aria-pressed","true")},"":function(){this.trigger("uncheck").domElem.attr("aria-pressed","false")}},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("pressed")}},focused:{"":function(){this.__base.apply(this,arguments),this.delMod("pressed")}},progress:{yes:function(){this.setMod("disabled","yes")},"":function(){this.delMod("disabled")}}},getText:function(){return this.elem("text").text()},setText:function(t){return this.elem("text").text(t),this},_onClick:function(t){(!this._preventClick||t.detail>0)&&this.trigger("click",this._buildClickEventData(t)),this._preventClick=!1},_processClick:function(t){this.trigger("click",this._buildClickEventData(t))},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(){this.delMod("pressed").unbindFromDoc("pointerrelease")},_onKeydown:function(t){var e=t.keyCode,i=BEM.blocks.keycodes;i.is(e,this.params.pressKeys)&&(this.setMod("pressed","yes"),i.is(e,this.params.prvntKeys)&&t.preventDefault())},_onKeyup:function(t){var e=t.keyCode,i=BEM.blocks.keycodes;i.is(e,this.params.prvntKeys)&&t.preventDefault(),i.is(e,this.params.pressKeys)&&(this.delMod("pressed"),i.is(e,this.params.clickKeys)&&(this._preventClick=!0,this._processClick(t)))},_buildClickEventData:function(t){return{domEvent:t,isModKey:t.ctrlKey||t.altKey||t.metaKey||t.shiftKey}},getDefaultParams:function(){return $.extend(this.__base(),{pressKeys:["SPACE","ENTER"],prvntKeys:[],clickKeys:[]})}},{live:function(){return this.liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}).liveBindTo("pointerclick",function(t){this.hasMod("disabled")||this._onClick(t)}).liveBindTo("keydown",function(t){this._onKeydown(t)}).liveBindTo("keyup",function(t){this._onKeyup(t)}),this.__base()}}),BEM.DOM.decl("button2",{onSetMod:{hovered:{yes:function(){return!this.hasMod("disabled")}},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("hovered")}}},_onPointerenter:function(){this.setMod("hovered","yes")},_onPointerleave:function(){this.delMod("hovered")},_onClick:function(){this.__base.apply(this,arguments),this._isDestructing||this.setMod("focused","yes")}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.hasMod("disabled")||this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}).liveBindTo("mousedown",function(t){t.preventDefault()}),this.__base()}}),BEM.DOM.decl("button2",{getIconWidth:function(){var t=this.elem("icon");if(t.length)return t.width()}}),BEM.DOM.decl({block:"tags",modName:"carousel",modVal:!0},{initCarousel:function(){this.blockInside("carousel")&&this.blockInside("carousel").delMod("js")},scrollToStart:function(){this.blockInside("carousel")&&this.blockInside("carousel").scrollToStart()}}),BEM.DOM.decl("carousel",{onSetMod:{js:{inited:function(){this.setScrollMod(),this.bindTo("wrap","scroll",$.throttle(this._onScroll,50,this)),BEM.blocks["b-page"].on("resize",this._onResize,this),this.hasMod("calculatingScrollStep")&&window.requestAnimationFrame(function(){this.params.calculatedScrollStep=this.getCarouselScrollStep()}.bind(this))}},scroll:{both:function(){this.trigger("scrollModChange",{type:"both"})}}},getDefaultParams:function(){return{itemMarginRight:16}},destruct:function(){BEM.blocks["b-page"].un("resize",this._onResize,this),this.__base.apply(this,arguments)},getCarouselScrollStep:function(){if(this._isDestructing)return 0;var t,e=this.elem("item");t=this.params.itemWidth?this.params.itemWidth:e?e.width()+this.params.itemMarginRight:0;var i=(this.domElem.width()||0)-30,n=Math.floor(i/t),s=this._getScrollItemsCorrection();return n+=Number(s),t?n*t:0},setScrollMod:function(){var t,e=this.scrollLeft(),i=this._getWrapHiddenWidth();return t=i<=0?"":0===e?"right":e<i?"both":"left",this.setMod("scroll",t)},checkEndOfList:function(){if(!this.params.offset)return this;var t=this.scrollLeft(),e=this._getWrapHiddenWidth();return t<=this.params.offset&&this.trigger("listOut","left"),t>e-this.params.offset&&this.trigger("listOut","right"),this},scrollToStart:function(){this.scrollLeft(0)},setItemsInList:function(t){this.getList().html(t)},getItemsFromList:function(){return this.getList().html()},setItemsInListWithInit:function(t){BEM.DOM.update(this.getList(),t)},appendItemsInList:function(t){this.getList().append(t)},appendItemsInListWithInit:function(t){BEM.DOM.append(this.getList(),t)},prependItemsInList:function(t){this.getList().prepend(t)},prependItemsInListWithInit:function(t){BEM.DOM.prepend(this.getList(),t)},getList:function(){return this.list||(this.list=this.elem("list"))},getContentWidth:function(){return this.getList().width()},getControlWidth:function(t){return this.elem("control","side",t).width()},getWrapperWidth:function(){return this.elem("wrap").width()},scrollLeft:function(t){return void 0!==t?this.elem("wrap").scrollLeft(t):Math.ceil(this.elem("wrap").scrollLeft())},flatten:$.noop,_getScrollItemsCorrection:function(){return 0},_onScroll:function(){this.setScrollMod().checkEndOfList()},_onResize:function(){this.hasMod("calculatingScrollStep")&&(this.params.calculatedScrollStep=this.getCarouselScrollStep()),this.setScrollMod()},_getWrapHiddenWidth:function(){return Math.ceil(this.elem("wrap").get(0).scrollWidth-this.elem("wrap").outerWidth())}},{live:!0}),BEM.DOM.decl("carousel",{_onMouseMove:function(t){this.setMod(t.data.domElem,"hovered","yes")},_onMouseLeave:function(){this.delMod(this.elem("control"),"hovered")}},{live:function(){this.__base(),this.liveBindTo("control","mouseover",function(t){this._onMouseMove(t)}).liveBindTo("control","mouseout",function(){this._onMouseLeave()})}}),BEM.DOM.decl("carousel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.scrollToStart(),this.setWidth(),this.items=this.elem("item")}}},getDefaultParams:function(){var t=this.__base();return t.animationTime=this.hasMod("full-scroll","yes")?400:300,t},setWidth:function(){return this.carouselWidth=this.domElem.width(),this},_onResize:function(){this.__base.apply(this,arguments),this.setWidth()}}),BEM.DOM.decl("carousel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindTo("item","pointerclick",function(t){this._onItemClick(t)})}}},setScrollMod:function(t){return this.setWidth(),this.__base.apply(this,arguments)},_onItemClick:function(t){if(this.preventClick)return this.preventClick=!1,t.stopImmediatePropagation(),t.preventDefault(),!1},_onMouseDown:function(t){this.clicked=!0,this.preventClick=!1,this.startPoint=t.clientX+this.elem("wrap").scrollLeft(),this._mouseDownX=t.clientX,this._mouseDownY=t.clientY},_onDragStart:function(t){t.preventDefault()},_onItemMouseMove:function(t){if(this.clicked&&(t.clientX!==this._mouseDownX||t.clientY!==this._mouseDownY)){if(void 0!==t.buttons&&!(1&t.buttons))return this._onMouseUp(t);this.setMod(this.elem("wrap"),"grabbing","yes"),this.elem("wrap").scrollLeft(this.startPoint-t.clientX),this.preventClick=!0}},_onMouseUp:function(){this.delMod(this.elem("wrap"),"grabbing"),this.clicked=!1},insertAfterThumb:function(t,e){this.getList().find("#gallery-"+e).after(t)},insertBeforeAllThumbs:function(t){this.getList().prepend(t)},getStep:function(){return this.params.step}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("wrap","dragstart",function(t){this._onDragStart(t)}).liveBindTo("wrap","mousedown",function(t){this._onMouseDown(t)}).liveBindTo("wrap","mousemove",function(t){this._onItemMouseMove(t)}).liveBindTo("wrap","mouseup mouseleave",function(){this._onMouseUp()})}}),BEM.DOM.decl({block:"button2",modName:"type",modVal:"link"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._url=this.params._url||this.domElem.attr("href")}},disabled:{"":function(){this.__base.apply(this,arguments),this.domElem.attr("tabindex",this.params._tabindex).attr("href",this._url)},yes:function(){this.__base.apply(this,arguments),void 0!==this._url&&this.domElem.attr("tabindex",-1),this.domElem.removeAttr("href")}}},getUrl:function(){return this._url},setUrl:function(t){return this._url=t,this.hasMod("disabled")||this.domElem.attr("href",t),this},getDefaultParams:function(){return $.extend(this.__base(),{pressKeys:["ENTER"]})}}),BEM.DOM.decl({block:"button2",modName:"type",modVal:"link"},{},{live:function(){return this.liveBindTo("dragend",function(t){this.hasMod("type","link")&&!this.hasMod("disabled")&&this.delMod("pressed")}),this.__base()}}),BEM.DOM.decl("more",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["serp-controller"].on("listOut",this._onListOut,this)}},loading:{yes:function(){this.hideButton(),this.blockInside("spin2").setMod("progress","yes")},"":function(){this.blockInside("spin2").delMod("progress")}},disabled:{yes:function(){this.hideButton()}}},destruct:function(){BEM.blocks["serp-controller"].un("listOut",this._onListOut,this),this.__base.apply(this,arguments)},_onListOut:function(t,e){var i=this.hasMod("direction","next");"left"!==e&&"up"!==e||i||this.trigger("click"),"right"!==e&&"down"!==e||!i||this.trigger("click")},_onClick:function(t){t.preventDefault(),this.trigger("click"),this.setMod("loading","yes")},startProgress:function(){return this.setMod("loading","yes"),this},stopProgress:function(){return this.delMod("loading"),this},show:function(){return this.delMod("hidden")},hide:function(){return this.setMod("hidden","yes")},showButton:function(){var t=this.blockInside("spin2");return t.hasMod("progress")&&t.delMod("progress"),this.delMod(this.elem("button"),"hidden"),this},hideButton:function(){return this.setMod(this.elem("button"),"hidden","yes"),this},url:function(t){return void 0!==t?(this.elem("button").attr("href",t),this.params.url=t,this):this.elem("button").attr("href")}},{live:function(){this.liveBindTo("button","pointerclick",function(t){this._onClick(t)})}}),BEM.DOM.decl("more",{},{live:function(){return this.__base.apply(this,arguments),!1}}),BEM.DOM.decl({block:"more",modName:"direction",modVal:"next"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["i-keyrouter"].on("special:right pagedown space",this._onLoadNextPage,this)}}},destruct:function(){BEM.blocks["i-keyrouter"].un("special:right, pagedown space",this._onLoadNextPage,this),this.__base.apply(this,arguments)},_onLoadNextPage:function(){this._isEndOfPage()&&this.trigger("click")},_isEndOfPage:function(){return window.pageYOffset+window.innerHeight>=this.__self.doc.height()}}),BEM.DOM.decl({block:"more",modName:"direction",modVal:"next"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("scroll",this._onScroll,this)}}},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_onScroll:function(){if(this.hasMod("loading","yes")){var t=window.pageYOffset+window.innerHeight,e=this.__self.doc.height(),i=this.blockInside("spin2").hasMod("position","fixed");t>e||(t-this.domElem.offset().top>=160?i||this.setSpinPosition("fixed"):i&&this.setSpinPosition(""))}},_onClick:function(){this.hasMod("last","yes")&&this.setSpinPosition(""),this.__base.apply(this,arguments)},setSpinPosition:function(t){var e="";"fixed"===t&&(e=this.domElem.offset().left+this.domElem.width()/2),this.blockInside("spin2").domElem.css("left",e),this.blockInside("spin2").setMod("position",t)}}),BEM.DOM.decl("serp-controller",{_viewParams:[],onSetMod:{js:{inited:function(){this.__self.instance=this,this.findBlocks()._setPageMod(),this.bindEvents(),this.syncState()}},infinite:{"":function(){this.disableInfiniteLoad()}}},destruct:function(){this.__self.instance=null,this.unbindEvents(),this.__base.apply(this,arguments)},findBlocks:function(){return this.page=this.findBlockOutside("b-page"),this.location=BEM.blocks.location.getInstance(),this},bindEvents:function(){return BEM.blocks.more.on("click",this._onMoreClick,this),BEM.blocks["serp-item"].on(this.domElem,"clicked",this._onItemClicked,this),BEM.blocks["serp-item"].on(this.domElem,"selected",this._onItemSelected,this),this},unbindEvents:function(){return BEM.blocks.more.un("click",this._onMoreClick,this),BEM.blocks["serp-item"].un(this.domElem,"clicked",this._onItemClicked,this),BEM.blocks["serp-item"].un(this.domElem,"selected",this._onItemSelected,this),this},_onPageChanged:function(){this._setPageMod().syncState(),c&&Ya.Rum.setSetting("reqid",c.getReqId()),this.__base.apply(this,arguments)},_setPageMod:function(){return this.setMod("page",this.page.getMod("type")),this},_onMoreClick:function(t){var e=t.block.getMod("direction");this.hasMod("loading","yes")||(this.load(e),"prev"===e&&this.location.change({url:t.block.params.url,history:!1,trigger:!1}))},syncState:function(){this.loadInitialItem(),this._competitors=this.findBlockInside("competitors")},showFooter:function(){var t=this.page.blockInside("footer");return t&&t.show(),this.toggleCompetitors(),this},toggleCompetitors:function(){return BEM.blocks["i-global"].param("isPumpkin")?this:(this._competitors&&this._competitors.domElem&&this._competitors.setMod("visibility",BEM.blocks["i-global"].param("query")?"":"hidden"),this)},hideFooter:function(t){var e=this.page.blockInside("footer");return e&&(t?e.transparent():e.hide()),this._competitors&&this._competitors.setMod("visibility",t?"transparent":"hidden"),this},findMore:function(t){var e="_more"+t,i=this[e];return i&&i.domElem||(this[e]=this.findBlockInside({block:"more",modName:"direction",modVal:t})),this[e]},checkListOut:function(t){var e=t.params.pos,i=this.changeThis(this.getStraightItem||this.getNearItem)(t,1),n=Boolean(this.getItemByPos(Number(e)+5).length);return i&&n||this.trigger("listOut","right"),this},addReqId:function(t){return t&&(t.params.reqid=c.getReqId(t.domElem)||!1),this},delViewParams:function(t){return this.location.change({url:BEM.blocks.uri.delParams(location.href,t||this._viewParams),trigger:!1,history:!1}),this},_getInfiniteSerpListParams:function(){return{}}},{get:function(){if(!this.instance){var t=$(this.buildSelector());this.instance=t.length?t.bem(this.getName()):null}return this.instance},live:function(){return this.liveInitOnBlockOutsideEvent("change","b-page",function(t,e){this._onPageChanged(t,e)}),this.liveInitOnBlockOutsideEvent("contentLoaded","b-page",function(){this._onContentLoaded()}),!1}}),BEM.DOM.decl("serp-controller",{onSetMod:{loading:{yes:function(){this.trigger("loading")}}},_getSerpList:function(){return this._serpList||(this._serpList=this.findBlockInside("serp-list"))},isCurrentPageLast:function(){var t=this._getSerpList();return!t||t.isCurrentPageLast()},getInitialPageNum:function(){var t=this._getSerpList();return t?t.getInitialPageNum():0},getDocsPerPage:function(){return this.params.docsPerPage},_getInfiniteSerpListParams:function(){return{initialPageNum:this.getInitialPageNum()}},getScrollPagesCount:function(){return this.params.count}}),BEM.DOM.decl("serp-controller",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.cacheMore&&this.setMod("cached-more","yes"),this._setPageMod()}},loading:{yes:function(){this.trigger("loading")}}},syncState:function(){return this.hasMod("page","search")&&(this.relatedBottom=this.findBlockInside({block:"related",modName:"position",modVal:"bottom"})),this._prevention=this.findBlockInside("prevention"),this.__base.apply(this,arguments)},_setPageMod:function(){var t="similar"===this.page.getMod("type"),e=this._viewParams.indexOf("rpt");return t?(e>-1&&this._viewParams.splice(e,1),this.setMod("page","search")):(-1===e&&this._viewParams.push("rpt"),this.setMod("page",this.page.getMod("type")))},showFooter:function(){return this.hasMod("page","search")&&this.relatedBottom&&this.relatedBottom.show(),this._prevention&&this._prevention.setMod("visible"),this.__base.apply(this,arguments)},hideFooter:function(){return this.hasMod("page","search")&&this.relatedBottom&&this.relatedBottom.hide(),this._prevention&&this._prevention.delMod("visible"),this.__base.apply(this,arguments)}}),BEM.DOM.decl("serp-controller",{_req:{},destruct:function(){this._clearRequestStack(),this.__base.apply(this,arguments)},_clearRequestStack:function(){return BEM.blocks.utils.forOwn(this._req,function(t){t.abort()}),this._req={},this},syncState:function(){this._clearRequestStack(),this._resetLoading("prev"),this._resetLoading("next"),this.__base.apply(this,arguments)},getRequest:function(t,e){var i={url:BEM.blocks.uri.getPath(t),ctx:this,cache:!0};return Object.assign(i,e),BEM.create("i-request_type_bem",i)},load:function(t,e){this._loadPage(t,e)&&(this._onListLoading(t),this._setLoading(t))},_setLoading:function(t){this.setMod("loading","yes");var e=this.findMore(t);return e&&e.startProgress(),this},_resetLoading:function(t){this.delMod("loading");var e=this.findMore(t);return e&&e.stopProgress(),this},_loadPage:function(t,e){var i=this.params[t+"PageUrl"],n=BEM.blocks.uri.parseParams(i);return!!i&&(e=Object.assign(e||{},{direction:t}),Object.assign(n,this.__self.getUrlRequestParams()),n.suggest_reqid=this.page.suggestReqID||BEM.blocks["i-global"].param("suggest_reqid"),this._sendRequest(n,e),!0)},_sendRequest:function(t,e){var i=this.getRequest(this.params[e.direction+"PageUrl"],e);this._req[t.p]=i,this.setRequestBlocks(i,e),i.get(t,this._onAjaxSuccess)},_onAjaxSuccess:$.noop,setRequestBlocks:function(t,e){var i=e.direction;return t.block("serp-controller",function(t){this._onSerpControllerLoaded(t,i)}.bind(this)).block("serp-list_infinite_yes",function(t){this._onListLoadSuccess(t,i)}.bind(this),function(){this._onListLoadError(i)}.bind(this),this._getInfiniteSerpListParams()).block("more_direction_"+i,this._onMoreDataLoaded),this},_onSerpControllerLoaded:function(t,e){this.params[e+"PageUrl"]=t.params[e+"PageUrl"]},_onContentLoaded:function(){var t=this.findMore("next");t&&t.params.visible||this.afterCurrentEvent(this.showFooter)},_onListLoading:$.noop,_onListLoadSuccess:$.noop,_onListLoadError:$.noop,_onMoreDataLoaded:function(t){var e=t.params.direction,i=t.params.visible,n=this.findMore(e);n&&(this._resetLoading(e),n.url(t.params.url).setMod("disabled",i?"":"yes").setMod("hidden",i?"":"yes"),this["_onMoreDataLoaded"+e](t,n))},_onMoreDataLoadednext:function(t,e){var i=t.params.visible,n=this.getListCount()%this.params.count==0;e.setMod("last",n?"yes":"no"),this.hideFooter(),this.isMoreButtonShouldShown(i)&&(this.trigger("infiniteLoadStop"),e.showButton(),this.showFooter()),i||this.showFooter()},isMoreButtonShouldShown:function(t){return t&&this.getListCount()%this.params.count==0},_onMoreDataLoadedprev:function(t,e){t.params.visible&&e.showButton()}},{getUrlRequestParams:function(){var t={serpid:BEM.blocks["i-global"].param("serpid")},e=BEM.blocks.location.getInstance();return["rdpass","tpid","testRunId"].forEach(function(i){e.hasParam(i)&&(t[i]=e.getParamValue(i))}),t}}),BEM.DOM.decl("serp-controller",{_updateListData:function(t,e){this._getSerpList()&&this._getSerpList().addSerpItems(t,e)},_onListLoading:function(t){this.__base.apply(this,arguments),this._setLoading(t),this.trigger("loading")},_onListLoadSuccess:function(t,e){this.__base.apply(this,arguments),this._resetLoading(e),this._updateListData(t,e),this.trigger("loaded",{params:t.params,direction:e})},_onListLoadError:function(t){this.__base.apply(this,arguments),this._resetLoading(t),this.trigger("loadError")}},{getUrlRequestParams:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["i-global"].param("verticalSerp")?t.serpListType="vertical":t.serpListType="horizontal",Object.assign(t,{uinfo:BEM.blocks["i-userinfo"].get().getUserInfo()})}}),BEM.DOM.decl("serp-controller",{setRequestBlocks:function(t){return this.__base.apply(this,arguments),t.block("gallery__items:ajax",this._onGalleryLoaded),this},_onGalleryLoaded:function(t){window.inNextFrame(function(){this.trigger("galleryLoaded",t)},this)},_onContentLoaded:function(){this.__base.apply(this,arguments),this._serpList=void 0,this.setMod("height",this._isFullHeightAllowed()?"full":"")},_isFullHeightAllowed:function(){var t=this.hasMod("page","search"),e=this.findMore("next"),i=e&&e.params.visible;return!BEM.blocks["i-global"].param("showRelevance")&&!BEM.blocks["i-global"].param("mobile")&&t&&i}}),BEM.DOM.decl("serp-controller",{deviation:5,itemSelector:".serp-item",getBlockByDirection:function(t){var e,i=this.getCurrentItem(),n=i&&i.params.pos;if(i)return n>=0&&"left"===t?e=this.getNearItem(i,-1):"right"===t&&(e=this.getNearItem(i,1)),e&&e.length?e.bem("serp-item"):void 0},getNearItem:function(t,e){return this.getNearItemBySibling(t,e)||this.getNearItemByIdx(t,e)||this.getNearItemByPos(t,e)},getNearItemBySibling:function(t,e){var i=t.domElem[e>0?"next":"prev"](this.itemSelector);return i.length&&i},getNearItemByPos:function(t,e){for(var i=[],n=t.params.pos,s=n;0===i.length&&Math.abs(n-s)<this.deviation;)s+=e,i=this.getItemByPos(s);return i.length&&i},getNearItemByIdx:function(t,e){var i=t.domElem.index(this.itemSelector)+e,n=i>=0?$(this.itemSelector).eq(i):$([]);return n.length&&n},getStraightItem:function(t,e){var i,n,s,o,r,a,h,c,l,u=t.domElem,d=u.offset(),p=0,f=0;for(BEM.blocks.utils.isEmpty(u)||BEM.blocks["scroll-spy"].getElemVisibility(u).visible||((a=this.getVisibleNearItem(u,-1))&&(u=a),d=u.offset()),n=Math.floor(d.left+u.width()/2),s=d.top,r=(o=this.getVisibleNearItem(u,e))&&o.offset();o&&p<=30&&(p++,!(r.top!==s&&(s=r.top,++f>2)));){if(h=n-r.left,c=r.left+o.width()-n,l=Math.min(Math.abs(h),Math.abs(c)),h>=0&&c>=0||l<7){i=o;break}r=(o=this.getVisibleNearItem(o,e))&&o.offset()}return i},getVisibleNearItem:function(t,e){for(var i=this.getNearItem(t.bem("serp-item"),e);i&&i.hasClass("serp-item_extra_yes");)i=this.getNearItem(i.bem("serp-item"),e);return i},getItemByPos:function(t){return $(".serp-item_pos_"+t+":eq(0)")},getItemParamsByPos:function(t){var e=this.getItemByPos(t);return e.length?e.bem("serp-item").params:null},getItemById:function(t){var e=$("#"+t);return e.length?e.bem("serp-item"):void 0},selectItem:function(t){return t.setMod("selected","yes"),this},getSelectedItemId:function(){return(this.params.item||{}).selected},getSelectedItem:function(){var t=this.getSelectedItemId();return t&&this.getItemById(t)},getCurrentItem:function(){return BEM.blocks["serp-item"].getCurrent()},getPrevItem:function(){return BEM.blocks["serp-item"].getPrev()},selectCurrentItem:function(){var t=this.getCurrentItem();return t&&this.selectItem(t),this},unselectCurrentItem:function(){return BEM.blocks["serp-item"].delSelected(),this}}),BEM.DOM.decl("serp-controller",{getNearItem:function(t,e){return BEM.blocks["i-global"].param("verticalSerp")?this.getNearItemByPos(t,e):this.__base.apply(this,arguments)}}),BEM.DOM.decl("serp-controller",{getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.blinkTime=1e3,t},loadInitialItem:function(){},blinkCurrentItem:function(){var t=this.getCurrentItem();return t&&(t.setMod("blink","yes"),setTimeout(function(){t&&t.domElem&&t.delMod("blink")},this.params.blinkTime)),this}}),BEM.DOM.decl("serp-controller",{onSetMod:{js:{inited:function(){var t=this.getRejectedParams();this.__base.apply(this,arguments),t&&t.length&&(BEM.blocks["i-ua"].ie>=10?setTimeout(this.removeParams.bind(this,t),this.__self.DELAY_REMOVE_PARAMS):this.removeParams(t))}}},getDefaultParams:function(){var t=this.__base.apply(this,arguments)||{};return t.rejectedParams=["parent-reqid","uinfo","photo-upload"],t},getRejectedParams:function(){var t=BEM.blocks.uri.parseParams();return this.params.rejectedParams.filter(function(e){return Boolean(t[e])})},removeParams:function(t){this.delViewParams(t)}},{DELAY_REMOVE_PARAMS:3e3}),BEM.DOM.decl({block:"serp-controller",modName:"infinite",modVal:"yes"},{offset:{default:700,serp:700,view:2e3},syncState:function(){return this.__base.apply(this,arguments),this.updateInfiniteLoadState(!0),this},unbindEvents:function(){return this.__base.apply(this,arguments),this.disableInfiniteLoad(),this},enableInfiniteLoad:function(){var t=this.findMore("next");t&&t.setMod("disabled","yes"),BEM.blocks["b-page"].on("scroll resize",this.tryLoad,this)},disableInfiniteLoad:function(){var t=this.findMore("next");t&&t.delMod("disabled"),BEM.blocks["b-page"].un("scroll resize",this.tryLoad,this)},updateInfiniteLoadState:function(){var t=this.needMore();BEM.channel("infinite-load").trigger("infinite-load-state",t),t?(new window.rafQueue).add(this.enableInfiniteLoad,this).add(this.tryLoad,this).run():(new window.rafQueue).add(this.disableInfiniteLoad,this).add(this.toggleCompetitors,this).run()},getListCount:function(){return this.findElem("list").length},_onMoreDataLoaded:function(t){this.__base.apply(this,arguments),"next"===t.params.direction&&this.updateInfiniteLoadState()},tryLoad:function(){(new window.rafQueue).add(function(){!this.hasMod("loading","yes")&&this._isEndOfPage()&&(this.disableInfiniteLoad(),this.load("next"))}.bind(this)).run()},_isEndOfPage:function(){var t,e=window.pageYOffset+window.innerHeight,i=this.findMore("next");return!!i&&(t=i.domElem.offset().top,e+this.offset.default>=t)},needMore:function(){return this.getListCount()%this.params.count!=0}}),BEM.DOM.decl({block:"serp-controller",modName:"infinite",modVal:"yes"},{getListCount:function(){var t=this._getSerpList();return t?t.getPagesCount():0},_isEndOfPage:function(){return!this.page.hasMod("fullscreen","yes")&&this.__base.apply(this,arguments)},needMore:function(){return!!this.page.hasMod("fullscreen","yes")||!this.hasMod("page","index")&&this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"index"},{syncState:function(){return this.showFooter(),this.__base.apply(this,arguments)},_onItemClicked:function(t,e){this.location.change({block:"b-page_type_search",url:e.params.detail_url},t)}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"search"},{_otherSitesBlockName:"other-sites",_otherSitesItemsBlockName:"other-sites__items",syncState:function(){return this.__self._removedThumbs&&this.__self._removedThumbs.empty(),this.__self._removedGalleryThumbs&&this.__self._removedGalleryThumbs.empty(),this.__base.apply(this,arguments)},_onPageChanged:function(){window.Ya.Images.ThumbsStore.clear(),this.__base.apply(this,arguments)},getLastPage:function(){return this._getSerpList().getLastPageNumber()}}),function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=Number(new Date),n=Math.max(0,16-(i-t)),s=setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.rafQueue=function(){var t=[];this.add=function(e,i){return Array.isArray(e)||(e=[e]),e.forEach(function(e){var n;"object"==typeof e&&e&&e.fn&&(n=(e=e.fn).ctx),t.push({fn:e,ctx:n||i})}),this},this.run=function(){var e,i=window.requestAnimationFrame,n=function(){0!==t.length&&((e=t.shift()).ctx?e.fn.call(e.ctx):e.fn(),i(n))};i(function(){i(n)})}},window.inNextFrame=function(t,e,i){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){e?t.call(e,i):t(i)})})}}(),BEM.DOM.decl("scroll-spy",{onFirstBecameVisible:function(t,e){var i=this.params.visibilityConditions;this.__self.notifyBecameVisible(this.domElem,t,e,i)}},{SCROLL_EVENT:"scroll touchmove",SCROLL_SMOOTHING:50,live:!0,init:function(){void 0===this._watchedElements&&(this._win=BEM.DOM.win,this._watchedElements=[],this._onScrollSmooth=$.debounce(this._onScroll,this.SCROLL_SMOOTHING,this))},getElemVisibility:function(t){if(!t||!t.is(":visible"))return{visible:!1,x:0,y:0,area:0};var e=t[0].getBoundingClientRect();if(e.right<=0||e.left>=window.innerWidth||e.bottom<=0||e.top>=window.innerHeight)return{visible:!1,x:0,y:0,area:0};var i=e.width*e.height,n=this.getIntersection(e,{top:0,right:window.innerWidth,bottom:window.innerHeight,left:0});return{visible:!0,x:e.width?n.xOverlap/e.width:0,y:e.height?n.yOverlap/e.height:0,area:i?n.overlapArea/i:0}},getIntersection:function(t,e){var i=Math.min(t.right,e.right)-Math.max(t.left,e.left),n=Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top);return i<0&&(i=0),n<0&&(n=0),{xOverlap:i,yOverlap:n,overlapArea:i*n}},watchVisibility:function(t,e,i){if(void 0===this._watchedElements&&this.init(),!t)throw new Error("Dom elem required");if(!e)throw new Error("Callback required");if(!t.length)throw new Error("Can't watch empty collection");var n=$.identify(t[0]);return this.isElemWatched(t,e)||(this._watchedElements.push({id:n,domElem:t,callback:e,ctx:i||null}),this._setupScrollListener()),this},stopWatchingVisibility:function(t,e,i){if(!t.length||void 0===this._watchedElements)return this;i=i||null;var n=$.identify(t[0]),s=e?function(t){return!(t.id===n&&t.callback===e&&t.ctx===i)}:function(t){return t.id!==n};return this._watchedElements=this._watchedElements.filter(s),this._setupScrollListener(),this},_setupScrollListener:function(){var t=this._watchedElements.length;1!==t||this._listeningScroll?0===t&&(this._win.off(this.SCROLL_EVENT,this._onScrollSmooth),this._listeningScroll=!1):(this._win.on(this.SCROLL_EVENT,this._onScrollSmooth),this._listeningScroll=!0)},_onScroll:function(){for(var t=0;t<this._watchedElements.length;t++){var e=this._watchedElements[t],i=this.getElemVisibility(e.domElem);setTimeout(e.callback.bind(e.ctx,i),0)}},isElemWatched:function(t,e,i){if(void 0===this._watchedElements&&this.init(),!t.length)return!1;var n=$.identify(t[0]);return i=i||null,this._watchedElements.some(function(t){return t.id===n&&t.callback===e&&t.ctx===i})},notifyBecameVisible:function(t,e,i,n){void 0===this._watchedElements&&this.init();var s=e.bind(i),o=this.getElemVisibility(t);if(this.checkVisibilityConditions(n,o))return setTimeout(s,0);this.watchVisibility(t,function e(i){this.checkVisibilityConditions(n,i)&&(setTimeout(s,0),this.stopWatchingVisibility(t,e,this))},this)},checkVisibilityConditions:function(t,e){void 0===this._watchedElements&&this.init();var i=e.visible;if(i)for(var n in t)if(t.hasOwnProperty(n)){var s=e[n]>=t[n];if(!(i=i&&s))break}return i}}),BEM.DOM.decl({block:"serp-controller",modName:"navigation",modVal:"yes"},{extraScroll:80,isInitialScrollDone:!1,findBlocks:function(){return this.navigation=this.findBlockOn("navigation-controller"),this.__base.apply(this,arguments)},bindEvents:function(){return this.params.item&&this.params.item.selected&&(this.bindToWin("load scroll",this.initialScroll),this.bindToWin("focus",this.initialScrollOnFocus),this.bindToWin("blur",this.unbindInitialScrollOnFocus)),this.__base.apply(this,arguments)},unbindInitialScrollOnFocus:function(){this.unbindFromWin("focus",this.initialScrollOnFocus),this.unbindFromWin("blur",this.unbindInitialScrollOnFocus)},initialScrollOnFocus:function(){this.initialScrollToSelected(),this.unbindFromWin("focus",this.initialScrollOnFocus),this.unbindFromWin("blur",this.unbindInitialScrollOnFocus),this.location.un("b-page_type_search",this.initialScrollOnFocus,this)},initialScroll:function(){this.isInitialScrollDone||this.initialScrollToSelected(),this.unbindFromWin("load scroll",this.initialScroll),this.location.un("b-page_type_search",this.initialScroll,this),this.isInitialScrollDone=!0},needScrollTo:function(t){return"function"==typeof this.isViewLayout&&this.isViewLayout()||t.offset().top>.7*this.__self.win.height()},initialScrollToSelected:function(){var t,e,i=this._getItemShouldScrollTo();i&&(t=i.domElem,e=this.needScrollTo(t)?t:this.__self.win.scrollTop(),this.page.scrollTo(e,950,this.extraScroll))},_getItemShouldScrollTo:function(){return this.getCurrentItem()}}),BEM.DOM.decl({block:"serp-controller",modName:"navigation",modVal:"yes"},{needMore:function(){return!!this.hasMod("page","search-by-image")||this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"serp-controller",modName:"navigation",modVal:"yes"},{extraScroll:150,initialScroll:function(){"wiz"===BEM.blocks.uri.getParamValue("source")&&(this.isInitialScrollDone=!0),this.__base.apply(this,arguments)}}),BEM.DOM.decl("serp-controller",{bindEvents:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("scroll",this._onScroll,this),this._enablePointerEventsDebounced=$.debounce(this._enablePointerEvents,300,this)},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_needPointerEventsSwitching:function(){return!BEM.blocks["i-global"].param("mobile")&&BEM.blocks["i-ua"].isPointerEventsAvailable()},_onScroll:function(){this._needPointerEventsSwitching()&&(this.hasMod(this._getContent(),"pointer-events","none")||this._disablePointerEvents(),this._enablePointerEventsDebounced())},_disablePointerEvents:function(){this.setMod(this._getContent(),"pointer-events","none")},_enablePointerEvents:function(){this.delMod(this._getContent(),"pointer-events")},_getContent:function(){return this._content||(this._content=this.findElem("content"))},_onPageChanged:function(){this.__base.apply(this,arguments),this._content=void 0}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"search-by-image"},{_nextDupsUrlChanged:!1,_updateListData:function(t,e){var i=this.findBlockInside(this._otherSitesBlockName);i&&i.loadSites(t)},_onListLoadSuccess:function(t,e){this.__base.apply(this,arguments),void 0===this._pagesCount&&(this._pagesCount=0),this._pagesCount++},_onMoreDataLoaded:function(t){!(t.params.visible&&this.params.nextPageUrl||this._nextDupsUrlChanged)&&this.params.nextPageUrlCBIR?(t.params.visible=!0,this._nextDupsUrlChanged=!0,this.params.nextPageUrl=this.params.nextPageUrlCBIR):t.params.visible=!1,this.__base.apply(this,arguments)},needMore:function(){return 2!==this._pagesCount&&this.__base.apply(this,arguments)},syncState:function(){this._pagesCount=0,this.__base.apply(this,arguments),this._nextDupsUrlChanged=!1,this.delMod("loading")},load:function(){var t,e=this.params.nextPageUrl;return e||this._nextDupsUrlChanged||(this._nextDupsUrlChanged=!0,this.params.nextPageUrl=this.params.nextPageUrlCBIR,e=this.params.nextPageUrlCBIR),!!e&&((t=this.getRequest(e)).block({block:this._otherSitesItemsBlockName,mods:{description:"yes"}},function(t){this._onListLoadSuccess(t,"next")}.bind(this),function(){this._onListLoadError("next")}.bind(this)).block("serp-controller",function(t){this.params.nextPageUrl=t.params.nextPageUrl}.bind(this)).block("more_direction_next",this._onMoreDataLoaded),t.get(BEM.blocks["i-url-controller"].mergePassedUrlParams(BEM.blocks["serp-controller"].getUrlRequestParams(),BEM.blocks.uri.parseParams(e))),this._onListLoading(),this._setLoading("next"),!0)}}),BEM.DOM.decl({block:"serp-controller",modName:"page",modVal:"search-by-image"},{_otherSitesBlockName:"other-sites",_otherSitesItemsBlockName:"other-sites__items"}),BEM.DOM.decl("navigation-controller",{onSetMod:{js:function(){this.__self.instance=this,this.serp=this.findBlockOn("serp-controller"),this.page=this.findBlockOutside("b-page"),this.bindEvents()}},bindEvents:function(){},goTo:function(t,e,i){var n=this.serp.getBlockByDirection(t);return n?(n.click(i||"keyboard",t),e&&this.hasMod("scrollable","yes")&&this.scroll(t),!0):(this.serp.trigger("listOut",t),!1)}},{get:function(){return this.instance}}),BEM.DOM.decl("navigation-controller",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.ROW_HEIGHT=190}}},scroll:function(t){return"left"===t||"up"===t?this.tryScrollTop():"right"!==t&&"down"!==t||this.tryScrollBottom(),this},tryScrollBottom:function(){var t=this.__self.win,e=t.height(),i=t.scrollTop()+e,n=this.getOffset()+this.ROW_HEIGHT,s=i-n;(s<this.ROW_HEIGHT||s>e)&&this.page.scrollTo(n+this.ROW_HEIGHT-e,200)},tryScrollTop:function(){var t=this.__self.win,e=this.getOffset(),i=this.page._headerHeight+9,n=e-t.scrollTop();(n<this.ROW_HEIGHT||n>t.height())&&this.page.scrollTo(e-this.ROW_HEIGHT-i,200)},getOffset:function(){var t=BEM.blocks["serp-item"].getCurrent();return t?t.domElem.offset().top:0}}),BEM.DOM.decl("serp-controller",{syncState:function(){return this.params.hoverTime>0&&(clearInterval(this._sendHoverInterval),this._sendHoverInterval=setInterval(this.sendHoverStats.bind(this),this.params.hoverTime)),this.__base.apply(this,arguments)},sendHoverStats:function(){var t,e=BEM.blocks["serp-item"].anim;BEM.blocks.utils.isEmpty(BEM.blocks["serp-item"].hovered)||(t=JSON.stringify(BEM.blocks["serp-item"].hovered),Object.keys(e).length&&(t+=",-anim="+JSON.stringify(e)),c.hit({dtype:"iweb",path:"/image/new/serp/hover",serpid:BEM.blocks["i-global"].param("serpid"),vars:"858,-info="+t}),BEM.blocks["serp-item"].hovered={},BEM.blocks["serp-item"].anim={})}}),BEM.DOM.decl({block:"serp-controller",modName:"prefetch",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),"search"===BEM.blocks["i-global"].param("page")&&this._loadPage("next",{cacheRequest:!0})}}},_clearRequestStack:function(){return BEM.blocks.utils.forOwn(this._req,function(t){t.reject()}),this._req={},this},setRequestBlocks:function(t,e){return e.cacheRequest?(t.block("serp-controller",$.noop).block("serp-list_infinite_yes",$.noop,$.noop,this._getInfiniteSerpListParams()).block("more_direction_"+e.direction,$.noop).block("gallery__items:ajax",$.noop),this):this.__base.apply(this,arguments)},_loadPage:function(t,e){var i=this.params[t+"PageUrl"],n=BEM.blocks.uri.parseParams(i),s=n.p;if(!i)return!1;if(e=Object.assign(e||{},{direction:t}),Object.assign(n,this.__self.getUrlRequestParams(e.direction)),this._req[s]&&e&&e.cacheRequest)return!0;if(this._req[s]){var o=this;return this._req[s].done(function(){return o._sendRequest(n,e)}),!0}return this._sendRequest(n,e),!0},_sendRequest:function(t,e){var i=$.Deferred(),n=this.getRequest(this.params[e.direction+"PageUrl"],e);this._req[t.p]=i,this.setRequestBlocks(n,e),n.get(t,this._onAjaxSuccess.bind(this,i))},_onAjaxSuccess:function(t){t.resolve&&t.resolve()}}),BEM.DOM.decl({block:"serp-controller",modName:"prefetch",modVal:"yes"},{_onSerpControllerLoaded:function(t,e){this.__base.apply(this,[t,e]),this._loadPage(e,{cacheRequest:!0})}}),BEM.DOM.decl({block:"serp-controller",modName:"height",modVal:"full"},{onSetMod:{height:{"":function(){this._removeEmptySpace()}}},findBlocks:function(){return this.__base.apply(this,arguments),this.layout=this.findBlockOn("page-layout"),this},_emptySpaceAdded:!1,_addSpace:function(){var t=this._getSerpList();if(t){var e=t.domElem.height()/t.getPagesCount(),i=t.getCurrentPageNumber(),n=t.getLastPageNumber()-i,s=Math.min(n,this.params.count);0!==i&&s--,this.layout.setHeight(this.layout.getHeight()+e*s)}},enableInfiniteLoad:function(){this.__base.apply(this,arguments),!this._emptySpaceAdded&&this._isFullHeightAllowed()&&(window.inNextFrame(this._addSpace,this),this._emptySpaceAdded=!0)},disableInfiniteLoad:function(){this.__base.apply(this,arguments),this.needMore()&&this._getSerpList()&&!this._getSerpList().isCurrentPageLast()||this._removeEmptySpace()},_removeEmptySpace:function(){this.layout.setDefaultHeight(),this._emptySpaceAdded=!1}}),BEM.DOM.decl({block:"serp-controller",modName:"vertical-shadowed",modVal:!0},{updateInfiniteLoadState:function(){this.__base.apply(this,arguments),window.Ya.Images.verticalSerpList&&(this.needMore()?this._getSerpList().hideShadow():this._getSerpList().showShadow())}}),BEM.DOM.decl({block:"serp-controller",modName:"grid-counter",modVal:!0},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["incut-controller"].on("completed",this._onIncutInsertionCompleted,this),BEM.blocks.search2.on("search:page:changed",this._onQueryChange,this),this._setGridFirstPage(!0)}}},_onQueryChange:function(){this._setGridFirstPage(!0),this._tagsLogged=!1},_setGridFirstPage:function(t){this._gridFirstPage=t},_isGridFirstPage:function(){return this._gridFirstPage},_isSearchPage:function(){return"search"===BEM.blocks["i-global"].param("page")},_onPageChanged:function(){var t=this.__base.apply(this,arguments);return this._setGridFirstPage(!0),t},destruct:function(){BEM.blocks["incut-controller"].un("completed",this._onIncutInsertionCompleted,this),BEM.blocks.search2.un("search:page:changed",this._onQueryChange,this),this.__base.apply(this,arguments)},_getGridTopOffset:function(){var t;if(void 0===this._gridTopOffset){if(!(t=this._getSerpList())||!t.domElem)return 0;this._gridTopOffset=t.domElem.offset().top}return this._gridTopOffset},_onIncutInsertionCompleted:function(t,e){"prev"!==e.dir&&this._isSearchPage()&&this._hitGridCounter()},_gridToString:function(t){return t?t.map(function(t){var e=[t.x,t.y,t.w,t.h];return void 0!==t.col&&e.push(t.col),void 0!==t.row&&e.push(t.row),t.type+":"+e.join(",")}).join(";"):""},_hitGridCounter:function(){var t=this._getGridMeta(),e=BEM.blocks["i-ua"];c.cpHitDelayed({pid:40,cid:73576,path:"desktop"===window.Ya.Images.platform?"8.228.471.436.3223":"8.584.471.436.3223",vars:["-grid="+this._gridToString(t.grid),"-viewport="+e.width+";"+e.height,"-type="+t.type].join(",")})},_getVerticalGrid:function(){if(!window.Ya||!window.Ya.Images)return[];var t=window.Ya.Images.JustifierStore||{},e=t.meta,i=[];if(!e)return i;var n,s,o,r,a=t.gap.vertical,h=t.gap.between,c=0,l=0,u=document.querySelectorAll(".serp-list .incut.incut_inserted_yes:not(.justifier__incut)"),d=this._getPageLayoutLeftMargin(),p=this._getTopIncutsHeight();for(o=0;o<e.length;o++)this._updateCurrentTopOffset(p,o);for(this._setCurrentLeftOffset(d),s=0;s<u.length;s++)if(n={domElem:u[s],type:u[s].getAttribute("data-type")},"top"!==u[s].getAttribute("data-position-type")&&!this._tagsLogged){c=parseInt(getComputedStyle(u[s]).marginBottom,10),l=isNaN(c)?0:c,r=this._getItemMeta("vertical",n,s,{left:h}),i.push(r);for(var f=0;f<e.length;f++)this._updateCurrentTopOffset(r.h+l,f);"tag"===n.type&&(this._tagsLogged=!0)}return e.forEach(function(t){o=t.col,r=this._getItemMeta("vertical",t,o,{left:h}),i.push(r),this._updateCurrentTopOffset(r.h+a,o)}.bind(this)),i},_getHorizontalGrid:function(){if(!(window.Ya&&window.Ya.Images&&window.Ya.Images.Justifier&&window.Ya.Images.Justifier.config))return[];var t,e,i,n,s,o=window.Ya.Images.Justifier.config.marginRight||0,r=window.Ya.Images.JustifierMeta.rows||[],a=window.Ya.Images.JustifierMeta.incuts||[],h=this._grid.currentRow,c=this._getPageLayoutLeftMargin(),l=[],u=this._getTopIncutsHeight();for(this._updateCurrentTopOffset(u),t=0;t<r.length;t++)(e=r[t])&&e.length&&((n=(a[(i=e[0]).id]||{}).before)&&(this._setCurrentLeftOffset(c),n.forEach(function(t){var e=this._getItemMeta("horizontal",t,h++);l.push(e),this._updateCurrentTopOffset(e.h)},this)),this._setCurrentLeftOffset(c),e.forEach(function(e,i){if(0===t&&0===i){var n=e.domElem.previousElementSibling;if(n&&(n.classList.contains("incut_type_direct")&&n.classList.contains("incut_inserted_yes")||n.classList.contains("direct_type_between"))){var s={domElem:n,type:"d"},r=this._getItemMeta("horizontal",s,h);l.push(r),this._updateCurrentTopOffset(r.h)}}var a=this._getItemMeta("horizontal",e,h);l.push(a),this._updateCurrentLeftOffset(e.width+o)},this),this._updateCurrentTopOffset(i.height+o),h++,(s=(a[e[e.length-1].id]||{}).after)&&(this._setCurrentLeftOffset(c),s.forEach(function(t){var e=this._getItemMeta("horizontal",t,h++);l.push(e),this._updateCurrentTopOffset(e.h)},this)),this._grid.currentRow=h);return l},_getTopIncutsHeight:function(){var t,e=0,i=document.querySelectorAll('.incut[data-position-type="top"]');for(t=0;t<i.length;t++)e+=i[t].clientHeight;return e},_getPageLayoutLeftMargin:function(){if(void 0===this._pageLayoutLeftMargin){var t=document.querySelector(".page-layout__column_type_content"),e=0;t&&(e=parseInt(getComputedStyle(t).marginLeft,10)),this._pageLayoutLeftMargin=isNaN(e)?0:e}return this._pageLayoutLeftMargin},_getCurrentTopOffset:function(t){var e=t||0;return Array.isArray(this._grid.colsHeights)||(this._grid.colsHeights=[]),void 0===this._grid.colsHeights[e]&&(this._grid.colsHeights[e]=this._grid.topOffset||0),this._grid.colsHeights[e]},_updateCurrentTopOffset:function(t,e){var i=e||0;void 0===this._grid.colsHeights[e]&&this._getCurrentTopOffset(e),this._grid.colsHeights[i]+=t},_getCurrentLeftOffset:function(){return void 0===this._grid.leftOffset&&(this._grid.leftOffset=0),this._grid.leftOffset},_updateCurrentLeftOffset:function(t){void 0===this._grid.leftOffset&&this._getCurrentLeftOffset(),this._grid.leftOffset+=t},_setCurrentLeftOffset:function(t){this._grid.leftOffset=t},_getItemMeta:function(t,e,i,n){var s=e.height?e.height:e.domElem.clientHeight;"col"!==e.type&&"rel"!==e.type||!e.domElem.clientHeight||(s=e.domElem.clientHeight);var o=e.width?e.width:e.domElem.clientWidth,r=this._getCurrentLeftOffset(),a=(n||{}).left||0,h=0;"vertical"===t&&(r=this._getCurrentLeftOffset()+i*o+i*a,h=i);var c={domElem:e.domElem,type:e.type,x:Math.floor(r),y:Math.floor(this._getCurrentTopOffset(h)),w:Math.floor(o),h:Math.floor(s)};return"horizontal"===t&&(c.row=i),"vertical"===t&&(c.col=i),"function"==typeof window.Ya.Images.printGrid&&window.Ya.Images.printGrid(e,c),c},_getGridMeta:function(){var t=BEM.blocks["i-global"].param("verticalSerp");return this._isGridFirstPage()&&(this._grid={topOffset:this._getGridTopOffset(),currentRow:0,colsHeights:[]},this._setGridFirstPage(!1)),{type:t?"vertical":"horizontal",grid:t?this._getVerticalGrid():this._getHorizontalGrid()}}}),BEM.DOM.decl("serp-controller",{bindEvents:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["serp-item"].on("clicked",this._onSerpItemClicked,this),BEM.blocks["serp-list"].on("loaded",this._onSerpListLoaded,this),window.Ya.reactBus&&window.Ya.reactBus.on("images-viewer:mounted",this._onViewerMounted,this).on("images-viewer:beforeClose",this._onViewerBeforeClose,this).on("images-viewer:listOut",this._onViewerGalleryListOut,this),t},unbindEvents:function(){return BEM.blocks["serp-item"].un("clicked",this._onSerpItemClicked,this),BEM.blocks["serp-list"].un("loaded",this._onSerpListLoaded,this),window.Ya.reactBus&&window.Ya.reactBus.off("images-viewer:mounted",this._onViewerMounted).off("images-viewer:beforeClose",this._onViewerBeforeClose),this.__base.apply(this,arguments)},_checkListOut:function(){var t=BEM.blocks["serp-item"].getCurrent();if(t&&t.params){var e=Number(t.params.pos),i=0===this.getItemByPos(e-5).length,n=0===this.getItemByPos(e+5).length;(i||n)&&this.trigger("listOut",i?"left":"right")}},_onViewerBeforeClose:function(){this.__base.apply(this,arguments),this.unselectCurrentItem(),this.blinkCurrentItem()},_onViewerMounted:function(){var t=this;this._viewerMounted=!0,this._fillViewerStore({queryChanged:!0}),setTimeout(function(){t._openSelectedItem()},0)},_fillViewerStore:function(t){t=t||{};var e=this._getSerpList();if(e){var i=e.getImagesStore();window.Ya.reactBus&&window.Ya.reactBus.emit("images-viewer:fill",i,Boolean(t.queryChanged))}},_onSerpListLoaded:function(t,e){this.__base.apply(this,arguments),this._viewerMounted&&this._fillViewerStore({queryChanged:!1})},_openSelectedItem:function(){var t=this.findBlockInside({block:"serp-item",modName:"selected",modVal:"yes"});t&&t.params&&this._openViewerWithItem(t.params.pos,{initialLoading:!0})},_openViewerWithItem:function(t,e){e=e||{},window.Ya.reactBus&&window.Ya.reactBus.emit("images-viewer:open",{activeIdx:t,initialLoading:Boolean(e.initialLoading),historyLoading:Boolean(e.historyLoading)})},_onViewerGalleryListOut:function(){this.trigger("listOut","right")},_onSerpItemClicked:function(t,e){e&&e.params&&this._openViewerWithItem(e.params.pos)}}),BEM.DOM.decl("serp-controller",{SAVED_ITEMS_COUNT:20,LOCATION_SET_TIMEOUT:150,_viewParams:["img_url","rpt","pos"],_viewParamsSimilar:["img_url","pos"],_viewedItemsUrls:{},_viewedRimUrls:{},_visitedUrls:[],onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._location=BEM.blocks.location.getInstance()}}},bindEvents:function(){var t=this.__base.apply(this,arguments);return window.Ya&&window.Ya.reactBus&&(Ya.reactBus.on("images-viewer:selectItem",this._onViewerSelectItem,this),Ya.reactBus.on("images-viewer:rimClick",this._onRimClick,this)),BEM.blocks["b-page"].on("change",this._onPageChanged,this),BEM.blocks.location.on("b-page_type_search b-page_type_similar b-page_type_search-by-image",this._onLocationChanged,this),t},unbindEvents:function(){return window.Ya.reactBus&&(window.Ya.reactBus.off("images-viewer:selectItem",this._onViewerSelectItem),window.Ya.reactBus.off("images-viewer:rimClick",this._onRimClick)),BEM.blocks["b-page"].un("change",this._onPageChanged,this),BEM.blocks.location.un("b-page_type_search b-page_type_similar b-page_type_search-by-image",this._onLocationChanged,this),this.__base.apply(this,arguments)},_onPageChanged:function(t,e){var i,n;"search"===e.type&&((i=(n=BEM.blocks.uri.getParamValue("pos"))?this.getItemByPos(n):null)?(BEM.blocks["serp-item"].setCurrent(i),this._openViewerWithItem(Number(n),{historyLoading:!0})):window.scrollTo(0,0)),this.__base.apply(this,arguments)},_onLocationChanged:function(t,e){var i=e.params,n=i&&i.pos&&Number(i.pos[0]);if(i.img_url){var s=this._viewedItemsUrls[i.img_url],o=s&&this.getItemById(s.id),r=o&&o.params.pos;if(o&&n===r){var a=i.rlt_url&&i.ogl_url,h=i.ogl_url&&this._viewedRimUrls[i.ogl_url];a&&h||this._openViewerWithItem(s.pos,{historyLoading:!0})}}else Ya.reactBus.emit("serp-controller:viewer-close")},_onRimClick:function(t){var e=this._getRimUrl(t),i=t?this.getItemParamsByPos(t.parentPos):null,n=i?this._getItemImageUrl(i):BEM.blocks.uri.getParamValue("img_url"),s=!this._isRimOpened(),o=BEM.blocks.uri.setParams({rlt_url:e,ogl_url:n});this._updateLocationForItem(o,{history:s}),this._saveViewedUrls(n,t)},_getRimUrl:function(t){var e=BEM.blocks.utils.get(t,"preview.0")||{};return e.origin?e.origin.url:e.url},_onViewerSelectItem:function(t){var e,i,n=t&&t.itemParams;t&&t.initialLoading?(this._setLocationForItem(BEM.blocks.uri.delParams(this._getParamsToDelete())),BEM.blocks["b-page"].getInstance().updateCacheKey(),this._saveViewedUrls(this._getItemImageUrl(n),n),this._setLocationForItem(this._getFullImageURL(n),{history:!0})):(e=!1,t.openedFromSerp&&(this._additionalParams=BEM.blocks.uri.parseParams(this._location.getState().url),e=!0),this._isRimOpened()&&(e=!0),this._saveViewedUrls(this._getItemImageUrl(n),n),this._updateLocationForItem(this._getFullImageURL(n),{history:e})),n&&(i=this.getItemById(n.id),BEM.blocks["serp-item"].setCurrent(i)),this._checkListOut()},_getItemImageUrl:function(t){if(!t)return"";var e=BEM.blocks.uri.parse(this._getDetailUrl(t)).getParam("img_url");return Array.isArray(e)&&e[0]?e[0]:""},_getDetailUrl:function(t){return t.previewUrl||t.detail_url||""},_updateLocationForItem:function(t,e){if(!window.screenfull||!window.screenfull.isFullscreen){this._updateLocationTimer&&clearTimeout(this._updateLocationTimer);var i=BEM.blocks["i-global"].param("page");"search"!==i&&"similar"!==i||(this._updateLocationTimer=setTimeout(function(){this._setLocationForItem(t,e)}.bind(this),this.LOCATION_SET_TIMEOUT))}},_saveViewedUrls:function(t,e){e&&e.isRim?this._viewedRimUrls[t]=e:this._viewedItemsUrls[t]=e,this._visitedUrls.push(t)},_onViewerBeforeClose:function(t){var e=this._location.getState().views||0;"history"!==(t&&t.source)&&(e>0?(window.history.go(-e),clearTimeout(this._updateLocationTimer)):this._setLocationForItem(BEM.blocks.uri.delParams(this._getParamsToDelete()))),this.__base.apply(this,arguments)},_setLocationForItem:function(t,e){e=e||{};var i=Boolean(e.history),n=Boolean(e.trigger),s=this._location.getState().views||0;this._location.change({url:t,trigger:n,history:i,views:i?s+1:s}),this._clearSavedUrls()},_getParamsToDelete:function(){var t=BEM.blocks["i-global"].param("page"),e=this._viewParams;return"similar"===t&&(e=this._viewParamsSimilar),e},_getFullImageURL:function(t){var e=this._getDetailUrl(t);return e?BEM.blocks.uri.setParams(e,this._getViewerSerpItemCgi(e)):""},_isRimOpened:function(){return Boolean(BEM.blocks.uri.getParamValue("rlt_url"))},_clearSavedUrls:function(){if(this._visitedUrls.length>=this.SAVED_ITEMS_COUNT){var t=this._visitedUrls.shift();delete this._viewedItemsUrls[t],delete this._viewedRimUrls[t]}},_getViewerSerpItemCgi:function(t){if(!t)return null;var e=BEM.blocks.uri.parseParams(t);return Object.assign({},this._additionalParams,e)}}),BEM.DOM.decl("serp-list",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.reqid&&Ya.Rum.setSetting("reqid",this.params.reqid)}}}}),BEM.DOM.decl("serp-list",{_isLastPageHasBeenLoaded:!1,onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.totalPages=1,this.thumbRows=[],this._imagesStore=[],this._initialPageNum=this.params.pageNum,this.justifier=BEM.blocks.justifier,this.bindEvents(),this.init()}}},bindEvents:$.noop,unbindEvents:$.noop,addVerticalItems:$.noop,destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onPageResize:function(){this.fitAllItems()},init:function(){var t=this.hasMod("vertical2");return window.Ya.Images.thumbRows?this.setThumbRows(window.Ya.Images.thumbRows):t||this.fitAllItems(),window.Ya.Images.thumbRows&&delete window.Ya.Images.thumbRows,this._removeDuplicates(this.domElem),t&&this._createVerticalSerpList(),this._imagesStore=this._getImagesFromSerpList(this.domElem[0]),this._onListAdded(),t||this._countLoadedRows(this.thumbRows),this},addSerpItems:function(t,e){this.params.pageNum=t.params.pageNum,this.params.lastPage=t.params.lastPage,this.params.reqid=t.params.reqid;var i,n,s=this.hasMod("vertical2"),o=$(t.html);return this._removeDuplicates(o),o.contents().length&&(s?(this._addToStore(o[0],e),this.addVerticalItems(o,e),this._countLoadedRows()):"next"===e?((i=this._getLastInvisibleRowItems()).length>0&&(this.thumbRows.pop(),o.prepend(i)),n=this.fitAddedItems(o),this._addToStore(o[0],e),BEM.DOM.append(this.domElem,o.contents()),this._countLoadedRows(n)):(this._addToStore(o[0],e),BEM.DOM.prepend(this.domElem,o.contents()),this.fitAllItems())),this.totalPages++,this._onListAdded(),this},_addToStore:$.noop,_onListAdded:function(){Ya.Rum.setSetting("reqid",this.params.reqid),BEM.blocks["i-global"].setParams({lastPageReqid:this.params.reqid}),this.trigger("loaded",{serpList:this,totalPages:this.totalPages})},_countLoadedRows:function(t){if(!BEM.blocks.utils.isEmpty(t)){var e,i;e=BEM.blocks["i-global"].param("perfOpt")?{width:(i=BEM.blocks["i-ua"]).width,height:i.height}:BEM.blocks["i-userinfo"].get().getWindowSize();for(var n=function(t,e){return window.Ya.Images.ThumbsStore.get(t,"fittedItem."+e)},s=[],o=[],r=[],a=0;a<t.length;a++){var h=n(t[a][0],"newHeight");h&&(s.push(t[a].length),o.push(h),r.push(t[a].map(function(t){return n(t,"newWidth")}).join("-")))}c.cpHitDelayed({pid:40,cid:72687,path:"desktop"===window.Ya.Images.platform?"8.228.471.436.1007":"8.584.471.436.1007",vars:["-thumbs="+s.join(";"),"-heights="+o.join(";"),"-widths="+r.join(";"),"-viewport="+e.width+";"+e.height].join(","),reqid:this.params.reqid})}},_getLastInvisibleRowItems:function(){var t=this.thumbRows.slice(-1)[0],e=window.Ya.Images.ThumbsStore;if(!Array.isArray(t))return[];var i=t[0],n=e&&e.get(i);return n&&n.fittedItem?[]:t.map(function(t){return document.getElementById(t)})},getLastThumbOfRow:function(t){var e,i=this.thumbRows[t];return i&&(e=i.slice(-1)[0]),$(document.getElementById(e))},getInitialPageNum:function(){return this._initialPageNum},getPagesCount:function(){return this.totalPages},getRowCount:function(){return this.thumbRows.length},setThumbRows:function(t){this.thumbRows=t},addThumbRows:function(t,e){void 0===e&&(this.thumbRows=this.thumbRows.concat(t)),"number"==typeof e&&this.thumbRows.splice(e,0,t)},isLastPageHasBeenLoaded:function(){return this.isCurrentPageLast()&&(this._isLastPageHasBeenLoaded=!0),this._isLastPageHasBeenLoaded},getPenultRowNum:function(){return this.isRowVisible(this.thumbRows.length-1)?this.thumbRows.length-2:this.thumbRows.length-3},isRowVisible:function(t){return!!BEM.blocks["i-global"].param("verticalSerp")||"inline-block"===this.getLastThumbOfRow(t).css("display")},getThumbRow:function(t){for(var e,i=0,n=0;n<this.thumbRows.length;n++)for(e=0;e<this.thumbRows[n].length;e++)if(++i===t)return n},appendToRow:function(t,e){var i=-1===t?this.getPenultRowNum():t-1;this.getLastThumbOfRow(i).after(e)},appendIncutElem:function(t){return this.domElem.append(t),this},prependIncutElem:function(t){return this.domElem.prepend(t),this},getCurrentPageNumber:function(){return this.params.pageNum},getLastPageNumber:function(){return this.params.lastPage},isCurrentPageLast:function(){return this.params.pageNum===this.params.lastPage},getIds:function(){return this.thumbRows.reduce(function(t,e){return t.concat(e)},[])},_getImagesFromSerpList:$.noop},{getUrls:function(){return $(".serp-item_type_search").toArray().reduce(function(t,e){return t.concat(BEM.blocks["serp-item"].getUrls($(e)))},[])}}),BEM.DOM.decl("serp-list",{init:function(){return this.delMod("interactive"),window.Ya.Images.thumbRows&&this._getContainerWidth(),this.__base.apply(this,arguments),this},bindEvents:function(){BEM.blocks["b-page"].on("resize",this._onPageResize,this)},unbindEvents:function(){BEM.blocks["b-page"].un("resize",this._onPageResize,this)},reFitAllItems:function(){this._onPageResize()},_onPageResize:function(){this._resetContainerWidth(),this.__base.apply(this,arguments)},fitAllItems:function(){return this.hasMod("justifier","no")?null:this._fitAllItems()},_fitAllItems:function(){var t=this.justifier.fitImages({container:this.domElem[0],containerWidth:this._getContainerWidth(),showDangling:this.isLastPageHasBeenLoaded(),fitIncuts:!0,saveMeta:!0,baseRowHeight:window.Ya.Images.baseRowHeight});return this.setThumbRows(t),t},fitAddedItems:function(t){var e=this.justifier.fitImages({container:t.get(0),containerWidth:this._getContainerWidth(),thumbRows:this.thumbRows,showDangling:this.isCurrentPageLast(),fitIncuts:!0,saveMeta:!0,baseRowHeight:window.Ya.Images.baseRowHeight});return this.addThumbRows(e),e},_getContainerWidth:function(){return this._containerWidth||(this._containerWidth=this.domElem.parent().width()),this._containerWidth},_resetContainerWidth:function(){return delete this._containerWidth,this},_addToStore:function(t,e){var i=this._getImagesFromSerpList(t);this._imagesStore="next"===e?this._imagesStore.concat(i):i.concat(this._imagesStore)},_getImagesFromSerpList:function(t){if(!t)return[];var e=this,i=Array.prototype.slice.call(t.querySelectorAll(".serp-item")).reduce(function(t,i){var n=BEM.blocks["serp-item"].getItemParams(i);return n.request||!n.snippet?t:(n.snippet.text=e._prepareText(n.snippet.text||""),n.snippet.redirUrl||(n.snippet.redirUrl=n.snippet.url),t.push({id:n.id,pos:n.pos,docid:n.docid,rimid:n.rimId,imgHref:n.img_href,reqid:n.reqid,counterPath:n.counterPath,freshness:n.freshness,isMarketIncut:n.isMarketIncut,commercialSource:n.commercialSource,previewUrl:n.detail_url,isFavorite:Boolean(n.isFavorite),photostockUrl:n.photostockUrl,uniqId:n.reqid+"-"+n.id,images:[],preview:n.preview,snippet:n.snippet,similarOffers:e._prepareSimilarOffers(n.similarOffers),marketSnippet:n.marketSnippet&&e._prepareMarketSnippet(n.marketSnippet),thumb:e._prepareThumb(n.thumb,i),dups:n.dups,row:n.row,col:n.col,page:e._getPageNum(n.pos)}),t)},[]);return this.hasMod("vertical2")&&(i=i.sort(function(t,e){return(t.data&&t.data.pos)<(e.data&&e.data.pos)?-1:1})),i},_prepareText:function(t){return t?t.replace(/<b>/g,"[").replace(/<\/b>/g,"]"):""},_prepareSimilarOffers:function(t){if(t&&t.length)return t.forEach(function(t){t.price?t.price=Number(t.price.replace(/ +/g,"")):delete t.price}),t},_prepareThumb:function(t,e){if(t&&t.size)return{url:t.url,microImg:t.microImg,size:{w:t.size.width,h:t.size.height}};var i,n=e.querySelector(".serp-item__thumb").src;try{i=JSON.parse(e.dataset.size)}catch(t){}return i&&i[0]&&i[1]||(i=[e.clientWidth,e.clientHeight]),{url:n,microImg:"",size:{w:i[0],h:i[1]}}},_prepareMarketSnippet:function(t){return{domain:t.domain,punycode:t.punycode,imageUrl:t.image_url,modelUrl:t.model_url,moneyId:t.money_id,price:t.price,shopRating:t.shop_rating,source:t.source,title:t.title,url:t.url,visiblePrice:t.visiblePrice,text:t.text}},_getPageNum:function(t){var e=BEM.DOM.blocks["serp-controller"].get();if(e)return Math.floor(t/e.getDocsPerPage())},getImagesStore:function(){return this._imagesStore}}),BEM.DOM.decl("commercial-discard",{_onButtonClick:function(){this.trigger("turn-off"),c.hitDelayed({dtype:"iweb",path:"/image/new/serp/commercial/filter/discard",reqid:BEM.blocks["i-global"].param("reqid")})}},{live:function(){this.liveInitOnBlockInsideEvent("click","button2",function(t){this._onButtonClick(t)})}}),BEM.DOM.decl("direct",{onSetMod:{js:{inited:function(){this._contextLoaderUrl||(this._contextLoaderUrl="//yandex.ru/images/_crpd/hmiK28s06/3a2294S0tYV5/q2_9kJH2QFtqTkDpsv1bAsYAM2b5v8wm1slTREBwy78V3rbw"),this.hasMod("update-on-init","yes")&&this.update(),this._onHide=this._onHide.bind(this)}}},update:function(t,e){window.Ya&&window.Ya.Direct&&this._isScriptLoaded()||this._load(t,e),this.__self._isAdvManagerInited?this._update(t,e):this._bindToScriptPromise(t,e)},_bindToScriptPromise:function(t,e){return this._getInitedPromise().done(this._update.bind(this,t,e))},_getInitedPromise:function(){var t=this.__self.initedPromise[this._contextLoaderUrl];return t||(t=this.__self.initedPromise[this._contextLoaderUrl]=$.Deferred()),t},_load:function(){this.__self.load(this._onLoad.bind(this),this._contextLoaderUrl,this._onScriptLoad.bind(this))},_onLoad:function(){(window.wHQVXXdG3wdQCFGhOvKWUHoMwzbcgLAsq||(window.wHQVXXdG3wdQCFGhOvKWUHoMwzbcgLAsq=[])).push(this._onAdvManagerInited.bind(this))},_onDirectLoaded:function(){this._isDestructing||(this._canShow()?(this.trigger("loaded",{domElem:this.domElem,reqid:this.params.reqid}),this.show()):this.hide())},_canShow:function(){return!this._isPornoQuery()},_isPornoQuery:function(){return BEM.blocks["i-global"].param("isPornoQuery")},_onAdvManagerInited:function(){this.__self._isAdvManagerInited=!0,this._getInitedPromise().resolve()},_render:function(t,e,i,n){if(window.Ya.wJwtXTdG36g){window.Ya.wJwtXTdG36g._asyncModeOn=!0;var s=i||this._getDirectId(),o={blockId:s,statId:n,renderTo:e,async:!0,onRender:this._onDirectLoaded.bind(this),onHide:this._onHide.bind(this),grab:this._getGrabText(t),extParams:"&"+$.param(this._getExtParams()),pageNumber:this.params.pageNumber>=0?this.params.pageNumber:null,searchPageNumber:this.params.searchPageNumber>=0?this.params.searchPageNumber:null};if(this.params.searchText&&(o.searchText=BEM.blocks["i-global__utils"].decodeEntities(this.params.searchText)),BEM.blocks["i-global"].getFlag("enable_direct_timing")&&(o.initTime=new Date),this.params.data)try{o.data=JSON.parse(this.params.data)}catch(t){}window.Ya.wJwtXTdG36g.AdvManager.render(o,this._onEmptyDirectLoaded.bind(this,s)),this._onAdRequest()}return this},_renderWithSearchQuery:function(t){var e=BEM.blocks["i-global"].param("query"),i=BEM.blocks["i-global"].getFlag("video_rtb_statid"),n=this.domElem&&this.domElem[0]&&this.domElem[0].id;t&&this._render(e,n,t,i)},_onAdRequest:$.noop,_getDirectId:function(){return this.params.directId},_getAltDirectId:function(){return this.params.altDirectId},_getGrabText:$.noop,_getExtParams:function(){return{}},_onEmptyDirectLoaded:function(t){this.__base.apply(this,arguments),this.trigger("empty-loaded"),this._isDestructing||this._shouldRenderAltPage(t)&&this._renderWithSearchQuery(this._getAltDirectId())},_shouldRenderAltPage:function(t){var e=this._getAltDirectId();return!!e&&(this._getDirectId()!==e&&t!==e)},_onHide:function(){this.destruct()},_isScriptLoaded:function(){return"loaded"===this.__self._status[this._contextLoaderUrl]},_onScriptLoad:$.noop},{contextLoaderUrl:"//yandex.ru/images/_crpd/hmiK28s06/3a2294S0tYV5/q2_9kJH2QFtqTkDpsv1bAsYAM2b5v8wm1slTREBwy78V3rbw",initedPromise:{},_status:{},load:function(t,e,i){var n=this;if(e||(e=this.contextLoaderUrl),t(),!this._status[e]){this._status[e]="loading";var s=document.createElement("script");s.onload=function(){n._status[e]="loaded",i&&i(e)},s.onerror=function(){n.initedPromise[e].reject(),n._status[e]="error"},s.src=e,document.body.appendChild(s)}}}),BEM.DOM.decl("direct",{onSetMod:{js:{inited:function(){this._fullInitDfd=$.Deferred(),this._canShow()?(this.__base.apply(this,arguments),this.bindEvents()):this.hide()}}},bindEvents:function(){this.params.dynamicDirectIds&&(this._onResizeBinded=!0,BEM.blocks["b-page"].on("resize",this._onPageResize,this)),this.bindTo("click",this._onClick)},destruct:function(){this._onResizeBinded&&(delete this._onResizeBinded,BEM.blocks["b-page"].un("resize",this._onPageResize,this)),this.unbindFrom("click",this._onClick),this._fullInitDfd.reject(),clearInterval(this._checkHeightInterval),this.trigger("direct:destruct",this._getEventParams()),this.__base.apply(this,arguments)},_onPageResize:function(){this.update()},updateIncut:function(){this.update()},transparent:function(){this.setMod("visibility","transparent")},hide:function(){return this.setMod("visibility","hidden"),this.trigger("direct:hide",this._getEventParams()),this._fullInitDfd.resolve(),this},show:function(){this.delMod("visibility");var t=0;return clearInterval(this._checkHeightInterval),this._checkHeightInterval=setInterval(function(){this.domElem?((this.domElem.height()>1||t>=5)&&(this._fullInitDfd.resolve(),this.trigger("direct:show",this._getEventParams()),clearInterval(this._checkHeightInterval)),t++):clearInterval(this._checkHeightInterval)}.bind(this),100),this},_update:function(){if(!this._isDestructing){if(!this._canShow())return this.hide(),this;var t=this._getDirectId();return this._lastDirectId===t?this:(this._lastDirectId=t,this._renderWithSearchQuery(t),this)}},_bindToScriptPromise:function(){var t=this.__base.apply(this,arguments);return t.fail(this.trigger.bind(this,"direct:error",this._getEventParams())),t},_onEmptyDirectLoaded:function(t){this.__base.apply(this,arguments),this._shouldRenderAltPage(t)||this._isDestructing||this.hide()},_getDirectId:function(){return this.params.dynamicDirectIds?this._getDynamicDirectId():(this._isPornoQuery()&&(t=this.params.adultDirectId),t||this.params.directId);var t},_getDynamicDirectId:function(){for(var t,e=this.params.dynamicDirectIds,i=window.innerWidth,n="",s=e.length-1;s>=0;s--)if(i>=(t=e[s])["min-width"]){n=t.id;break}return n},_getExtParams:function(){var t=this.getMod("type")||this.getMod("pos"),e=this.__self.getExtParams(t,this._rowNum),i=BEM.blocks["i-global"],n=BEM.blocks.uri.getParamValue("uuid"),s=i.param("yandexuid"),o=i.param("reqid");return this.params.extParams?Object.assign(e,this.params.extParams):"search"!==t&&"footer"!==t||(o=i.param("lastPageReqid")||o),o&&(e.reqid=o),n?e.uuid=n:s&&(e.yuid=s),e},_getGrabText:function(t){var e="t"+t+"\n";return BEM.blocks["i-global__utils"].base64Encode(e)},isExists:function(){return!this.domElem.is(":empty")},_canShow:function(){return!0},_onClick:function(){this.trigger("direct:click",this._getEventParams())},_onHide:function(){this.trigger("direct:close",this._getEventParams()),this.__base.apply(this,arguments)},_getEventParams:function(){return{type:this.getMod("type"),insertionPage:this.params.insertionPage,directId:this._getDirectId()}},getFullInitPromise:function(){return this._fullInitDfd.promise()}},{getExtParams:function(t,e){var i=BEM.blocks["i-global"],n={serpid:i.param("serpid"),testid:i.param("testId"),position:t||""};return i.param("mobile")?n.ui="phone":i.param("tablet")?n.ui="pad":n.ui="desktop",e&&(n.line=e),n}}),BEM.DOM.decl({block:"direct",modName:"type",modVal:"insertion"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._renderPromise=$.Deferred()}}},_load:function(){var t=this;this.__base.apply(this,arguments),this._getInitedPromise().fail(function(){t._renderPromise.reject()})},getRenderPromise:function(){return this._renderPromise},_onEmptyDirectLoaded:function(){this.__base.apply(this,arguments),this._renderPromise.reject()},_onDirectLoaded:function(){this.__base.apply(this,arguments),this._isDestructing?this._renderPromise.reject():BEM.blocks["i-global"].param("isPornoQuery")?this._renderPromise.reject():this._renderPromise.resolve()}}),BEM.DOM.decl("incut",{show:function(){return this.isVisible()||(this.delMod("visibility"),this.updateIncutBlock()),this},isVisible:function(){return!this.hasMod("visibility","hidden")},hide:function(){return this.setMod("visibility","hidden")},transparent:function(){return this.setMod("visibility","transparent")},setShown:function(){return this.setMod("inserted","yes")},getPositionType:function(){return this.params.positionType},getPos:function(){return this.domElem.data("position")},setPos:function(t){this.domElem.data("position",t),this.domElem.attr("data-position",t)},updateIncutBlock:function(){var t=this._getIncutBlock();t&&"function"==typeof t.updateIncut&&t.updateIncut()},_getIncutBlock:function(){var t=this.params.incutBlock;if(t)return this.blockInside(t)},getInitedIncutPromise:function(){var t=this._getIncutBlock(),e=this;if(t&&"function"==typeof t.getFullInitPromise)return t.getFullInitPromise().then(function(){return{instance:e,height:e.domElem.height(),width:e.domElem.width(),type:e.domElem[0].getAttribute("data-type"),pos:e.params.position}})},isIncutInViewport:function(){var t=this.domElem&&this.domElem[0].getBoundingClientRect();return t&&t.top>=0&&t.bottom-t.height/2<=$(window).height()}},{live:!0}),BEM.DOM.decl({block:"incut",modName:"type",modVal:"related"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.isIncutInViewport()?this._onScroll():BEM.blocks["b-page"].on("scroll",this._onScroll,this)}},inserted:{yes:function(){this.__base.apply(this,arguments),this._isWizardCarousel()&&this._setCarouselMod()}}},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_setCarouselMod:function(){var t=this._getWizard();t&&t.reduceLabelHeight().setCarouselMod().setCarouselSizes()},_onScroll:function(){if(this.isIncutInViewport()){var t=this._getWizard();t&&t.hitVisible(),BEM.blocks["b-page"].un("scroll",this._onScroll,this)}},_getWizard:function(){var t=this.params.wizName||"wizard-wrapper",e=this.blockInside(t);return e&&e.domElem?e:null},_isWizardCarousel:function(){var t=this._getWizard();return t&&t.hasMod("carousel","yes")}},{live:!1}),BEM.DOM.decl({block:"incut",modName:"position",modVal:"bottom"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks.footer.on({transparent:this._onFooterTransparent,show:this._onFooterShow,hide:this._onFooterHide},this)}}},destruct:function(){BEM.blocks.footer.un({transparent:this._onFooterTransparent,show:this._onFooterShow,hide:this._onFooterHide},this),this.__base.apply(this,arguments)},_onFooterTransparent:function(){this.transparent()},_onFooterHide:function(){this.hide()},_onFooterShow:function(){this.show()}}),BEM.DOM.decl("boards",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._fullInitDfd=$.Deferred()}}},getFullInitPromise:function(){return this._fullInitDfd.resolve().promise()},show:function(){return this.delMod("visibility")},_onViewed:function(){var t=this._getBoardsParam().map(function(t){return t.title+","+t.login+","+t.collection}).join(";");this._sendViewCounter(t)},_getCounterPathPrefix:function(){return"desktop"===window.Ya.Images.platform?"/image/new/serp/collections/":"/image/touch/serp/collections/"},_sendViewCounter:function(t){c.hitDelayed({dtype:"stred",pid:40,path:this._getCounterPathPrefix()+"show",vars:"-boards="+encodeURIComponent(t)},this.domElem)},_sendBoardCounter:function(t,e,i){c.hit({dtype:"iweb",path:this._getCounterPathPrefix()+"click",vars:"-pos="+t+",-board_id="+e},{href:i})},_sendMoreCounter:function(t){cp({dtype:"iweb",pid:40,cid:73019,path:this._getCounterPathPrefix()+"more/click",vars:"-pos="+t})},_onComplain:function(t){var e=this._getBoard(t),i=this._getBoardsParam(),n=i.map(function(t){return t.title}).join(";"),s=i.map(function(t){return t.thumbs}).join(";"),o=this.elemParams($(e))||{};BEM.channel("feedback").trigger("show",{abuseLink:BEM.blocks["i-global"].param("abuseLink"),"shows-related-images":s,"shows-related-queries":n,"related-query-complaint":o.title,"related-image-complaint":o.thumbs})},_getBoards:function(){return this._boardsArr||(this._boardsArr=this.elem("board").toArray())},_getBoard:function(t){return this._getBoards()[t]},_getBoardsParam:function(){var t=this._getBoards();return this.boardsParam||(this.boardsParam=t.map(function(t){return this.elemParams($(t))}.bind(this)).filter(function(t){return Boolean(t.thumbs)})),this.boardsParam},_getElemIndex:function(t,e){return this.elem(t).index(e)}},{live:function(){return this.liveInitOnBlockEvent("wizard-in-viewport","wizard-wrapper",function(){this._onViewed()}),this.liveBindTo("link","pointerclick",function(t){var e=this._getElemIndex("link",t.data.domElem),i=this._getBoardsParam()[e]||{},n=i.board_id,s=i.link;this._sendBoardCounter(e,n,s)}),this.liveBindTo({elem:"board",modName:"more",modVal:"yes"},"pointerclick",function(t){var e=this._getElemIndex("board",t.data.domElem);this._sendMoreCounter(e)}),this.liveBindTo("complain","pointerclick",function(t){var e=this._getElemIndex("complain",t.data.domElem);this._onComplain(e)}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"wizard-wrapper"},{hitVisible:function(){this.trigger("wizard-in-viewport")}}),BEM.DOM.decl("related",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._fullInitDfd=$.Deferred()}}},show:function(){return this.delMod("visibility"),this},hide:function(){return this.setMod("visibility","hidden"),this._fullInitDfd.resolve(),this._initWhenAllImagesLoaded(),this},shuffle:function(){BEM.DOM.update(this._getWizard().elem("list"),this.elem("item").sort(function(){return Math.random()-.5}))},_onItemClick:function(t){var e={},i=t.data.domElem;this.trigger("item-click",{item:i}),this._hitItemClickCounter(t),e[this.getMod("position")]="p"+this.getItemIndex(i),BEM.blocks["b-statcounter"].hit({params:{query:{related:e}}})},_initWhenAllImagesLoaded:function(){var t=this.domElem.find("img").filter(function(t,e){return"none"!==getComputedStyle(e).display});if(t.length){var e=t.length,i=function(){e<=0&&this._fullInitDfd.resolve()}.bind(this);t.each(function(t,n){n.complete?(e--,i()):(n.onload=function(){i(),e--},n.onerror=function(){e--,i()})})}},_hitItemClickCounter:function(t){var e=t.data.domElem,i=this.elemParams(e);c.hit({dtype:"iweb",path:this._getItemClickCounterPath(),serpid:BEM.blocks["i-global"].param("serpid"),vars:"-pos="+i.position+",-index="+this.getItemIndex(e)+",-query="+encodeURIComponent(i.label)+",-theme="+this._getWizard().getMod("theme")},{href:i.link})},_getItemClickCounterPath:function(){return"/image/new/serp/related_query/click"},_getWizard:function(){return this._wizard||(this._wizard=this.findBlockOn("wizard-wrapper"))},getItemIndex:function(t){return this.elem("item").index(t)},getFullInitPromise:function(){return this._fullInitDfd.resolve().promise()}},{live:function(){this.liveInitOnBlockInit("wizard-wrapper").liveBindTo("item","pointerclick",function(t){this._onItemClick(t)}).liveBindTo("preview","click",function(t){2===t.which||t.metaKey||t.ctrlKey||t.preventDefault()})}}),Array.prototype.slice.call(document.querySelectorAll(".related__thumb[data-thumb]")).forEach(function(t){t.getAttribute("src")||t.setAttribute("src",t.getAttribute("data-thumb"))}),BEM.DOM.decl({block:"related",modName:"complain",modVal:"yes"},{_onComplain:function(t){var e=this.elem("item").toArray(),i=e.map(function(t){return this.elemParams($(t))}.bind(this)),n=i.map(function(t){return t.label}).join(";"),s=i.map(function(t){return t.thumb}).join(";"),o=this.elemParams($(e[t]))||{};BEM.channel("feedback").trigger("show",{abuseLink:BEM.blocks["i-global"].param("abuseLink"),"shows-related-images":s,"shows-related-queries":n,"related-query-complaint":o.label,"related-image-complaint":o.thumb})}},{live:function(){return this.liveInitOnBlockInsideEvent("click","button2",function(t){this._onComplain(this.elem("complain").index(t.target.domElem))}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"related",modName:"carousel",modVal:"yes"},{reduceLabelHeight:function(){return this._getWizard().reduceLabelHeight(),this},setCarouselMod:function(){return this._getWizard().setCarouselMod(),this},setCarouselSizes:function(){return this._getWizard().setCarouselSizes(),this}}),BEM.DOM.decl({block:"wizard-wrapper",modName:"carousel",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.reduceLabelHeight().setCarouselMod().setCarouselSizes(),this._getCarousel().on("scrollModChange",this._onCarouselScrollModChange,this)}}},getDefaultParams:function(){return{pageWidth:this.__self.win.width()}},reduceLabelHeight:function(){this.delMod("one-line-label");for(var t=this.elem("label"),e=2*parseInt(t.css("line-height"),10),i=Math.floor(this.params.pageWidth/this._getCarousel().getStep()),n=!1,s=0;s<i;s++)if(t[s]&&t[s].offsetHeight===e){n=!0;break}return n||this.setMod("one-line-label","yes"),this},setCarouselSizes:function(){return this.setCarouselHeight(),this._getCarousel().setWidth(),this},setCarouselHeight:function(t){return t||(t=this._getCarousel().elem("list").height()),0!==t&&this.elem("carousel").css("height",t),this},_getCarousel:function(){return this._carousel||(this._carousel=this.findBlockInside("carousel"))},setCarouselMod:function(){return this._getCarousel().setScrollMod(),this},_onCarouselScrollModChange:function(){this._getCarousel().un("scrollModChange",this._onCarouselScrollModChange,this),this.trigger("scrolled")}}),BEM.DOM.decl({block:"carousel",modName:"controls",modVal:!0},{onSetMod:{scroll:{left:function(){var t=this.elem("control","side","right");this.hasMod(t,"hovered","yes")&&this.setMod(t,"disable","yes")},right:function(){var t=this.elem("control","side","left");this.hasMod(t,"hovered","yes")&&this.setMod(t,"disable","yes")}}},onElemSetMod:{control:{hovered:{"":function(){this.delMod(this.elem("control"),"disable")}}}},getDefaultParams:function(){var t=this.__base();return t.animationTime=300,t.finishBeforeMove=!1,t.offset=null,t},_onControlClick:function(t){if(!this.hasMod(this.elem("control"),"disable","yes")){var e=this.getMod(t.data.domElem,"side");this.canScrollTo(e)&&this.move(e)}},_onControlPress:function(t){this.setMod(t.data.domElem,"pressed","yes")},_onPointerRelease:function(t){this.delMod(t.data.domElem,"pressed")},canScrollTo:function(t){var e=this.getMod("scroll");return"both"===e||e===t},move:function(t){this.params.finishBeforeMove&&this.elem("wrap").finish();var e=this.elem("wrap").scrollLeft()+this.getOffset(t);this.elem("wrap").animate({scrollLeft:e},this.params.animationTime,this.setScrollMod.bind(this))},getOffset:function(t){var e=this.params.calculatedScrollStep||this.params.step;return("left"===t?-1:1)*e}},{live:function(){this.__base(),this.liveBindTo("control","pointerclick",function(t){this._onControlClick(t)}).liveBindTo("control","pointerpress",function(t){this._onControlPress(t)}).liveBindTo("control","pointerrelease",function(t){this._onPointerRelease(t)}).liveBindTo("control","dblclick",function(t){t.preventDefault()})},liveMod:!1}),BEM.DOM.decl({block:"carousel",modName:"controls",modVal:!0},{getDefaultParams:function(){var t=this.__base();return t.offsetRatio=1.4,t},getOffset:function(t){var e=this.hasMod("full-scroll","yes")?this.getFullOffset(t):this.params.step,i=this.shouldAddExtraScroll(e,t)?e*this.params.offsetRatio:e;return("left"===t?-1:1)*i},getFullOffset:function(t){var e=this.carouselWidth,i=this.elem("wrap").scrollLeft(),n=this.elem("control").width(),s=this._getItemToScroll(t),o=$(s).position().left;return"right"===t?o-n-i:e+i-o-$(s).outerWidth(!0)-n},_getItemToScroll:function(t){for(var e,i=$.makeArray(this.items),n=this.elem("wrap").scrollLeft(),s=i.length-1;s>=0;s--){var o=$(i[s]).position().left;if("right"===t&&o<n+this.carouselWidth||"left"===t&&o<n){e=i[s];break}}return e},shouldAddExtraScroll:function(t,e){var i=this.domElem.width(),n=this.elem("wrap").scrollLeft(),s=this.elem("wrap")[0].scrollWidth;return"right"===e&&s-i-n-t<=.4*t||"left"===e&&n-t<=.4*t}}),BEM.DOM.decl("serp-item",{onSetMod:{selected:{yes:function(){this.delMod("hovered"),this.__self.delSelected()}}},saveCurrent:function(){return this.__self.prev=this.__self.getCurrent(),this.__self.setCurrent(this),this}},{getCurrent:function(){return this.current&&!this.current._isDestructing?this.current:void 0},getPrev:function(){return this.prev&&!this.prev._isDestructing?this.prev:void 0},setCurrent:function(t){this.current=t},clearCurrent:function(){this.setCurrent(null)},delSelected:function(){return this.getCurrent()&&this.getCurrent().delMod("selected"),this},getParams:function(t){var e=$("#"+t).data("bem");return e?e["serp-item"]:void 0},current:null,prev:null}),BEM.DOM.decl("serp-item",{onSetMod:{hovered:{yes:function(){return this.canHover()}}},canHover:function(){return!this.hasMod("selected","yes")},_onClick:function(t){BEM.blocks["i-global"].param("isPumpkin")&&"index"===BEM.blocks["i-global"].param("page")||(this.click("mouse"),t.preventDefault())},click:function(t,e){return this.eventSource=t,this.eventParams=e,BEM.blocks["serp-item"].delSelected(),this.select().saveCurrent().trigger("clicked",this),this},select:function(){return this.setMod("selected","yes"),this}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnEvent("mousemove")}}),BEM.DOM.decl("serp-item",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindTo("pointermove",this._onPointerMove),this.bindTo("pointerleave",this._onPointerLeave)}},_onPointerMove:function(){this.setMod("hovered","yes")},_onPointerLeave:function(){this.delMod("hovered")}}),BEM.DOM.decl("serp-item",{},{getItemParams:function(t){var e=this.getName();if(t&&t.classList&&t.classList.contains(e)){var i=JSON.parse(t.getAttribute("data-bem"))[e],n=JSON.parse(t.getAttribute("data-grid-position"))||{};return Object.assign({},i,n)}}}),BEM.DOM.decl("serp-item",{_hoverTimer:null,_onPointerMove:function(){if(null===this.__self.hoverStartTime&&(this.__self.hoverStartTime=Date.now()),!this.hasMod("hovered","yes")&&!this._hoverTimer){var t=this.__base,e=arguments;this._hoverTimer=setTimeout(function(){t.apply(this,e)}.bind(this),this.__self.HOVER_DELAY)}},_onPointerLeave:function(){if(this.__base.apply(this,arguments),this.__self.hoverStartTime){var t=Number(this.getMod("pos"));this.__self.hovered[t]=(this.__self.hovered[t]||0)+Date.now()-this.__self.hoverStartTime,this.__self.hoverStartTime=null,this.hasMod("gif-badge")&&(this.__self.anim[t]=1)}clearTimeout(this._hoverTimer),this._hoverTimer=null},click:function(){var t=BEM.blocks["i-global"].param("lags"),e=t&&t.show,i=this.__base,n=arguments;e?setTimeout(function(){i.apply(this,n)}.bind(this),e):i.apply(this,n)},_thumbLoaded:function(){var t=this.elem("thumb")[0];return t&&t.complete&&t.naturalHeight},_onClick:function(){this.sendClickCounter({click_source:"serp"}),this.__base.apply(this,arguments)},sendClickCounter:function(t){var e=BEM.blocks.counter.convertVarsToString(t),i={dtype:"iweb",path:"/image/new/serp/results/"+this.params.counterPath,pos:this.params.pos,reqid:this.params.reqid};return e&&(i.vars=e),c.hitDelayed(i,{href:this.params.img_href}),this},getIndex:function(){return this.domElem.index(".serp-item")}},{HOVER_DELAY:400,hovered:{},anim:{},hoverStartTime:null,getUrls:function(t){var e=t.params||t.data("bem")["serp-item"],i=[e.img_href,this._getOriginUrl(e.preview[0])],n=e.dups.slice(0);n.push.apply(n,e.preview);for(var s=0;s<n.length;s++)i.push(this._getOriginUrl(n[s]));return i.filter(function(t,e){return i.indexOf(t)===e})},_getOriginUrl:function(t){return t.origin?t.origin.url:t.url},getNearestImages:function(t,e){var i=document.querySelector(this.buildSelector("pos",t));if(!i)return[];for(var n=[this.getItemParams(i)],s=i.nextElementSibling,o=i.previousElementSibling;e>0&&(s||o);)s&&(n.push(this.getItemParams(s)),s=s.nextElementSibling,e--),o&&e>0&&(n.push(this.getItemParams(o)),o=o.previousElementSibling,e--);return n.filter(function(t){return t})}}),BEM.DOM.decl({block:"serp-item",modName:"type",modVal:"search"},{onSetMod:{hovered:{yes:function(){if(!1===this.__base.apply(this,arguments))return!1;var t=this._calcWidth(),e=this.domElem;this._polaroid=BEM.DOM.blocks.polaroid2.showTo({scale:this.__self.HOVER_SCALE,commercial:this._getCommercialParams(),itemWidth:this.getWidth(),itemHeight:this.getHeight(),minWidth:this.getPolaroidMinWidth(),snippet:this.params.snippet,hovered:this._calcHoveredParams(t,e),serpItemDomElem:this.elem("preview"),position:this.params.pos,gridPosition:this.getGridPosition(),id:this.params.id,greenUrlCounterPath:this.params.greenUrlCounterPath,serpItemIndex:this.getIndex(),serpItemParams:this.params,reqid:this.params.reqid,color:this.params.colorwiz}),this._polaroid.on("complain.click",this._onComplainClick,this)},"":function(){this._polaroid&&(this._polaroid.un("complain.click",this._onComplainClick,this),BEM.DOM.blocks.polaroid2.hide(this._polaroid),this._polaroid=null)}},blink:function(){this.__self.canUseCSSAnimation||this.domElem.animate({opacity:"1"},{duration:500})},selected:{yes:function(){this.__base.apply(this,arguments),this.trigger("viewed")}}},getPolaroidMinWidth:function(){return this.__self.MIN_WIDTH},getWidth:function(){return this.domElem.width()},getHeight:function(){return this.domElem.height()},getGridPosition:function(){return this.domElem.data("gridPosition")},_getCommercialParams:function(){var t,e,i=this.params,n=i.marketSnippet,s=i.pos,o="-pos="+s+",-link_type=market-search";if(n)return e=(t=n.visiblePrice)?BEMHTML.apply({tag:"b",content:[t,{block:"rub",mods:{space:"yes"}}]}):BEM.I18N("serp-item","Купить",{context:'[перевод не нужен] Для текста на кнопке перехода на сайт магазина: "Купить на сайте магазина"'}),{text:BEM.I18N("serp-item","{price} на сайте магазина",{context:'[перевод не нужен] Текст на кнопке перехода на сайт магазина: "1 234 Р на сайте магазина" или "Купить на сайте магазина"',price:e}),url:n.url,counters:{click:{path:"/image/new/serp/results/thumb/commercial/button/market",params:{reqid:i.reqid,pos:s,domain:n.domain,money_id:n.money_id,vars:o}}}}},_calcHoveredParams:function(t,e){var i=this._isFirstImageInRow(e,e.prev()),n=this._isLastImageInRow(t,e,e.next());return{lastInRow:n,firstInRow:i,middle:!i&&!n,small:t===this.getPolaroidMinWidth()}},_calcWidth:function(t){return t=t||this.domElem.width(),Math.max(t,this.getPolaroidMinWidth())},_calcPolaroidPadding:function(t){return(t=t||this.domElem.height())+this.__self.PADDING},_onComplainClick:function(){BEM.blocks.feedback.showPopup(this)},_isLastImageInRow:function(t,e,i){var n=e.offset(),s=!(i.length&&n.top===i.offset().top),o=n.left+t+this.__self.PADDING>this.__self.doc.width();return s&&o},_isFirstImageInRow:function(t,e){if(BEM.blocks["i-global"].param("verticalSerp")){var i=t.parent();return i.offset().left===i.parent().offset().left}return!e.length||t.offset().top!==e.offset().top}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("link","pointerclick",function(t){if(t.stopPropagation(),2===t.which||t.metaKey||t.ctrlKey)return!0;this._onClick(t)}),this.canUseCSSAnimation=BEM.blocks["i-ua"].canUseCSSAnimation()},PADDING:12,MIN_WIDTH:170}),BEM.DOM.decl({block:"serp-item",modName:"scale",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._resetScaleStyles()._updateLoadedMod(),BEM.blocks["b-page"].on("resize",this._onResize,this)}},hovered:{yes:function(){if(!this._leaved){var t=this.__self.HOVER_SCALE,e=this;this.__base.apply(this,arguments),t>1&&(this._baseSize=this._calcBaseParams(this.domElem),this._scaledSize=this._calcScaledParams(t),this.setMod("scaled","yes"),this._nextFrameExec(function(){var t={left:e._scaledSize.left,top:e._scaledSize.top,width:e._scaledSize.width,paddingBottom:e._scaledSize.paddingBottom};BEM.blocks["i-global"].param("verticalSerp")&&(t.height=e._scaledSize.height),e.elem("preview").css(t)}))}}},selected:{yes:function(){this._leave(this.__base)}}},destruct:function(){this._setLoadedFunc&&this.elem("thumb").off("load",this._setLoadedFunc),BEM.blocks["b-page"].un("resize",this._onResize,this),this.__base.apply(this,arguments)},_onResize:function(){this._resetScaleStyles(),this._scaledSize={},this._baseSize={}},_setLoadedMod:function(){return this.setMod("loaded")},_resetScaleStyles:function(){var t={left:0,top:0,width:this.domElem.width()};return BEM.blocks["i-global"].param("verticalSerp")&&(t.height=this.domElem.height()),this.elem("preview").css(t),this},_updateLoadedMod:function(){return this._thumbLoaded()?this._setLoadedMod():(this._setLoadedFunc=this._setLoadedMod.bind(this),this.elem("thumb").on("load",this._setLoadedFunc)),this},_nextFrameExec:function(t){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){t()})})},_onPointerLeave:function(){this._leave(this.__base)},_leave:function(t){var e=this;this._leaved=!0,this._nextFrameExec(function(){e._resetScaleStyles()}),setTimeout(function(){this.delMod("scaled"),this._leaved=!1,t&&t.apply(this,arguments)}.bind(this),this.__self.HOVER_ANIMATION_DURATION)},_calcBaseParams:function(t){return this.isSizeInited(this._baseSize)?this._baseSize:{height:t.height(),width:t.width(),paddingTop:this._calcPolaroidPadding()}},_calcScaledParams:function(t){var e=this.isSizeInited(this._scaledSize)?this._scaledSize:{height:Math.floor(this._baseSize.height*t),width:Math.floor(this._baseSize.width*t)};return e.left=this._calcShiftLeft(this._baseSize,e),e.top=this._calcShiftTop(this._baseSize,e),e.paddingBottom=Math.floor((this._baseSize.height-this.elem("thumb").height())/2),e},_calcShiftLeft:function(t,e){var i=this.domElem;return this._isFirstImageInRow(i,i.prev())?0:this._isLastImageInRow(e.width,i,i.next())?t.width-e.width:Math.floor((t.width-e.width)/2)},_calcShiftTop:function(t,e){var i=this.domElem;return this._isFirstRow(i,i.parent())?0:Math.floor((t.height-e.height)/2)},_isFirstRow:function(t,e){var i=t.offset(),n=e.offset();return!(!i||!n)&&i.top===n.top},isSizeInited:function(t){return Boolean(t&&t.width>0&&t.height>0)}},{HOVER_ANIMATION_DURATION:150,HOVER_SCALE:1.3}),BEM.DOM.decl({block:"serp-item",modName:"gif-anim",modVal:!0},{onSetMod:{scaled:{yes:function(){this.__base.apply(this,arguments),this._playAnimation()},"":function(){this.__base.apply(this,arguments),this._stopAnimation()}}},_playAnimation:function(){var t=this,e=this.params.preview&&this.params.preview[0],i=e&&e.url;t.blockInside("spin2")||BEM.DOM.append(this.elem("preview"),BEMHTML.apply({block:"spin2",mods:{progress:"yes",size:"xxs"}})),t.setMod("loading",!0),c.hitDelayed({dtype:"iweb",path:"/image/new/serp/gif/start",pos:t.params.pos,reqid:t.params.reqid},{href:t.params.img_href}),this._loadPreview(i).done(function(){t.hasMod("loading")&&(t.elem("thumb").attr("src",i),t.delMod("loading"),c.hitDelayed({dtype:"iweb",path:"/image/new/serp/gif/play",pos:t.params.pos,reqid:t.params.reqid},{href:t.params.img_href}))}).fail(function(){t.delMod("loading")})},_stopAnimation:function(){this.delMod("loading"),this.elem("thumb").attr("src",this.params.thumb.url),this._stopLoadPreview()},_stopLoadPreview:function(){this._animationImg&&(this._animationImg.src="",this._animationImg=null)},_loadPreview:function(t){var e=$.Deferred();if(this._previewLoaded)return e.resolve();var i=new Image;return this._animationImg=i,i.onload=e.resolve,i.onerror=e.reject,i.src=t,e.promise()},_onPointerLeave:function(){this.__base.apply(this,arguments),this._stopAnimation()}}),BEM.DOM.decl({block:"serp-list",modName:"lazy-thumbs",modVal:"yes"},{_onListAdded:function(){this.__base.apply(this,arguments),this._handleThumbs(this._getLazyThumbs())},_handleThumbs:function(t){var e=t.length;this._thumbsLoadList=t,this._thumbsLoadCursor=-1,this._loadThumbs(e)},_getLazyThumbs:function(){return this.domElem.find(".serp-item__thumb:not([src])")},_loadThumbs:function(t){for(var e=0;e<t;e++)this._loadNextThumb()},_loadThumb:function(t){t&&$(t).on("load error",this._loadNextThumb.bind(this)).attr("src",t.getAttribute("data-thumb"))},_loadNextThumb:function(){var t=this._thumbsLoadList[++this._thumbsLoadCursor];this._loadThumb(t)}}),BEM.DOM.decl({block:"serp-list",modName:"unique",modVal:"yes"},{_removeDuplicates:function(t){this._uniqIds||(this._uniqIds={});var e=this._uniqIds,i=!1,n=this;t.find(".serp-item").each(function(t,s){e[s.id]?($(s).remove(),n._countRemovedDuplicate(s),i=!0):e[s.id]=!0}),i&&this.fitAllItems()},_countRemovedDuplicate:function(t){var e=$(t).data("bem")["serp-item"].img_href;window.Ya.Images.errcnt({src:e},73082)}}),BEM.DOM.decl({block:"serp-list",modName:"rum",modVal:"yes"},{_loadedThumbs:{},_serpItemImgSelector:".serp-item__thumb",_rumThumbCounterPath:void 0,getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.chunks=[6,6,18],t},onSetMod:{js:{inited:function(){if(this.MAX_RESULTS=450,this.__base.apply(this,arguments),this._isResourceTimingAPIAvaliable()){this.setupSpeedTest();var t=this._getImagesToBind(this.domElem.find(this._serpItemImgSelector).get());t&&t.forEach(function(t){this.bindToImages(t)}.bind(this))}}}},_getImagesToBind:function(t){if(!t||!t.length)return null;var e,i,n,s=this.params.chunks,o=[],r=0;for(n=0;n<s.length&&(i=r+s[n],(e=t.slice(r,i)).length);n++)o.push(this._getImagesWithPos(e,r)),r=i;return o},_getImagesWithPos:function(t,e){return e||(e=0),t.map(function(t,i){return{domElem:t,pos:i+e}})},_isResourceTimingAPIAvaliable:function(){return window.performance&&(window.performance.getEntries||window.performance.webkitGetEntries)},setupSpeedTest:function(){var t=window.performance,e=t.setResourceTimingBufferSize?"setResourceTimingBufferSize":"webkitSetResourceTimingBufferSize";return t[e]&&t[e](this.MAX_RESULTS),this},bindToImages:function(t){var e=t.length,i=function(){0===--e&&setTimeout(function(){this.allImagesLoadedHandler(t)}.bind(this),1)}.bind(this);return t.forEach(function(t){t.domElem.complete?i():$(t.domElem).bind("load error",i)}),this},getEntriesName:function(){return window.performance.getEntries?"getEntries":"webkitGetEntries"},getImagesTimings:function(t){for(var e,i,n,s,o,r,a,h=this.getEntriesName(),c=window.performance[h](),l=BEM.blocks["i-ua"].getConnectionType(),u=[],d=0,p=c.length;d<p;d++)void 0===t[a=(r=c[d]).name]||this._loadedThumbs[a]||(s=-1!==a.indexOf("http://")?"http":"https",n=a.replace(".yandex.net","").replace(s+"://","").split("/"),o=r.startTime,i=r.responseStart||o,e=[Math.floor(o),Math.floor(r.redirectEnd-r.redirectStart),Math.floor(r.domainLookupEnd-r.domainLookupStart),Math.max(Math.floor(r.domainLookupStart-r.fetchStart),0),Math.floor(r.connectEnd-(r.secureConnectionStart||r.connectStart)),Math.floor(r.responseStart-r.requestStart),Math.floor(r.responseEnd-i),Math.floor(r.duration),Math.floor(r.responseEnd),void 0===r.transferSize?-1:Math.floor(r.transferSize),s,encodeURIComponent(n[0]),encodeURIComponent(n[1]),t[a]],l&&e.push(l),u.push(e.join(";")),this._loadedThumbs[a]=e);return u},allImagesLoadedHandler:function(t){var e,i,n={};t.forEach(function(t){i=t.domElem.src,/^https?\:/.test(i)||(i=window.location.protocol+i),n[i]=t.pos}),(e=this.getImagesTimings(n)).length&&this.sendStats(e)},sendStats:function(t){c.hitDelayed({dtype:"stred",pid:40,cid:73260,path:this._rumThumbCounterPath,vars:"-info="+t.join("!")},this.domElem),BEM.blocks.counter.debug("thumbs load timings",{path:this._rumThumbCounterPath,vars:t})}}),BEM.DOM.decl({block:"serp-list",modName:"rum",modVal:"yes"},{_rumThumbCounterPath:"8.228.1045"}),BEM.decl("justifier",{},{fitImages:function(t){return window.Ya.Images.fitImages(t)}}),BEM.DOM.decl({block:"serp-list",modName:"vertical2",modVal:!0},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._fixMediaBannerWidth()}}},_getColsContainerWidth:function(){var t;return void 0===this._colsContainerWidth&&(t=this.domElem.find(".justifier__cols"),this._colsContainerWidth=t.width()),this._colsContainerWidth},_resetColsContainerWidth:function(){delete this._colsContainerWidth},_onPageResize:function(){this.__base.apply(this,arguments),this._resetColsContainerWidth(),this._fixMediaBannerWidth()},_fixMediaBannerWidth:function(){var t=this.blockInside({block:"direct",modName:"type",modVal:"search-top"});t&&t.domElem.css({width:this._getColsContainerWidth()})}}),BEM.DOM.decl({block:"serp-list",modName:"vertical2",modVal:!0},{destruct:function(){window.Ya.Images.verticalSerpList=null,this.__base.apply(this,arguments)},_createVerticalSerpList:function(){if(!window.Ya.Images.verticalSerpList){var t=this.domElem[0],e=this._getVerticalJustifierParams(t);window.Ya.Images.updateThumbsUnderlayColor(t),window.Ya.Images.verticalSerpList=new window.Ya.Images.VerticalJustifier2(e),t.style.visibility="visible"}},_getVerticalJustifierParams:function(t){var e=window.Ya,i=e.Images.verticalJustifierParams;i.dynamicConfig&&(i.dynamicConfig.avgRatio=BEM.blocks["i-global"].param("avgVerticalRatio"));var n=this.getMod("theme");return i.containerPadding="rounded"===n?24:0,{container:t,gap:i.gap,dynamicConfig:i.dynamicConfig,containerPadding:i.containerPadding,theme:n,containerWidth:function(){return t.clientWidth||document.body.clientWidth-(e.Images.serpMargin||0)},itemMaxHeight:i.itemMaxHeight}},_fitAllItems:function(){var t=this.hasMod("vertical-shadowed",!0);return this._createVerticalSerpList(),t&&this.hideShadow(),window.Ya.Images.updateThumbsUnderlayColor(this.domElem[0]),window.Ya.Images.verticalSerpList.fit(),t&&window.inNextFrame(this.showShadow,this),null},_getMinColHeight:function(){var t=Math.max(window.Ya.Images.verticalSerpList.minColumnHeight,window.Ya.Images.verticalSerpList.getSyncColMinHeight()),e=window.Ya.Images.verticalJustifierParams,i=e.gap&&e.gap.vertical||0;return t>0?t-i:0},showShadow:function(){var t=this._getMinColHeight();t?(this.domElem.css("height",t),this.setMod("vertical-shadowed",!0)):this.hideShadow()},hideShadow:function(){this.domElem.css("height",""),this.delMod("vertical-shadowed")},addVerticalItems:function(t,e){var i=[].slice.apply(t[0].children);return i.length?(window.Ya.Images.updateThumbsUnderlayColor(t[0]),"next"===e?window.Ya.Images.verticalSerpList.append(i):window.Ya.Images.verticalSerpList.prepend(i),this):this}}),BEM.DOM.decl({block:"serp-list",modName:"direct-insertions",modVal:"yes"},{bindEvents:function(){this.__base.apply(this,arguments),BEM.blocks["serp-list"].on("loaded",this._showDirectItems,this)},unbindEvents:function(){BEM.blocks["serp-list"].un("loaded",this._showDirectItems,this),this.__base.apply(this,arguments)},_showDirectItems:function(){var t=this.findBlocksInside({block:"serp-direct",modName:"pending",modVal:"yes"}),e=t.map(function(t){return t.getDirect().getRenderPromise()});e.length&&$.when.apply($,e).always(this._onAllDirectsRendered.bind(this,t))},_onAllDirectsRendered:function(t){var e=!1,i=0,n=this,s=function(t,i){"show"===i?(t.hasMod("hidden","yes")&&(e=!0),t.show()):(t.hasMod("hidden","yes")||(e=!0),t.hide())},o=function(){++i>=t.length&&e&&n.fitAllItems()};t.forEach(function(t){t.getDirect().getRenderPromise().done(function(){s(t,"show")}).fail(function(){s(t,"hide")}).always(o)})}}),BEM.DOM.decl("serp-direct",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.getDirect().update()}}},show:function(){this.domElem[0].classList.add("justifier__item"),this.delMod("pending").delMod("hidden"),this.blockInside("spin2").delMod("progress")},hide:function(){this.domElem[0].classList.remove("justifier__item"),this.delMod("pending").setMod("hidden","yes"),this.blockInside("spin2").delMod("progress")},getDirect:function(){return this.blockInside("direct")}}),BEM.DOM.decl("back",{onSetMod:{js:function(){this._isEnabled()&&(this.setMod("visibility","visible"),this.bindTo("pointerclick",this._onClick))}},_isEnabled:function(){return window.history&&window.history.length>1},_onClick:function(t){t.preventDefault(),window.history.back()}}),BEM.DOM.decl("notice",{_onEnableClick:$.noop,_onDisableCLick:$.noop,_setCookieValue:function(t,e){$.cookie("ipnd",t,{expires:new Date(Date.now()+18e5),path:e})},_hitCounter:function(t){c.hitDelayed({dtype:"iweb",path:this.params.counterPath,vars:"-action="+t})}}),BEM.DOM.decl("notice",{_onClick:function(t){var e=t.target.domElem;this.elem("enable").is(e)?this._onEnableClick():this.elem("disable").is(e)&&this._onDisableClick(),this.setMod("hidden","yes")}},{live:function(){this.liveInitOnBlockInsideEvent("click","button2",function(t){this._onClick(t)})}}),BEM.DOM.decl({block:"notice",modName:"type",modVal:"commercial"},{_onEnableClick:function(){this.__base.apply(this,arguments),this.trigger("commercial:turn-on"),this._hitCounter("yes")},_onDisableClick:function(){this.__base.apply(this,arguments),this._hitCounter("no")}}),BEM.DOM.decl({block:"notice",modName:"type",modVal:"safe-search"},{_onEnableClick:function(){this.__base.apply(this,arguments),this._setCookieValue(1,BEM.blocks["i-global"].param("router").index),this._hitCounter("enable")},_onDisableClick:function(){this.__base.apply(this,arguments),this._setCookieValue(0,BEM.blocks["i-global"].param("router").index),this.trigger("safe-search:turn-off"),this._hitCounter("disable")}}),BEM.DOM.decl("polaroid2",{showTo:function(t){return this._scale=t.scale||1,this._itemParams=t,this._setSnippet(t.snippet),this.domElem.css(this._calcPolaroidStyle(t)),t.serpItemDomElem.append(this.domElem),this._setBackgroundColor(t.color),this.show(),this},_setBackgroundColor:function(t){t&&(this._startBackgroundColor=this.domElem.css("background-color"),this.domElem.css("background-color",t))},_clearBackgroundColor:function(){void 0!==this._startBackgroundColor&&this.domElem.css("background-color",this._startBackgroundColor)},_calcPolaroidStyle:function(t){var e,i=t.itemWidth,n=t.padding||0,s=t.hovered,o=t.minWidth+2*n,r=i+2*n,a={top:-n,bottom:0};return i<o&&(o-i)%2&&o++,s.middle&&s.small?(e=Math.floor((Math.max(r,o)-i)/2),a.left=-e,a.right=-e):(a.left=s.lastInRow?-Math.abs(o-r):-n,a.right=s.firstInRow&&s.small?-Math.abs(o-r):-n),a},_setSnippet:function(t){var e=this.elem("link");this.elem("title").html(t.text),this.setMod(this.elem("title"),"visibility",t.text?"":"hidden"),e.text(t.domain),e.attr("href",t.redirUrl),e.attr("title",t.domain)},_onComplainClick:function(){this.trigger("complain.click")},_onUrlClick:function(){c.hit({dtype:"iweb",path:this._itemParams.greenUrlCounterPath,pos:this._itemParams.position,reqid:this._itemParams.reqid,redirUrl:this._itemParams.snippet.url},{href:this._itemParams.snippet.url})},isVisible:function(){return this.hasMod("visible")},show:function(){this.setMod("visible","yes"),BEM.channel("polaroid2").trigger("show")},hide:function(){this._itemParams=null,this.delMod("visible"),this._clearBackgroundColor()}},{_instances:[],_cloneInstance:function(t){var e=t.domElem.clone(),i=e.bem(this.getName());return this._initInnerBlocks(e,t),i.hide(),i},_initInnerBlocks:function(t,e){t.find(".i-bem").each(function(t,i){var n=$(i),s=n.attr("data-bem"),o=s&&JSON.parse(s);o&&Object.keys(o).forEach(function(t){n.bem(t,e.blockInside(t).params)})})},getInstance:function(){var t=this._instances;return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance.domElem?t.length?this._getHiddenInstance(t):(t.push(this._instance),this._instance):(this.clearInstances(),this.getInstance())},_getHiddenInstance:function(t){for(var e,i=0;i<t.length;i++)if(!t[i].isVisible())return t[i];return e=this._cloneInstance(this._instance),t.push(e),e},clearInstances:function(){this._instance=null,this._instances=[]},showTo:function(t){return t?this.getInstance().showTo(t):null},hide:function(t){t&&t.hide()},live:function(){this.liveBindTo("complain","pointerclick",function(){this._onComplainClick()}).liveBindTo("url","pointerclick",function(){this._onUrlClick()})}}),BEM.DOM.decl({block:"polaroid2",modName:"with-onboarding",modVal:"yes"},{show:function(){var t=this.findBlockInside("tooltip");if(t){var e=this._itemParams.itemWidth*this._scale;t.updateIllustration(e)}return this.__base.apply(this,arguments)},hide:function(){var t=this.findBlockInside("tooltip");return t&&t.hide(),this.__base.apply(this,arguments)}}),BEM.DOM.decl("tooltip",{onSetMod:{js:{inited:function(){this._popup=null,this._owner=null}},shown:{yes:function(){this._getPopup().setMod("visible","yes").unbindFromDoc("keydown")},"":function(){this._getPopup().delMod("visible")}}},getOwner:function(){return this._owner},setOwner:function(t){return this._owner=t,this._getPopup().setAnchor(t),this},setContent:function(t){return BEM.DOM.update(this.elem("content"),t),this.redraw()},redraw:function(){return this.hasMod("shown","yes")&&this._getPopup().redraw(),this},destruct:function(){this.delMod("shown"),this.__base.apply(this,arguments)},_getPopup:function(){return this._popup||(this._popup=this.findBlockOn("popup2").on("beforeOpen",this._onPopupShow,this).on("beforeClose",this._onPopupHide,this)),this._popup},_onPopupShow:function(){this.trigger("show")},_onPopupHide:function(){this.delMod("shown").trigger("hide")},_onClick:function(){this.trigger("click").delMod("shown")}},{live:function(){this.liveBindTo("click",function(){this._onClick()})}}),BEM.DOM.decl("tooltip",{syncVisible:function(){this.getOwner()&&this.hasMod("shown","yes")&&this._getPopup().syncVisible()}}),BEM.DOM.decl("tooltip",{show:function(){return this.setMod("shown","yes")},hide:function(){return this.delMod("shown")}}),BEM.DOM.decl("tooltip",{setDirection:function(t){return this.__base.apply(this,arguments),this._getPopup().setDirection(t),this},setDescription:function(t){var e=this.elem("description");return e&&e.text(t),this}}),BEM.DOM.decl("popup2",{onSetMod:{js:{inited:function(){this._parentPopup=void 0,this._zIndex=null,this._zIndexGroupLevel=null,this._scope=BEM.DOM.scope,this._isAttachedToScope=!1}},visible:{yes:function(){this.trigger("beforeOpen"),this._makeEventOnAnimationEnd("Open"),this._isAttachedToScope||(this._scope.append(this.domElem),this._isAttachedToScope=!0),this._captureZIndex()._bindToParentPopup().bindTo("pointerdown pointerclick",this._setPreventHideByClick)},"":function(){this.trigger("beforeClose")._releaseZIndex()._unbindFromParentPopup().unbindFrom("pointerdown pointerclick"),this._makeEventOnAnimationEnd("Close")}}},destruct:function(){this.delMod("visible"),this.__base.apply(this,arguments)},setScope:function(t){return this._scope=t,this._isAttachedToScope=!1,this},setContent:function(t){return BEM.DOM.update(this.domElem,t),this},_calcZIndexGroupLevel:function(){var t=this.params.zIndexGroupLevel,e=this._getParentPopup();return e&&(t+=e._zIndexGroupLevel),t},_setPreventHideByClick:function(){var t=this;do{t._preventHideByClick=!0,t=t._getParentPopup()}while(t)},_bindToParentPopup:function(){var t=this._getParentPopup();return t&&t.on("beforeClose",this._onParentPopupClose,this),this},_unbindFromParentPopup:function(){return this._parentPopup&&this._parentPopup.un("beforeClose",this._onParentPopupClose,this),this._parentPopup=void 0,this},_onParentPopupClose:function(){this.delMod("visible")},_getParentPopup:function(){return this._parentPopup},_captureZIndex:function(){null===this._zIndexGroupLevel&&(this._zIndexGroupLevel=this._calcZIndexGroupLevel());var t=this.__self._visiblePopupsZIndexes,e=this._zIndexGroupLevel,i=t[e],n=this._zIndex;return i||(i=t[e]=[(e+1)*this.__self.ZINDEX_FACTOR]),this._zIndex=i[i.length-1]+1,i.push(this._zIndex),this._zIndex!==n&&this.domElem.css("z-index",this._zIndex),this},_releaseZIndex:function(){var t=this.__self._visiblePopupsZIndexes[this._zIndexGroupLevel];return t&&t.splice(t.indexOf(this._zIndex),1),this},_recaptureZIndex:function(){return this._releaseZIndex(),this._zIndexGroupLevel=null,this._captureZIndex()},getDefaultParams:function(){return{zIndexGroupLevel:0}},_makeEventOnAnimationEnd:function(t){var e=this.domElem,i=window.getComputedStyle?window.getComputedStyle(e[0]):e[0].currentStyle,n=parseFloat(i.animationDuration)>0?"animationend":parseFloat(i.webkitAnimationDuration)>0?"webkitAnimationEnd":"",s=function(){this.trigger("after"+t)};n?e.one(n,s.bind(this)):this.afterCurrentEvent(s)}},{live:!0,_visiblePopupsZIndexes:{},ZINDEX_FACTOR:1e3}),BEM.DOM.decl("popup2",{attachToScope:function(t){return t&&(this._scope=t),this._scope.append(this.domElem),this._isAttachedToScope=!0,this}}),BEM.DOM.decl("popup2",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._bindEvents()}}},_bindEvents:function(){return this.redraw&&(BEM.channel("atom").on("stripe-show",this._onDaasChanged,this),BEM.channel("atom").on("stripe-hide",this._onDaasChanged,this)),BEM.blocks["b-page"].on("load:start",this._onPageChange,this),this.__base.apply(this,arguments)},destruct:function(){this.redraw&&(BEM.channel("atom").un("stripe-show",this._onDaasChanged,this),BEM.channel("atom").un("stripe-hide",this._onDaasChanged,this)),BEM.blocks["b-page"].un("load:start",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(){this.delMod("visible")},_onDaasChanged:function(){this.redraw()}}),BEM.DOM.decl("popup2",{onSetMod:{visible:{yes:function(){this.__base.apply(this,arguments),this.hasMod("type","internal")||BEM.blocks["b-page"].on("scroll",this._onPageScroll,this)},"":function(){this.__base.apply(this,arguments),this.hasMod("type","internal")||BEM.blocks["b-page"].un("scroll",this._onPageScroll)}}},_onPageScroll:function(){this.params.keepOnScroll||this.delMod("visible")},setDirection:function(t){return this.__base.apply(this,arguments),this.params.directions=t,this}}),BEM.DOM.decl({block:"popup2",modName:"target"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._lastPopupDrawingCss={left:void 0,top:void 0,zIndex:void 0,display:void 0},this._lastTailDrawingCss={left:void 0,top:void 0},this._initialVisible=this.hasMod("visible")}},visible:{yes:function(){this.__base.apply(this,arguments),this.bindToWin("scroll resize",this._onWinScrollAndResize).redraw(!0)},"":function(){this.__base.apply(this,arguments),this.unbindFromWin("scroll resize")}}},setContent:function(){return this.__base.apply(this,arguments).redraw()},_draw:function(){var t=this._calcBestDrawingParams();return this.setMod("direction",t.direction),e(this._lastPopupDrawingCss,this._calcDrawingCss(t))&&this.domElem.css(this._lastPopupDrawingCss),e(this._lastTailDrawingCss,this._calcTailDrawingCss(t))&&this.elem("tail").css(this._lastTailDrawingCss),this;function e(t,e){var i=!1;return Object.keys(e).forEach(function(n){var s=e[n];t[n]!==s&&(t[n]=s,i=!0)}),i}},redraw:function(t){return this.hasMod("visible","yes")||t?(this.setMod("outside","yes")._draw().delMod("outside"),this):this},_calcDrawingCss:function(t){var e,i=this._scope;return i.is(BEM.DOM.scope)||(e=i.offset(),t.top-=e.top,t.left-=e.left),{left:t.left,top:t.top}},_calcTailDrawingCss:function(t){return t.tail},calcPossibleDrawingParams:function(){var t=this._calcTargetDimensions(),e=this._calcViewportDimensions(),i=this._calcOffsets();return this.params.directions.map(function(n){var s={direction:n,width:0,height:0,left:0,top:0};return this._checkMainDirection(n,"bottom")?(s.top=t.top+t.height+i.main,s.height=e.bottom-s.top-i.viewport):this._checkMainDirection(n,"top")?(s.height=t.top-e.top-i.main-i.viewport,s.top=t.top-s.height-i.main):(this._checkSecondaryDirection(n,"center")?(s.height=e.bottom-e.top-2*i.viewport,s.top=t.top+(t.height-s.height)/2):this._checkSecondaryDirection(n,"bottom")?(s.height=t.top+t.height-e.top-i.secondary-i.viewport,s.top=t.top+t.height-s.height-i.secondary):this._checkSecondaryDirection(n,"top")&&(s.top=t.top+i.secondary,s.height=e.bottom-s.top-i.viewport),this._checkMainDirection(n,"left")?(s.width=t.left-e.left-i.main-i.viewport,s.left=t.left-s.width-i.main):(s.left=t.left+t.width+i.main,s.width=e.right-s.left-i.viewport)),this._checkSecondaryDirection(n,"right")?(s.width=t.left+t.width-e.left-i.secondary-i.viewport,s.left=t.left+t.width-s.width-i.secondary):this._checkSecondaryDirection(n,"left")?(s.left=t.left+i.secondary,s.width=e.right-s.left-i.viewport):this._checkSecondaryDirection(n,"center")&&this._checkMainDirection(n,"top","bottom")&&(s.width=e.right-e.left-2*i.viewport,s.left=t.left+t.width/2-s.width/2),s},this)},_calcBestDrawingParams:function(){for(var t,e,i,n,s,o,r=this._calcPopupDimensions(),a=this._calcTargetDimensions(),h=this._calcViewportDimensions(),c=this.params.directions,l=c.length,u=0;u<l&&(t=c[u],e=this._calcPos(t,a,r),i=this._calcViewportFactor(e,h,r),(0===u||i>o||!o&&this.hasMod("direction",t))&&(n=t,o=i,s=e),!(o>this.__self.VIEWPORT_ACCURACY_FACTOR));u++);return{direction:n,left:s.left,top:s.top,tail:this._calcTailPos(n,a,r,s)}},_calcPopupDimensions:function(){var t=this.domElem.outerWidth(),e=this.domElem.outerHeight();return{width:t,height:e,innerWidth:this.domElem.innerWidth(),innerHeight:this.domElem.innerHeight(),area:t*e}},_calcTailDimension:function(){var t=this.elem("tail"),e=this.params.tailSize||t.outerWidth();return t.length>0?e:0},_calcTargetDimensions:function(){},_calcViewportDimensions:function(){var t=BEM.DOM.win,e=t.scrollTop(),i=t.scrollLeft(),n=t.width();return{top:e,left:i,bottom:e+t.height(),right:i+n}},_calcPos:function(t,e,i){var n={},s=this._calcOffsets();return this._checkMainDirection(t,"bottom")?n.top=e.top+e.height+s.main:this._checkMainDirection(t,"top")?n.top=e.top-i.height-s.main:this._checkMainDirection(t,"left")?n.left=e.left-i.width-s.main:this._checkMainDirection(t,"right")&&(n.left=e.left+e.width+s.main),this._checkSecondaryDirection(t,"right")?n.left=e.left+e.width-i.width-s.secondary:this._checkSecondaryDirection(t,"left")?n.left=e.left+s.secondary:this._checkSecondaryDirection(t,"bottom")?n.top=e.top+e.height-i.height-s.secondary:this._checkSecondaryDirection(t,"top")?n.top=e.top+s.secondary:this._checkSecondaryDirection(t,"center")&&(this._checkMainDirection(t,"top","bottom")?n.left=e.left+e.width/2-i.width/2:this._checkMainDirection(t,"left","right")&&(n.top=e.top+e.height/2-i.height/2)),n},_calcTailPos:function(t,e,i,n){var s={},o=this._calcTailDimension()/2,r=this.params.tailOffset,a=this.params.tailSize;return this._checkMainDirection(t,"bottom")?s.top=-o:this._checkMainDirection(t,"top")?s.top=Math.floor(i.innerHeight-o):this._checkMainDirection(t,"left")?s.left=Math.floor(i.innerWidth-o):this._checkMainDirection(t,"right")&&(s.left=-o),this._checkSecondaryDirection(t,"right")?s.left=i.innerWidth-Math.ceil(Math.min(i.innerWidth,e.width)/2)-o-r:this._checkSecondaryDirection(t,"left")?s.left=Math.ceil(Math.min(i.innerWidth,e.width)/2)-o+r:this._checkSecondaryDirection(t,"bottom")?s.top=i.innerHeight-Math.ceil(Math.min(i.innerHeight,e.height)/2)-o-r:this._checkSecondaryDirection(t,"top")?s.top=Math.ceil(Math.min(i.innerHeight,e.height)/2)-o+r:this._checkSecondaryDirection(t,"center")&&(this._checkMainDirection(t,"top","bottom")?s.left=Math.ceil(i.innerWidth/2)-o+r:s.top=Math.ceil(i.innerHeight/2)-o+r),{top:s.top,left:s.left,width:a,height:a}},_calcViewportFactor:function(t,e,i){var n=this.params.viewportOffset,s=Math.max(t.left,e.left+n),o=Math.min(t.left+i.width,e.right-n),r=Math.max(t.top,e.top+n),a=Math.min(t.top+i.height,e.bottom-n);return s<o&&r<a?(o-s)*(a-r)/i.area:0},_calcOffsets:function(){var t=this.params,e=this._calcTailDimension();return{main:t.mainOffset>=0&&e>0?Math.max(t.mainOffset,Math.round(e*Math.SQRT1_2)):t.mainOffset,secondary:t.secondaryOffset,viewport:t.viewportOffset}},_checkMainDirection:function(t,e,i){return 0===t.indexOf(e)||i&&0===t.indexOf(i)},_checkSecondaryDirection:function(t,e){return t.indexOf("-"+e)>0},_checkDirection:function(t,e){return t.indexOf(e)>=0},_onWinScollAndResize:function(t){this._onWinScrollAndResize(t)},_onWinScrollAndResize:function(t){this.hasMod("visible","yes")&&this._draw()},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{mainOffset:0,secondaryOffset:0,viewportOffset:0,tailOffset:0,directions:this.__self.AVAILABLE_DIRECTIONS})},_setVisible:function(){this._initialVisible&&(this._initialVisible=!1,this.delMod("visible").setMod("visible","yes"))}},{VIEWPORT_ACCURACY_FACTOR:.99,AVAILABLE_DIRECTIONS:["bottom-left","bottom-center","bottom-right","top-left","top-center","top-right","right-top","right-center","right-bottom","left-top","left-center","left-bottom"]}),function(t){BEM.DOM.decl({block:"popup2",modName:"target",modVal:"anchor"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._anchor=null,this._destructor=null,this._fixedAnchor=void 0}},visible:{yes:function(){this.bindToDoc("documentchange",this._onWinScrollAndResize),this.__base.apply(this,arguments)},"":function(){this.__base.apply(this,arguments),this.unbindFromDoc("documentchange")}}},destruct:function(){this._unbindFromDestructor(),this.__base.apply(this,arguments)},setAnchor:function(t){var e,i;return this._unbindFromDestructor()._unbindFromParentPopup(),this._anchor=t instanceof BEM.DOM?t.domElem:t,this._destructor=(e=this._anchor,i="_"+this.__self.getName()+"-destructor",e.addClass("i-bem "+i).bem(i)),this._fixedAnchor=void 0,this._bindToDestructor(),this._setVisible(),this.hasMod("visible")?this._recaptureZIndex()._bindToParentPopup().redraw():this._zIndexGroupLevel=null,this},_calcTargetDimensions:function(){var t=this._anchor,e=this._getOffsetOf(t);return{left:e.left,top:e.top,width:t.outerWidth(),height:t.outerHeight()}},_getOffsetOf:function(t){var e=t.offset();return"pageYOffset"in window&&(e.top-=window.pageYOffset-(document.documentElement.scrollTop||document.body.scrollTop),e.left-=window.pageXOffset-(document.documentElement.scrollLeft||document.body.scrollLeft)),e},_calcDrawingCss:function(e){var i=this.__base.apply(this,arguments);if(void 0===this._fixedAnchor&&(this._fixedAnchor=this._getFirstFixedParent(this._anchor)),this._fixedAnchor){var n=0,s=0,o=this._getFirstFixedParent(this._scope);if(o){var r=o.offset();n=r.left,s=r.top}i.left-=t(window).scrollLeft()-n,i.top-=t(window).scrollTop()-s}return t.extend(i,{position:this._fixedAnchor?"fixed":""})},_getFirstFixedParent:function(e){for(e=e[0];e;){if(1===e.nodeType&&"fixed"===t(e).css("position"))return t(e);e=e.parentNode}return null},_calcZIndexGroupLevel:function(){var t=this.__base.apply(this,arguments);return this._destructor.findBlocksOutside("z-index-group").reduce(function(t,e){return t+Number(e.getMod("level"))},t)},_bindToDestructor:function(){return this._destructor.on("destruct",this._onPopupAnchorDestruct,this),this},_unbindFromDestructor:function(){return this._destructor&&this._destructor.un("destruct",this._onPopupAnchorDestruct,this),this},_onPopupAnchorDestruct:function(){this.domElem&&BEM.DOM.destruct(this.domElem)},_getParentPopup:function(){if(void 0===this._parentPopup){var t=this._anchor.closest(".popup2");this._parentPopup=this.findBlockOn(t,this.__self.getName())}return this._parentPopup}}),BEM.DOM.decl("_popup2-destructor",{destruct:function(){this.trigger("destruct"),this.__base.apply(this,arguments)}})}(jQuery),BEM.DOM.decl({block:"popup2",modName:"target",modVal:"anchor"},{syncVisible:function(){this._updateIsAnchorVisible()}}),$.extend({debounce:function(t,e,i,n){var s,o=function(){var o=arguments;n=n||this,i&&!s&&t.apply(n,o),clearTimeout(s),s=setTimeout(function(){i||t.apply(n,o),s=null},e)};return 3===arguments.length&&"boolean"!=typeof i&&(n=i,i=!1),o.stop=function(){clearTimeout(s),s=null},o},throttle:function(t,e,i){var n,s,o,r=function(){s=arguments,o=!0,i=i||this,n||function(){o?(t.apply(i,s),o=!1,n=setTimeout(arguments.callee,e)):n=null}()};return r.stop=function(){clearTimeout(n),n=null},r}}),BEM.DOM.decl({block:"popup2",modName:"hiding",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._anchorParents=null,this._isAnchorVisible=void 0,this._updateIsAnchorVisible=$.throttle(this._updateIsAnchorVisible,this.__self.UPDATE_TARGET_VISIBILITY_THROTTLING_INTERVAL,this)}},visible:{yes:function(){this._anchorParents=this._getAnchorParents(),this._bindToAnchorParents(),this.__base.apply(this,arguments)},"":function(){this.__base.apply(this,arguments),this._updateIsAnchorVisible.stop(),this._unbindFromAnchorParents(),this._anchorParents=null,this._isAnchorVisible=void 0}}},_getAnchorParents:function(){for(var t,e=this;e&&e._anchor;)t=e,e=e._getParentPopup();return $(t._anchor).parents()},setAnchor:function(t){return this.__base.apply(this,arguments),this._unbindFromAnchorParents(),this._isAnchorVisible=void 0,this.hasMod("visible")?(this._anchorParents=this._getAnchorParents(),this._bindToAnchorParents()):this._anchorParents=null,this},_unbindFromDestructor:function(){return this._updateIsAnchorVisible.stop&&this._updateIsAnchorVisible.stop(),this.__base.apply(this,arguments)},_calcDrawingCss:function(t){var e=this.__base.apply(this,arguments);return void 0===this._isAnchorVisible&&(this._isAnchorVisible=this._calcIsAnchorVisible()),$.extend(e,{display:this._isAnchorVisible?"":"none"})},_calcIsAnchorVisible:function(){var t=!0;return this._anchorParents.each(function(e,i){if("BODY"===i.tagName)return!1;i=$(i);var n=/scroll|hidden|auto/,s=n.test(i.css("overflow-y")),o=n.test(i.css("overflow-x"));if(s||o){var r=this._getOffsetOf(i),a=Math.floor(r.top),h=this._anchor,c=this._getOffsetOf(h),l=this.getMod("direction"),u=Math.floor(this._checkDirection(l,"top")?c.top:c.top+h.outerHeight());if(u<a||a+i.outerHeight()<u)return t=!1,!1;var d=Math.floor(this._checkDirection(l,"left")?c.left:c.left+h.outerWidth()),p=Math.floor(r.left);return t=d>=p&&p+i.outerWidth()>=d}}.bind(this)),t},_bindToAnchorParents:function(){return this.bindTo(this._anchorParents,"scroll",this._onAnchorParentsScroll)},_unbindFromAnchorParents:function(){return this._updateIsAnchorVisible.stop(),this._anchorParents&&this.unbindFrom(this._anchorParents,"scroll"),this},_onAnchorParentsScroll:function(){this.redraw()._updateIsAnchorVisible()},_onWinScrollAndResize:function(){this.hasMod("visible")&&(this.__base.apply(this,arguments),this._updateIsAnchorVisible())},_updateIsAnchorVisible:function(){if(this.domElem){var t=this._calcIsAnchorVisible();t!==this._isAnchorVisible&&(this._isAnchorVisible=t,this.redraw())}}},{UPDATE_TARGET_VISIBILITY_THROTTLING_INTERVAL:100}),BEM.DOM.decl({block:"popup2",modName:"autoclosable",modVal:"yes"},{onSetMod:{visible:{yes:function(){this.__self._visiblePopupsStack.unshift(this),this.afterCurrentEvent(function(){this.domElem&&this.hasMod("visible")&&this.bindToDoc("pointerclick",this._onDocClick)}),this.__base.apply(this,arguments)},"":function(){var t=this.__self._visiblePopupsStack;t.splice(t.indexOf(this),1),this.unbindFromDoc("pointerclick").__base.apply(this,arguments)}}},_onDocClick:function(t){this.hasMod("target","anchor")&&(this._anchor[0]===t.target||this._anchor.find(t.target).length>0)||(this._preventHideByClick?this._preventHideByClick=null:this.delMod("visible"))}},{live:function(){return BEM.DOM.doc.on("keydown",this._onDocKeyPress.bind(this)),this.__base()},_visiblePopupsStack:[],_onDocKeyPress:function(t){BEM.blocks.keycodes.is(t.keyCode,"ESC")&&this._visiblePopupsStack.length&&this._visiblePopupsStack[0].delMod("visible")}}),BEM.DOM.decl({block:"popup2",modName:"autoclosable",modVal:"yes"},{_onDocClick:function(t){if(!this.hasMod("fixed","yes")||!(this._anchor[0]===t.target||this._anchor.find(t.target).length>0))return this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"popup2",modName:"theme",modVal:"normal"},{getDefaultParams:function(){return $.extend(this.__base(),{mainOffset:5,viewportOffset:5})}}),BEM.DOM.decl({block:"tooltip",modName:"inline",modVal:!0},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.setMod("shown","yes")}}},_getPopup:function(){var t,e=this;function i(){return t}return t={hide:function(){e.hide()},show:function(){e.show()},setMod:i,delMod:i,redraw:i,setAnchor:i,setDirection:i,syncVisible:i,unbindFromDoc:i}}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("close","pointerclick",function(t){this.hide(),t.preventDefault()})}}),BEM.DOM.decl({block:"tooltip",modName:"onetime",modVal:!0},{getDefaultParams:function(){var t=this.__base();return t.storekey="onboardingtooltip",t},onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._storage=window.localStorage,this.wasShown()&&this.delMod("shown")}},shown:{"":function(){this.markAsShown()}}},show:function(){if(!this.wasShown())return this.__base.apply(this,arguments)},wasShown:function(){var t=this._storage&&this._storage.getItem(this.params.storekey);return Boolean(t)},markAsShown:function(){this._storage&&this._storage.setItem(this.params.storekey,!0)}}),BEM.DOM.decl("tooltip",{SHOW_ILLUSTRATION_THRESHOLD:300,updateIllustration:function(t){var e=t<this.SHOW_ILLUSTRATION_THRESHOLD;if(e){var i=this.getMod(this.elem("illustration"),"pos");this.oldIllustrationPos=i||this.oldIllustrationPos,this.delMod(this.elem("illustration"),"pos")}!e&&this.oldIllustrationPos&&this.setMod(this.elem("illustration"),"pos",this.oldIllustrationPos)}}),BEM.DOM.decl({block:"polaroid2",modName:"with-actions",modVal:!0},{SOURCE_NAME:"lego_img_serp_thumb",showTo:function(t){this._serpItemParams=t.serpItemParams,this._serpItemIndex=t.serpItemIndex;var e=this.blockInside("favorites-button");return e&&e.setSource(this._serpItemParams,this.SOURCE_NAME),this._initActionState(),this.__base.apply(this,arguments)},_onActionPointerMove:function(t){var e=this.elemify(t.data.domElem,"action");BEM.channel("polaroid2").trigger("action:pointer-move",{target:$(t.target),type:t.type,text:this._getText(e)})},_updateFavoritesText:function(){var t=this.elem("action","type","favorites");BEM.channel("polaroid2").trigger("action:pointer-move",{text:this._getText(t)})},_onActionClick:function(t){var e,i=this.getMod(t.data&&t.data.domElem,"type"),n=this.elem("action","type",i);n&&("favorites"===i&&(i=this.blockInside("favorites-button").getButtonType()),e=this.hasMod(n,"disabled","yes"),c.hitDelayed({dtype:"iweb",path:"/image/new/serp/action/click",reqid:this._serpItemParams.reqid,vars:BEM.blocks.counter.convertVarsToString({pos:this._serpItemIndex,type:i,disabled:e?"yes":"no"})},{href:this._serpItemParams.img_href}),e||(BEM.channel("polaroid2").trigger("action:click",{type:i,serpItemParams:this._serpItemParams,serpItemIndex:this._serpItemIndex,clickEvent:t}),"similar"===i&&(this.setMod(n,"disabled","yes"),this._markAsDisabled(i,this._serpItemParams.docid))))},_markAsDisabled:function(t,e){this.__self._stateCahce[t]=this.__self._stateCahce[t]||{},this.__self._stateCahce[t][e]={disabled:!0}},_isDisabled:function(t,e){var i=this.__self._stateCahce[t];return i&&i[e]&&i[e].disabled},_initActionState:function(){this.elem("action").each(function(t,e){var i=this.elemify(e,"action"),n=this._isDisabled(this.getMod(i,"type"),this._serpItemParams.docid);this.setMod(i,"disabled",n?"yes":"")}.bind(this))},_getText:function(t){var e=this.getMod(t,"type"),i=this.elemParams(t);return"favorites"===e?i.texts[this.blockInside("favorites-button").getButtonType()]:i.texts[e]}},{_stateCahce:{},live:function(){this.__base.apply(this,arguments),this.liveBindTo("action","pointerover pointerout",function(t){this._onActionPointerMove(t)}).liveBindTo("action","click",function(t){this._onActionClick(t)}).liveInitOnChannelEvent("collections","button:updated",function(){this._updateFavoritesText()})}}),BEM.DOM.decl("polaroid2-tooltip",{getDefaultParams:function(){return{showTimeout:500}},_canShow:!1,_onActionTextChange:function(t){t.text&&(this.blockInside("tooltip").setContent(t.text),this._canShow=!0)},_onActionPointerMove:function(t){switch(t.type){case"pointerover":this._show(t.target);break;case"pointerout":this._hide()}},_show:function(t){this._canShow&&(clearTimeout(this._showTimeout),this._showTimeout=setTimeout(function(){this.blockInside("tooltip").setOwner(t).show()}.bind(this),this.params.showTimeout))},_hide:function(){clearTimeout(this._showTimeout),this.blockInside("tooltip").setOwner(this.elem("fake")).hide().setContent("")}},{live:function(){this.liveInitOnChannelEvent("polaroid2","action:pointer-move",function(t,e){this._onActionTextChange(e),this._onActionPointerMove(e)}).liveInitOnChannelEvent("polaroid2","action:text-change",function(t,e){this._onActionTextChange(e)})}}),BEM.DOM.decl("favorites-button",{setSource:function(t,e){this._sourceItem=t,this._sourceName=e;var i=BEM.blocks["favorites-controller"];return t.isFavorite&&!i.hasCachedState(t.docid)&&i.markAsSaved(t.docid),this._updateButton(),this},_updateButton:function(){var t=BEM.blocks["collections-controller"].getImages(this._sourceItem);this.setMod("saved",this._inCollections()?"yes":"no"),this.toggleMod("hidden","yes","",!t.length)},_inCollections:function(){return BEM.blocks["favorites-controller"].hasCollectionCard(this._sourceItem&&this._sourceItem.docid)}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("click",function(t){this._onClick(t)})}}),BEM.decl({block:"collections-controller",modName:"window",modVal:!0},{},{_windowMessages:{READY:"pdb-ready",CLOSE:"pdb-close",ADD_CARD:"pdb-add-card"},_windowSettings:{waitForClose:1e3,url:"/collections/share/?bus=1"},_window:null,openWindow:function(t,e,i){this.destructWindow(),window.addEventListener("message",this._windowOnMessage);var n=Object.keys(t).map(function(e){return e+"="+t[e]}).join(",");this._windowCard=e,this._newCollection=i&&i.newCollection,this._moveCollection=i&&i.moveCollection,this._useFavoritesAPI=i&&i.useFavoritesAPI,this._window=window.open(this._windowSettings.url,"favorites",n),this._windowHandleUnexpectedClose()},destructWindow:function(){this._windowCard=null,this._newCollection=!1,this._window&&(this._window.close(),this._window=null,window.removeEventListener("message",this._windowOnMessage)),clearInterval(this._windowInterval)},removeCard:function(t){if(t&&t.doc_id){var e=this;$.ajax({url:"/collections/api/favorites/cards/",type:"DELETE",dataType:"json",data:JSON.stringify(t),processData:!1,contentType:"application/json"}).done(function(){e._setCache(t.doc_id,{isSaved:!1})}).always(function(){BEM.channel("collections").trigger("window:removed",{id:t.doc_id})})}},_windowHandleUnexpectedClose:function(){this._windowInterval=setInterval(function(){this._window&&this._window.closed&&(BEM.channel("collections").trigger("window:closed"),this.destructWindow())}.bind(this),this._windowSettings.waitForClose)},_windowOnMessage:function(t){if(t.data){var e=BEM.blocks["collections-controller"];switch(t.data.type){case e._windowMessages.READY:return e._windowOnMessageReady();case e._windowMessages.CLOSE:return e._windowOnMessageClose(t.data)}}},_windowOnMessageReady:function(){var t={card:this._windowCard||{},type:this._windowMessages.ADD_CARD},e=this._getCache(this._windowCard.doc_id);this._newCollection&&(t.ui="board-create"),this._useFavoritesAPI&&(t.fav=!0),this._moveCollection&&(t.card.task_id=e&&e.taskId,t.card.doc_id=this._windowCard.doc_id),this._window.postMessage(t,"*")},_windowOnMessageClose:function(t){var e;t&&t.card&&(e=t.card.doc_id,this._setCache(e,{isSaved:!0}),this._useFavoritesAPI&&this._setCache(e,{taskId:t.card.task_id}),BEM.channel("collections").trigger("window:saved",{id:e,board:t.card.board,withMoreButton:!this._newCollection,inNewCollection:Boolean(this._newCollection),moveCollections:this._moveCollection})),this.destructWindow()}}),BEM.decl({block:"collections-controller",modName:"card-adapter",modVal:!0},{},{cardAdapter:function(t){var e=this.getImages(t),i=t.snippet||{},n=$.clearText(i.title||""),s=e[0].url||e[0].origin.url,o=e&&e.length?s:"";return{doc_id:t.docid,returl:location.href,description:n,content:[{source_type:"image",source:{url:o,preview:t.thumb&&t.thumb.url}}],source_meta:{page_title:n,page_url:i.url||"",page_domain:i.domain}}},getImages:function(t){return t?t.dups&&t.dups.length?t.dups:t.images&&t.images.length?t.images:t.preview&&t.preview.length?t.preview:[]:[]}}),jQuery.clearText=function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent},jQuery.clearText=function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent},BEM.decl({block:"favorites-controller"},{},{_SOURCE_NAME:"lego",_SOURCE_VERSION:"0.36.0",_UI:"common",SAVEBLE_FOR_SOURCE_TYPE:"image",OLD_FAV_API_URL:"/collections/api/favorites/cards/",BOARDS_LIST_API_URL:"/collections/api/v1.0/boards",CRF_API_URL:"/collections/api/v1.0/csrf-token",_crfToken:null,createCard:function(t,e,i,n){if(this._cacheBoardTypes&&this._cacheBoardTypes[e.content[0].source_type]||i){e.board=this._cacheBoardTypes&&this._cacheBoardTypes[e.content[0].source_type];var s=this._favoritesCommonRequest("POST",e,void 0,n);this._favoritesGetResponse("create",t,e,s,n)}else this._openAddPopup(e,n)},shareCard:function(t,e,i){if(this._cacheBoardTypes&&this._cacheBoardTypes[e.content[0].source_type]){var n=this._cacheBoardTypes[e.content[0].source_type],s=this._favoritesShareRequest({board_id:n},e.card_id,i);this._favoritesGetResponse("create",t,e,s,i)}else this._openAddPopup(e,i)},_openAddPopup:function(t,e){this.attachWindowSavedListener(),BEM.channel("collections").trigger("favorite:open-popup",{card:t,fav:!0,sourceName:e})},addCard:function(t,e,i,n){var s=$.extend({},e);s.board=i;var o=this._favoritesCommonRequest("POST",s,void 0,n);this._favoritesGetResponse("create",t,e,o,n)},removeCard:function(t,e,i,n){var s=(this._getCache(t)||{}).card_id;if(!s&&e&&e.card_id&&(s=e.card_id),s){var o=this._favoritesCommonRequest("DELETE",{},s,n);this._favoritesGetResponse("remove",t,e,o,n)}else this._old_removeCard(t,e,i,n)},_old_removeCard:function(t,e,i,n){var s=$.extend({},e);if(i&&i.byTaskId){var o=this._getCache(t);s.task_id=o&&o.task_id}var r=$.ajax({url:this._decorateUrlWithQuery(this.OLD_FAV_API_URL,n),type:"DELETE",dataType:"json",data:JSON.stringify(s),processData:!1,contentType:"application/json"});this._favoritesGetResponse("remove",t,e,r,n)},moveCollectionsCard:function(t,e,i){var n=t.card_id||t.id;if(e&&n){var s=this._favoritesCommonRequest("PATCH",{board_id:e},n,i);this._favoritesGetResponse("move",t.item_id,t,s,i)}},_favoritesCommonRequest:function(t,e,i,n){var s=this._decorateUrlWithQuery("/collections/api/v1.0/cards"+(i?"/"+i:""),n);return this._favoritesRequest(t,e,s)},_favoritesShareRequest:function(t,e,i){var n=this._decorateUrlWithQuery("/collections/api/cards/"+e+"/shares",i);return this._favoritesRequest("POST",t,n)},_favoritesRequest:function(t,e,i){var n=$.Deferred();return this._getCrf().then(function(s){$.ajax({headers:{"x-csrftoken":s["csrf-token"]},url:i,type:t,dataType:"json",data:JSON.stringify(e),processData:!1,contentType:"application/json"}).always(function(t){n.resolve(t)})}),n},_decorateUrlWithQuery:function(t,e){return t+"?source_name="+(e||this._SOURCE_NAME)+"&source_version="+this._SOURCE_VERSION+"&ui="+this._UI},_getCrf:function(){var t=$.Deferred(),e=this;return this._crfToken&&new Date<1e3*new Date(parseInt(this._crfToken.expires))?t.resolve(this._crfToken):($.ajax({url:this.CRF_API_URL,type:"GET",dataType:"json",processData:!1,contentType:"application/json"}).always(function(i){e._crfToken=i,t.resolve(i)}),t)},_favoritesGetResponse:function(t,e,i,n,s){var o=this;n.done(function(i){"create"===t&&o._setCache(e,{task_id:i.task_id})}).always(function(n){var r="create"===t||"move"===t?"window:saved":"window:removed",a=Boolean(n&&n.id)&&403!==n.status;"remove"!==t?o._setCache(e,{card_id:n.id,isSaved:a||o.hasCollectionCard(e)}):o._setCache(e,{isSaved:!1}),BEM.channel("collections").trigger(r,{action:t,card:$.extend(i,{id:n.id,item_id:e,failed:!a,card_id:n.id,task_id:n.task_id,board:n.board||null}),sourceName:s,response:n})})},_cache:{},_getCache:function(t){return this._cache[t]||null},_setCache:function(t,e,i){var n=this._cache[t]||{},s=this._cacheBoardTypes||{};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);i&&(s[i.sourceType]=i.boardId),this._cache[t]=n,this._cacheBoardTypes=s},hasCachedState:function(t){var e=this._getCache(t);return Boolean(e)&&"isSaved"in e},hasCollectionCard:function(t){var e=this._getCache(t);return Boolean(e&&e.isSaved)},markAsSaved:function(t){this._setCache(t,{isSaved:!0})},attachWindowSavedListener:function(){this.__attached||(this.__attached=!0,BEM.channel("collections").on("window:saved",function(t,e){if(!(e&&e.card&&e.card.failed)&&e&&e.card){var i,n=e.card,s={};n.content&&n.content[0]?i=n.content[0].source_type:this._windowCard&&this._windowCard.content[0]&&(i=this._windowCard.content[0].source_type),n.board&&n.board.id&&i&&(s.boardId=n.board.id,s.sourceType=i),this._setCache(n.item_id||n.doc_id||n.original_id,{id:n.id,card_id:n.id,task_id:n.task_id,isSaved:!0},s)}}.bind(this)))}}),BEM.decl({block:"favorites-controller"},{},{_UI:"desktop"}),BEM.DOM.decl({block:"favorites-button",modName:"open-window",modVal:!0},{_toggleButton:function(t){var e=BEM.blocks["collections-controller"].getImages(this._sourceItem);this.setMod("saved",this._inCollections()?"yes":"no"),this.toggleMod("hidden","yes","",!e.length),t.action&&BEM.channel("collections").trigger("button:updated",{inCollections:this._inCollections()})},_onClick:function(){var t=BEM.blocks["favorites-controller"],e=BEM.blocks["collections-controller"].cardAdapter(this._sourceItem),i=BEM.blocks["i-global"].param("isUzkubr"),n=BEM.blocks["i-global"].param("login");this._inCollections()?t.removeCard(e.doc_id,e,void 0,this._sourceName):i?(t.createCard(e.doc_id,e,!n,this._sourceName),BEM.channel("collections").trigger("favorite:action",{card:e,"tooltip-sticky":this.params&&this.params["tooltip-sticky"],target:this.domElem})):(t.attachWindowSavedListener(),BEM.channel("collections").trigger("favorite:open-popup",{card:e,fav:!0,sourceName:this._sourceName}),BEM.channel("collections").trigger("favorite:action",{card:e,"tooltip-sticky":this.params["tooltip-sticky"],target:this.domElem}))}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnChannelEvent("collections","window:saved",function(t,e){this._toggleButton(e)}).liveInitOnChannelEvent("collections","window:removed",function(t,e){this._toggleButton(e)})}}),BEM.DOM.decl({block:"favorites-button",modName:"theme",modVal:"polaroid"},{onSetMod:{saved:{yes:function(){this.__base.apply(this,arguments),this.switchIcon("favorites-filled")},no:function(){this.__base.apply(this,arguments),this.switchIcon("favorites")}}},switchIcon:function(t){this.blockInside("icon").setMod("action",t)},_updateButton:function(){this.__base(this,arguments),BEM.channel("collections").trigger("button:updated",{inCollections:this._inCollections()})},getButtonType:function(){return this._inCollections()?"favorites-remove":"favorites"}}),BEM.DOM.decl({block:"polaroid2",modName:"with-commercial",modVal:"yes"},{showTo:function(t){return this.params&&!this.params.showDirectOnMarket&&this._updateMarketButton(t),this.__base.apply(this,arguments)},_updateMarketButton:function(t){t&&t.commercial?this._showCommercial(t.commercial):this._hideCommercial()},_showCommercial:function(t){var e=t.text,i=t.url;e&&i&&(this.elem("button").html(e),this.elem("button").attr("href",i),this.setMod(this.elem("button"),"visibility","visible"),this.setMod("commercial","yes"),this._hitCounter("show"))},_hideCommercial:function(){this.delMod(this.elem("button"),"visibility"),this.delMod("commercial")},_onCommercialClick:function(){this._hitCounter("click")},_hitCounter:function(t){var e=BEM.blocks.utils.get(this._itemParams,"commercial.counters."+t);e&&c.hitDelayed(Object.assign({dtype:"iweb",path:e.path},e.params),this.domElem)}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("button","pointerclick",function(){this._onCommercialClick()})}}),BEM.DOM.decl({block:"polaroid2",modName:"with-direct",modVal:"yes"},{showTo:function(t){var e=this.__base.apply(this,arguments),i=t.serpItemParams;return i&&!i.isYabs&&this.updateCommercial(t),e},_getItemGridInfo:function(t){var e=t.position,i=this.params.docsPerPage,n={pos:e,page:Math.floor(e/i)};return Object.assign(n,t.gridPosition)},_hitDirectCounter:function(t){var e=this._itemParams;if(e){var i=this._getItemGridInfo(e);window.c.hit({dtype:"iweb",path:"/image/new/serp/polaroid/direct/"+t,reqid:e.reqid,vars:BEM.blocks.counter.convertVarsToString(i)})}},updateCommercial:function(t){var e=this,i=this.blockInside({block:"wAA1LXNe7s8QDE2xboaU",modName:"type",modVal:"spec"}),n=this.blockInside("direct-updater");n&&i&&n.update({market:t.commercial,pos:t.position,id:t.id}).then(function(){e.params&&(2===e.params.showDirectOnMarket&&e._hideCommercial&&e._hideCommercial(),i.show())}).fail(function(){e.params&&(i.hide(),2===e.params.showDirectOnMarket&&e._updateMarketButton&&e._updateMarketButton(t))})}},{live:function(){this.__base.apply(this,arguments);var t=["direct:title:click","direct:link:click","direct:sitelink:click","direct:favicon:click","direct:contacts:click","direct:phone:click","direct:text:click"].join(" ");this.liveInitOnBlockInsideEvent(t,"wAA1LXNe7s8QDE2xboaU",function(t){this._hitDirectCounter("click")}).liveInitOnBlockInsideEvent("direct:show","wAA1LXNe7s8QDE2xboaU",function(t){this._hitDirectCounter("shown")})}}),BEM.DOM.decl({block:"mm-favicon"},{update:function(t){var e,i=this,n=t?t.toLowerCase():"";if(this._currentFaviconDomain=n,n)return e=this._getFromCache(n),this.delMod("hidden"),void 0!==e?this._setFavicon(e):(this.elem("favicon").css({"background-image":"none"}),this._loadIcon(n).always(function(){i._currentFaviconDomain===n&&i._setFavicon(i._getFromCache(n))}));this.setMod("hidden")},_loadIcon:function(t){var e=this,i="https://favicon.yandex.net/favicon/"+t+"?size=16&json=1",n=this.__self._loaders;return n[t]||(n[t]=$.ajax({url:i}).then(function(i){e._saveToCache(t,i&&i[0]&&i[0].image)}).always(function(){delete n[t]})),n[t]},_getFromCache:function(t){return this.__self._favicons[t]},_saveToCache:function(t,e){this.__self._favicons[t]=e},_setFavicon:function(t){this._isDestructing||(t&&this.domElem?this.domElem.css({"background-image":"url(data:image/png;base64,"+t+")"}):this.setMod("hidden"))}},{live:!0,_favicons:{},_loaders:{}}),BEM.DOM.decl("direct-updater",{TITLE_REGEXP:/[^a-zа-я0-9\-\—.,!?\s]/gi,getDefaultParams:function(){return{showOnlyLoaded:!1,preloadCount:6,includeQuery:!1,useJsonp:!1}},onSetMod:{js:{inited:function(){this.params.showOnlyLoaded||this._getDirectLoader().on("loaded error",this._onDirectLoadComplete,this)}}},destruct:function(){this.params.showOnlyLoaded||this._getDirectLoader().un("loaded error",this._onDirectLoadComplete,this),this.__base.apply(this,arguments)},update:function(t){this._dfd&&this._dfd.reject();var e,i=this._getLoadedDirect(t.id);return this.params.autoHideEmpty&&!i&&this.hideDirect(),this._dfd=$.Deferred(),this._current=t,this._isDirectDisabled(t)?(this.hideDirect(),this._dfd.promise()):(e=void 0!==t.preloadCount?t.preloadCount:this.params.preloadCount,this._preloadDirect({pos:t.pos,count:e}),(this.params.showOnlyLoaded||i)&&this._updateDirect(i),this._dfd.promise())},showDirect:function(t,e){var i=this._getDirectSnippet();i&&i.update(t,e),this._dfd&&this._dfd.resolve(this._getDirectSnippet())},hideDirect:function(){var t=this._getDirectSnippet();t&&t.hide(),this._dfd&&this._dfd.reject()},_isDirectDisabled:function(t){return this._isPornoQuery()&&!this.params.adultPageId},_getOKRExperimentId:$.noop,_isPornoQuery:$.noop,_getLoadedDirect:function(t){return this._getDirectLoader().getLoaded(t)},_updateDirect:function(t){var e=t&&t.data;if(e&&e.length){var i=e[0];i?this.showDirect(i,t.id):this.hideDirect()}else this.hideDirect()},_preloadDirect:function(t){var e=this._getLoadingDirectParams(t);this._getDirectLoader().batchLoad(e)},_getLoadingDirectParams:function(t){var e=this._getNearestImages(t.pos,t.count);return e instanceof Array?(e=e.filter(this._noDirectData,this),this._prepareLoadingDirectParams(e)):[]},_getNearestImages:$.noop,_prepareLoadingDirectParams:function(t){var e=this.params.includeQuery?BEM.blocks["i-global"].param("query")+" ":"";return t.reduce(function(t,i){if(!this._getPageId(i))return t;var n=this._decodeEntities(e+this._getImageTitle(i)),s={id:i.id,text:this._getCleanTitle(n),pageId:this._getPageId(i)},o=this._getDefaultReqId();return o&&(s.reqid=o),t.push(s),t}.bind(this),[])},_getCleanTitle:function(t){return t?t.replace(this.TITLE_REGEXP,"").replace(/\s+/gi," ").replace(/\s+$/gi,""):""},_decodeEntities:function(t){return t.replace(/&(lt|gt|quot|apos|amp);/g,function(t,e){return{lt:"<",gt:">",quot:'"',apos:"'",amp:"&"}[e]})},_getImageTitle:$.noop,_getDefaultReqId:$.noop,_getPageId:function(t){return this.params.pageId},_noDirectData:function(t){return!this._getLoadedDirect(t.id)},_getDirectLoader:function(){if(!this._directLoader){var t=this._getOKRExperimentId();this._directLoader=BEM.create("direct-loader",{region:BEM.blocks["i-global"].param("lr"),url:this.params.url,experimentId:t,enableFlatHighlight:this.params.enableFlatHighlight,useJsonp:this.params.useJsonp})}return this._directLoader},_onDirectLoadComplete:function(t,e){this._current&&e.id===this._current.id&&this._updateDirect(e)},_getDirectSnippet:function(){return this._directSnippet||(this._directSnippet=this.findBlockOn("wAA1LXNe7s8QDE2xboaU")),this._directSnippet}},{live:!0}),BEM.DOM.decl("direct-updater",{getDefaultParams:function(){var t=this.__base.apply(this,arguments);return $.extend(t,{showOnMarket:!0,useMarketTitle:!1,useMarketPage:!1,commThreshold:0,useSnippetTitleForCommOnly:!1,commPageId:null}),t},getCommercialThreshold:function(){return this.params.commThreshold},_getOKRExperimentId:function(){return BEM.blocks["i-global"].getFlag("images_viewer_direct_experiment_id")},_isDirectDisabled:function(t){return this.__base.apply(this,arguments)||Boolean(!this.params.showOnMarket&&t.market)},_isPornoQuery:function(){return BEM.blocks["i-global"].param("isPornoQuery")},_getDefaultReqId:function(){return BEM.blocks["i-global"].param("reqid")},_notMarketImage:function(t){return!(t.marketSnippet||t.market)},_prepareLoadingDirectParams:function(t){var e=t;return this.params.showOnMarket||(e=t.filter(this._notMarketImage,this)),this.__base.call(this,e)},_getMarketTitle:$.noop,_getImageTitle:function(t){var e=t.snippet||{},i=[],n=this._getMarketTitle(t);return this.params.useTagsTitle&&t.tags&&t.tags[0]&&i.push(t.tags[0]),this.params.useMarketTitle&&n?i.push(n):!e.title||this.params.useSnippetTitleForCommOnly&&!this._isRequestCommercial()||i.push(e.title),i.join(" ")},_getPageId:function(t){var e=this.params,i=this._isPornoQuery(),n=this._shouldUseCommPageId(t),s=this.__base.apply(this,arguments),o=e.adultPageId,r=e.adultCommPageId||e.adultPageId;return i&&o?n?r:o:n?e.commPageId:s},_isRequestCommercial:function(){var t=BEM.blocks["i-global"].param("cm2"),e=this.params.commThreshold;return e&&t>e},_shouldUseCommPageId:function(t){var e=this.params,i=e.commPageId,n=this._isRequestCommercial(),s=e.useMarketPage&&(t.marketSnippet||t.market);return Boolean(i&&(n||s))}}),BEM.DOM.decl("direct-updater",{_getMarketTitle:function(t){return(t.marketSnippet||t.market||{}).title},_getNearestImages:function(t,e){return BEM.blocks["serp-item"].getNearestImages(t,e)}}),BEM.decl("batch-data-loader",{onSetMod:{js:{inited:function(){this.clear()}}},clear:function(){return this._states={},this},batchLoad:function(t){return t&&t.length?(this._getAbortRequests(t).forEach(this.abort.bind(this)),this._loadQueue=t,this._loadNext(),this):this},load:function(t){if(!t||!t.id)return this;var e=this._getState(t.id),i=e&&e.status;switch(i){case"loaded":case"error":this.trigger(i,e),this._onComplete();break;case"loading":break;default:this._load(t)}return this},abort:function(t){return t&&t.req?(t.req.abort(),this._setState(t.id,{status:"canceled"}),this):this},getLoaded:function(t){var e=this._getState(t),i=e&&e.status;return"loaded"===i||"error"===i?e:null},_load:function(t){var e=t.id,i=this._getRequest(t).success(this._onSuccess.bind(this,e)).error(this._onError.bind(this,e)).complete(this._onComplete.bind(this,e));return this._setState(e,{status:"loading",req:i}),this},_loadNext:function(){var t=this._loadQueue;t&&t.length&&this.load(t.shift())},_onSuccess:function(t,e){this._setState(t,{status:"loaded",data:this._convert(e)})},_onError:function(t,e){this._setState(t,{status:"error",error:e})},_onComplete:function(){this._loadNext()},_getAbortRequests:function(t){for(var e,i=Object.keys(this._states),n=t.map(function(t){return t.id}),s=[],o=0;o<i.length;o++)"loading"===(e=this._getState(i[o])).status&&-1===n.indexOf(e.id)&&s.push(e);return s},_getState:function(t){return this._states[t]},_setState:function(t,e){var i={status:e.status,id:t};e.data&&(i.data=e.data),e.error&&(i.error=e.error),e.req&&(i.req=e.req),this._states[t]=i,this.trigger(i.status,i)},_convert:function(t){return t},_getRequest:$.noop}),BEM.decl({block:"direct-loader",baseBlock:"batch-data-loader"},{getDefaultParams:function(){return{url:"https://bs.yandex.ru/page/",region:0,useJsonp:!1}},_getRequest:function(t){return this._getDirectParser().req(this._getUrl(t),{jsonp:this.params.useJsonp})},load:function(t){var e=this.__base.apply(this,arguments);return t.pageId?e:this},_onSuccess:function(t,e){var i=this._parseDirect(e);i.error?this._onError(t,i.error):this.__base.call(this,t,i)},_getUrl:function(t){var e=this._getUrlParams(t),i=this.params.url+this._getPageId(t);return this._getUrlWithParams(i,e)},_getUrlWithParams:$.noop,_getUrlParams:function(t){var e=this.params,i={"target-ref":encodeURI(this._getTargetRef()),"tune-region-id":e.region,charset:"utf-8"};t.text&&(i.text=t.text.replace(/ /g," ")),t.banners&&(i["additional-banners"]=t.banners),t.reqid&&(i.reqid=t.reqid),e.enableFlatHighlight&&(i["enable-flat-highlight"]=1),e.experimentId&&(i["experiment-id"]=e.experimentId);var n=this._getImpId(t);return n&&(i["imp-id"]=n),i},_getImpId:function(t){var e=t.pageId||this.params.pageId;return String(e).split("-")[1]},_getPageId:function(t){var e=t.pageId||this.params.pageId;return String(e).split("-")[0]},_getTargetRef:function(){var t=BEM.blocks.location.getInstance().getState().url,e=BEM.blocks.uri.parse(t);return e.protocol()+"://images.yandex."+BEM.blocks["i-global"].param("tld")+"/search"+e.query()},_parseDirect:function(t){return this._getDirectParser().parse(t)},_convert:function(t){if(!t||!t.common)return[];var e=t.premium||t.direct;return e&&e.ads&&e.ads.length?e.ads.map(function(e){var i=e.add_info||{},n=Array.isArray(i.callouts_list)?i.callouts_list:[];return{query:this._getQuery(),source:"direct",url:this._processUrl(e.url),title:e.title,text:e.body,images:e.images,domain:e.domain,punyDomain:e.punyDomain,warning:e.warning,age:e.age,sitelinks:this._processSitelinks(e.sitelinks),telNum:e.telNum,vcardUrl:this._processUrl(e.vcardUrl),path:e.path,path_url:this._processUrl(e.path_url),price:e.price&&e.price.current,link_head:t.common.linkHead,link_tail:e.linkTail,workingTime:e.workingTime,region:e.region,callouts:n.filter(Boolean)}},this):[]},_getQuery:$.noop,_processUrl:function(t){return t},_processSitelinks:function(t){return t},_getDirectParser:function(){return this._directParser||(this._directParser=BEM.create("direct-parser")),this._directParser}},{_instances:{},getInstance:function(t,e){return e=e||{},this._instances[t]||(e.region=BEM.blocks["i-global"].param("lr"),this._instances[t]=BEM.create("direct-loader",e)),this._instances[t]}}),BEM.decl("direct-loader",{_load:function(t){var e=BEM.blocks["i-global"].param("isIntegrationTest"),i="function"==typeof this._loadStub;return e&&i?this._loadStub(t):this.__base.apply(this,arguments)},_getUrlWithParams:function(t,e){return BEM.blocks.uri.setParams(t,e)},_getUrlParams:function(){var t=this.__base.apply(this,arguments),e=BEM.blocks.uri.getParamValue("uuid"),i=BEM.blocks["i-global"].param("yandexuid");return e?t.uuid=e:i&&(t.yuid=i),t}}),BEM.DOM.decl("direct-loader",{_getUrl:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["direct-utils"].addTestTag(t)},_processUrl:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["direct-utils"].addTestTag(t)},_getQuery:function(){return BEM.blocks["i-global"].param("query")},_processSitelinks:function(){var t=this.__base.apply(this,arguments);return Array.isArray(t)?t.map(function(t){return t.url=this._processUrl(t.url),t},this):t}}),BEM.decl("direct-parser",{load:function(){var t=$.Deferred(),e=this.__base.apply(this,arguments);return e||(this.req(this.params.url).success(function(e){var i=this.parse(e);i.error?t.reject(i.error):t.resolve(i)}.bind(this)).error(t.reject),t)},req:function(t,e){var i={url:t,xhrFields:{withCredentials:!0}};return e&&e.jsonp&&(i.dataType="jsonp"),$.ajax(i)},parse:function(t){var e,i;"string"==typeof t&&(e=t.match(/^(\/\*\*\/)?\('(.*)\'\)$/)),i=e&&e[2]?e[2]:t;try{if(!i||"{ }"===i)throw new Error("Empty response");return new Function("return"+i)()}catch(t){return{error:t}}}}),BEM.decl("direct-utils",{},{TEST_TAG:"562949953421312",getConfig:function(){return{"detect": {"iframes": [], "links": [{"src": "https://an.yandex.ru/system/context.js", "type": "get"}], "trusted": [], "custom": ["<div class=\"adbanner\" id=\"AdFox_banner\"></div>", "<div class=\"advblock\" id=\"yandex_ad\"></div>", "<div class=\"b-adv\" id=\"yandex_rtb\"></div>", "<div class=\"b-banner\"></div>", "<div class=\"bannerad\"></div>", "<div class=\"pagead\"></div>", "<div class=\"pub_300x250m\"></div>", "<div class=\"pub_728x90\"></div>", "<div class=\"reklama\"></div>", "<div class=\"sideads\"></div>", "<div class=\"smart-info-wrapper\"></div>", "<div class=\"sponsoredlinks\"></div>", "<div class=\"text-ad\"></div>", "<div class=\"serp-list\"><img width=\"240\" height=\"400\"/></div>", "<div class=\"adv\" />"]}, "log": {"percent": 0}, "removeAttributeId": false, "deprecatedCookies": ["JPIqApiY", "zmFQeXtI", "ScSvCIlBC", "kNAcVGYFWhx", "jsOmqPGh", "OqYspIFcUpLY", "XcfPaDInQpzKj", "hcxWnzbUzfz", "MGphYZof", "NBgfDVFir", "qgZTpupNMGJBM", "mcBaGDt", "BgeeyNoBJuyII", "orrXTfJaS", "FgkKdCjPqoMFm", "EIXtkCTlX", "KIykI", "HgGedof", "ancQTZw", "instruction", "engineering", "discussion", "computer", "engineer", "adequate", "Silver", "Mercury", "Bismuth", "Silicon", "Tennessine", "Zinc", "Sulfur", "Nickel", "Radon", "Manganese", "LBCBNrZSu", "VTouhmwR", "TbwgcPzRMgzVo", "liPkbtFdIkYqc", "HOhdORSx", "EMCzniGaQ", "PIwsfZeu", "FxuGQqNNo", "sMLIIeQQeFnYt", "pClnKCSBXcHUp"], "hideLinks": false, "pid": "yandex_images", "cookieName": "tCTmkfFoXn", "treeProtection": {"enabled": false}, "cookieDomain": {"type": 0, "list": []}, "cookieTTL": 336, "disableShadow": false, "invertedCookieEnabled": true, "encode": {"trailingSlash": false, "seed": "3a2294", "key": "ZGQ5ObTPnrdtehwrxNHLfeJcodVBT2BZAe-Zuhkz9FAmKWbI0S6CB2OnrzbN6jCMOOw75BVJEV0Zu43_TkYqjw==", "urlPrefix": "https://yandex.ru/images/_crpd/"}, "additionalParams": {}, "extuidCookies": ["addruid", "yandexuid"], "cookieMatching": {"publisherKey": "eyJhbGciOi", "publisherTag": "yandex-images", "imageUrl": "https://statchecker.yandex.ru/mapuid/", "cryptedUidTTL": 336, "redirectUrl": "//an.yandex.ru/mapuid/", "cryptedUidCookie": "crookie", "types": [], "cryptedUidUrl": "https://http-check-headers.yandex.ru"}, "hideMetaArgsUrlMaxSize": 70, "rtbRequestViaScript": true,"fn":{"encodeCSS":function(className){var base64alphabet='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=';function decodeUInt8String(input){var output=[];var i=0;while(i<input.length){var enc1=base64alphabet.indexOf(input.charAt(i++));var enc2=base64alphabet.indexOf(input.charAt(i++));var enc3=base64alphabet.indexOf(input.charAt(i++));var enc4=base64alphabet.indexOf(input.charAt(i++));var chr1=(enc1<<2)|(enc2 >> 4);var chr2=((enc2&15)<<4)|(enc3 >> 2);var chr3=((enc3&3)<<6)|enc4;output.push(String.fromCharCode(chr1));if(enc3!==64){output.push(String.fromCharCode(chr2));}if(enc4!==64){output.push(String.fromCharCode(chr3));}}return output.join('');}function encodeUInt8String(input){var output='';var i=0;while(i<input.length){var chr1=input.charCodeAt(i++);var chr2=input.charCodeAt(i++);var chr3=input.charCodeAt(i++);var enc1=chr1 >> 2;var enc2=((chr1&3)<<4)|(chr2 >> 4);var enc3=((chr2&15)<<2)|(chr3 >> 6);var enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;} else if(isNaN(chr3)){enc4=64;}output=output+base64alphabet.charAt(enc1)+base64alphabet.charAt(enc2)+base64alphabet.charAt(enc3)+base64alphabet.charAt(enc4);}return output;}function getKey(){return decodeUInt8String("ZGQ5ObTPnrdtehwrxNHLfeJcodVBT2BZAe-Zuhkz9FAmKWbI0S6CB2OnrzbN6jCMOOw75BVJEV0Zu43_TkYqjw==");}function xor(data,key){var result=[];for(var i=0; i<data.length; i++){var xored=data.charCodeAt(i)^key.charCodeAt(i%key.length);result.push(String.fromCharCode(xored));}return result.join('');}function cropEquals(base64){return base64.replace(/=+$/,'');}function encode(url){var xoredUrl=xor(url,getKey());return cropEquals(encodeUInt8String(xoredUrl));}var encoded=encode(className);var CHAR_CODE_A='a'.charCodeAt(0);var firstChar=String.fromCharCode(getKey().charCodeAt(0)%26+CHAR_CODE_A);return(firstChar+encoded).replace(/-/g,'a');},"encodeUrl":function(url){var seed="3a2294";var base64alphabet='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=';function decodeUInt8String(input){var output=[];var i=0;while(i<input.length){var enc1=base64alphabet.indexOf(input.charAt(i++));var enc2=base64alphabet.indexOf(input.charAt(i++));var enc3=base64alphabet.indexOf(input.charAt(i++));var enc4=base64alphabet.indexOf(input.charAt(i++));var chr1=(enc1<<2)|(enc2 >> 4);var chr2=((enc2&15)<<4)|(enc3 >> 2);var chr3=((enc3&3)<<6)|enc4;output.push(String.fromCharCode(chr1));if(enc3!==64){output.push(String.fromCharCode(chr2));}if(enc4!==64){output.push(String.fromCharCode(chr3));}}return output.join('');}function encodeUInt8String(input){var output='';var i=0;while(i<input.length){var chr1=input.charCodeAt(i++);var chr2=input.charCodeAt(i++);var chr3=input.charCodeAt(i++);var enc1=chr1 >> 2;var enc2=((chr1&3)<<4)|(chr2 >> 4);var enc3=((chr2&15)<<2)|(chr3 >> 6);var enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;} else if(isNaN(chr3)){enc4=64;}output=output+base64alphabet.charAt(enc1)+base64alphabet.charAt(enc2)+base64alphabet.charAt(enc3)+base64alphabet.charAt(enc4);}return output;}function repeat(str,count){var result=[];for(var i=0; i<count; i++){result.push(str);}return result.join('');}function getKey(){return decodeUInt8String("ZGQ5ObTPnrdtehwrxNHLfeJcodVBT2BZAe-Zuhkz9FAmKWbI0S6CB2OnrzbN6jCMOOw75BVJEV0Zu43_TkYqjw==");}function xor(data,key){var result=[];for(var i=0; i<data.length; i++){var xored=data.charCodeAt(i)^key.charCodeAt(i%key.length);result.push(String.fromCharCode(xored));}return result.join("");}function cropEquals(base64){return base64.replace(/=+$/,"");}function encode(url){var xoredUrl=xor(url,getKey());return cropEquals(encodeUInt8String(xoredUrl));}var sdr=336132323934;function getRandomInt(min,max){sdr=(sdr*73)%9949;var rand=min+(sdr/9950)*(max+1-min);rand=Math.floor(rand);return rand;}function getRandomChar(from,to){from=from||"a";to=to||"z";var charCode=getRandomInt(from.charCodeAt(0),to.charCodeAt(0));return String.fromCharCode(charCode);}function mixWithSlashes(encodedUrl){var CHUNK_LENGTH=7;var urlParts=encodedUrl.match(/.{1,7}/g);if(urlParts===null){return encodedUrl;}var urlTemplate=[["/", 1]];var symbolsToInsert='';var symbolsToInsertSet='';for(var i=0; i<urlTemplate.length; i++){symbolsToInsert+=repeat(urlTemplate[i][0],urlTemplate[i][1]);symbolsToInsertSet+=urlTemplate[i][0];}for(var i=0; i<urlParts.length-1&&i<symbolsToInsert.length; i++){var positionToInsert=getRandomInt(1,CHUNK_LENGTH-1);var part=urlParts[i].split("");part.splice(positionToInsert,0,symbolsToInsert[i]);urlParts[i]=part.join("");}var url=urlParts.join("");if(symbolsToInsertSet.indexOf('&')!==-1){return url.replace(/&(lt|gt)/ig,'$1');}else{return url}}function cryptNumber(num,minEncryptedLength){var k=seed.charCodeAt(0);var b=seed.charCodeAt(5);var result=(num*k+b).toString().split("");while(result.length<minEncryptedLength){var positionToInsert=getRandomInt(0,result.length);var charToInsert=getRandomChar();result.splice(positionToInsert,0,charToInsert);}result.push("/");return result.join("");}function expandUrl(url,minLengthDecoded){if(minLengthDecoded > url.length){var symbolsToGenerate=Math.max(minLengthDecoded-url.length-1,0); var randomSymbols="";for(var i=0; i<symbolsToGenerate; i++){randomSymbols+=getRandomChar();}return url+" "+randomSymbols;}return url;}function isEncodedUrl(url){if(url.indexOf("3a2294")===-1){return false;}if(/^(?:https?:)?\/\/[^/]+?(?:\/images\/\_crpd\/|\/|\/images\/)\w{9}\/3a2294./.test(url)){return true;}return false;}if(isEncodedUrl(url)){return url;}var expandedUrl=url;var url_is_subdocument=false;if(/^(?:https?:)?\/\/yastat(?:ic)?\.net\/safeframe-bundles\/[\d.\-\/]*\/(?:protected\/)?render_adb\.html$/.test(url)){expandedUrl=expandUrl(url,40); url_is_subdocument=true;} else if(!/^(?:https?:)?\/\/cryprox\.yandex\.net\/bamboozled/.test(url)){expandedUrl=expandUrl(url,40); }var encoded=encode(expandedUrl);var encodedLink=mixWithSlashes(encoded);var linkLength=encoded.length;var url_prefix="https://yandex.ru/images/_crpd/";if(/static-mon\.yandex\.net\/.*?|favicon\.yandex\.net\/favicon.*?|(?:storage|avatars)\.mds\.yandex\.net\/.*?|(?:st\.)?yandexadexchange\.net\/.*?|avatars\-fast\.yandex\.net\/.*?|direct\.yandex\.ru\/\?partner|yastatic\.net\/islands\/.*?|(?:betastatic\.)?yastat(?:ic)?\.net\/.*(?:\.|%2[Ee])(?:(?:s|%73)(?:w|%77)(?:f|%66)|(?:h|%68)(?:t|%74)(?:m|%6[Dd])(?:l|%6[Cc])?)(?:(?:\?|%3[Ff]).*)?|awaps(?:\-v6)?\.yandex\.(?:ru|net)\/(?:[^1].|.[^5]).*?/.test(url)){url_prefix="https://yandex.ru/images/_crpd/"; }if(url.indexOf('//')===0){url_prefix=url_prefix.replace(/^https?:/,'');}var prefix=url_prefix+cryptNumber(linkLength,9)+seed;var lastSlash=false?"/":"";var result=prefix+encodedLink+lastSlash;if(false&&url_is_subdocument){return result.replace(/^https?:/,'').replace(/(^\/\/)/,'').replace(/(.*?\/)/,'/');} else{return result;}},"decodeUrl":function(url){var base64alphabet='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=';function decodeUInt8String(input){var output=[];var i=0;input=input.replace(/[^A-Za-z0-9\-_=]/g,'');while(i<input.length){var enc1=base64alphabet.indexOf(input.charAt(i++));var enc2=base64alphabet.indexOf(input.charAt(i++));var enc3=base64alphabet.indexOf(input.charAt(i++));var enc4=base64alphabet.indexOf(input.charAt(i++));var chr1=(enc1<<2)|(enc2 >> 4);var chr2=((enc2&15)<<4)|(enc3 >> 2);var chr3=((enc3&3)<<6)|enc4;output.push(String.fromCharCode(chr1));if(enc3!==64){output.push(String.fromCharCode(chr2));}if(enc4!==64){output.push(String.fromCharCode(chr3));}}return output.join('');}function addEquals(base64){while(base64.length%4!==0){base64+='=';}return base64;}function getKey(){return decodeUInt8String("ZGQ5ObTPnrdtehwrxNHLfeJcodVBT2BZAe-Zuhkz9FAmKWbI0S6CB2OnrzbN6jCMOOw75BVJEV0Zu43_TkYqjw==");}function xor(data,key){var result=[];for(var i=0; i<data.length; i++){var xored=data.charCodeAt(i)^key.charCodeAt(i%key.length);result.push(String.fromCharCode(xored));}return result.join('');}function decode(encodedUrl){var fullUrl=addEquals(encodedUrl);return xor(decodeUInt8String(fullUrl),getKey());}var lastSymbolInUrl=url.slice(-1);var encodedUrl=url;if(false&&lastSymbolInUrl==="/"){encodedUrl=encodedUrl.slice(0,-1);}encodedUrl=encodedUrl.split("3a2294")[1];encodedUrl=addEquals(encodedUrl.replace(/[\/?.=&!$()|*~\[\]^<>\\]/g,""));return decode(encodedUrl).replace(/\{3a2294=[a-zA-Z]*\}$|\s[a-zA-Z]*$/,"");},"isEncodedUrl":function(url){if(url.indexOf("3a2294")===-1){return false;}if(/^(?:https?:)?\/\/[^/]+?(?:\/images\/\_crpd\/|\/|\/images\/)\w{9}\/3a2294./.test(url)){return true;}return false;}}}},getBase64Utils:function(){return window.Ya.Images.base64Utils},isConfigAvailable:function(){if(void 0===this._configAvailable){var t=this.getConfig(),e=this.getBase64Utils();if(t&&"object"==typeof t&&e&&"object"==typeof e){var i=t.fn&&t.fn.encodeUrl;this._configAvailable="function"==typeof i}else this._configAvailable=!1}return this._configAvailable},encryptUrl:function(t){if(!t||!this.isConfigAvailable())return t;var e=this.getConfig(),i=this.getBase64Utils();return e.fn.encodeUrl(t,i)},addTestTag:function(t){return t&&this.isConfigAvailable()?t+(-1===t.indexOf("?")?"?":"&")+"test-tag="+this.TEST_TAG+"&adb-bits=1":t}}),BEM.DOM.decl("wAA1LXNe7s8QDE2xboaU",{update:function(t){return this.setCurrent(t)._updateTitle(t)._updateGreenurl(t)._updateText(t)._updateDisclaimers(t)._hitShowCounter(t),this},setCurrent:function(t){return this._snippet=t,this},getCurrent:function(){return this._snippet},show:function(){return this.setMod("visible","yes"),this._sendShowEvent(),this},_sendShowEvent:function(){this.trigger("direct:show")},hide:function(){return this._sendHideEvent(),this.delMod("visible")},_sendHideEvent:function(){this.trigger("direct:hide")},_processUrl:function(t){return t},_getSnippetCountUrl:function(t){var e=t.link_head,i=t.link_tail;return e&&i?e+i:""},_updateTitle:function(t){return this.elem("title").html(this._getSnippetTitle(t)).attr("href",t.url),this},_updateGreenurl:function(t){return this.elem("greenurl-text").text(t.domain),this.elem("greenurl").attr("href",t.url),this},_updateText:function(t){return this.elem("text").html(this._getSnippetText(t)),this},_getSnippetText:function(t){return t&&t.text},_getSnippetTitle:function(t){return t&&t.title},_updateDisclaimers:function(t){return["warning","age"].map(function(e){var i,n,s=t[e];s&&(i=this._getShortWarning(s),n=Boolean(i),this.elem("text").append([" ",BEMHTML.apply({block:"wAA1LXNe7s8QDE2xboaU",elem:"disclaimer",content:i||s,elemMods:{collapsed:n,short:!n},attrs:{"data-full-warning":n?s:""}})]))},this),this},_onDisclaimerClick:function(t){var e,i;this.hasMod(t,"short")||(e=t.data("full-warning"),this.hasMod(t,"collapsed")?(t.html(e),this.delMod(t,"collapsed")):(i=this._getShortWarning(e),t.html(i),this.setMod(t,"collapsed",!0)))},_onTextClick:function(t){var e,i=this.findElem("disclaimer");i.is(t.target)&&(e=i.filter(function(e,i){return $(i).is(t.target)})).length&&(t.preventDefault(),this._onDisclaimerClick(e))},_getShortWarning:function(t){return t.length>this.__self.WARNING_MIN_LENGTH?t.substr(0,this.__self.WARNING_MIN_LENGTH)+"...":""},_hitShowCounter:function(t){var e=this._getSnippetCountUrl(t),i=this._processUrl(e),n=i!==e;return e&&!this._isShown(e)&&this._makeShowCounterRequest(i,n).done(function(){this._setShown(e)}.bind(this)),this},_makeShowCounterRequest:function(t){return $.ajax({url:t,dataType:"script",cache:!0,async:!0})},_setShown:function(t){this.__self._shownAds[t]=!0},_isShown:function(t){return Boolean(this.__self._shownAds[t])},_triggerEvent:function(t,e){this.trigger(t,{domElem:e.target,snippet:this.getCurrent()})}},{_shownAds:{},WARNING_MIN_LENGTH:46,live:function(){this.liveBindTo("title","pointerclick",function(t){this._triggerEvent("direct:title:click",t)}).liveBindTo("greenurl-text","pointerclick",function(t){this._triggerEvent("direct:link:click",t)}).liveBindTo("text","pointerclick",function(t){this._onTextClick(t)})}}),BEM.DOM.decl("wAA1LXNe7s8QDE2xboaU",{_processUrl:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["direct-utils"].encryptUrl(t)},_makeShowCounterRequest:function(t,e){if(!e)return this.__base.apply(this,arguments);t=BEM.blocks["direct-utils"].addTestTag(t);var i=$.Deferred(),n=document.createElement("script");return n.onload=function(){i.resolve()},n.onerror=function(){i.reject()},n.src=t,document.body.appendChild(n),i}}),BEM.DOM.decl({block:"wAA1LXNe7s8QDE2xboaU",modName:"theme",modVal:"polaroid"},{onSetMod:{visible:{yes:function(){this.__base.apply(this,arguments);var t=this;t.delMod("expanded"),setTimeout(function(){t.setMod("expanded")},0)}}}}),BEM.DOM.decl("wAA1LXNe7s8QDE2xboaU",{update:function(t){var e=this.__base.apply(this,arguments);return this._updateContacts(t),e},_hasContacts:function(t){return Boolean(t.telNum&&t.vcardUrl)},_updateContacts:function(t){return this.elem("contact-info")[0]?this._hasContacts(t)?(this.findBlockOn(this.elem("contact-url"),"link").setMod("disabled",t.vcardUrl?"":"yes"),this.elem("contact-url").attr("href",t.vcardUrl||""),this.elem("contact-tel").text(t.telNum||""),this.elem("contact-worktime").text(t.workingTime||""),this.elem("contact-region").text(t.region||""),this.delMod(this.elem("contact-info"),"hidden"),this):(this.setMod(this.elem("contact-info"),"hidden"),this):this}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("contact-url","pointerclick",function(t){this._triggerEvent("direct:contacts:click",t)}).liveBindTo("contact-phone","pointerclick",function(t){this._triggerEvent("direct:phone:click",t)})}}),BEM.DOM.decl("wAA1LXNe7s8QDE2xboaU",{_updateGreenurl:function(t){var e=(t.path||"").trim();return this.hasMod("favicon")&&this._updateFavicon(t.punyDomain||t.domain),this.hasMod("crumbs")&&e?(this.elem("greenurl-text").text(t.path),this.elem("greenurl-text").attr("title",t.path),this.elem("greenurl").attr("href",t.path_url),this):this.__base.apply(this,arguments)}}),BEM.DOM.decl("wAA1LXNe7s8QDE2xboaU",{update:function(t){var e=this.__base.apply(this,arguments);return this._updateSitelinks(t),e},_updateSitelinks:function(t){if(this.__base.apply(this,arguments),!this.elem("sitelinks")[0])return this;var e=t.sitelinks,i=[];return e&&e.length>1&&(i=this._genSitelinksJSON(e),this.hasMod(this.elem("sitelinks"),"multicolumn")&&i.length>1&&(i=this._genSitelinksColumnsJSON(i))),BEM.DOM.update(this.elem("sitelinks"),BEMHTML.apply(i)),this},_genSitelinksColumnsJSON:function(t){var e=this.__self.getName(),i=t.slice();i.forEach(function(t){t.mix.push({block:e,elem:"sitelinks-column-item"})});var n=Math.ceil(i.length/2);return[{block:e,elem:"sitelinks-column",content:i.splice(0,n)},{block:e,elem:"sitelinks-column",content:i}]},_getSitelinksMixes:function(){return[{block:"wAA1LXNe7s8QDE2xboaU",elem:"sitelink"}]},_genSitelinksJSON:function(t){var e=this._getSitelinksMixes();return t.filter(function(t){return t.title&&t.url}).map(function(t){return{block:"link",mods:{theme:"normal"},mix:e,target:"_blank",url:t.url,content:t.title}})}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("sitelink","pointerclick",function(t){this._triggerEvent("direct:sitelink:click",t)})}}),BEM.DOM.decl("wAA1LXNe7s8QDE2xboaU",{_updateFavicon:function(t){var e=this;return this._canUpdateFavicon().then(function(){var i=e.findBlockInside("mm-favicon");i&&i.update(t)}),this},_canUpdateFavicon:function(){return $.Deferred().resolve()}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("favicon","pointerclick",function(t){this._triggerEvent("direct:favicon:click",t)})}}),BEM.DOM.decl({block:"wAA1LXNe7s8QDE2xboaU",modName:"highlight-query",modVal:!0},{_getSnippetText:function(t){return t.query?BEM.blocks.utils.highlightQuery(t.query,t.text):t.text},_getSnippetTitle:function(t){return t.query?BEM.blocks.utils.highlightQuery(t.query,t.title):t.title}}),BEM.blocks.utils.highlightQuery=function(t,e){if(!e||!t)return e;var i=(t=t.toLowerCase()).split(" ");return e.split(" ").map(function(t){return i.indexOf(t.toLowerCase())>-1?BEMHTML.apply({tag:"b",content:t}):t}).join(" ")},function(t){var e=t.innerWidth>t.innerHeight,i=t.innerWidth,n=$.throttle(function(){var n=t.innerWidth,s=t.innerHeight,o=n>s;o!==e&&n!==i&&($(t).trigger("orientchange",{landscape:o,width:n,height:s}),e=o,i=n)},400);BEM.DOM.win.bind("resize",n),BEM.DOM.decl("i-ua",{onSetMod:{js:{inited:function(){this.bindToWin("orientchange",this._onOrientChange,this).__base.apply(this,arguments)}}},_onOrientChange:function(t,e){var i=this.__self,n=document.documentElement,s=n.className,o="i-ua_orient_"+(e.landscape?"landscape":"portrait");-1===s.indexOf(o)&&(n.className=s.replace(/\bi-ua_orient_\w+\b/,o)),i.width=e.width,i.height=e.height,i.landscape=e.landscape}},{width:t.innerWidth,height:t.innerHeight,landscape:e})}(window),BEM.DOM.decl("serp-header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.__self.instance=this}}}},{get:function(){return this.instance||(this.instance=$(this.buildSelector()).bem(this.getName()))},replacePlaceholder:function(t,e){var i=e.domElem,n=this.get().elem(t+"-container");n&&(n.replaceWith(i.detach()),e.delMod("hidden"))}}),BEM.DOM.decl("serp-header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.__self.searchBlock=this.findBlockInside("search2")}}}},{getSearch:function(){return this.searchBlock||$(".search2").length&&$(".search2").bem("search2")}}),BEM.DOM.decl("serp-header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.DOM.blocks["cbir-panel"].on({modName:"visibility",modVal:"visible"},this.onCbirVisible,this).on({modName:"visibility",modVal:"hidden"},this.onCbirHidden,this)}}},onCbirVisible:function(){this.setMod("cbir-panel","visible")},onCbirHidden:function(){this.delMod("cbir-panel")}}),BEM.decl("favorites-counter",{},{count:function(t,e,i,n){n=n||{};var s=["reqid","yuid","serpid","service","ui"].reduce(function(t,e){return t+(n[e]?"/"+e+"="+n[e]:"")},""),o="//yandex"+(document.location.host.match(/^.*(\..+)$/)[1]||".ru")+"/clck/click/pid=902/cid="+i+"/dtype=stred"+(t?"/path="+t:"")+(e?"/vars="+e:"")+s+"/cts="+(new Date).getTime()+"/*"+document.location.href;document.createElement("IMG").src=o}}),BEM.create("favorites-counter"),BEM.DOM.decl("header-favorites-button",{onSetMod:{js:{inited:function(){var t=this,e=this.params;this.count=function(i,n){(BEM.blocks["favorites-counter"].count||function(){}).call(t,i,e.logged?"-authorized=1":"-authorized=0",n,e.counterParams)},this.link=this.findBlockInside("link"),this.events()}}},events:function(){var t=this.count;this.link&&this.link.on("click",function(){t("1352.183.882","73393")})}}),BEM.DOM.decl("header-favorites-button",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.delMod("hidden"),this._onChangeMode=this._onChangeMode.bind(this),BEM.channel("kids").on("change-mode",this._onChangeMode)}}},_onChangeMode:function(t,e){this.setMod(this.elem("link"),"kids-enabled",e)}}),BEM.DOM.decl("header-favorites-button",{onSetMod:{js:{inited:function(){BEM.blocks["serp-header"].replacePlaceholder("header-favorites-button",this),this.__base.apply(this,arguments)}}}}),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindToWin("resize",$.throttle(this._onResize,150)),this._collapseUserIfNeeded()}}},_onResize:function(){this._collapseUserIfNeeded()},_onUserUpdatesName:function(){this._collapseBreakpoint=null,this._collapseUserIfNeeded()},_collapseUserIfNeeded:function(){var t=this._getUser();t&&t.toggleCollapsed(this._getCollapseBreakpoint()>=this.elem("nav").width())},_getCollapseBreakpoint:function(){return this._collapseBreakpoint||(this._collapseBreakpoint=this._getNavItemsWidth()+this.__self.NAV_ITEMS_GAP),this._collapseBreakpoint},_getNavItemsWidth:function(){var t=0;return this.elem("nav").children().each(function(){t+=$(this).outerWidth(!0)}),t},_getUser:function(){return this._user?this._user._isDestructing&&(this._collapseBreakpoint=null,this._user=this.findBlockInside("user")):(this._user=this.findBlockInside("user"),this._user&&this._user.on("update-name",this._onUserUpdatesName,this)),this._user}},{NAV_ITEMS_GAP:10,live:!1}),BEM.DOM.decl("header",{},{live:function(){return this.liveBindTo("action","click",function(t){t.preventDefault()}),this.__base.apply(this,arguments)}}),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__self.instance=this}}}},{get:function(){return this.instance||(this.instance=$(this.buildSelector()).bem(this.getName()))},replacePlaceholder:function(t,e){var i=e.domElem,n=this.get().elem(t+"-container");n&&(n.replaceWith(i.detach()),e.delMod("hidden"))}}),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.__self.searchBlock=this.findBlockInside("search2"),this._syncState().bindEvents()}}},_syncState:function(){var t=this.getFiltersCount();return t>0&&this._isFiltersCountHidden()&&(this.params.filtersAutoopen=t),this},_getAdvanced:function(){return this._advancedSearch||(this._advancedSearch=this.findBlockInside("advanced-search"))},getHeight:function(){return this.domElem.height()},_getNavItemsWidth:function(){var t,e=0;return this.elem("nav").children().each(function(){(t=$(this)).is(":visible")&&(e+=t.outerWidth(!0))}),e}},{getSearch:function(){return this.searchBlock||$(".search2").length&&$(".search2").bem("search2")}}),BEM.DOM.decl({block:"header",modName:"type",modVal:"advanced"},{getHeight:function(){if(this._height)return this._height;var t=this._getAdvanced();return this._height=this.domElem.height(),t&&(this._height+=t.domElem.height()-1),this._height}}),BEM.DOM.decl("header",{bindEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["advanced-search"].on("countUpdate",this._onCountUpdate,this),this},_onCountUpdate:function(t,e){this.setFiltersCount(e.count)},_isFiltersCountHidden:function(){return this.hasMod(this.getFiltersCountElem(),"hidden","yes")},setFiltersCount:function(t){return this.getFiltersCountElem().text(t),this.setMod(this.getFiltersCountElem(),"hidden",t?"":"yes")},getFiltersCount:function(){return Number(this.getFiltersCountElem().text())},getFiltersCountElem:function(){return this._filtersCount||(this._filtersCount=this.elem("filters-count"))}}),BEM.DOM.decl("header",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._openedSlide=null}}},onElemSetMod:{action:{pressed:{"":function(t){this.elemParams(t).releaseByDocumentScroll&&this.unbindFromWin("scroll"),this._openedSlide&&(this._openedSlide.unbindFromDoc("pointerclick"),this._openedSlide=null),this.unbindFromWin("closeUnder"),t.attr({"aria-pressed":!1,"aria-expanded":!1}),t.trigger("released")},yes:function(t,e){var i=this;i.delMod(this.elem("action"),e).bindToWin("closeUnder",function(){i.delMod(t,e)}),i.elemParams(t).releaseByHeaderOutsideClick&&i.afterCurrentEvent(function(){if(i.domElem){var e=i._openedSlide=i._getOpenedSlide(t);e&&i._slideOnClick(e,t)}}),i.elemParams(t).releaseByDocumentScroll&&this.bindToWin("scroll",function(){i._onScroll(t)}),t.attr({"aria-pressed":!0,"aria-expanded":!0}),t.trigger("pressed")}}}},_getOpenedSlide:function(t){var e,i=this.buildSelector("action","type",this.getMod(t,"type"));return this.findBlocksInside("slide").some(function(t){return!(!t.params.rel||t.params.rel[0].elem!==i)&&(e=t,!0)}),e},_onScroll:function(t){this.delMod(t,"pressed")},_slideOnClick:function(t,e){var i=this;t.bindToDoc("pointerclick",function(n){var s=$(n.target);t.containsDomElem(s)||s.is(i.elem("main"))||s.is(i.elem("action-i"))||i.delMod(e,"pressed")})},_onActionClick:function(t){t.preventDefault(),BEM.blocks["i-ua"].opera<13&&t.stopPropagation(),this.toggleMod(t.data.domElem,"pressed","yes","")},_onActionKeyup:function(t){var e=BEM.blocks["i-ua"].opera<13,i=BEM.blocks.keycodes;(!e&&t.keyCode===i.ENTER||t.keyCode===i.SPACE)&&(t.preventDefault(),this.toggleMod(t.data.domElem,"pressed","yes",""))},destruct:function(){this._openedSlide&&(this._openedSlide.unbindFromDoc("pointerclick"),this._openedSlide=null),this.__base.apply(this,arguments)}},{live:function(){return this.liveBindTo("action","pointerclick",function(t){this._onActionClick(t)}).liveBindTo("action","keyup",function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||this._onActionKeyup(t)}),this.__base()}}),BEM.DOM.decl("advanced-search",{onSetMod:{js:{inited:function(){this._vals=[],this.findBlocks().bindEvents()}}},findBlocks:function(){return this.page=this.findBlockOutside("b-page"),this.dropdowns=this.findBlocksInside({block:"dropdown",modName:"advanced",modVal:"yes"}),this.checkboxes=this.findBlocksInside({block:"check-button",modName:"advanced",modVal:"yes"}),this.filters=this.dropdowns.concat(this.checkboxes),this._resetButton=this.elem("action","type","reset"),this},_onTouchMove:function(){this.dropdowns.forEach(function(t){t.hide()})},_addFiltersChangeListeners:function(){this.filters.forEach(function(t){t.on("change",this.submit,this)},this)},_removeFiltersChangeListeners:function(){this.filters.forEach(function(t){t.un("change",this.submit,this)},this)},bindEvents:function(){return BEM.blocks["b-page"].on("filters:update",this.updateFilters,this),BEM.blocks["b-page"].on("touchmove",this._onTouchMove,this),BEM.blocks.search2.on("search:query:changed",this._resetMisspell,this),this.bindTo(this.domElem,"submit",this._onSubmit),this.filters.forEach(this._initSearchControl.bind(this)),this.afterCurrentEvent(function(){this._addFiltersChangeListeners(),this._updateResetButton()}),this.dropdowns.forEach(function(t){t.on("change",this._onDropdownItemChange,this)},this),this.bindTo(this._resetButton,"click",this._onResetClick),this.page.on("change",this._onPageChange,this),this},unbindEvents:function(){return BEM.blocks["b-page"].un("filters:update",this.updateFilters,this),BEM.blocks["b-page"].un("touchmove",this._onTouchMove,this),BEM.blocks.search2.un("search:query:changed",this._resetMisspell,this),this.afterCurrentEvent(function(){this._removeFiltersChangeListeners(),this._updateResetButton()}),this.dropdowns.forEach(function(t){t.un("change",this._onDropdownItemChange,this)},this),this.page.un("change",this._onPageChange,this),this},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},_onSubmit:function(){return this.submit(),!1},_onResetClick:function(){this.reset()},_initSearchControl:function(t,e){this._vals.push(t.val()),t.on("change silentChange",function(t){this._vals[e]=t.block.val(),this._updateResetButton()},this)},_onDropdownItemChange:function(t){var e=t.block;t.target.hide(),e.setMod("applied",e.val()?"yes":"")},updateFilters:function(t,e){var i=e.params.filters;this.dropdowns.forEach(function(t){this.updateDropdown(t,i)},this),this.checkboxes.forEach(function(t){this.updateCheckButton(t,i)},this)},createMisspell:function(){var t=BEMHTML.apply([{block:"advanced-search",elem:"misspell-hidden-input",tag:"input",attrs:{type:"hidden",name:"noreask",value:1}},this._hasParam("nomisspell")?{block:"advanced-search",elem:"misspell-hidden-input",tag:"input",attrs:{type:"hidden",name:"nomisspell",value:1}}:""]);BEM.DOM.append(this.domElem,t)},_resetMisspell:function(){this.findElem("misspell-hidden-input").remove()},updateDropdown:function(t,e){t._control.val(e[t.params.name]||""),t.trigger("silentChange")},updateCheckButton:function(t,e){e[t.params.name]?t.setMod("checked","yes"):t.delMod("checked")},_onPageChange:function(t,e){"search"===e.type||this.reset()},isDefaultState:function(){return!this._vals.some(function(t){return t})},submit:function(t){if(this.page.hasMod("type","search")){var e=this.page.findBlockInside("search2");this._needCreateMisspell()&&this.createMisspell(),this._checkPreventAfter(t)||this.afterCurrentEvent(function(){this.afterCurrentEvent(function(){e.domElem.submit()})})}},_needCreateMisspell:function(){return BEM.blocks.utils.isEmpty(this.findElem("misspell-hidden-input"))&&(this._hasParam("nomisspell")||this._hasParam("noreask"))},_hasParam:function(t){return"1"===BEM.blocks.uri.getParamValue(t)},reset:function(){this.isDefaultState()||(this._disableCounters(),this.controlsToReset().forEach(function(t){t.reset()}),this.findBlocksInside("input").forEach(function(t){t.val("")}),this.afterCurrentEvent(function(){this.submit(),this._updateResetButton()}),this._enableCounters())},controlsToReset:function(){return this.filters},_updateResetButton:function(){this._updateSelectedCounter(),this.setMod(this._resetButton,"hidden",this.isDefaultState()?"yes":"")},_updateSelectedCounter:function(){var t=this._vals.filter(function(t){return t&&""!==t});this.trigger("countUpdate",{count:t.length})},_enableCounters:function(){this.filters.forEach(function(t){t.enableCounters()})},_disableCounters:function(){this.filters.forEach(function(t){t.disableCounters()})},getParams:function(){return this.domElem.serialize().replace(/&?[^&?]+=(?=(?:&|$))/g,"").replace(/^&/,"")},_checkPreventAfter:function(){return!1}},{live:!0}),BEM.DOM.decl("advanced-search",{onSetMod:{js:{inited:function(){this.params.disabled||(this.__base.apply(this,arguments),this._setExtraWallpaperText())}}},findBlocks:function(){return this.__base.apply(this,arguments),this.site=this.findBlockInside("custom-site"),this.filters=this.filters.concat(this.site),this.size=this.findBlockInside("custom-size"),this.color=this.findBlockInside("filter-color"),this.sizesDropdown=this.findBlockInside({block:"dropdown",modName:"custom-size",modVal:"yes"}),this.wallpaperButton=this.findBlockInside({block:"check-button",modName:"wallpaper",modVal:"yes"}),this.commercialButton=this.findBlockInside({block:"check-button",modName:"commercial",modVal:"yes"}),this},bindEvents:function(){return this.__base.apply(this,arguments),this.wallpaperButton.on("change",this._onWallpaperChange,this),BEM.blocks.notice&&BEM.blocks.notice.on({"commercial:turn-on":this._onTurnOnCommercial,"commercial:turn-off":this._onTurnOffCommercial},this),BEM.blocks["commercial-discard"]&&BEM.blocks["commercial-discard"].on({"turn-off":this._onTurnOffCommercial},this),this},destruct:function(){this.wallpaperButton.un("change",this._onWallpaperChange,this),BEM.blocks.notice&&BEM.blocks.notice.un({"commercial:turn-on":this.turnOnCommercialFilter,"commercial:turn-off":this.turnOffCommercialFilter},this),BEM.blocks["commercial-discard"]&&BEM.blocks["commercial-discard"].un({"turn-off":this._onTurnOffCommercial},this),this.__base.apply(this,arguments)},_onWallpaperChange:function(){this.wallpaperButton.isChecked()&&this.resolveConflicts(this.wallpaperButton)},_onDropdownItemChange:function(t){this.__base.apply(this,arguments);var e=t.block;e.val()&&this.resolveConflicts(e)},_onResetClick:function(){this.reset(),BEM.blocks["b-statcounter"].hit({params:{query:{filter:{reset:"yes"}}}})},updateFilters:function(t,e){var i=e.params.filters;$.isEmptyObject(e.params.filters)?this.reset():BEM.blocks["i-global"].param("isPumpkin")||(e.params.wallpaper&&!this.wallpaperButton.hasMod("checked","yes")?this.setMod("wallpaper","autoChecked"):this.delMod("wallpaper"),this.color&&i.icolor&&this.color.setMod("color",i.icolor),this._submitDisabled=!0,this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this._submitDisabled=!1,this.trigger("show")}),"eq"===i.isize&&this.size.updateSizes(i.iw,i.ih))},isWallpaper:function(t){return t&&t.isize&&"wallpaper"===t.isize},updateDropdown:function(t,e){("isize"!==t.params.name||!this.isWallpaper(e))&&this.__base.apply(this,arguments)},updateCheckButton:function(t,e){var i=!0;switch(t.params.name){case"isize":i=this.isWallpaper(e);break;case"icomm":i=1===e.icomm||void 0===e.icomm}i&&this.__base.apply(this,arguments)},submit:function(){this._submitDisabled||("search"===BEM.blocks["i-global"].param("page")&&(BEM.blocks.header.getSearch().submitByFilters=!0),this.__base.apply(this,arguments))},resolveConflicts:function(t){var e=t.params.name,i=this.isWallpaper(t.params.values);return"isize"===e&&i&&(this.sizesDropdown.disableCounters(),this.sizesDropdown.reset(),this.sizesDropdown.enableCounters()),"isize"!==e||t._isCustom||i||this.wallpaperButton.reset(),this},controlsToReset:function(){var t=$.extend([],this.__base.apply(this,arguments));return t.push(this.site),t},_setExtraWallpaperText:function(){var t=BEM.blocks["i-userinfo"].get().getScreenInfo(),e=this.findElem(this.elem("more-item","wallpaper","yes"),"more-item-text");e.text(e.text()+" "+t.width+"×"+t.height)},turnOffCommercialButton:function(){this.commercialButton.delMod("checked").val({})},turnOnCommercialButton:function(){this.commercialButton.setMod("checked","yes")},_onTurnOnCommercial:function(){this.turnOnCommercialButton(),this.commercialButton.val({comm:"1"}),this.submit()},_onTurnOffCommercial:function(){this.turnOffCommercialButton(),this.commercialButton.val({comm:"0"}),this.submit()},_checkPreventAfter:function(t){var e;return void 0!==t&&((e=t.target).isChanged&&!e.isChanged()&&("wp"===e._field&&"off"===BEM.blocks.utils.get(e,"params.values.wp")||e.hasMod("auto","yes")))},showFilters:function(){this.setMod("filters","show"),this._saveFilterVisibility(!0)},hideFilters:function(){this.setMod("filters","hide"),this._saveFilterVisibility(!1)},_saveFilterVisibility:function(t){var e=BEM.blocks["i-global"].param("router").index,i=t?90:-1;$.cookie("fst","1",{expires:i,path:e})}},{live:!1}),BEM.DOM.decl({block:"checkbox",baseBlock:"control"},{onSetMod:{js:{inited:function(){var t=this.elem("control");this.toggleMod("checked","yes",t.prop("checked")),this.toggleMod("focused","yes",t.isFocused())}},hovered:{yes:function(){return!this.hasMod("disabled")}},pressed:{yes:function(){return!this.hasMod("disabled")}},checked:function(t,e){var i=this.elem("control");i.prop("checked",e),i.attr("aria-checked","mixed"===i.attr("aria-checked")?"mixed":Boolean(e)),this.trigger("change",{checked:Boolean(e)})},disabled:{yes:function(){this.__base.apply(this,arguments),this.delMod("hovered").delMod("pressed")}}},isDisabled:function(){return this.hasMod("disabled")},isChecked:function(){return Boolean(this.elem("control").prop("checked"))},toggle:function(){this.toggleMod("checked","yes")},val:function(t){var e=this.elem("control");return void 0===t?e.val():(e.val(t),this)},name:function(t){var e=this.elem("control");return arguments.length?(e.attr("name",t),this):e.attr("name")},_onChange:function(t){this.toggleMod("checked","yes",t.target.checked)},_onPointerenter:function(t){this.setMod("hovered","yes")},_onPointerleave:function(t){this.delMod("hovered")},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")},_onClick:function(t){var e=this.elem("label"),i=t.target;this.domElem[0]===i&&this._onChange(t),i!==e[0]&&this.trigger("click",{domEvent:t}),this.setMod("focused","yes")},_onKeydown:function(t){t.keyCode===BEM.blocks.keycodes.SPACE&&this.setMod("pressed","yes")},_onKeyup:function(t){t.keyCode===BEM.blocks.keycodes.SPACE&&this.delMod("pressed")}},{live:function(){return this.liveBindTo("pointerover pointerout",function(t){this.isDisabled()||this.domElem[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}).liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}).liveBindTo("pointerclick",function(t){this.hasMod("disabled")||this._onClick(t)}).liveBindTo("control","keydown",function(t){this.hasMod("disabled")||this._onKeydown(t)}).liveBindTo("control","keyup",function(t){this.hasMod("disabled")||this._onKeyup(t)}).liveBindTo("control","change",function(t){this._onChange(t)}),this.__base()}}),BEM.DOM.decl({block:"check-button",baseBlock:"checkbox"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments)}},checked:function(t,e){if(!1===this.__base.apply(this,arguments))return!1;this.elem("control").attr("aria-pressed",Boolean(e))}}}),BEM.DOM.decl({block:"check-button",modName:"advanced",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindEvents().initButton()}},checked:function(t,e){this.__base.apply(this,arguments),this._buttonProcess(e?this.params.values:"")}},bindEvents:function(){return this.on("change",this._onAdvancedClick),this},_onAdvancedClick:function(){this.delMod("focused")},_generateHidden:function(t,e){return BEMHTML.apply({block:"check-button",mods:{advanced:"yes"},elem:"hidden-value",tag:"input",attrs:{type:"hidden",name:t,value:e}})},initButton:function(){this._buttonProcess(this.val())},_buttonProcess:function(t){this.params.generateHidden&&(t===this.params.defaultValue?this.reset():this.val(t))},val:function(t){if(arguments.length){this.findElem("hidden-value").remove();for(var e=Object.keys(t),i=0,n=e.length;i<n;i++)this.domElem.append(this._generateHidden(e[i],t[e[i]]))}return this.isChecked()?this.params.values:""},reset:function(){"wp"!==BEM.blocks.utils.get(this.params,"state.field")&&this.findElem("hidden-value").remove(),this.delMod("checked")},enableCounters:function(){this._countersDisabled=!1},disableCounters:function(){this._countersDisabled=!0},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{generateHidden:!0})}}),BEM.DOM.decl({block:"check-button",modName:"advanced",modVal:"yes"},{_onChange:function(){if("yes"!==this.getMod("site")&&(this.__base.apply(this,arguments),!this._countersDisabled)){var t=this.params.name,e=this.val()?{ifreshness:"week",isize:"wallpaper",icomm:"yes"}[t]:"any",i={};i[{ifreshness:"fresh"}[t]||t]=e,BEM.blocks["b-statcounter"].hit({params:{query:{filter:i}}})}}}),BEM.DOM.decl("dropdown",{onSetMod:{js:{inited:function(){var t=this,e=t.params,i=t.findBlockOn(t.elem(e.popupElem),"popup");t._popup=i,i.on("show",t._onPopupShow,t).on("hide",t._onPopupHide,t),e.popupMethods.forEach(function(e){t[e]=i[e].bind(i)}),t.elem("switcher").attr({"aria-haspopup":!0,"aria-expanded":!1})}},action:function(t,e){var i="open"===e;this.elem("switcher").attr("aria-expanded",i),this._getButton()&&this._getButton().toggleMod("arrow","up","down",i)}},getPopup:function(){return this._popup},_getButton:function(){return this._button||(this._button=this.findBlockInside("switcher","button")),this._button},_toggle:function(){["button","link"].some(function(t){var e=this.findBlockOn("switcher",t);return e&&e.hasMod("disabled")},this)&&!this._popup.isShown()||this._popup.toggle(this.elem("switcher"))},_onSwitcherClick:function(){this._toggle()},_onSwitcherKeyUp:function(t){if(!(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey)){var e=this.elem("switcher")[0].tagName.toLowerCase(),i=BEM.blocks.keycodes;"button"!==e&&("a"!==e&&t.keyCode===i.ENTER||t.keyCode===i.SPACE)&&(t.preventDefault(),this._toggle())}},_onPopupShow:function(){this.setMod("action","open").trigger("show")},_onPopupHide:function(){this.setMod("action","closed").trigger("hide")},destruct:function(){this._popup.un("show",this._onPopupShow,this).un("hide",this._onPopupHide,this),this._popup.domElem&&BEM.DOM.destruct(this._popup.domElem),this.__base.apply(this,arguments)},getDefaultParams:function(){return{popupElem:"popup",popupMethods:["toggle","show","hide","setContent"]}}},{live:function(){this.liveBindTo("switcher","pointerclick",function(t){this._onSwitcherClick(t)}).liveBindTo("switcher","keyup",function(t){this._onSwitcherKeyUp(t)})}}),BEM.DOM.decl("popup",{onSetMod:{js:{inited:function(){this.__base(),this._tailPos={}}}},_calcTailPos:function(t){var e=t.to,i=this._positions[t.key],n=t.tail.axis,s={};return"top"===e||"bottom"===e?s.left=this._calcTailLeft(n,i):"left"!==e&&"right"!==e||(s.top=this._calcTailTop(n,i)),s},_calcTailTop:function(t,e){var i=0,n=this.getOwnerSize(),s=this.getOwnerPos(),o=this.params.tail.width,r=this.getPopupSize(),a=r.height,h=s.top-e.top,c=e.top+r.height-(s.top+n.height);return h>0&&(i+=h,a-=h),c>0&&(a-=c),"middle"===t?i+=(a-=o)/2:"bottom"===t&&(i+=a-=o),i<0&&(i=0),i},_calcTailLeft:function(t,e){var i=0,n=this.getOwnerSize(),s=this.getOwnerPos(),o=this.params.tail.width,r=this.getPopupSize(),a=s.left-e.left,h=r.width,c=e.left+r.width-(s.left+n.width);return a>0&&(i+=a,h-=a),c>0&&(h-=c),"center"===t?i+=(h-=o)/2:"right"===t&&(i+=h-=o),i},_calcOffsetByTail:function(t){var e=this.params.tail.height,i={};switch(t.to){case"top":i={top:-e};break;case"bottom":i={top:e};break;case"right":i={left:e};break;case"left":i={left:-e}}return i},_calcTailOffset:function(t){var e={},i=t.to,n=t.tail,s=n.offset,o=n.axis;return!!s&&("top"===i||"bottom"===i?(e.left=0,"left"===o?e.left+=s.left:"center"===o?(s.left&&(e.left+=s.left),s.right&&(e.left-=s.right)):"right"===o&&(e.left-=s.right)):"left"!==i&&"right"!==i||(e.top=0,"top"===o?e.top+=s.top:"middle"===o?(s.top&&(e.top+=s.top),s.bottom&&(e.top-=s.bottom)):"bottom"===o&&(e.top-=s.bottom)),e)},_resetTailPos:function(t){return t?this._tailPos[t]=null:this._tailPos={},this},_pushTailPos:function(t,e){return this._pushPosTo(this._tailPos,t,e),this}}),BEM.DOM.decl({block:"dropdown",modName:"advanced",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._popup=this.findBlockInside("popup"),this._button=this.findBlockInside("button"),this._buttonText=this.findElem(this._button.domElem,"switcher-text"),0===this._buttonText.length&&(this._buttonText=this._button.elem("text")),this._buttonDefaultTitle=this._buttonText.text(),this._buttonIcon=this.findElem(this._button.domElem,"icon"),this._initControl(),this._afterInit()}}},_initControl:function(){this._control=this.findBlockInside("radiobox"),this._control.on("change",function(t,e){this._radioboxProcess(e.current,t.target.val(),this._control.name()),this.trigger("change")},this)},_afterInit:function(){this._radioboxProcess(this._control.getCurrent(),this._control.val(),this._control.name())},_buildHidden:function(t,e){return BEMHTML.apply({block:"dropdown",mods:{advanced:"yes"},elem:"hidden-value",name:e,value:t})},_radioboxProcess:function(t,e){var i=this.findElem(t,"text").text(),n=Number(e)!==this.params.defaultValue?i:this._buttonDefaultTitle;this._buttonText.empty().append(n),this.params.withIcons&&this.setMod(this._buttonIcon,"type",this.params.withIcons[e]),this._generateHidden()},_generateHidden:function(){if(this.params.generateHidden&&!this.findBlockInside("popup")){this.findElem("hidden-value").remove();var t=this._control.val();t!==this.params.defaultValue&&this.domElem.append(this._buildHidden(t,this._control.name()))}},val:function(){if(this._control.val()!==this.params.defaultValue)return[{name:this.params.name,val:this._control.val()}]},reset:function(){this.findElem("hidden-value").remove(),void 0!==this.params.defaultValue&&this._control.val(this.params.defaultValue)},getDefaultParams:function(){return Object.assign(this.__base.apply(this,arguments),{generateHidden:!0})},enableCounters:function(){this._countersDisabled=!1},disableCounters:function(){this._countersDisabled=!0}}),BEM.DOM.decl({block:"dropdown",modName:"advanced",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this.on("change",this._onChange,this)}),this.on("show",this._radioboxProcess,this)}}},_onChange:function(t){if(!this._countersDisabled){var e=t.block,i=e.val(),n=e.params.name,s={};s[{itype:"format",icolor:"color"}[n]||n]=i&&i[0]?i[0].val:"any",BEM.blocks["b-statcounter"].hit({params:{query:{filter:s}}})}},_radioboxProcess:function(){this._generateHidden()}}),function(t,e){"use strict";t.ajaxPrefilter(function(t,e,i){if("iframe"===t.type.toLowerCase())return"iframe"}),t.ajaxTransport("iframe",function(e,i,n){var s,o,r=t(e.file),a="iframe-"+t.now(),h=t("<form></form>").hide().attr({action:e.url,target:a}),c=function(){o&&o.replaceWith(r),h.remove(),s.attr("src","javascript:false;").remove()};return e.dataTypes.shift(),t.each(i.data||{},function(e,i){t("<input />").attr({type:"hidden",name:e,value:i}).appendTo(h)}),r.length&&(o=r.after(r.clone().prop("disabled",!0)).next(),h.attr({enctype:"multipart/form-data",method:"POST"}),h.append(r)),{send:function(e,i){(s=t("<iframe></iframe>").hide().attr({name:a,id:a,src:"javascript:false;"})).one("load",function(){s.bind("load",function(){try{var t=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document,e=t.documentElement?t.documentElement:t.body;i(200,e.innerHTML)}catch(t){i(500)}setTimeout(function(){c()},42)}),h[0].submit()}),t("body").append(h,s)},abort:function(){null!==s&&(s.unbind("load").attr("src","javascript:false;"),c())}}})}(jQuery),BEM.DOM.decl("advanced-search",{findBlocks:function(){this._freshness=this.findBlockInside({block:"check-button",modName:"freshness",modVal:"yes"}),this._commercial=this.findBlockInside({block:"check-button",modName:"commercial",modVal:"yes"}),this._commercial&&!this.findElem(this._commercial.domElem,"extra").length&&(this._commercial=null),this._moreDropdown=this.findBlockOn(this.elem("more"),"dropdown2");var t=this.elem("more-item","site","yes");return this._moreSiteDefaultText=this.findElem(t,"more-item-text","type","default"),this._moreSiteCustomText=this.findElem(t,"more-item-text","type","custom"),this.__base.apply(this,arguments),this._updateMoreButtonState(),this},bindEvents:function(){return this.bindTo(this.elem("more-item","freshness","yes"),"pointerclick",function(){this._freshness.toggle(),this._onMoreItemClick()}),this.bindTo(this.elem("more-item","commercial","yes"),"pointerclick",function(){this._commercial.toggle(),this._onMoreItemClick()}),this.bindTo(this.elem("more-item","wallpaper","yes"),"pointerclick",function(){this.wallpaperButton.toggle(),this._onMoreItemClick()}),this.bindTo(this.elem("more-item","site","yes"),"pointerclick",function(){this.site.showModal(),this._moreDropdown.delMod("opened")}),this.__base.apply(this,arguments)},getMoreFilters:function(){return[this._commercial,this._freshness,this.wallpaperButton,this.site]},_onMoreItemClick:function(){this._moreDropdown.delMod("opened"),this._updateMoreButtonState()},_updateMoreButtonState:function(){this.getMoreFilters().some(function(t){return Boolean(t&&t.val())})?this.setMod(this.elem("more-button"),"checked","yes"):this.delMod(this.elem("more-button"),"checked")},_onCheckButtonChange:function(t,e){var i,n;t.block.hasMod("site")||(t.block.hasMod("freshness")?i="freshness":t.block.hasMod("wallpaper")?i="wallpaper":t.block.hasMod("commercial")&&(i="commercial"),n=this.elem("more-item",i,"yes"),e.checked?this.setMod(n,"selected","yes"):this.delMod(n,"selected"),this._updateMoreButtonState())},_onCustomSiteChange:function(t,e){var i=this.elem("more-item","site","yes");e.value?(this.setMod(i,"selected","yes"),this.setMod(this._moreSiteCustomText.text(e.value),"visibility","visible"),this.setMod(this._moreSiteDefaultText,"visibility","hidden")):(this.delMod(i,"selected"),this.setMod(this._moreSiteCustomText,"visibility","hidden"),this.setMod(this._moreSiteDefaultText,"visibility","visible")),this._updateMoreButtonState()}},{live:function(){return this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("change","check-button",function(t,e){this._onCheckButtonChange(t,e)}).liveInitOnBlockInsideEvent("change","custom-site",function(t,e){this._onCustomSiteChange(t,e)}),!1}}),BEM.DOM.decl("dropdown2",{onSetMod:{js:{inited:function(){this._switcher=null,this._popup=null}},opened:{yes:function(){if(this.hasMod("disabled"))return!1;this.trigger("beforeOpen").getPopup().setAnchor(this.getSwitcher()).setMod("visible","yes").on("beforeClose",this._onPopupBeforeClose,this)},"":function(){this.trigger("beforeClose").getPopup().delMod("visible").un("beforeClose",this._onPopupBeforeClose,this)}},disabled:{"*":function(t,e){this.getSwitcher().setMod(t,e)},yes:function(){this.delMod("opened")}}},getPopup:function(){return this._popup||(this._popup=this.findBlockInside("popup2")),this._popup},getSwitcher:function(){return this._switcher||(this._switcher=this.findBlockInside(this.getMod("switcher"))),this._switcher},_onPopupBeforeClose:function(){this.delMod("opened")},_onSwitcherClick:function(t){this._switcher||(this._switcher=t.block),this.toggleMod("opened","yes")}},{live:!0}),BEM.DOM.decl({block:"dropdown2",modName:"switcher",modVal:"button"},{onSetMod:{opened:function(t,e){this.__base.apply(this,arguments),this.hasMod("has-tick")&&this.getSwitcher().toggleMod("arrow","up","down",Boolean(e))}}},{live:function(){return this.liveInitOnBlockInsideEvent("click","button",function(t){this._onSwitcherClick(t)}),this.__base()}}),BEM.DOM.decl({block:"popup2",modName:"zoom-fix",modVal:"yes"},{_getOffsetOf:function(t){var e=this.__base.apply(this,arguments);return"object"!=typeof e||isNaN(e.top)||isNaN(e.left)?e:{top:Math.round(e.top),left:Math.round(e.left)}}}),BEM.DOM.decl({block:"dropdown",modName:"custom-size",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=BEM.blocks["i-global"].param("mobile");this.afterCurrentEvent(function(){BEM.blocks["custom-size"].on("change",this._onCustomChange,this).on("reset",this._onCustomReset,this)}),t||this._popup.on("show",this._onPopupShow,this),t&&this.bindTo("size-input","blur",this._popupKeyboardHideFix)}}},destruct:function(){BEM.blocks["custom-size"].un("change",this._onCustomChange,this).un("reset",this._onCustomReset,this),this.__base.apply(this,arguments)},_popupKeyboardHideFix:function(){this.afterCurrentEvent(function(){window.scrollTo(0,0)})},_onPopupShow:function(){this.setMod("action","open"),this.getCustomSize().focus()},_onCustomChange:function(){this._isCustom=!0,this.getAdvancedSearch().submit(),this._popup.hide(),this.trigger("silentChange")},_onCustomReset:function(){this._isCustom=!1,this.trigger("silentChange")},val:function(){return this._isCustom?this.getCustomSize().selected:this.__base.apply(this,arguments)},_radioboxReset:function(){this.__base.apply(this,arguments),this.getCustomSize().reset()},getCustomSize:function(){return this._customSize||(this._customSize=this.findBlockOn("custom-size")),this._customSize},getAdvancedSearch:function(){return this._advancedSearch||(this._advancedSearch=$(".advanced-search").bem("advanced-search")),this._advancedSearch}}),BEM.DOM.decl("custom-site",{onSetMod:{js:{inited:function(){this.findBlocks().bindEvents().val(this._controlVal())}}},findBlocks:function(){return this._modal=this.findBlockInside("modal"),this._checkButton=this.findBlockInside("check-button"),this._input=this.findBlockInside("input"),this},bindEvents:function(){return BEM.blocks.button2.on(this.elem("cancel"),"click",this._onCancel,this),BEM.blocks.button2.on(this.elem("search"),"click",this._onSearch,this),this._modal.on({afterOpen:function(){this._input.setMod("focused","yes")},afterClose:this._onCancel},this),this._input.bindTo("keypress",this._onKeyPress.bind(this)),this},destruct:function(){this._modal.domElem&&(BEM.blocks.button2.un(this._modal.domElem,"click"),this._input.unbindFrom("keypress"),this._modal.un("afterOpen"),BEM.DOM.destruct(this._modal.domElem)),this.__base.apply(this,arguments)},toDomain:function(t){var e=BEM.blocks.uri;return e.isAcceptable(t)?e.parse(t).host().toLowerCase():""},submit:function(t){return BEM.blocks["b-statcounter"].hit({params:{query:{filter:{site:this.toDomain(t)?"on":"any"}}}}),this},val:function(t){if(void 0===t)return this._controlVal();this._checkButton.delMod("checked");var e=this.toDomain(t);e?(this._val=e,this._checkButton.setMod("checked","yes"),this._checkButton.elem("text").text(e)):(this._val="",this._checkButton.elem("text").text(this.params.label));var i=this.val();return this._controlVal(this._val),i!==this._val&&this.trigger("change",{value:this._val}),this},reset:function(){this.val("")},showModal:function(){this._modal.setMod("visible","yes")},hideModal:function(){this._modal.delMod("visible")},_onKeyPress:function(t){13===t.which&&this._onSearch()},_controlVal:function(t){return void 0===t?this._checkButton.val():(this._checkButton.val(t),this._input.val(t),this)},_onCancel:function(){this.hideModal(),this.val(this.val())},_onSearch:function(){var t=this._input.val();this.hideModal(),this.val(t),this.submit(t)},disableCounters:$.noop,enableCounters:$.noop},{live:function(){return this.liveInitOnBlockInsideEvent("click","check-button",function(){this.showModal()}),!1}}),BEM.DOM.decl("modal",{onSetMod:{js:{inited:function(){this._popup=this.findBlockOn("popup2")}},visible:function(t,e){var i=e?"Open":"Close",n=this.elem("content"),s=window.getComputedStyle?window.getComputedStyle(n[0]):n[0].currentStyle,o=parseFloat(s.animationDuration)>0?"animationend":parseFloat(s.webkitAnimationDuration)>0?"webkitAnimationEnd":"",r=function(){this.trigger("after"+i)};this.trigger("before"+i)._popup.setMod(t,e),o?n.one(o,r.bind(this)):this.afterCurrentEvent(r)}},destruct:function(){this.delMod("visible").__base.apply(this,arguments)},setContent:function(t){return BEM.DOM.update(this.elem("content"),t),this}},{live:!0}),BEM.DOM.decl("modal",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._enforceRepaint=this._enforceRepaint.bind(this)}},visible:{yes:function(){this.__base.apply(this,arguments),window.attachEvent&&this.elem("content")[0].attachEvent("onresize",this._enforceRepaint)},"":function(){this.__base.apply(this,arguments),window.detachEvent&&this.elem("content")[0].detachEvent("onresize",this._enforceRepaint)}}},_enforceRepaint:function(){this.domElem[0].className+=""}}),BEM.DOM.decl("modal",{attachToScope:function(t){return this._popup.attachToScope(t)}}),BEM.DOM.decl({block:"modal",modName:"theme",modVal:"normal"},{onSetMod:{visible:{yes:function(){this.setMod("has-animation","yes").__base.apply(this,arguments)}}}}),BEM.DOM.decl({block:"modal",modName:"autoclosable",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._preventHideByClick=!1}},visible:{yes:function(){this.__base.apply(this,arguments),this.bindTo("content","pointerdown",this._onPointerDownContent).bindTo("pointerclick",this._onPointerClick)._popup.on("beforeClose",this._onPopupClose,this)},"":function(){this.__base.apply(this,arguments),this.unbindFrom("content","pointerdown").unbindFrom("pointerclick")._popup.un("beforeClose",this._onPopupClose,this)}}},_onPointerDownContent:function(t){this.isPointerDownContent=!0},_onPointerClick:function(t){var e=this._popup;$(this.buildSelector("visible","yes")).each(function(){var t=$(this).bem("popup2");t!==e&&(t._preventHideByClick=!0)}),$(t.target).closest(this.buildSelector("content")).length||this.isPointerDownContent||(this._popup._preventHideByClick=!1,this.delMod("visible")),this.isPointerDownContent=!1},_onPopupClose:function(){this.delMod("visible")}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this._val=this.elem("control").val()}},disabled:{"*":function(t,e){this.elem("control").prop("disabled",e)},yes:function(){this.delMod("focused")}},focused:function(t,e){if(this.hasMod("disabled"))return!1;e?this._focused||this._focus():this._focused&&this._blur(),this.afterCurrentEvent(function(){this.domElem&&this.trigger(e?"focus":"blur")})}},isDisabled:function(){return this.hasMod("disabled")},val:function(t,e){var i=void 0!==t,n=this.elem("control");return t=i?null===t?"":t.toString():n.val(),this._val!==t&&(this._val=t,n.val()!==t&&n.val(t),this.trigger("change",e)),i?this:t},name:function(t){var e=this.elem("control");return arguments.length?(e.attr("name",t),this):e.attr("name")},getSelectionEnd:function(){var t=this.elem("control")[0],e=0;if("number"==typeof t.selectionEnd)e=t.selectionEnd;else{var i=document.selection.createRange();if(i&&i.parentElement()===t){var n=t.value.length,s=t.createTextRange();s.moveToBookmark(i.getBookmark());var o=t.createTextRange();o.collapse(!1),e=s.compareEndPoints("EndToEnd",o)>-1?n:-s.moveEnd("character",-n)}}return e},_onFocus:function(){if(parseInt(BEM.blocks["i-ua"].ios,10)>=8&&!this.hasMod("type","textarea")){var t=this.elem("control")[0];t.selectionStart===t.value.length&&(t.scrollLeft=t.scrollWidth)}return this._focused=!0,this.setMod("focused","yes")},_onBlur:function(){return this._returnFocus?(this.afterCurrentEvent(function(){this.domElem&&this._focus()}),this):this.hasMod(this.elem("clear"),"pressed")?this:(this._focused=!1,this.delMod("focused"))},_focus:function(){if(this.hasMod("disabled","yes"))return!1;this.elem("control").focus()},_blur:function(){this._returnFocus=!1,this.elem("control").blur()},_updateVal:function(){this.val(this.elem("control").val())},destruct:function(){this._blur(),this.__base.apply(this,arguments)}},{live:function(){this.liveBindTo("control","focusin focusout",function(t){this["focusin"===t.type?"_onFocus":"_onBlur"](t)}),this.liveBindTo("control","input",function(){this._updateVal()})}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=this.elem("control"),e=$.dom.getActiveElement(),i=this.params.autoFocus&&!e.is("input, textarea");(e[0]===t[0]||i)&&(this.setMod("focused","yes")._focused=!0),this.params.shortcut&&this.bindToDoc("keydown",function(t){t.ctrlKey&&t.which===BEM.blocks.keycodes.UP&&!$(t.target).is("input, textarea")&&this.setMod("focused","yes")})}}},_focus:function(){if(!1===this.__base())return!1;var t=this.elem("control")[0];if(t.createTextRange&&!t.selectionStart){var e=t.createTextRange();e.move("character",t.value.length),e.select()}},destruct:function(){this.params.shortcut&&this.unbindFromDoc("keydown"),this.__base.apply(this,arguments)},_onPointerenter:function(t){this.setMod("hovered","yes")},_onPointerleave:function(t){this.delMod("hovered")}},{live:function(){return this.liveBindTo("box","pointerover pointerout",function(t){this.hasMod("disabled")||this.elem("box")[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onPointerenter(t):this._onPointerleave(t))}),this.liveBindTo("control","dragenter"),this.__base()}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindTo(this.domElem,"keypress",this._onKeyPress),window.Ya.reactBus&&window.Ya.reactBus.on("images-viewer:fullscreenEnter",this._onFullscreenEnter,this).on("images-viewer:fullscreenExit",this._onFullscreenExit,this).on("images-viewer:opened",this._onViewerOpen,this).on("images-viewer:close",this._onViewerClose,this)}}},destruct:function(){window.Ya.reactBus&&window.Ya.reactBus.off("images-viewer:fullscreenEnter",this._onFullscreenEnter).off("images-viewer:fullscreenExit",this._onFullscreenExit).off("images-viewer:opened",this._onViewerOpen).off("images-viewer:close",this._onViewerClose),this.__base.apply(this,arguments)},_onKeyPress:function(t){this.trigger("keypress",t)},_onFullscreenEnter:function(){this._disable()},_onFullscreenExit:function(){this._enable()},_onViewerOpen:function(){this._disable()},_onViewerClose:function(){this._enable()},_disable:function(){this.setMod("disabled","yes")},_enable:function(){this.delMod("disabled")},setFocus:function(){return this.setMod("focused","yes")}},{live:function(){var t=this.__base.apply(this,arguments);return this.liveBindTo("cbir-button","pointerclick",function(){this.trigger("cbir-click")}),t}}),BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.on("change",this._updateClear)._updateClear()}}},_onClearClick:function(){return this.trigger("clear"),this.removeInsets&&this.removeInsets(),this.clearInput({source:"clear"})._focus()},clearInput:function(t){return this.val("",t),this},_updateClear:function(){return this.toggleMod(this.elem("clear"),"visibility","visible",Boolean(this._val))}},{live:function(){return this.liveBindTo("clear","pointerpress",function(t){this.setMod(this.elem("clear"),"pressed","yes")}).liveBindTo("clear","pointerover",function(t){this.setMod(this.elem("clear"),"hovered","yes")}).liveBindTo("clear","pointerout",function(t){this.delMod(this.elem("clear"),"hovered")}).liveBindTo("clear","pointerclick",function(){this.delMod(this.elem("clear"),"pressed"),this._onClearClick()}).liveBindTo("control","paste",function(){this.setMod(this.elem("clear"),"visibility","visible")}),this.__base()}}),BEM.DOM.decl("input",{_onBoxClear:function(){BEM.blocks["b-page"].preventFocus||this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"input",modName:"cbir",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindEvents().findBlocks().checkIntent()}}},checkIntent:function(){this.cbirIntent.checkIntent()&&this._onDisableInput()},findBlocks:function(){return this.cbirIntent=BEM.blocks["serp-header"].getSearch().findBlockInside("cbir-intent"),this},bindEvents:function(){return this.__base.apply(this,arguments),this.bindTo(this.domElem,"keypress",this._onKeyPress),BEM.blocks["cbir-intent"].on("enableInput",this._onEnableInput,this).on("disableInput",this._onDisableInput,this).on("focusInput",this._onInputFocus,this),BEM.blocks["cbir-panel"].on("inputFocus",this._onInputFocus,this),this},destruct:function(){BEM.blocks["cbir-intent"].un("enableInput",this._onEnableInput,this).un("disableInput",this._onDisableInput,this).un("focusInput",this._onInputFocus,this),BEM.blocks["cbir-panel"].un("inputFocus",this._onInputFocus,this),this.__base.apply(this,arguments)},disableInput:function(){this.elem("control").attr("disabled",!0),this.delMod(this.elem("clear"),"visibility"),this.setMod(this.elem("box"),"cbir","yes"),this.val("")},_onDisableInput:function(){this.disableInput()},_onEnableInput:function(){this.elem("control").attr("disabled",!1),this.elem("control").val()&&this.setMod(this.elem("clear"),"visibility","visible"),this.delMod(this.elem("box"),"cbir")},_onInputFocus:function(){this.setFocus()}}),BEM.DOM.decl("cbir-intent",{onSetMod:{js:{inited:function(){this._intentTexts=this.params.texts,this.bindEvents().checkIntent()}},loading:{yes:function(){this.setIntentTitle("loading").startSpin()}}},bindEvents:function(){return this.bindTo("close","pointerclick",this._onClearClick),BEM.blocks["b-page"].on("cbir-intent:loaded",this.prepareInputForCBIR,this),this},destruct:function(){BEM.blocks["b-page"].un("cbir-intent:loaded",this.prepareInputForCBIR,this),this.__base.apply(this,arguments)},_onClearClick:function(){this.hide(),this.focusInput()},hide:function(){this.delMod("visibility").enableInput()},checkIntent:function(){var t=this.elem("thumb").attr("data-src");t&&this.bindLoadThumbEvent().setThumbSrc(t).makeIntentLoading(),(this.isVisible()||t)&&this.disableInput()},bindLoadThumbEvent:function(){return this.elem("thumb").one("load",this.makeIntentNormal.bind(this)),this.elem("thumb").one("error",this.makeIntentAbnormal.bind(this)),this},setThumbSrc:function(t){return this.elem("thumb").attr("src",t),this},isVisible:function(){return this.hasMod("visibility","visible")},startSpin:function(){return this.getSpin().setMod("progress","yes"),this},getSpin:function(){return this._spin||(this._spin=this.findBlockOn(this.elem("spinner"),"spin2"))},setIntentTitle:function(t){var e=this._intentTexts[t];return e&&this.elem("title").text(e),this},stopSpin:function(){return this.getSpin().delMod("progress"),this},makeIntentLoading:function(){var t=this.elem("thumb"),e=!BEM.blocks.utils.isEmpty(t[0])&&t[0].width>0;return this.setMod("visibility","visible"),e||this.setMod("loading","yes").delMod(this.elem("thumb"),"visibility"),this},makeIntentNormal:function(){return this.elem("thumb").attr("src")?this.setMod(this.elem("thumb"),"visibility","visible").setIntentTitle("loaded").stopSpin():this.delMod("visibility").stopSpin(),this},makeIntentAbnormal:function(){return this.delMod("visibility").stopSpin().enableInput().trigger("notLoaded"),this},prepareInputForIndex:function(){return this.delMod("visibility").delMod(this.elem("thumb"),"visibility").enableInput()},disableInput:function(){return this.trigger("disableInput"),this},enableInput:function(){return this.trigger("enableInput"),this},focusInput:function(){return this.trigger("focusInput"),this},prepareInputForCBIR:function(t,e){if(!BEM.blocks.utils.isEmpty(e.html))return this.elem("thumb").attr("src",e.html),this.setMod("visibility","visible").delMod("loading").disableInput().bindLoadThumbEvent()},prepareInputForSearch:function(){return this.clearThumb(),this.delMod(this.elem("thumb"),"visibility").delMod("loading").delMod("visibility").enableInput()},clearThumb:function(){this.elem("thumb").attr("src","")}}),BEM.DOM.decl("custom-size",{onSetMod:{js:{inited:function(){var t=this.params.values;this.findBlocks().bindEvents(),this.select(t.iw,t.ih),this.setHints()}}},findBlocks:function(){return this.dropdown=this.findBlockOn("dropdown"),this.radiobox=this.dropdown.findBlockInside("radiobox"),this.switcher=this.dropdown.findBlockOn(this.dropdown.elem("switcher"),"button"),this._initialSwitcherText=this.switcher.elem("text").text(),this.inputs=this.findBlocksInside("input"),this.button=this.findBlockOn(this.elem("button"),"button"),this.message=this.elem("message"),this},bindEvents:function(){return this.button.on("click",this.trySubmit,this),this.dropdown.on("change",this.reset,this),this.inputs.forEach(function(t){t.on("change",this._onInputUpdate,this).bindTo("keypress",this.changeThis(this._onKeyPress))},this),this},destruct:function(){this.button.un("click",this.trySubmit,this),this.dropdown.un("change",this.reset,this),this.inputs.forEach(function(t){t.un("change",this._onInputUpdate,this)},this),this.__base.apply(this,arguments)},_onKeyPress:function(t){13===t.which&&this.trySubmit()},trySubmit:function(){var t=this.getVals(),e=this.checkVal(t.width),i=this.checkVal(t.height);this.hideError(),e&&i?this.select(t.width,t.height):this.showError(e,i)},_onInputUpdate:function(){this.inputs.forEach(function(t){t.hasMod("invalid")&&this.hideError()},this)},select:function(t,e){return t&&e?(this.removeVals().setCustomValues().setText(t,e).trigger("change"),this):this},setCustomValues:function(){for(var t=this.getVals(),e={isize:this.params.values.isize,iw:t.width,ih:t.height},i=Object.keys(e),n=0,s=i.length;n<s;n++)this.dropdown.domElem.append(this._generateHidden(i[n],e[i[n]]));return this.selected=[{name:"isize",val:"eq"}],this},removeVals:function(){return this.radiobox.val("custom"),this.dropdown.findElem("hidden-value").remove(),this},reset:function(){return"custom"===this.radiobox.val()?this:(this.selected=!1,this.setVals(),this.resetText(),this.hideError().trigger("reset"),this.dropdown.val()||this.dropdown.delMod("applied"),this)},_generateHidden:function(t,e){return BEMHTML.apply({block:"dropdown",mods:{advanced:"yes"},elem:"hidden-value",tag:"input",attrs:{type:"hidden",name:t,value:e}})},showError:function(t,e){return this.highlightInvalidFields(t,e),this.setMod(this.message,"hidden",""),this},hideError:function(){return this.highlightInvalidFields(!0,!0),this.setMod(this.message,"hidden","yes"),this},highlightInvalidFields:function(t,e){return this.inputs[0].setMod("invalid",t?"":"yes"),this.inputs[1].setMod("invalid",e?"":"yes"),this},checkVal:function(t){return/^[0-9]+$/.test(t)&&Number(t)>0},setText:function(t,e){return this.switcher.elem("text").text(t+"x"+e),this},resetText:function(){return this.switcher.elem("text").text(this._initialSwitcherText),this},getVals:function(){return{width:this.inputs[0].val(),height:this.inputs[1].val()}},setVals:function(t,e){return this.inputs[0].val(t||""),this.inputs[1].val(e||""),this},setHints:function(){var t=BEM.blocks["i-userinfo"].get().getScreenSize();this.inputs[0].elem("hint").text(t.width),this.inputs[1].elem("hint").text(t.height)},updateSizes:function(t,e){this.setVals(t,e).select(t,e)},focus:function(){this.inputs[0].elem("control").focus()}},{live:!0}),BEM.DOM.decl("wallpaper",{onSetMod:{js:function(){this.checkButton=this.findBlockOn("check-button"),this.params.text=this.checkButton.elem("text").text(),this.setResolution()}},setResolution:function(){var t=this.checkButton,e=this.getScreenParams();return t.elem("text").text(this.params.text+" "+e.resolution),t.params.values.wp=e.wp,this},getScreenParams:function(){var t,e=this.params.resolution;return e||(e=(t=this._getScreenInfo()).width+"×"+t.height),{resolution:e,wp:"wh"+this._getWP()}},_getScreenInfo:function(){return BEM.blocks["i-userinfo"].get().getScreenInfo()},_getWP:function(){return BEM.blocks["i-userinfo"].get().getWP()}}),BEM.DOM.decl("paranja",{onSetMod:{js:{inited:function(){[].concat(this.params.rel||[]).forEach(function(t){$(t.elem||this.domElem).on(t.event,this[t.method].bind(this))},this),this.bindTo("pointerclick",function(){this.trigger("click")})}},state:{open:function(){this.trigger("open")},close:function(){this.trigger("close")}}},open:function(t){this.setMod("state","open")},close:function(t){this.setMod("state","close")}},{live:!1}),BEM.DOM.decl("paranja",{setTheme:function(t){return this.setMod("theme",t)},delTheme:function(){return this.delMod("theme")}}),BEM.DOM.decl("i-services",{getServiceUrl:function(t,e){var i=this.params[t],n="";if(!i)return"";i.search&&e&&(n=i.search+encodeURIComponent(e));var s=i.params||"";return n?n+=s:n=i.baseUrl&&-1===i.baseUrl.indexOf("?")?s?"/?"+s.replace(/^\&/,""):"/":"all"===t?s.replace(/^\&/,""):s,i.baseUrl+n}},{getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance},getServiceUrl:function(t,e){return this.getInstance().getServiceUrl(t,e)},live:!0}),BEM.DOM.decl("tabs-navigation",{_onDocClick:function(t){this.elem("tab").is(t.target)||this.delMod("show-extra").unbindFromDoc("click")},_onMoreClick:function(){this.setMod("show-extra","yes").bindToDoc("click",this._onDocClick)},_onMoreKeydown:function(t){BEM.blocks.keycodes.is(t.keyCode,"SPACE")&&t.preventDefault()},_onMoreKeyup:function(t){BEM.blocks.keycodes.is(t.keyCode,"ENTER","SPACE")&&this.setMod("show-extra","yes").bindToDoc("click",this._onDocClick)}},{live:function(){this.liveBindTo("more","pointerclick",function(t){this._onMoreClick(t)}).liveBindTo("more","keydown",function(t){this._onMoreKeydown(t)}).liveBindTo("more","keyup",function(t){this._onMoreKeyup(t)})}}),BEM.DOM.decl("tabs-navigation",{hide:function(){return this.setMod("hidden","yes")},show:function(){return this.delMod("hidden")}}),BEM.DOM.decl("search2",{onSetMod:{js:{inited:function(){this.findBlocks().bindEvents()}}},_onInputChange:function(){BEM.blocks["i-global"].setParams({searchInputText:BEM.blocks.utils.escape(this._input.val())})},reset:function(){return this._input.val("",{suggest:!1}),this},focus:function(){var t;return BEM.blocks["i-global"].param("isPumpkin")||(t=this._suggest.params.onFocus,this._suggest.params.onFocus=!1),this._input.elem("control").focus(),BEM.blocks["i-global"].param("isPumpkin")||this.afterCurrentEvent(function(){this._suggest.params.onFocus=t},this),this},findBlocks:function(){return this._location=BEM.blocks.location.getInstance(),this._input=this.findBlockInside("input"),this._suggestForm=this.findBlockInside("suggest2-form"),this._suggestPopup=$("#main-search-suggest"),this._suggest=this.findBlockOn(this._suggestPopup,"suggest2"),this},bindEvents:function(){return this._location.on("change",this._onChange,this),this._suggest&&this._suggest.on("select",this._onSuggestSelect,this),this._input.on("change",this._onInputChange,this),this._input.on("focus",this._onInputFocus,this),BEM.blocks["b-page"].on("search:input:update",this.updateSearchPage,this),this.bindTo("submit",this._onSubmit),this},_onInputFocus:function(){this.trigger("input:focus")},_onSuggestSelect:function(t){t.preventDefault()},_onSubmit:function(t,e){this.submit(t,e),t.preventDefault()},submit:function(t,e){var i=BEM.blocks["i-global"].getFlag("suggest_context_redirect"),n=BEM.blocks["i-global"].param("tld");i&&"ru"===n?this._checkRedirectURL(t,i):(this.val()!==BEM.blocks.uri.getParamValue("text")&&this.trigger("search:query:changed"),this._ajaxSubmit(t,e&&e.cgiQuerySource))},_ajaxSubmit:function(t,e){this._location.change({url:this._buildUrl(e)},t)},_checkRedirectURL:function(t,e){var i=BEM.blocks["i-global"].param("id"),n=this._input.val(),s="images"===i?40:197,o="images"===i?72863:72894,r=2===e?"control-":"",a=this;$.ajax({url:"//yandex.ru/suggest/suggest-redir",data:{current:i,part:n,lr:BEM.blocks["i-global"].param("lr")},dataType:"json",context:this,cache:!1}).then(function(t,e,i){var n=BEM.blocks.utils.get(t,"redirect_info.url"),s=$.Deferred();return n?s.resolve(n):s.reject(i,"no"),s.promise()}).then(function(h){cp({pid:s,cid:o,path:r+"yes",text:n,service:i},{href:h}),2===e?a._ajaxSubmit(t):location.href=h},function(e,h){cp({pid:s,cid:o,path:r+h,text:n,service:i}),a._ajaxSubmit(t)})},_buildUrl:function(t){var e=this.getAdvancedSearch();return this.domElem.attr("action")+"?"+this.domElem.serialize()+(e?"&"+e.getParams():"")+(t?"&query_source="+t:"")},_onChange:function(t,e){switch(this.__self.win.scrollTop(0),e.block){case"b-page_type_index":case"b-page_type_favorites":this.updateIndexPage(t,e);break;case"b-page_type_search":this.updateSearchPage(t,e)}},updateIndexPage:function(){this.reset().focus()},updateSearchPage:function(t,e){this.fill(e.params.text),this._input._updateClear(),this._input.delMod("focused")},fill:function(t){var e=t;return Array.isArray(t)&&(e=t[0]),BEM.blocks["i-global"].param("isPumpkin")&&this._input&&this._input.val(e),this._suggest&&(!this._suggest.params["suggest2-input"]&&this._suggestForm.initNodes(),this._suggest.params["suggest2-input"]&&this._suggest.params["suggest2-input"].valWithoutSuggest(e)),this},getAdvancedSearch:function(){if(!this._advancedSearch){var t=$(".advanced-search");this._advancedSearch=!BEM.blocks.utils.isEmpty(t)&&t.bem("advanced-search")}return this._advancedSearch},val:function(){return this._input.val()}}),BEM.DOM.decl("search2",{bindEvents:function(){return this.__base.apply(this,arguments),this},countSubmit:function(){this.submitByFilters?this.submitByFilters=!1:this.submitBySuggest?this.submitBySuggest=!1:"index"===BEM.blocks["i-global"].param("page")?(-1!==["ru","ua","com.tr"].indexOf(BEM.blocks["i-global"].param("tld"))&&BEM.blocks["b-statcounter"].goal({goal:"button",params:{query:{morda:"submit"}}}),BEM.blocks["b-statcounter"].hit({params:{query:{morda:"submit"}}})):BEM.blocks["b-statcounter"].hit({params:{query:{reform:"submit"}}})},_onSuggestSelect:function(t){if(BEM.blocks["i-global"].param("isPumpkin"))return this._location.change({url:this._buildUrl(),reload:!0},t),void t.preventDefault();this.__base.apply(this,arguments),this.submitBySuggest=!0,BEM.blocks["b-statcounter"].hit({params:{query:"index"===BEM.blocks["i-global"].param("page")?{morda:"suggest"}:{reform:"suggest"}}})},updateIndexPage:function(){this.reset(),this._input.setMod("autofocus","yes")},updateCbirPage:function(){this.fill(""),this._input.delMod("autofocus")},updateSearchPage:function(){this.__base.apply(this,arguments),this._input.setMod("autofocus","yes")}},{live:function(){this.liveBindTo("label","click",function(t){t.preventDefault()})}}),BEM.DOM.decl("search2",{},{getInstance:function(){var t;return void 0===this._instance&&(t=$(this.buildSelector()),this._instance=t.length?t.bem(this.getName()):null),this._instance}}),BEM.DOM.decl({name:"input",modName:"autofocus",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.bindToDoc("keydown",this._autoFocusBind)}}},_autoFocusBind:function(t){if(!this.hasMod("focused","yes")&&!this.elem("control").attr("disabled")){var e;try{e=document.activeElement.tagName.toLowerCase()}catch(t){}if(function(t){if(function(t){var e=t.charCode||t.keyCode||t.which||0;return t.ctrlKey||t.altKey||t.metaKey||16===e||8===e||20===e||9===e||e>=32&&e<=40||e>=112&&e<=123||27===e||45===e||46===e||13===e||e>=91&&e<=93}(t))return!1;var e=t.charCode||t.keyCode||t.which||0;if(e>=48&&e<=57)return!0;if(e>=96&&e<=105)return!0;if(e>=65&&e<=90||e>=1025&&e<=1071)return!0;var i=t.key||"";return"хёэжбю".indexOf(i.toLowerCase())>=0}(t)&&"input"!==e&&"textarea"!==e){var i=this.elem("control")[0],n=this.val();if(n.length>0&&" "!==n.slice(-1)&&(n+=" ",this.val(n)),i.createTextRange){var s=i.createTextRange();s.collapse(!1),s.select()}else i.setSelectionRange&&i.setSelectionRange(n.length,n.length);this.setMod("focused","yes")}}}}),BEM.DOM.decl({block:"input",modName:"theme",modVal:"websearch2"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.on("change",this._updateState)._updateState()}}},_updateState:function(){return this.toggleMod("empty",!0,!this._val)}}),BEM.DOM.decl({block:"input",modName:"found",modVal:"yes"},{_onFoundUpdate:function(t,e){this.setFound(BEM.blocks["i-common__string"].escapeHTML(e.text))}}),BEM.DOM.decl("suggest2",{onSetMod:{js:{inited:function(){this.params.form||this.findBlockOutside("suggest2-form"),this._lastSubmitTime=0,this._lastBlurTime=0,this._clear()}}},_bodyHandler:function(t){if(!this._isDestructing){var e=$(t.target);this.containsDomElem(e)||this.params.form.containsDomElem(e)||(this._freezeInputFocus=!1)}},getDefaultParams:function(){return{submitBySelect:!1,updateOnEnterByKeyboard:!0,onFocus:"request",requestOnEmptyInput:!1,abortQueries:!1,sequentialQueriesTimeout:!1}},destruct:function(){this.unbindAllEvents(),this.__base.apply(this,arguments)},init:function(){var t=this;t.params.form.on("submit",function(e,i){t._lastSubmitTime=(new Date).getTime(),t._isActualSearchCGIParams?t._isActualSearchCGIParams=!1:"suggest2-counter"!==i.data.block&&!1!==i.data.prevent&&this.removeHiddenInputs(),t._clear(),t._model.reset(),t._popup.hide()}),t._input=t.params["suggest2-input"],t._popup=t.params["suggest2-popup"],t._inputValue=t._input.val(),t._model=t.initModel(),t._view=t.initView(),t._counter=t.initCounter(),t._model.on({response:this.setItems,reject:function(e,i){2===i.code&&(t._popup.hide(),t._clear())}},t),t.bindToDoc("pointerclick",t._bodyHandler),t.bindEvents(),this._input.isFocused()&&this._doRequest();var e=BEM.blocks["i-ua"]&&BEM.blocks["i-ua"].ua.toLowerCase();return e&&e.indexOf("mozilla/5.0")>-1&&e.indexOf("android ")>-1&&e.indexOf("applewebkit")>-1&&!(e.indexOf("chrome")>-1)&&t.setMod("old-flex",!0),t},initModel:function(){return BEM.create("suggest2-model",this.params)},getModel:function(){return this._model},initView:function(t,e){var i=this.getMod("type");return t=$.extend(t,this.params.viewMods||{}),e=$.extend(e,this.params.viewParams||{}),"simple"!==i&&"all"!==i||(t.simple="yes"),"advanced"!==i&&"all"!==i||(t.advanced="yes"),BEM.create({block:"suggest2-view",mods:t||{}},e||{})},getView:function(){return this._view},initCounter:function(){return this.params.counter?this.params.counter.initValues().bindEvents():void 0},getCounter:function(){return this._counter},setDataConverter:function(t){return this.getModel().getProvider().convert=t,this},setRequestData:function(t){return this.getModel().getProvider().getRequestData=t,this},setRequestUrl:function(t){return this.getModel().getProvider().getRequestUrl=t,this},setOwner:function(t){return this._popup.owner(t),this},bindEvents:function(){var t=this;return t._input.bindEvents({change:t._onChange,focus:t._onFocus,blur:t._onBlur},t),t._popup.on({preshow:function(){t.trigger("preshow")},show:function(){t._onShow()},hide:function(e,i){t._onHide(i)}}),t.params.form&&t.params.form.on("button-press",t._onSearchButtonMousedown,t),BEM.blocks["suggest2-item"].on(t.domElem,{"link-click":function(e,i){t._counter&&"_self"===$(i.domEvent.target).attr("target")&&i.domEvent.preventDefault()}}),t},_onShow:function(){this.trigger("show")},_onHide:function(t){this.trigger("hide",t)},_onSearchButtonMousedown:function(){this._input.realVal(this._input.val()),this._popup.hide()},unbindAllEvents:function(){return this.unbindFromDoc("pointerclick"),this._input.unbindAllEvents(),this.params.form.un("submit"),this._model.un("response").un("reject"),this._popup.un("preshow").un("show").un("hide"),this.params.form&&this.params.form.un("button-press",this._onSearchButtonMousedown,this),this},setItems:function(t,e){var i=e.data.items||[];return this._isFormSubmitDurinQuery()||!i.length?(this._popup.hide(),this._clear()):this.params.sequentialQueriesTimeout||this._input.val()===e.val?(this._text=e.val,this._pos=e.pos,this._meta=e.data.meta||{},this._popup.show(this._view.html(i,this._meta)).width(this.getPopupWidth()),this._items=this.findBlocksInside("suggest2-item"),this._clearItems().trigger("update",{val:this._text,pos:this._pos,items:this._items,dataItems:i}),this):this._clear()},getItems:function(){return this._items||[]},isBlur:function(){return this._isBlur&&!this._isMouseDown},getPopupWidth:function(){},getInputWidth:function(){return 0},isNeedSubmitFormOnSelectItem:function(t){return this.params.submitBySelect&&"link"!==t.getMod("interact")},_isFormSubmitDurinQuery:function(){return!!this._lastSubmitTime&&(this._model.filterRequestsByVal(this._input.realVal()),this._model.isTimeInRequestInterval(this._lastSubmitTime))},_onChange:function(t,e){e&&e.hasOwnProperty("suggest")&&!1===e.suggest||this._inputValue!==this._input.val()&&(this._inputValue=this._input.val(),this._doRequest(e))},_doRequest:function(t){var e=this.getCounter();this._model.request(this._input.realVal(this._input.val()),this._input.getCaretPosition(),t,e&&e.getCurrentReqId())},_onFocus:function(){!this._popup.isShown()&&this._isBlur&&this.params.onFocus&&this._isLastBlurTimeLater(50)&&(this.getItems().length&&this._input.val()===this._text?(this._clearItems(),this._popup.show()):this._isMouseDown||"request"!==this.params.onFocus||this._doRequest())},_onBlur:function(){this._isBlur?(this._clear(),this._popup.hide()):this._freezeInputFocus?(this._clear(),this._input.focus()):this._isMouseDown&&this._input.focus(),this._lastBlurTime=(new Date).getTime(),this._isBlur=!0},_getItemIndex:function(t){return this.getItems().indexOf(t)},_clear:function(){return this._isBlur=!0,this._freezeInputFocus=!1,this._clearItems()},_clearItems:function(){return this._isMouseDown=!1,this._enterItemIndex=-1,this._unselectItems()},_isLastBlurTimeLater:function(t){return(new Date).getTime()-this._lastBlurTime>t},_unselectItems:function(t){return(t?[].slice.call(arguments):this.getItems()).forEach(function(t){t.onLeave()}),this},_onSelectItem:function(t,e){var i=this._getItemIndex(t),n=t.onSelect(e),s=t.valOnSelect();return this._text=this._input.realVal(s),this._isBlur=!0,this._freezeInputFocus=!1,this._setSearchCGIParams(t),this.trigger("select",{val:this._text,pos:this._pos,item:t,meta:this._meta,itemIndex:i,byKeyboard:e,callbackOnSelect:n}),!1!==s&&(this._items=[],this.isNeedSubmitFormOnSelectItem(t)&&this.params.form.submit()),i},_isActualSearchCGIParams:!1,_setSearchCGIParams:function(t){this.params.form.removeHiddenInputs(),t.params.searchCGI&&(this._isActualSearchCGIParams=!0,this.params.form.appendHiddenInputs(t.params.searchCGI.map(function(t){return{name:t[0],value:t[1]}})))},_onDownItem:function(){this._isBlur=!1,this._isMouseDown=!0}}),BEM.DOM.decl("suggest2",{getInputLeft:function(){return 0},getInputWidth:function(){return 0},getContainerWidth:function(){return 0},getMetrics:function(){var t=this.getInputLeft(),e=this.getInputWidth(),i=this.getContainerWidth()-t;return{marginLeft:t,minWidth:e>=i?i:e,maxWidth:i}},adjustView:function(){return this.getMetrics()},_resizeHandler:function(){}}),BEM.DOM.decl("suggest2",{bindEvents:function(){var t=this;return t._input.bindEvents({keydown:t._onKeyDown,keyup:t._onKeyUp,keypress:t._onKeyPress,mousedown:function(){t._input.isFocused()&&t._onFocus()}},t),BEM.blocks["suggest2-item"].on(t.domElem,{mouseover:function(e){t._onEnterItem(e.block,!1)},mouseout:function(e,i){var n=e.block.domElem[0];n===i.relatedTarget||$.contains(n,i.relatedTarget)||t._onLeaveItem(e.block,!1)},mousedown:function(){t._onDownItem()},click:function(e){t._onSelectItem(e.block,!1)}}),t.__base.apply(t,arguments)},_onKeyDown:function(t){var e=this.__self.keyboard,i=t.which;!this._popup.isShown()||i!==e.up&&i!==e.down||(t.preventDefault(),this._enterByKeyboard(i))},_onKeyUp:function(t){var e=this.__self.keyboard;if(t.which!==e.left&&t.which!==e.right||(this.trigger("change-cursor-pos"),this._model.request(this._input.realVal(this._input.val()),this._input.getCaretPosition())),t.which===e.right&&-1!==this._enterItemIndex&&this._enterItemByKeyboard){var i=this._items[this._enterItemIndex];i&&this.trigger("ahead",{item:i,val:"link"===i.getMod("interact")?i.elem("text").text():i.val()})}},_onKeyPress:function(t){if(t.which===this.__self.keyboard.enter&&-1!==this._enterItemIndex&&this._enterItemByKeyboard){var e=this._items[this._enterItemIndex];e&&(t.preventDefault(),this._onSelectItem(e,!0))}},_enterByKeyboard:function(t){var e=t-39,i=this._items.length,n=this._enterItemIndex+e;if(-1===n||n===i)return this._enterItemIndex=n,this._unselectItems(this._items[n]),this.trigger("out",{val:this._text,byKeyboard:!0});n<0?n=i-1:n>=i&&(n=0),this._onEnterItem(this._items[n],!0)},_onEnterItem:function(t,e){this._enterItemIndex=this._getItemIndex(t),this._enterItemByKeyboard=e,this._unselectItems(),t.onEnter(e)},_onLeaveItem:function(t,e){this._clearItems()._unselectItems(t)}},{keyboard:{enter:13,left:37,up:38,right:39,down:40},live:function(){return this.liveBindTo("mousedown",function(){this._onDownItem()}),this.__base()}}),BEM.DOM.decl("suggest2",{_onSelectItem:function(t){"no"!==t.getMod("interact")&&this.__base.apply(this,arguments)}}),BEM.DOM.decl("suggest2",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),window.Ya.reactBus&&window.Ya.reactBus.on("images-viewer:fullscreenEnter",this._onFullscreenEnter,this).on("images-viewer:fullscreenExit",this._onFullscreenExit,this).on("images-viewer:opened",this._onViewerOpen,this).on("images-viewer:close",this._onViewerClose,this)}}},destruct:function(){window.Ya.reactBus&&window.Ya.reactBus.off("images-viewer:fullscreenEnter",this._onFullscreenEnter).off("images-viewer:fullscreenExit",this._onFullscreenExit).off("images-viewer:opened",this._onViewerOpen).off("images-viewer:close",this._onViewerClose),this.__base.apply(this,arguments)},_onFullscreenEnter:function(){this._disable()},_onFullscreenExit:function(){this._enable()},_onViewerOpen:function(){this._disable()},_onViewerClose:function(){this._enable()},_disable:function(){this.setMod("disabled","yes")},_enable:function(){this.delMod("disabled")}}),BEM.decl("suggest2-model",{onSetMod:{js:{inited:function(){this._requests=[]}}},destruct:function(){this._provider&&this._provider.destruct(),this.__base.apply(this,arguments)},getProvider:function(){return this._provider?this._provider:(this._provider=this.setProvider(this.params),this._provider)},setProvider:function(t){return this._provider=BEM.create({block:"suggest2-provider",mods:t.providerMods||{}},t),this._provider},getCancelRequestConditions:function(){return[{block:"suggest2",show:!1},{block:"suggest2",event:"select"},{block:"suggest2-item",event:"select"},{block:"suggest2",event:"out"},{block:"suggest2-item",show:!1},{block:"suggest2-popup",event:"hide"},{suggest:!1},{source:"sample"}]},request:function(t,e,i,n){var s=this,o={val:t,caretPosition:e,reqId:n,data:i};s._requests.push(o);var r=s._isNeedRequest(t,i);return r.need?(o.requestTime=(new Date).getTime(),s.lastSendedRequest=o,s.trigger("request",{val:t,pos:e,request:o}),s.getProvider().get(t,e,n,function(t,e,i,n){o.responseTime=(new Date).getTime(),$.extend(o,{duration:o.responseTime-o.requestTime,error:i.error,fromCache:n,itemsCount:i.items?i.items.length:0}),s._onResponse(t,e,i,o);var r=s._requests[s._requests.length-1];s.params.sequentialQueriesTimeout&&r&&r.val!==t&&s.request(r.val,r.caretPosition,r.data)}),s):s.trigger("reject",{val:t,pos:e,code:r.code,reason:r.reason||{}})},isTimeInRequestInterval:function(t){for(var e=this._requests.length-1;e>=0;e--)if(t>this._requests[e].requestTime&&t<this._requests[e].responseTime)return!0;return!1},filterRequestsByVal:function(t){this._requests=this._requests.filter(function(e){return e.val===t})},_isNeedRequest:function(t,e){if(""===t&&!this.params.requestOnEmptyInput)return{need:!1,code:2};var i;if(this.lastSendedRequest&&this.lastSendedRequest.val===t)return{need:!1,code:4};if(this.params.sequentialQueriesTimeout)for(i=this._requests.length-1;i>=0;i--){var n=this._requests[i];if(void 0===n.responseTime&&(new Date).getTime()-n.requestTime<this.params.sequentialQueriesTimeout)return{need:!1,code:3,reason:{request:n}}}if(!e)return{need:!0};var s,o=this.getCancelRequestConditions();t:for(i=0;i<o.length;i++){for(var r in s=o[i])if(s.hasOwnProperty(r)&&s[r]!==e[r])continue t;return{need:!1,code:1,reason:{condition:s}}}return{need:!0}},_onResponse:function(t,e,i,n){var s={val:t,pos:e,data:i||[],request:n};BEM.channel("suggest2").trigger("response",s),this.trigger("response",s)},reset:function(){this._requests=[],this.lastSendedRequest=null}}),BEM.DOM.decl("suggest2-detect",{onSetMod:{js:{inited:function(){this.bindToDoc("keydown",function(t){this.__self._pressedKeyCode=t.which},this).bindToDoc("keyup",function(){this.__self._pressedKeyCode=null},this),this.__self.isSupportInlineSVG()||this.setMod("inlinesvg","no")}}}},{_pressedKeyCode:null,isPressedEscape:function(){return 27===this._pressedKeyCode},_isSupportInlineSVG:null,isSupportInlineSVG:function(){if(null!==this._isSupportInlineSVG)return this._isSupportInlineSVG;var t=document.createElement("div");return t.innerHTML="<svg/>",this._isSupportInlineSVG="http://www.w3.org/2000/svg"===(t.firstChild&&t.firstChild.namespaceURI),this._isSupportInlineSVG}}),function(t){if(!t.support.cors&&t.ajaxTransport&&window.XDomainRequest){var e=/^(https?:)?\/\//i,i=/^get|post$/i,n=new RegExp("^(//|"+location.protocol+")","i");t.ajaxTransport("* text html json",function(s,o,r){if(s.crossDomain&&s.async&&i.test(s.type)&&e.test(s.url)&&n.test(s.url)){var a=null;return{send:function(e,i){var n="",r=(o.dataType||"").toLowerCase();a=new XDomainRequest,/^\d+$/.test(o.timeout)&&(a.timeout=o.timeout),a.ontimeout=function(){i(500,"timeout")},a.onload=function(){var e="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,n={code:200,message:"success"},s={text:a.responseText};try{if("html"===r||/text\/html/i.test(a.contentType))s.html=a.responseText;else if("json"===r||"text"!==r&&/\/json/i.test(a.contentType))try{s.json=t.parseJSON(a.responseText)}catch(t){n.code=500,n.message="parseerror"}}catch(t){throw t}finally{i(n.code,n.message,s,e)}},a.onprogress=function(){},a.onerror=function(){i(500,"error",{text:a.responseText})},o.data&&(n="string"===t.type(o.data)?o.data:t.param(o.data)),a.open(s.type,s.url),a.send(n)},abort:function(){a&&a.abort()}}}})}}(jQuery),BEM.decl("suggest2-provider",{getDefaultParams:function(){return{cache:!1,type:"GET",dataType:"jsonp",timeout:2e3}},_cachedResponses:Object.create?Object.create(null):{},_cachingTime:6e4,_lastQuery:null,get:function(t,e,i,n){"function"==typeof i&&(n=i,i=void 0);var s=this,o=s.params.abortQueries,r="jsonp"===this.params.dataType,a=s._extendParamsData(s.getRequestData(t,e,i));n=n.bind(s,t,e),o&&null!==s._lastQuery&&s._lastQuery.abort(),s._lastQuery=$.ajax(a).done(function(t){n(s.convert(t),s._validateCache(this.url))}).fail(function(t,e){!o&&!r&&n({error:e||"error"})})},convert:function(t){return{orig:t[0],items:t[1],meta:t[2]}},getRequestData:function(t,e,i){return $.extend({part:t,pos:e},i&&{suggest_reqid:i},BEM.blocks["suggest2-detect"].isSupportInlineSVG()&&{svg:1})},getRequestUrl:function(){return this.params.url},_extendParamsData:function(t){return this.params.url=this.getRequestUrl(),this.params.data=$.extend(this.params.data||{},t),this.params.traditional=!0,this.params},_validateCache:function(t){var e=Boolean(this._cachedResponses[t])&&this._cachedResponses[t]>Date.now();return!e&&this._addToCache(t),e},_addToCache:function(t){this._cachedResponses[t]=Date.now()+this._cachingTime,setTimeout(function(){this._cachedResponses[t]=void 0}.bind(this),this._cachingTime)}}),BEM.decl("suggest2-provider",{getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.dataType=BEM.blocks["i-global"].getFlag("disable_jsonp")?"json":"jsonp",t},getRequestData:function(t,e){return $.extend(this.__base.apply(this,arguments),{"prev-query":BEM.blocks["i-global"].param("query")})}}),BEM.DOM.decl("suggest2-item",{val:function(){if(void 0!==this.params.val)return this.params.val;var t=this.elem("text");return(t.length?t:this.domElem).text()},valOnSelect:function(){return this.val()},valOnEnter:function(){return this.val()},valOnLeave:function(){return this.val()},onEnter:function(t){return this.setMod("selected","yes").triggerEvent("enter",{val:this.valOnEnter(),byKeyboard:t})},onLeave:function(t){return this.domElem?this.delMod("selected").triggerEvent("leave",{val:this.valOnLeave(),byKeyboard:t}):this},onSelect:function(t){this.triggerEvent("select",{val:this.valOnSelect(),byKeyboard:t})},_onPointerpress:function(t){this.setMod("pressed","yes").bindToDoc("pointerrelease",this._onPointerrelease)},_onPointerrelease:function(t){this.delMod("pressed").unbindFromDoc("pointerrelease")},triggerEvent:function(t,e){return this.trigger(t,{val:e.val,id:this.domElem.attr("id"),show:!1,byKeyboard:e.byKeyboard})}},{live:function(){return this.liveBindTo("pointerpress",function(t){this.hasMod("disabled")||this._onPointerpress(t)}),this.__base()}}),BEM.DOM.decl("suggest2-item",{},{live:function(){return this.liveBindTo("mouseover mouseout mousedown pointerclick",function(t){this.trigger("pointerclick"===t.type?"click":t.type,{domEvent:t})}).liveBindTo("link","pointerclick",function(t){this.trigger("link-click",{domEvent:t})}),this.__base()}}),BEM.DOM.decl({block:"suggest2-item",modName:"interact",modVal:"no"},{val:function(){return""},onEnter:function(){},onLeave:function(){},onSelect:function(){},_onPointerpress:function(){},_onPointerrelease:function(){},_onClick:function(t){t.stopPropagation()}}),BEM.decl("suggest2-popup",{onSetMod:{js:{inited:function(){this._popup=this.params.popup,this._popupContent=this.params.popupContentElem&&this._popup.findElem(this.params.popupContentElem),this.bindSuggestEvents()}}},show:function(t){return this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this._popup.domElem?(t&&this.setContent(t),this.isShown()?this:(this.trigger("preshow"),this._setPosition(),this.trigger("show"),this)):this},_setPosition:function(){throw new Error("Этот метод должен быть переопределен в модификаторе _for")},hide:function(t){var e=this;return e.isShown()&&!e.hideTimeout&&(e.hideTimeout=setTimeout(function(){e._doHide(),e.trigger("hide",t||{}),e.hideTimeout=null},300)),e},_doHide:function(){throw new Error("Этот метод должен быть переопределен в модификаторе _for")},setContent:function(t){return this._popupContent?BEM.DOM.update(this._popupContent,t):this._popup.setContent(t),this},isShown:function(){throw new Error("Этот метод должен быть переопределен в модификаторе _for")},owner:function(t){return t?(this.params.owner=t,this):this.params.owner},get:function(){return this._popup},width:function(t){return void 0===t?this._popup.domElem.outerWidth():(this._popup.domElem.outerWidth(t),this)},destruct:function(){this._popup&&(this.unbindAllEvents(),this.__base.apply(this,arguments))},bindSuggestEvents:function(){return this.params.suggest.on({select:this._onSuggestSelect,update:this._onSuggestUpdate},this),this},_onSuggestSelect:function(t,e){this.hide(e)},_onSuggestUpdate:function(t,e){e.items.length||this.hide({response:"empty"})},unbindAllEvents:function(){return this.params.suggest.un("select").un("update"),this}}),BEM.decl("suggest2-view",{html:function(t,e){return BEMHTML.apply(this.build(t,e))},build:function(t,e){return this.buildContent(t,e)},buildContent:function(t,e){return{block:"suggest2",elem:"content",elemMods:{theme:"normal"},content:this.buildItems(t,e)}},buildItems:function(t,e){return t.reduce(function(t,e){return t.push(this.buildItem(e)),t}.bind(this),[])},buildItem:function(t){var e=this.__self._getPrefs(t),i=this.__self._getType(t,e),n="html"===i||"bemjson"===i?{}:{type:i};return this._getItemByType(t,e,i,{text:{elem:"text",content:this.__self._highlight(this.__self._getText(t,e),e)},mods:n,js:e.js||{},props:{},content:[]})},_getItemByType:function(t,e,i,n){var s=n.text,o=n.mods,r=n.js,a=n.props,h=n.content;0===h.length&&h.push(s),this.__self._getPersonal(e)&&(o.personal="yes",h.push({elem:"spacer"},{elem:"cross",elemMods:{type:"delete"}})),e.url&&(o.interact="link",a.url=this.__self._resolveUrl(e.url),e.target&&(a.target=e.target)),e.search_cgi&&(r.searchCGI=e.search_cgi),e.attrs&&(a.attrs=e.attrs);var c,l=BEM.blocks["i-global"];return"nav"===i?c="object"==typeof t[5]?t[5].counter:t[5]:"bemjson"===i&&(c=e.counter),c&&(r.safeclickUrl=l.param("click-host")+c),$.extend({block:"suggest2-item",mods:o,js:r,content:h},a)}},{_getPrefs:function(t){if(!Array.isArray(t))return{};var e=t[t.length-1];return $.isPlainObject(e)?e:{}},_getType:function(t,e){return Array.isArray(t)&&t[0]||"text"},_getText:function(t){return Array.isArray(t)?t[1]:t},_highlight:function(t,e){if(!e.hl)return t;var i,n=e.hl.sort(function(t,e){return t[0]-e[0]}).filter(function(t){return t[0]>=0}),s=[],o=0;return n.length?(n.forEach(function(e){i=o>e[0]?o:e[0],s.push(t.slice(o,i)),s.push({elem:"highlight",content:t.slice(i,o=e[1])})},this),s.push(t.slice(o)),s.filter(function(t){return t})):t},_resolveUrl:function(t){return(/[\/]{2}/.test(t)?"":"http://")+t},_getPersonal:function(t){return Boolean(t.pers)},_getPersonalProps:function(t){var e={pers:1};return t&&(e.label=t),e}}),BEM.decl("suggest2-view",{},{_getGroupType:function(t,e){return t.pers?"nah":-1!==["nav"].indexOf(e)?e:"text"},_getTextLabel:function(t){return BEM.I18N("suggest2",t)}}),BEM.decl("suggest2-view",{},{_getTextLabel:function(t){return"text"===t?BEM.blocks["i-global"].param("serviceName"):BEM.I18N("suggest2",t)}}),BEM.decl("suggest2-input",{onSetMod:{js:{inited:function(){var t=this;t._input=t.params.input,t.disableBrowserAutocomplete(),t.realVal(t.val()),t.bindEvents({change:function(e,i){t._onChange(e,i)},clear:$.throttle(function(e,i){t._onClear(e,i)},300)}),t.bindSuggestEvents()}}},_onChange:function(t,e){this.trigger("change",e)},_onClear:function(t,e){this.trigger("clear",e)},destruct:function(){this.unbindAllEvents(),this.__base.apply(this,arguments)},get:function(){return this._input},isFocused:function(){return this._input.hasMod("focused")},focus:function(){return this._input.setMod("focused","yes"),this},blur:function(){return this._input.delMod("focused"),this},getControl:function(){return this._input.elem("control")},val:function(t,e){return this._input.val.apply(this._input,arguments)},valWithoutSuggest:function(t,e){return this._input.val.call(this._input,t,$.extend(e,{suggest:!1}))},realVal:function(t){return void 0===t?this._realVal:("string"==typeof t&&(this._realVal=t),this._realVal)},width:function(){return this._input.domElem.width()},getCaretPosition:function(){var t,e=this.getControl()[0],i=this.val().length;return document.selection?((t=document.selection.createRange()).moveStart("character",-i),t.text.length):"number"==typeof e.selectionStart?e.selectionStart:i},moveCaretToEnd:function(){var t=this.getControl()[0],e=t.value.length;if(void 0!==t.createTextRange){var i=t.createTextRange();i.collapse(!1),i.select()}else"number"==typeof t.selectionStart&&(t.scrollLeft=999999,t.setSelectionRange(e,e));return this},disableBrowserAutocomplete:function(){this.getControl().attr({autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false","aria-autocomplete":"list"})},_bindedEventsNames:[],bindEvents:function(t,e){return Object.keys(t).forEach(function(i){-1===this._bindedEventsNames.indexOf(i)&&this._bindedEventsNames.push(i),this._eventsFilter(i).on(i,t[i].bind(e||this))},this),this},bindSuggestEvents:function(){var t=this.params.suggest;return t.on({out:function(t,e){this.a11yDeactive(),this._changeValueByEvent(t,e)}},this),BEM.blocks["suggest2-item"].on(t.domElem,{tpah:this._onSuggestItemTpah,select:this._onSuggestItemSelect,enter:this._onSuggestItemEnter},this),this},_onSuggestItemTpah:function(t,e){this._changeValueByEvent(t,e),this.moveCaretToEnd()},_onSuggestItemSelect:function(t,e){"link"!==t.block.getMod("interact")&&(this._changeValueByEvent(t,e),this.moveCaretToEnd())},_onSuggestItemEnter:function(t,e){this.a11yActive(e.id),e.byKeyboard&&this.params.updateOnEnterByKeyboard&&(this._changeValueByEvent(t,e),this.moveCaretToEnd())},unbindAllEvents:function(){return this._input.domElem&&this._bindedEventsNames.forEach(function(t){var e=this._eventsFilter(t);e[e instanceof BEM.DOM?"un":"off"](t)},this),this._bindedEventsNames=[],this.params.suggest.un("out"),this},a11yActive:function(t){this.getControl().attr("aria-activedescendant",t)},a11yDeactive:function(){this.getControl().removeAttr("aria-activedescendant")},_eventsFilter:function(t){return-1!==["blur","focus","change","clear"].indexOf(t)?this._input:this.getControl()},_changeValueByEvent:function(t,e){var i=e&&void 0!==e.val?e.val:this.realVal();this.val(i,$.extend({block:t.block.__self.getName(),event:t.type},e))}}),BEM.decl("suggest2-input",{onSetMod:{js:{inited:function(){var t=this;t.__base.apply(this,arguments),t.bindEvents({keydown:function(e){t._onKeyDown(e)}},t)}}},_onKeyDown:function(t){t.which===this.params.suggest.__self.keyboard.enter&&this.trigger("enter")}}),BEM.DOM.decl("suggest2",{onSetMod:{disabled:{yes:function(){this._disabled=!0,this._clear(),this._popup.hide()},"":function(){this._disabled=!1,this.params.showPopupOnEnabled&&this._input.isFocused()&&this._doRequest()}}},getDefaultParams:function(){var t=this.__base.apply(this,arguments);return t.showPopupOnEnabled=!1,t},_onFocus:function(){this._disabled||this.__base.apply(this,arguments)},_onBlur:function(){this._disabled||this.__base.apply(this,arguments)},_doRequest:function(){this._disabled||this.__base.apply(this,arguments)},setItems:function(){this._disabled||this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"suggest2",modName:"disabled",modVal:"yes"},{_onKeyDown:function(){},_onKeyUp:function(){},_onKeyPress:function(){}}),BEM.DOM.decl({block:"suggest2",modName:"adaptive",modVal:"yes"},{init:function(){this.__base.apply(this,arguments),this._boundResizeHandler=this._resizeHandler.bind(this),this.__self._bindToWinResize(this._boundResizeHandler)},_resizeHandler:function(){this._popup.width(this.getPopupWidth())},destruct:function(){this.__self._unbindFromWinResize(this._boundResizeHandler),this._boundResizeHandler=null,this.__base.apply(this,arguments)}},{_resizeCallbacks:[],_bindToWinResize:function(t){return this._resizeCallbacks.push(t),this},_unbindFromWinResize:function(t){for(var e=0;e<this._resizeCallbacks.length;e++)if(this._resizeCallbacks[e]===t)return this._resizeCallbacks.splice(e,1),this;return this},_getResizeCallback:function(){return $.throttle(function(){var t=arguments;this._resizeCallbacks.forEach(function(e){e.apply(this,t)},this)},300,this)},live:function(){return this._resizeCallback=this._getResizeCallback(),BEM.DOM.win.on("resize",this._resizeCallback),this.__base()}}),BEM.DOM.decl({block:"suggest2",modName:"adaptive",modVal:"yes"},{_minWidth:0,_maxWidth:0,_resizeHandler:function(){this.__base.apply(this),this.afterCurrentEvent(function(){this.adjustView()})},_onShow:function(){this.__base.apply(this),this.hasMod("theme","large")&&this._applyMetricsToContent()},adjustView:function(){var t=this.__base.apply(this,arguments),e=t.minWidth,i=t.maxWidth,n=!1;return e!==this._minWidth&&(this._minWidth=e,n=!0),i!==this._maxWidth&&(this._maxWidth=i,n=!0),n&&this._popup.isShown()&&this._applyMetricsToContent(),t},_applyMetricsToContent:function(){this.__base.apply(this,arguments);var t=this.findElem("content");this._minWidth&&t.css("min-width",this._minWidth),this._maxWidth&&t.css("max-width",this._maxWidth)}}),BEM.DOM.decl({block:"suggest2",modName:"theme",modVal:"large"},{initView:function(t,e){return t=t||{},this.__base($.extend(t,{adjustable:"yes",theme:"large",group:"false"!==this.getMod("group")&&(t.group||this.getMod("group")||"type")}),e)}}),BEM.DOM.decl({block:"suggest2",modName:"theme",modVal:"large"},{getInputWidth:function(){return this._input.get().elem("control").outerWidth()}}),BEM.decl({block:"suggest2-view",modName:"theme",modVal:"large"},{buildContent:function(t,e){var i=this.__base.apply(this,arguments);return i.elemMods.theme="large",i}}),BEM.decl({block:"suggest2-view",modName:"theme",modVal:"large"},{getMinWidth:function(){return this._minWidth||0},getMaxWidth:function(){return this._maxWidth||0},setMinWidth:function(t){return this._minWidth=t,this},setMaxWidth:function(t){return this._maxWidth=t,this},getMarginLeft:function(){return this._marginLeft},setMarginLeft:function(t){return this._marginLeft=t,this},buildContent:function(t,e){var i=this.__base.apply(this,arguments),n=["min-width:"+this.getMinWidth()+"px;"],s=this.getMaxWidth();s&&n.push("max-width:"+s+"px;");var o=this.getMarginLeft();return o&&n.push("margin-left:"+o+"px;"),i.attrs={style:n.join(" ")},i}}),BEM.DOM.decl({block:"suggest2-item",modName:"personal",modVal:"yes"},{onSetMod:{js:{inited:function(){this._catchEvents&&this._crossCatchHandler&&this.bindTo("cross",this._catchEvents,this._crossCatchHandler),this.historyElem=this.elem("text").text()}}},val:function(){return this.params.val?this.params.val:this.elem("text").text()},remove:function(t){var e=this;this.domElem.one("webkitTransitionEnd transitionend",function(){e.domElem.remove(),t&&t()}),this.domElem.css("height",0)}}),BEM.DOM.decl({block:"suggest2-item",modName:"personal",modVal:"yes"},{_catchEvents:"click",_crossCatchHandler:function(t){t.preventDefault(),t.stopImmediatePropagation(),this.trigger("delete")}}),BEM.DOM.decl({block:"suggest2",modName:"adjustable",modVal:"yes"},{_marginLeft:0,init:function(){this.__base.apply(this,arguments),this.adjustView()},adjustView:function(){var t=this.__base.apply(this,arguments);this._view.setMarginLeft(t.marginLeft),this._view.setMinWidth(t.minWidth),this._view.setMaxWidth(t.maxWidth);var e=!1;return t.marginLeft!==this._marginLeft&&(this._marginLeft=t.marginLeft,e=!0),e&&this._popup.isShown()&&this._applyMetricsToContent(),t},getInputLeft:function(){var t=this._input.get().findElem("control"),e=t.offset(),i=t[0];if(!i)return 0;var n=i.currentStyle?i.currentStyle:window.getComputedStyle(i),s=parseInt(n.borderLeftWidth,10)||0,o=parseInt(n.paddingLeft,10)||0;return e.left+s+o},getInputWidth:function(){return this._input.get().domElem.outerWidth()},getContainerWidth:function(){return BEM.DOM.scope.width()},_applyMetricsToContent:function(){this.__base.apply(this,arguments);var t=this.findElem("content");this._marginLeft&&t.css("margin-left",this._marginLeft)}}),BEM.decl({block:"suggest2-view",modName:"group",modVal:"type"},{buildItems:function(t,e){var i,n;return t.reduce(function(t,e){var s=this.__self._getPrefs(e),o=this.__self._getType(e,s),r=this.__self._getGroupType(s,o);return i!==r&&(i=r,n=[],t.push({block:"suggest2",elem:"group",content:[{elem:"title",content:this.__self._getTextLabel(i)},{elem:"items",content:n}]})),n.push(this.buildItem(e)),t}.bind(this),[])}}),BEM.DOM.decl({block:"suggest2",modName:"group",modVal:"label"},{initView:function(t,e){return this.__base($.extend(t||{},{group:"label"}),$.extend(e||{},{label:this.params.label}))}}),BEM.decl({block:"suggest2-view",modName:"group",modVal:"label"},{buildItems:function(t,e){var i,n;return t.reduce(function(t,e,s){var o,r=this.__self._getPrefs(e).label||"";i!==r&&(i=r,n=[],o=r||(0===s?"":this.params.label||this.__self._getTextLabel("text")),t.push({block:"suggest2",elem:"group",content:[{elem:"title",content:o},{elem:"items",content:n}]}));return n.push(this.buildItem(e)),t}.bind(this),[])}}),BEM.decl({block:"suggest2-view",modName:"advanced",modVal:"yes"},{_getItemByType:function(t,e,i,n){var s=n.js,o=n.content,r=t[1];switch(i){case"html":s.val=r,o.push(e.body);break;case"bemjson":s.val=r,o.push.apply(o,Array.isArray(e.bemjson)?e.bemjson:[e.bemjson])}return this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"suggest2-item",modName:"interact",modVal:"link"},{onSelect:function(t){var e=this;e.__base.apply(e,arguments);var i=e.elem("link");if(t||"_self"===i.attr("target"))return function(){e._locationChange(i.attr("href"))}},_locationChange:function(t){window.location=t},valOnSelect:function(){return!1}}),BEM.DOM.decl("suggest2-form",{onSetMod:{js:{inited:function(){this._isReady=!1,this._nodes=this.initNodes()}}},getDefaultParams:function(){return{inputName:"input",buttonName:"button2",popupName:"popup"}},destruct:function(){this._nodes.forEach(function(t){t.suggest.domElem&&BEM.DOM.destruct(t.suggest.domElem),this.unbindFormEvents(t),t.counter&&t.counter.destruct(),t.proxies.input.destruct(),t.proxies.popup.destruct()},this),this.__base.apply(this,arguments)},getOwner:function(t){},isReady:function(){return this._isReady},initNodes:function(){var t=this.getNodes();return t.forEach(function(t){t.suggest.init()}),this._isReady=!0,this.trigger("ready",{nodes:t}),t},getNodes:function(){return this.getNodeList().map(function(t){var e=t.suggest,i=e.params;return i.form=this,i.input=t.input,i.popup=t.popup,i.button=t.button,t.proxies={},t.proxies.popup=i["suggest2-popup"]=BEM.create({block:"suggest2-popup",mods:$.extend({for:this.params.popupName},this.params.popupMods)},this._getNodePopupParams(e,i)),t.proxies.input=i["suggest2-input"]=BEM.create({block:"suggest2-input",mods:this.params.inputMods},this._getNodeInputParams(e,i)),t.counter&&(t.counter.params.form=this,t.counter.params.suggest=e,i.counter=t.counter),this.bindFormEvents(t),t},this)},_getNodeInputParams:function(t,e){return{suggest:t,input:e.input,updateOnEnterByKeyboard:e.updateOnEnterByKeyboard}},_getNodePopupParams:function(t,e,i){return{suggest:t,popup:e.popup,popupContentElem:this.params.popupContentElem,owner:this.getOwner(i)||e.input}},bindFormEvents:function(t){var e=this;return t.button&&t.button.bindTo("pointerclick",function(t){e._onButtonClick(t)}),e.bindTo("submit",function(t,i){e.onSubmit(t,i)}),e},_onButtonClick:function(t){this.trigger("button-click",{domEvent:t})},unbindFormEvents:function(t){return t.button&&t.button.un("pointerclick"),this.unbindFrom("submit"),this},submit:function(t){return this.domElem.trigger("submit",t||{}),this},onSubmit:function(t,e){t.data=e||{},this.trigger("submit",t)},getNodeList:function(){var t=this,e=[];return t.elem("node").each(function(i,n){var s=$(n),o=t._getFormNodeElems(s);e.push(t._getFormNodeBlocks(o,s))}),e},_getFormNodeElems:function(t){return{input:this.findElem(t,"input"),button:this.findElem(t,"button")}},_getSuggestForNode:function(t){return this.findBlockInside(t,"suggest2")},_getFormNodeBlocks:function(t,e){var i=this._getSuggestForNode(e);return{node:e,suggest:i,counter:this.findBlockOn("suggest2-counter"),input:this.findBlockOn(t.input,"input"),button:this.findBlockOn(t.button,this.params.buttonName),popup:i.findBlockOn(this.params.popupName)}},appendHiddenInputs:function(t){return BEM.DOM.append(this.domElem,BEMHTML.apply(t.map(function(t){return{block:this.__self.getName(),elem:"hidden-input",tag:"input",attrs:{type:"hidden",name:t.name,value:t.value}}},this))),this},removeHiddenInputs:function(){return BEM.DOM.destruct(this.findElem(this.domElem,"hidden-input")),this}},{live:function(){var t=this;return this.liveInitOnBlockInsideEvent("mousedown pointerdown change focus","input"),(!BEM.blocks["i-ua"].ie||BEM.blocks["i-ua"].ie>8)&&(this.liveBindTo("input","mousedown pointerdown change focus",function(e){t.disableNativeAutocomplete(e.target)}),this.disableNativeAutocompleteAll()),this.__base()},disableNativeAutocompleteAll:function(){var t=document.querySelectorAll(".suggest2-form__input .input__control");(t=Array.prototype.slice.call(t)).forEach(this.disableNativeAutocomplete.bind(this))},disableNativeAutocomplete:function(t){if("off"!==t.getAttribute("autocapitalize")){var e={autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false","aria-autocomplete":"list"};for(var i in e)t.setAttribute(i,e[i]);this.hideNativeAutocomplete(t)}},hideNativeAutocomplete:function(t){var e=document.activeElement===t;e&&t.blur(),e&&t.focus()}}),BEM.DOM.decl("suggest2-form",{_getFormNodeElems:function(t){return{input:this.findElem(t,"input"),button:this.findElem(t,"button")}}},{}),BEM.DOM.decl("suggest2-counter",{pointerStartEvent:"pointerdown",onSetMod:{js:{inited:function(){this.clear()}}},destruct:function(){this.unbindAllEvents()},getDefaultParams:function(){return{submitBySelect:!1,suggestReqID:!1,preventSubmit:!0,host:"//yandex.ru",path:"clck/jclck",dataUrl:"http://ya.ru",params:{},timeout:300}},metaProps:{exprt:"exprt",r:"region",log:"log"},clear:function(){return this._params={user_input:"",text:""},this._times=[],this._renderTimes=[],this._renderTime=0,this._path={service:this.params.service,state:"not_shown",index:0,personal:"nah_not_shown",submit:""},this._ratio={len:0,queryLen:0,actionsCount:0},this._firstChange=0,this._lastChange=0,this._sinceChange={first:0,last:0},this._selectedText="",this._session=0,this._reqID=this.__self._generateReqID(),this._meta={},this._afterSendAjaxCallback,this._startClickTime=null,this._startInputTime=null,this._requests=[],this._clicksCount=0,this._blurDuration=0,this._blurTime=null,this._blurDurationFirstChange=0,this._blurDurationLastChange=0,this},submit:function(t){var e=this.params.suggest.params["suggest2-input"],i=e.val();this._params.text=i,this._params.pos=e.getCaretPosition(),this._params.times=this._requests.map(function(t){return!t.error&&t.duration?t.duration:0}).join("."),this.params.suggestReqID&&this.attachReqID(),this._input.elem("control").blur(),this.sendAjax(this.getUrl(),$.extend({submitForm:!0,afterSendAjaxCallback:function(){}},t)),this.trigger("submit",this._getSubmitEventData()).clear(),this._params.prev_query=i},_getSubmitEventData:function(){return{path:this._path,times:this._times,render_times:this._params.times,prev_query:this._params.prev_query,user_input:this._params.user_input,text:this._params.text,pos:this._params.pos,ratio:this._ratio,since_first_change:this._sinceChange.first,since_last_change:this._sinceChange.last,session:this._session,suggest_reqid:this._reqID,meta:this._meta,url:this.getUrl()}},sendAjax:function(t,e){return $.ajax({type:"GET",url:t,dataType:"script",timeout:this._getAjaxTimeout()}).always(this._sendAjaxAlways.bind(this,e)),this},_getAjaxTimeout:function(){return this.params.timeout},afterSendAjax:function(t){return this._afterSendAjaxCallback=t,this},getUrl:function(){return this.params.host+["/",this.params.path].concat(this._getUrlParams()).join("/").replace(/(\/+)/g,"/")},_sendAjaxAlways:function(t){t||(t={}),this.params.preventSubmit&&t.submitForm&&this.params.form.submit({block:this.__self.getName(),prevent:!1}),t.afterSendAjaxCallback&&t.afterSendAjaxCallback(),this._afterSendAjaxCallback&&this._afterSendAjaxCallback()},_getUrlParams:function(){var t=this;return this._getParamsList().concat(t._getData()).reduce(function(e,i){return e.concat(t._getParams(i))},[]).concat(["/"])},_getParamsList:function(){return[this.params.params,this._getPath(),this._params,this._getRatio(),this._getSinceChange(),this._getSession(),this._getResponsesShows(),{suggest_reqid:this._reqID}]},initValues:function(){return this._params.prev_query=this.params.suggest.params["suggest2-input"].val(),this},attachReqID:function(){this._reqID=this.__self._generateReqID(),this.params.form.appendHiddenInputs([{name:"suggest_reqid",value:this._reqID}])},getCurrentReqId:function(){return this._reqID},bindEvents:function(){var t=this.params,e=t.suggest,i=t.form,n=e.getModel(),s=e.params["suggest2-input"],o=e.params["suggest2-popup"];return i.on({"button-click":this._onFormButtonClick,submit:this._onFormSubmit},this),n.on({request:this._onModelRequest,response:this._onModelResponse},this),s.on({change:this._onInputChange,enter:this._onInputEnter},this),o.on({show:this._onPopupShow},this),BEM.blocks["suggest2-item"].on(e.domElem,"enter",this._onSuggestItemEnter,this),e.on({update:this._onSuggestUpdate,select:this._onSuggestSelect},this),this._input=s._input,this._input.bindTo(this.pointerStartEvent,this._onInputClick.bind(this)).on("focus",this._onInputFocus,this),this._input.findElem("control").on("blur",this._onInputBlur.bind(this)),this},_onInputClick:function(){this._startInputTime||(this._startClickTime=Date.now())},_onClickPopup:function(){this._clicksCount++},_onInputFocus:function(){this._startInputTime||this._startClickTime||(this._startClickTime=Date.now()),this._startInputTime=this._startInputTime||this._startClickTime;var t=this._blurTime?Date.now()-this._blurTime:0;t>300&&(this._blurDuration+=t,this._blurTime=null,0!==this._lastChange&&(this._blurDurationLastChange+=t),0!==this._firstChange&&(this._blurDurationFirstChange+=t))},_onInputBlur:function(t){this._blurTime=Date.now()},_onFormButtonClick:function(){"keyboard"!==this._path.submit&&(this._path.submit="button_by_mouse")},_onFormSubmit:function(t,e){e.data.block!==this.__self.getName()&&!1!==e.data.prevent&&(this.params.preventSubmit&&(e.stopImmediatePropagation(),e.preventDefault()),this._doSubmit())},_doSubmit:function(){this.submit()},_onModelRequest:function(t,e){this._requests.push(e.request)},_onModelResponse:function(t,e){if(Object(e.data).items){var i=e.data.items;this._path.personal=this._hasPersonal(i)?"nah_not_used":"nah_not_shown",this._meta=e.data.meta||{},this._renderTime=new Date,this._setMetaProps(e),this._requests&&delete this._requests[e.val.toLowerCase()]}},_onInputChange:function(t,e){e&&"clear"!==e.source||(this._params.user_input=t.block.val(),this._firstChange=this._firstChange||new Date,this._lastChange=new Date,this._startInputTime||(this._startInputTime=this._firstChange.getTime())),this._selectedText&&(this._path.state="edit"),this._ratio.actionsCount++},_onInputEnter:function(){this._path.submit="keyboard"},_onPopupShow:function(){"not_shown"===this._path.state&&(this._path.state="not_used")},_onSuggestItemEnter:function(t,e){e.byKeyboard&&this.params.suggest.params.updateOnEnterByKeyboard&&(this._selectedText=e.val,this._path.state="suggest")},_onSuggestUpdate:function(){this._addRenderTime(new Date-this._renderTime)},_onSuggestSelect:function(t,e){this._path.state=e.byKeyboard?"keyboard":"mouse",this._path.index=e.itemIndex+1,this._selectedText=e.val,e.item.hasMod("personal")&&(this._path.personal="nah_used"),"link"===e.item.getMod("interact")&&this._safeclickCount(t,e),this.params.submitBySelect&&(this._path.submit=e.byKeyboard?"keyboard":"click_by_mouse",this._params.pos=e.pos,this._params.text=this._selectedText),this.params.suggest.isNeedSubmitFormOnSelectItem(e.item)||this.submit({submitForm:!1,afterSendAjaxCallback:e.callbackOnSelect})},_safeclickCount:function(t,e){var i=t.block&&t.block.params.safeclickUrl||e.item&&e.item.params.safeclickUrl;i&&(this._addMetrikaCookie(e.item||t.block),(new Image).src=i)},_addMetrikaCookie:function(t){var e=this.params.suggest.getModel().lastSendedRequest.val,i=this.params.suggest.getModel().lastSendedRequest.reqId,n=[e,t.elem("link").attr("href"),this._getNavSource(),i].map(encodeURIComponent).join(":"),s=Date.now();document.cookie="sc_"+s+"="+n+";path=/watch;domain=."+location.hostname.replace(/^www\./,"")+";expires="+new Date(s+1e3).toUTCString()+";secure"},_getNavSource:$.noop,unbindAllEvents:function(){var t=this.params,e=t.suggest,i=t.form,n=e.params["suggest2-popup"];return i.un("button-click").un("submit"),e.getModel().un("request").un("response"),e.params["suggest2-input"].un("change").un("enter"),n.un("show").un("hide"),e.un("select"),this},_hasPersonal:function(t){return t.some(function(t){return 1===BEM.blocks["suggest2-view"]._getPrefs(t).pers})},_setMetaProps:function(t){t.data.meta&&Object.keys(this.metaProps).forEach(function(e){this._params[this.metaProps[e]]=t.data.meta[e]||""},this)},_getParams:function(t){return Object.keys(t).reduce(function(e,i){return""===t[i]?e:(e.push(i+"="+encodeURIComponent(t[i]).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%2C/g,",").replace(/\*/g,"%2A")),e)},[])},_getPath:function(){return{path:[this._path.service,this._path.state,"p"+this._path.index,this._path.personal,this._path.submit].join(".")}},_getSession:function(){return this._session=(new Date).getTime()+Math.round(1e4*Math.random()),{session:this._session}},_getSinceChange:function(){return{since_first_change:this._getSinceTime("first"),since_last_change:this._getSinceTime("last"),total_input_time:this._getTotalInputTime()}},_getSinceTime:function(t){var e="_"+t+"Change";return this._sinceChange[t]=this[e]?Date.now()-this[e]-("first"===t?this._blurDurationFirstChange:this._blurDurationLastChange):0,this._sinceChange[t]},_getTotalInputTime:function(){return this._startInputTime&&Date.now()-this._startInputTime-this._blurDuration||0},_getResponsesShows:function(){return this._requests.reduce(function(t,e){return t.rqs++,e.error||(e.responseTime&&t.rsp++,0===e.itemsCount&&t.ersp++,e.fromCache&&t.cchd++),t},{rqs:0,rsp:0,rndr:this._renderTimes.length,ersp:0,clks:this._clicksCount,cchd:0})},_getRatio:function(){return this._ratio.len=this._params.user_input.length,this._ratio.queryLen=this._params.text.length,{ratio:[this._ratio.len,this._ratio.queryLen,this._ratio.actionsCount].join(".")}},_addRenderTime:function(t){return this._renderTimes.push(t),this._params.render_times=this._renderTimes.join("."),this},_getData:function(){return{"*data":"url="+this.params.dataUrl}}},{_generateReqID:function(){return(BEM.blocks["i-global"]&&BEM.blocks["i-global"].param("yandexuid")?BEM.blocks["i-global"].param("yandexuid"):this._random(9)+this._random(9))+String(Date.now()).slice(-7)+this._random(7)},_random:function(t){return Math.random().toString().slice(-Math.min(t,10))}},{live:function(){this.liveInitOnBlockEvent("init","suggest2-form")}}),BEM.DOM.decl("suggest2-counter",{bindEvents:function(){this.__base.apply(this,arguments);var t=this.params.suggest;return BEM.blocks["suggest2-item"].on(t.domElem,"pointerclick",this._onClickPopup.bind(this)),this}}),BEM.DOM.decl("suggest2-counter",{bindEvents:function(){return BEM.blocks["b-page"].on("beforeContentLoad",this._onAjaxRequest,this),this.__base.apply(this,arguments),this},_doSubmit:function(){this._formSubmit=!0},_onAjaxRequest:function(){this._formSubmit&&"not_shown"!==this._path.state&&(this._formSubmit=!1,this.submit())},unbindAllEvents:function(){return this.__base.apply(this,arguments),BEM.blocks["b-page"].un("beforeContentLoad",this._onAjaxRequest),this}}),BEM.DOM.decl("suggest2-counter",{_onFormSubmit:function(t,e){e.data&&e.data.notSendCounter||this.__base.apply(this,arguments)}}),BEM.decl({block:"suggest2-popup",modName:"for",modVal:"popup2"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._popup.on("beforeClose",function(){this.afterCurrentEvent(function(){BEM.blocks["suggest2-detect"].isPressedEscape()&&this.trigger("hide",{})})},this)}}},_setPosition:function(){this._popup.setAnchor(this.params.owner),this._popup.setMod("visible","yes")},_doHide:function(t){this._popup.delMod("visible")},isShown:function(){return!!this._popup&&this._popup.hasMod("visible")}}),BEM.DOM.decl({block:"popup2",modName:"fixed",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._anchor=null,this._lastDrawingCss={left:void 0,top:void 0}}},visible:{yes:function(){if(!this._anchor)throw new Error("Can't show popup without anchor");this.setMod("outside","yes").redraw().delMod("outside"),this.__base.apply(this,arguments)}}},show:function(t){return this.setAnchor(t).setMod("visible","yes")},hide:function(){return this.delMod("visible")},setAnchor:function(t){return this._anchor=t instanceof BEM.DOM?t.domElem:t,this},redraw:function(){if(!this.hasMod("visible","yes")&&!this.hasMod("outside","yes"))return this;var t=this._lastDrawingCss,e=!1;return $.each(this._calcDrawingParams(),function(i,n){t[i]!==n&&(t[i]=n,e=!0)}),e&&this.domElem.css(t),this},_calcDrawingParams:function(){var t=this._calcAnchorDimensions();return{left:t.left,top:t.top+t.height}},_calcAnchorDimensions:function(){var t=this._anchor,e=t.offset(),i=BEM.DOM.win;return{left:e.left-i.scrollLeft(),top:e.top-i.scrollTop(),width:t.outerWidth(),height:t.outerHeight()}},_calcZIndexGroupLevel:function(){var t=this.__base.apply(this,arguments);return this.findBlocksOutside(this._anchor,"z-index-group").reduce(function(t,e){return t+Number(e.getMod("level"))},t)}}),BEM.DOM.decl({block:"search2",modName:"cbir",modVal:"yes"},{_onSubmit:function(t,e){this.trigger("search:submit",{event:t,data:e}),t.preventDefault()},getErrorTargetDomElem:function(){return this.elem("input")}}),BEM.DOM.decl({block:"suggest2-form",modName:"extra-popup",modVal:"yes"},{onSetMod:{js:{inited:function(){this._page=this.findBlockOn(BEM.DOM.scope,"b-page"),this.__base.apply(this,arguments)}}},_getSuggestForNode:function(t){var e=this.params["extra-popup-id"];if(e){var i=this._page.domElem.find("#"+e);return t.append(i),this.findBlockOn(i,"suggest2")}return this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"suggest2",modName:"history",modVal:"yes"},{init:function(){return this.__base.apply(this,arguments),this._history=this.findBlockOn("suggest2-history"),this._historyData=this._history.getData(),this._history.on("update",this._onUpdate,this),this._boundAfterDomElemRemove=this._afterDomElemRemove.bind(this),this._updateHistory(),BEM.DOM.blocks["suggest2-item"].on(this.domElem,"delete",this._deleteHistoryItem,this),this},unbindAllEvents:function(){this._history.un("update"),this.__base.apply(this,arguments)},getDefaultParams:function(){return $.extend(this.__base(),{needRequestWithHistory:!1})},_onUpdate:function(t,e){this._historyData=e,this._updateHistory()},_updateHistory:function(){this._historyItems=this._getHistoryItems(),this._historyHtml=null},_deleteHistoryItem:function(t){var e=t.block.historyElem;$.ajax({url:this.params.deleteHistoryUrl+encodeURIComponent(e),method:"GET",dataType:"json",xhrFields:{withCredentials:!0}}).then(this._afterQueryRemove.bind(this,e,t.block))},_afterQueryRemove:function(t,e,i){BEM.DOM.blocks["suggest2-history"].updateState(),(this._findAndRemove(this._historyData.running,t)||this._findAndRemove(this._historyData.other,t))&&this._updateHistory(),e.remove(this._boundAfterDomElemRemove)},_afterDomElemRemove:function(){""===this._input.val()&&0===this._historyItems.length&&(this._model.reset(),this._doRequest())},_findAndRemove:function(t,e){var i=t.indexOf(e);return i>=0&&(t.splice(i,1),!0)},setItems:function(){if(!1===this._isShowHistory())return this.__base.apply(this,arguments)},_doRequest:function(){this._isShowHistory()?(this._showHistory(),this.params.needRequestWithHistory?this.__base.apply(this,arguments):this._model.reset()):this.__base.apply(this,arguments)},_isShowHistory:function(){return this._historyData&&""===this._input.val()&&this._historyItems.length>0},_showHistory:function(){this._historyHtml||(this._historyHtml=this._view.html(this._historyItems,{historyMod:!0})),this._popup.show(this._historyHtml),this._items=this.findBlocksInside("suggest2-item"),this.trigger("update-history",{items:this._historyItems})},_getHistoryItems:function(){var t=this._generateItems(this._historyData.running),e=this._historyData.other&&this._historyData.other.length>0?this._generateItems(this._historyData.other,BEM.I18N("suggest2","on_other_devices")):[];return e.length>0?t.concat(e):t},_generateItems:function(t,e){var i=this._view.__self._getPersonalProps(e),n=this._getPersonalItemType();return(t||[]).map(function(t){return[n,t,i]})}}),BEM.DOM.decl({block:"suggest2",modName:"history",modVal:"yes"},{_showHistory:function(){this.__base.apply(this,arguments),this._applyMetricsToContent()},_applyMetricsToContent:function(){this.__base.apply(this,arguments);var t=this.findElem("content");t.width(Math.min(t.width()+1,this._maxWidth))},_getPersonalItemType:function(){return"text"}}),BEM.DOM.decl({block:"suggest2",modName:"history",modVal:"yes"},{_showHistory:function(){var t=this._historyItems.some(function(t){return"yes"===t.cbir});this.hasMod("cbir","yes")&&!t&&this._historyItems.unshift({cbir:"yes"}),this.__base.apply(this,arguments)}}),BEM.decl({block:"suggest2-provider",modName:"history",modVal:"yes"},{getRequestData:function(t,e,i){return $.extend(this.__base.apply(this,arguments),{hs:BEM.DOM.blocks["suggest2-history"].getState()})}}),BEM.DOM.decl("suggest2-history",{_defaultParams:{running:[],other:[]},getDefaultParams:function(){return $.extend(this.__base(),this._defaultParams)},onAjaxSuccess:function(t){this.params=$.extend(this._defaultParams,t.params||{}),this.__self.updateState(),this.trigger("update",this.params)},getData:function(){return this.params}},{_state:0,updateState:function(){this._state++},getState:function(){return this._state}}),BEM.DOM.decl({block:"suggest2-history"},{},{live:function(){this.liveInitOnBlockOutsideEvent("suggestHistoryReceived","b-page",function(t,e){this.onAjaxSuccess(e)})}}),BEM.DOM.decl({block:"serp-header",modName:"slide-auto-hide",modVal:!0},{_contentTopOffset:65,onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._scrolled=window.pageYOffset||document.documentElement.scrollTop,this._bindEvents()}}},destruct:function(){this._unbindEvents(),this.__base.apply(this,arguments)},_bindEvents:function(){BEM.blocks["b-page"].on("scroll",this._toggleSlideVisible,this)},_unbindEvents:function(){BEM.blocks["b-page"].un("scroll",this._toggleSlideVisible,this)},_toggleSlideVisible:function(){var t=window.pageYOffset||document.documentElement.scrollTop;t>this._contentTopOffset&&t>this._scrolled?(this.setMod("slide-hidden","yes"),this._scrolled=t,BEM.channel("header").trigger("hidden",!0)):t<this._scrolled&&(this.setMod("slide-hidden","no"),this._scrolled=t,BEM.channel("header").trigger("hidden",!1))}}),BEM.DOM.decl("cbir-panel",{onSetMod:{js:{inited:function(){this.detectDragDrop()&&this.setMod("dragdrop","yes"),this.findBlocks().bindEvents()}}},detectDragDrop:function(){var t=$("<div />")[0];return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&!window.opera&&(!BEM.blocks["i-ua"].ie||BEM.blocks["i-ua"].ie>=10)},findBlocks:function(){return this.file=this.elem("file-input"),this.input=this.findBlockInside({block:"input",modName:"type",modVal:"cbir"}),this},bindEvents:function(){return this.bindTo("find-button","pointerclick",this._onFindButtonClick).bindTo(this.file,"change",this._onFileChange).bindTo("input","pointerclick",this._onInputBoxClick).bindTo("input","submit",this._onFormSubmit).bindTo("close","keypress",this._onCloseKeyboard).bindTo("close","pointerclick",this._onCloseClick).bindTo("input","keydown",this._onInputChange),this.input.on("clear change",this._onValueChange,this),BEM.blocks["i-keyrouter"].on("esc",this.hidePanel,this),BEM.blocks["b-page"].on("contentLoaded",this.hidePanel,this),this},destruct:function(){BEM.blocks["i-keyrouter"].un("esc",this.hidePanel,this),this.unbindFromDoc("pointerclick",this._onOutsideClick),this.input.un("clear change",this._onValueChange,this),BEM.blocks["b-page"].un("contentLoaded",this.hidePanel,this),this.__base.apply(this,arguments)},getController:function(){return BEM.blocks["i-cbir-controller"].get()},_onFindButtonClick:function(){this.getController().submit()},_onCloseClick:function(){this.hidePanel()},_onCloseKeyboard:function(t){13!==t.which&&32!==t.which||(t.preventDefault(),this.hidePanel())},_onInputBoxClick:function(){this.input.setFocus()},_onFormSubmit:function(t){t.preventDefault(),this.getController().submit()},_onOutsideClick:function(t){this.hasMod("visibility","visible")&&(this.containsDomElem($(t.target))||this.hidePanel())},_onInputChange:function(t){switch(t.keyCode){case 13:this.getController().submit();break;case 27:this.hidePanel()}},_onValueChange:function(t){this.blockInside({block:"button",modName:"type",modVal:"cbir"}).toggleMod("disabled","yes",!t.block.val()||"clear"===t.type)},_onFileChange:function(t){this.trigger("filechange",t)},showPanel:function(t){var e=this;return this.getController().runCBIRRequest().showParanja(),this.domElem.fadeIn(250,function(){e.setMod("visibility","visible")}),t&&this.input.setFocus(),this.bindToDoc("pointerclick",this._onOutsideClick),this},hidePanel:function(){if(!this.hasMod("visibility","visible"))return this;var t=this;return this.getController().cancelCBIRRequest().hideParanja(),this.input.val(""),this.domElem.fadeOut(250,function(){t.setMod("visibility","hidden")}),this.getController().hideError(),this.unbindFromDoc("pointerclick",this._onOutsideClick),this},clearFileInput:function(){return BEM.blocks["i-ua"].ie?setTimeout(function(){this.file=this.file.clone(!0),this.file.replaceWith(this.file)}.bind(this),100):this.file.val(""),this},val:function(){return this.input.val().replace(/^\s+|\s+$/g,"")},setThreateningLook:function(){this.setMod(this.elem("input"),"error","yes")},unsetThreateningLook:function(){this.delMod(this.elem("input"),"error")},getErrorTargetDomElem:function(t){return"url"===t?this.elem("input"):this.elem("dragzone")}},{live:!0}),BEM.DOM.decl({block:"cbir-panel",modName:"dragdrop",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._panelShowedByDrag=!1}}},hidePanel:function(){return this.__base.apply(this,arguments),this._panelShowedByDrag=!1,this},_processGlobalDragEvent:function(t){switch(t.type){case"dragstart":return this._onGlobalDragStart(t);case"dragend":return this._onGlobalDragEnd(t);case"dragover":return this._onGlobalDragOver(t)}},_onGlobalDragStart:function(t){var e=t.originalEvent.dataTransfer,i=$(t.target);if(i.is("img")||(i=i.find("img:eq(0)")),0!==i.length){var n=i.attr("src");0===n.indexOf("//")&&(n=location.protocol+n);try{e.setData("text/uri-list",n)}catch(t){}e.setData("text",n)}},_onGlobalDragEnd:function(t){this._panelShowedByDrag&&(this._uninstallDragendHack(),this.hidePanel())},_onGlobalDragOver:function(t){this.hasMod("visibility","visible")||(this.showPanel(),this._installDragendHack(),this._panelShowedByDrag=!0)},_processDragZoneDragEvent:function(t){t.preventDefault(),this._toggleStroke("dragleave"!==t.type)},_onDragZoneDrop:function(t){t.preventDefault(),this._panelShowedByDrag=!1,this._toggleStroke(!1),this._uninstallDragendHack(),this.getController().hideError();var e=t.originalEvent.dataTransfer,i=this._getFirstDataTransferFile(e),n=this._getDataTransferUrl(e);i&&!n?(this.trigger("drag-file",{fileType:i.type,fileSize:i.size}),this.getController().tryUploadFile(i)):n&&(this.trigger("drag-url",{url:n}),this.getController().tryUploadURL(n))},_installDragendHack:function(){this._installedDragendHack||(this._installedDragendHack=this._dragendHack.bind(this),document.addEventListener("mousemove",this._installedDragendHack))},_uninstallDragendHack:function(){this._installedDragendHack&&(document.removeEventListener("mousemove",this._installedDragendHack),this._installedDragendHack=void 0)},_dragendHack:function(){this._panelShowedByDrag&&(this._uninstallDragendHack(),this.hidePanel())},_toggleStroke:function(t){this.setMod(this.elem("wrap"),"hover",t?"yes":"")},_getFirstDataTransferFile:function(t){if(t.items)for(var e=0;e<t.items.length;e++)if("file"===t.items[e].kind)return t.items[e].getAsFile();return t.files.length>0?t.files[0]:null},_getDataTransferUrl:function(t){var e=null;try{e=t.getData("text/uri-list")}catch(t){}if(!e)try{e=this._extractImageUrlFromHtml(t.getData("text/html"))}catch(t){}return e||(e=t.getData("text")),e},_extractImageUrlFromHtml:function(t){var e=t.match(/<img.*?src=['"](.+?)['"]/i);return e&&e[1]}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("dragzone","dragenter dragover dragleave",function(t){this._processDragZoneDragEvent(t)}).liveBindTo("dragzone","drop",function(t){this._onDragZoneDrop(t)}).liveBindToDoc("dragstart dragend dragenter dragover",function(t){this._processGlobalDragEvent(t)})}}),BEM.DOM.decl("i-cbir-controller",{onSetMod:{js:{inited:function(){this.findBlocks()}}},findBlocks:function(){return this.cbirPanel=this.findBlockInside("cbir-panel"),this.cbirError=this.findBlockInside("cbir-error"),this.cbirIntent=this.findBlockInside("cbir-intent"),this.search=BEM.blocks["serp-header"].getSearch(),this.layout=this.findBlockInside("page-layout"),this.paranja=this.findBlockInside("paranja"),this._location=BEM.blocks.location.getInstance(),this},_onPageChange:function(){var t=this._location.getState().block;"b-page_type_search-by-image"!==t&&this.setCachedUrl(""),-1===["b-page_type_search-by-image","b-page_type_similar"].indexOf(t)&&this.clearIntent()},_onCbirClick:function(){this.showPanel(!0)},showError:function(t){return this.getRequestStatus()?this.cbirError.showError(t,this.cbirPanel):this.cbirError.showError(t,this.search),this},hideError:function(){return this.cbirError.hideError(),this},showPanel:function(t){return this.cbirPanel.showPanel(t),this},hidePanel:function(){return this.cbirPanel.hidePanel(),this},getRequestStatus:function(){return this.__self.getRequestStatus()},setRequestStatus:function(t){return this.__self.setRequestStatus(Boolean(t)),this},cancelCBIRRequest:function(){return this.setRequestStatus(!1),this},runCBIRRequest:function(){return this.setRequestStatus(!0),this},clearIntent:function(){return this.cbirIntent.clearThumb(),this},showLoader:function(){return this.cbirIntent.makeIntentLoading(),this},hideLoader:function(){return this.cbirIntent.makeIntentNormal(),this},showParanja:function(){return this.layout.toggleCBIRMode(!0),this.paranja.setTheme("dark").open(),this},hideParanja:function(){return this.layout.toggleCBIRMode(!1),this.paranja.delTheme().close(),this}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockEvent("change","b-page",function(){this._onPageChange()}).liveInitOnReactBusEvent("cbir-landing:cbir-click",function(){this._onCbirClick()}).liveInitOnBlockInsideEvent("cbir-click","input",function(){this._onCbirClick()}).liveInitOnBlockInsideEvent("showParanja","cbir-error",function(){this.showParanja()}).liveInitOnBlockInsideEvent("hideParanja","cbir-error",function(){this.hideParanja()})},_instance:null,getRequestStatus:function(){return this.isRequestRunning},setRequestStatus:function(t){this.isRequestRunning=Boolean(t)},get:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName()))}}),BEM.decl("i-cbir-controller",{validateFile:function(t){return this.isValidFile(t)?!!this.isValidFileSize(t)||(this.showError("size"),!1):(this.showError("format"),!1)},isValidFile:function(t){return t&&/image.*/.test(t.type)},isValidFileSize:function(t){var e=BEM.blocks["i-global"].getFlag("images_cbir_upload_max_size"),i="number"==typeof e?e:8;return t.size<=1024*i*1024},validateURL:function(t){return t.indexOf("http")&&(t="http://"+t),BEM.blocks.uri.isAcceptable(t)}}),function(){var t;BEM.decl("i-cbir-controller",{setCachedUrl:function(e){t=e},checkCachedUrl:function(e){return t===e}})}(),BEM.decl("i-cbir-controller",{linkBlockName:"b-page_type_search-by-image__link",queryArgs:{rpt:"imageview"},_makeUrl:function(t){return BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,BEM.blocks["i-url-controller"].mergePassedUrlParams(BEM.blocks["serp-controller"].getUrlRequestParams(),this.queryArgs,{format:"json",request:JSON.stringify({blocks:[{block:this.linkBlockName}]})},t))},_uploadFile:function(t){this.trigger("image-upload-start",{fileType:t.type,fileSize:t.size});var e=new FormData;return this.setRequestStatus(!0),e.append("upfile",t),this.fade(),this.showLoader(),$.ajax({type:"post",url:this._makeUrl(),data:e,dataType:"json",context:this,cache:!1,contentType:!1,processData:!1,success:this._onUploadSuccess.bind(this,t),error:this._onUploadError.bind(this,t)}),this},_onUploadSuccess:function(t,e,i,n){if(e&&"captcha"===e.type&&e.captcha&&e.captcha["captcha-page"])return window.c.hit({dtype:"stred",pid:40,cid:72952,path:BEM.blocks["i-global"].param("project").replace("/",".")}),void window.location.assign(e.captcha["captcha-page"]);var s=BEM.blocks.utils.get(e,"blocks.0.params.url");s?(this.trigger("image-upload-success",{fileType:t.type,fileSize:t.size,urlParams:s}),this._loadCbirPageAfterUpload(s)):this._onUploadError(t,n)},_onUploadError:function(t,e){this.trigger("image-upload-error",{fileType:t.type,fileSize:t.size,statusCode:e?e.status:"",result:e&&e.responseJSON?e.responseText:""}),this.showUploadError()},_uploadURL:function(t){var e=this;-1===(t=BEM.blocks.utils.unescape(t)).indexOf("://")&&(t=location.protocol+"//"+t),this.fade().checkImageAccessibility(t).done(function(t){e.setRequestStatus(!0).showLoader().setCachedUrl(t),BEM.blocks.location.getInstance().change({block:"b-page_type_search-by-image",url:BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,Object.assign({url:t},e.queryArgs))}),BEM.blocks["b-page"].getInstance().scrollTo(0,100)}).fail(function(){e.showError("url").unfade()})},checkImageAccessibility:function(t){var e,i=$.Deferred(),n=!1,s=new Image;return s.onload=function(){n||(clearTimeout(e),n=!0,i.resolve(t))},s.onerror=function(){n=!0,clearTimeout(e),i.reject()},e=setTimeout(s.onerror,3e5),s.src=t,s.complete&&s.onload(),i.promise()},tryUploadURL:function(t){if(t)if(this.validateURL(t)){if(this.checkCachedUrl(t))return;this._uploadURL(t)}else this.showError("url")},tryUploadFile:function(t){this.validateFile(t)?this._uploadFile(t):this.clearFileInput()},showUploadError:function(){this.hideLoader().showError("upload").unfade()}}),BEM.decl("i-cbir-controller",{_onSearchSubmit:function(t,e){this.processSubmitEvent(e.event,e.data)},processSubmitEvent:function(t,e){!1!==this.submit()&&(this.search.submit(t,e),this.search.countSubmit())},submit:function(){if(this.isCBIRRequest()||this.isExcessSearch()){var t=this.getURL();return""!==t&&this.tryUploadURL(t),!1}return!0},isCBIRRequest:function(){return this.getRequestStatus()},getURL:function(){return this.isCBIRRequest()?this.cbirPanel.val():this.search.val()},isExcessSearch:function(){return""===this.getURL()&&"b-page_type_search-by-image"===this._location.getState().block}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("search:submit","search2",function(t,e){this._onSearchSubmit(t,e)})}}),BEM.decl("i-cbir-controller",{fade:function(){return this.trigger("fade"),this},unfade:function(){return this.trigger("unfade"),this}}),BEM.DOM.decl("i-cbir-controller",{_onFileChange:function(t){var e=this.getFileFromEvent(t);e?this.tryUploadFile(e):this.showError("format")},getFileFromEvent:function(t){return t.target&&t.target.files?t.target.files[0]:t.dataTransfer&&t.dataTransfer.files?t.dataTransfer.files[0]:null},clearFileInput:function(){return this.cbirPanel.clearFileInput(),this}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("filechange","cbir-panel",function(t,e){this._onFileChange(e)})}}),BEM.DOM.decl("i-cbir-controller",{_getCbirUrlAfterUpload:function(t){var e={rpt:"imageview",cbir_id:t.cbirId,from:void 0};return BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,BEM.blocks["i-url-controller"].mergePassedUrlParams(e))},_isCbirIdSameAfterUpload:function(t){return t===BEM.blocks.uri.getParamValue("cbir_id")},_loadCbirPageAfterUpload:function(t){this.clearFileInput().hideLoader();var e=BEM.blocks.uri.getParamValue("?"+t,"cbir_id");!e||this._isCbirIdSameAfterUpload(e)?this.unfade().hidePanel():(this.setCachedUrl(""),this._location.change({block:"b-page_type_search-by-image",url:this._getCbirUrlAfterUpload({cbirId:e})}))}}),BEM.decl("downscale",{resize:function(t,e,i){var n=window.URL?window.URL:window.webkitURL,s=n.createObjectURL(t);return this._loadImage(s).then(this._getOrientation.bind(this,t)).then(this._putImageOnCanvas.bind(this)).then(this._resizeImage.bind(this,e,i)).always(n.revokeObjectURL.bind(this,s))},canvasToBlob:function(t,e,i){var n=$.Deferred();try{i.toBlob(n.resolve,t,e)}catch(t){n.reject(t)}return n.promise()},shouldEnable:function(){var t=window.URL||window.webkitURL,e=BEM.blocks["i-ua"].ios,i=BEM.blocks["i-ua"].android;return!(!t||!t.createObjectURL)&&(!(e&&parseFloat(e)<7.1)&&!(i&&parseFloat(i)<4.4))},_getOrientation:function(t,e){var i,n=$.Deferred(),s=new FileReader;return s.onload=function(t){if(65496!==(i=new DataView(t.target.result)).getUint16(0,!1))return n.resolve(e,-2);for(var s,o,r,a=i.byteLength,h=2;h<a;)if(s=i.getUint16(h,!1),h+=2,65505===s){o=18761===i.getUint16(h+=8,!1),h+=i.getUint32(h+4,o),r=i.getUint16(h,o),h+=2;for(var c=0;c<r;c++)if(274===i.getUint16(h+12*c,o))return n.resolve(e,i.getUint16(h+12*c+8,o))}else{if(65280!=(65280&s))break;h+=i.getUint16(h,!1)}return n.resolve(e,-1)},s.error=n.reject,s.readAsArrayBuffer(t[File.prototype.webkitSlice?"webkitSlice":"slice"](0,65536)),n.promise()},_putImageOnCanvas:function(t,e){var i=this._getSizeByOrientation(t,e),n=this._getMaxSize(i),s=i.transform,o=document.createElement("canvas"),r=o.getContext("2d");return o.width=n.width,o.height=n.height,"left"===s?(r.setTransform(0,-1,1,0,0,n.height),r.drawImage(t,0,0,n.height,n.width)):"right"===s?(r.setTransform(0,1,-1,0,n.width,0),r.drawImage(t,0,0,n.height,n.width)):"flip"===s?(r.setTransform(-1,0,0,-1,n.width,n.height),r.drawImage(t,0,0,n.width,n.height)):(r.setTransform(1,0,0,1,0,0),r.drawImage(t,0,0,n.width,n.height)),o},_getMaxSize:function(t){var e,i,n=t.width/t.height,s={};return t.width*t.height>5e6?t.width>t.height?(e=Math.sqrt(5e6*n),s={width:Math.floor(e),height:Math.floor(5e6/e)}):(i=Math.sqrt(5e6/n),s={width:Math.floor(5e6/i),height:Math.floor(i)}):s=t,s.width>4096&&(s.width=4096,s.height=Math.round(s.width/n)),s.height>4096&&(s.height=4096,s.width=Math.round(n*s.height)),s},_getSizeByOrientation:function(t,e){var i,n,s="none";return 8===e?(i=t.height,n=t.width,s="left"):6===e?(i=t.height,n=t.width,s="right"):3===e?(i=t.width,n=t.height,s="flip"):(i=t.width,n=t.height),{width:i,height:n,transform:s}},_resizeImage:function(t,e,i){var n=i.width/i.height,s=$.Deferred();return e<t?e=Math.round(t/n):t=Math.round(e*n),this.shouldResizeImage(i,t,e)?(this._initResize(i.width,t,e),this._stepResize(i,t,e,s.resolve.bind(s)),s.promise()):s.resolve(i)},shouldResizeImage:function(t,e,i){return t.width>e&&t.height>i},_initResize:function(t,e,i){this._steps=Math.ceil(Math.log(t/e)/Math.LN2),this._currentWidth=e*Math.pow(2,this._steps-1),this._currentHeight=i*Math.pow(2,this._steps-1)},_stepResize:function(t,e,i,n){this._steps&&this.shouldResizeImage(t,e,i)?this.afterCurrentEvent(this._stepResizeDelay.bind(this,t,e,i,n)):n(t)},_stepResizeDelay:function(t,e,i,n){var s=document.createElement("canvas");s.width=this._currentWidth,s.height=this._currentHeight,s.getContext("2d").drawImage(t,0,0,this._currentWidth,this._currentHeight),t.width=1,t.height=1,t=s,this._currentWidth=Math.round(this._currentWidth/2),this._currentHeight=Math.round(this._currentHeight/2),--this._steps,this._stepResize(t,e,i,n)},_loadImage:function(t){var e=$.Deferred(),i=new Image;return i.onload=e.resolve.bind(this,i),i.onerror=e.reject.bind(this,i),i.src=t,e.promise()}}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),s=n.length,o=new Uint8Array(s),r=0;r<s;r++)o[r]=n.charCodeAt(r);t(new Blob([o],{type:e||"image/jpeg"}))}}),BEM.DOM.decl("cbir-error",{onSetMod:{js:function(){this.setTexts().findBlocks().bindEvents(),this.params.searchError&&(this.afterCurrentEvent(this.showSearchError),BEM.blocks.location.getInstance().change({url:BEM.blocks.uri.delParams(["cbirerror"]),history:!1,trigger:!1}))}},findBlocks:function(){return this.popupUser=this.findBlockOn(this.elem("popup","type","user"),"popup"),this.popupSearch=this.findBlockOn(this.elem("popup","type","search"),"popup"),this.popupSearch&&(this.closeSearchErrorButton=this.findBlockOn(this.elem("close-error-button"),"button")),this},bindEvents:function(){this.popupUser.on("hide",this._onUserPopupHide,this),this.popupSearch&&(this.popupSearch.on("hide",this._onSearchPopupHide,this),this.closeSearchErrorButton.on("click",this._onCloseErrorClick,this))},destruct:function(){this.popupUser.un("hide",this._onUserPopupHide,this).destruct(),this.popupSearch&&(this.closeSearchErrorButton.un("click",this._onCloseErrorClick,this),this.popupSearch.un("hide",this._onSearchPopupHide,this).destruct()),this.__base.apply(this,arguments)},setTexts:function(){return this.errorTexts={size:BEM.I18N("cbir-error_spok_yes","Слишком большой файл, попробуйте загрузить другую картинку."),format:BEM.I18N("cbir-error_spok_yes","Неправильный формат загружаемого файла. Попробуйте загрузить файл изображения."),upload:BEM.I18N("cbir-error_spok_yes","Картинка не загрузилась, попробуйте загрузить другую."),url:BEM.I18N("cbir-error_spok_yes","По указанному адресу не смогли найти картинку, попробуйте ввести другой адрес.")},this},_onCloseErrorClick:function(){this.popupSearch.hide()},_onUserPopupHide:function(){this.delMod(this.elem("input"),"error"),this.hidePopupTimeout&&(clearTimeout(this.hidePopupTimeout),this.hidePopupTimeout=null)},_onSearchPopupHide:function(){this.trigger("hideParanja")},hideError:function(){return this.popupUser.hide(),this.popupSearch&&this.popupSearch.hide(),this._lastErrorTager&&(this._lastErrorTager.unsetThreateningLook(),this._lastErrorTager=null),this},showSearchError:function(){return this.popupSearch.show(),this.trigger("showParanja"),this},showError:function(t,e){var i=this.errorTexts[t],n=this;return i?(this.popupUser.elem("error-text").text(i),"url"===t&&e.setThreateningLook&&(this._lastErrorTager=e,e.setThreateningLook()),this.popupUser.show(e.getErrorTargetDomElem(t)),this.hidePopupTimeout=setTimeout(function(){n.hidePopupTimeout=null,n.hideError()},5e3),this):this}}),BEM.DOM.decl("tooltip-owner",{onSetMod:{js:{inited:function(){this.findBlocks().bindEvents()}}},findBlocks:function(){return this.tooltip=this.findBlockInside("tooltip"),this},bindEvents:function(){return this.bindTo("mouseleave",this._onMouseOut),this},destruct:function(){this.unbindFrom("mouseleave",this._onMouseOut),this.__base.apply(this,arguments)},show:function(){this.hasMod("disabled",!0)||this.tooltip.setOwner(this.domElem).show()},hide:function(){this.tooltip.hide()},setContent:function(t){this.tooltip.setContent(t)},_onMouseOver:function(){this.show()},_onMouseOut:function(){this.hide()},_onClick:function(){this.hide()}},{live:function(){this.liveInitOnEvent("mousemove"),this.liveBindTo("pointerclick",function(t){this._onClick(t)}),this.liveBindTo("pointerover",function(t){BEM.blocks["i-global"].param("mobile")||this._onMouseOver(t)})}}),BEM.DOM.decl("under-menu",{_onToggleClick:function(){this.hasMod("show-filters")?(this.blockInside("advanced-search").hideFilters(),this.delMod("show-filters"),this._hitCounter("hide")):(this.blockInside("advanced-search").showFilters(),this.setMod("show-filters","yes"),this._hitCounter("show"))},_resetMenuState:function(){this.findBlockOn("filters-toggle","check-button").delMod("checked"),this.delMod("show-filters"),this.blockInside("advanced-search").delMod("filters")},_hitCounter:function(t){return c.hit({dtype:"iweb",path:"/images/new/serp/filter/"+t}),this}},{live:function(){this.liveInitOnBlockOutsideEvent("contentLoaded","b-page",function(t,e){"search"!==e.page&&this._resetMenuState()}),this.liveInitOnBlockElemEvent("filters-toggle","change","check-button",function(){this._onToggleClick()})}}),BEM.DOM.decl("collections-menu",{getDefaultParams:function(){return{popupWidth:994,popupHeight:576}},_openWindow:function(t){var e=this.params.popupWidth,i=this.params.popupHeight,n={scrollbars:1,resizable:1,menubar:0,toolbar:0,status:0,left:(screen.width-e)/2,top:(screen.height-i)/2,width:e,height:i},s=Object.keys(n).map(function(t){return t+"="+n[t]}).join(",");this._window=window.open(t,"add_card",s)},_onMenuItemClick:function(t){var e=t.data.domElem,i=this.getMods(e),n=this.elemParams(e);this._hitCounter(n.counter),"add-card"===i.type&&(t.preventDefault(),this._openWindow(t.target.href))},_hitCounter:function(t){return c.hit({dtype:"iweb",path:"/image/new/serp/navig/collections/"+t}),this}},{live:function(){this.liveBindTo("menu-item","pointerclick",function(t){this._onMenuItemClick(t)})}}),BEM.DOM.decl("collections-menu-list",{_hitCounter:function(t){return c.hit({dtype:"iweb",path:"/image/new/serp/navig/collections/"+t.type,vars:t.href?"-link="+t.href:""}),this}},{live:function(){this.liveBindTo("item","pointerclick",function(t){this._hitCounter({type:this.params.counter,href:t&&t.target&&t.target.pathname})})}}),BEM.DOM.decl({block:"dropdown2",modName:"switcher",modVal:"link"},null,{live:function(){return this.liveInitOnBlockInsideEvent("click","link",function(t){this._onSwitcherClick(t)}),this.__base()}}),BEM.DOM.decl({block:"link",modName:"pseudo",modVal:"yes"},{_onClick:function(t){t.preventDefault(),this.hasMod("disabled")||this.trigger("click",this._buildClickEventData(t))},_onKeydown:function(t){BEM.blocks.keycodes.is(t.keyCode,"ENTER","SPACE")&&(BEM.blocks.keycodes.is(t.keyCode,"SPACE")&&t.preventDefault(),this.setMod("pressed","yes"))},_onKeyup:function(t){BEM.blocks.keycodes.is(t.keyCode,"ENTER","SPACE")&&(BEM.blocks.keycodes.is(t.keyCode,"SPACE")&&this.trigger("click"),this.delMod("pressed"))},_buildClickEventData:function(t){return{domEvent:t,isModKey:t.ctrlKey||t.altKey||t.metaKey||t.shiftKey}}},{live:function(){return this.liveBindTo({modName:"pseudo",modVal:"yes"},"pointerclick",function(t){this._onClick(t)}).liveBindTo({modName:"pseudo",modVal:"yes"},"keydown",function(t){this.hasMod("disabled")||this._onKeydown(t)}).liveBindTo({modName:"pseudo",modVal:"yes"},"keyup",function(t){this.hasMod("disabled")||this._onKeyup(t)}),this.__base()}}),BEM.DOM.decl({block:"popup2",modName:"target",modVal:"position"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params.position&&this.setPosition(this.params.position.left,this.params.position.top)}},visible:{yes:function(){this.__base.apply(this,arguments)}}},setPosition:function(t,e){return this._position={left:t,top:e},this._setVisible(),this.redraw()},_onWinScrollAndResize:$.noop,_calcTargetDimensions:function(){var t=this._position;return{left:t.left,top:t.top,width:0,height:0}},getDefaultParams:function(){return $.extend(this.__base(),{mainOffset:0,viewportOffset:0})}}),BEM.DOM.decl("footer",{hide:function(){this.hasMod("hidden","yes")||(this.setMod("hidden","yes"),this.trigger("hide"))},transparent:function(){this.setMod("hidden","yes"),this.trigger("transparent")},show:function(){this.delMod("hidden"),this.trigger("show")}}),BEM.DOM.decl("footer",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["b-page"].on("change",this._onPageChange,this)}}},destruct:function(){BEM.blocks["b-page"].un("change",this._onPageChange,this),this.__base.apply(this,arguments)},_onPageChange:function(){BEM.blocks["i-global"].param("mobile")&&!BEM.blocks["i-global"].param("tablet")&&this.updateMobileLink()},updateMobileLink:function(){var t=this.elem("link","mobile","yes"),e=t.attr("href"),i=BEM.blocks.uri.getParamValue(e,"retpath"),n=BEM.blocks.uri.getParamValue("text"),s=BEM.blocks.uri.parse(i),o=BEM.blocks.utils.isEmpty(n)?s.getRoot():s.getRoot()+"/search?text="+encodeURIComponent(n);t.attr("href",BEM.blocks.uri.setParam(e,"retpath",o))}}),BEM.DOM.decl("footer",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.distro=this.findBlockInside("distro"),this.hasMod("distro","yes")&&this.distroCounterOnScroll()}}},distroCounterOnScroll:function(){BEM.blocks["b-page"].on("scroll",this._onScroll,this),this._onScroll()},destruct:function(){BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},showDistro:function(){this.setMod("distro","yes"),this.distro.show(),this.trigger("distro","show")},_onPageChange:function(t,e){var i=this.params.links;this.__base.apply(this,arguments),BEM.blocks["b-page"].un("scroll",this._onScroll,this),this.elem("link","type","help").attr({href:"index"===e.type?i["help-index"]:i.help}),this.distro&&"ru"===BEM.blocks["i-global"].param("tld")&&this.distroCounterOnScroll()},_onScroll:function(){var t=BEM.DOM.win,e=this.distro;if(e){var i=e.domElem;!this.hasMod("hidden")&&t.scrollTop()+t.height()>=i.offset().top+i.height()&&(this.showDistro(),BEM.blocks["b-page"].un("scroll",this._onScroll,this))}}}),BEM.DOM.decl("yaplus",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.insertIntoHeader()}}},_getPage:function(){return this._page||(this._page=this.findBlockOn(BEM.DOM.scope,"b-page"))}}),BEM.DOM.decl("yaplus",{insertIntoHeader:function(){var t=BEM.blocks["serp-header"];if(this.hasMod("available","yes")){var e=t.get().elem("yaplus-container");if(!e)return;t.get().elem("nav").prepend(e.detach())}t.replacePlaceholder("yaplus",this)}}),BEM.DOM.decl("yaplus",{insertIntoHeader:function(){this.__base.apply(this,arguments),BEM.channel("yaplus").trigger("rendered")}}),BEM.DOM.decl("lang-switcher",{setRetpath:function(t){var e=encodeURIComponent(t),i=this.findBlockOn("dropdown2").getPopup();return this.findElem(i.domElem,"lang").map(function(){var t=$(this),i=t.attr("href");if(i){var n=i.replace(/(&retpath=)[^\&]*/,"$1"+e);n!==i&&t.attr("href",n)}}),this}},{live:!0}),BEM.DOM.decl("lang-switcher",{onSetMod:{js:{inited:function(){var t=this.findBlockOn("dropdown2").getPopup().domElem;this.langs=this.findElem(t,"lang")}}}},{live:function(){this.liveBindTo("pointerclick",function(){this.langs.each(function(){var t=$(this).attr("href"),e=BEM.blocks.uri;t&&$(this).attr("href",e.setParam(t,"retpath",e.clearHashSymbol(location.href)))})})}}),BEM.DOM.decl({block:"menu",baseBlock:"control"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.elem("item").attr("id",function(t,e){return e||$.identify()}),this._val=this.getVal()}},disabled:function(t,e){this.__base.apply(this,arguments),this.setMod(this.elem("item"),t,e)}},onElemSetMod:{item:{hovered:{yes:function(t){if(this.hasMod(t,"disabled"))return!1;this.delMod(this.elem("item","hovered","yes"),"hovered"),this.domElem.attr("aria-activedescendant",t.attr("id")),this.trigger("item-hover",{item:t})},"":function(){this.domElem.removeAttr("aria-activedescendant"),this.trigger("item-hover",{})}},checked:function(t,e,i){this.domElem.attr("aria-selected",Boolean(i))},disabled:{yes:function(){this.delMod("hovered"),this.domElem.attr("aria-disabled",!0)},"":function(){this.domElem.attr("aria-disabled",!1)}}}},_onChange:function(){var t=this._val,e=this.getVal();return t!==e&&(this._val=e,this.trigger("change",{prevVal:t,currVal:e})),this},getItems:function(t,e){return this.elem("item",t,e).get().map(function(t){return $(t)})},setContent:function(t){return BEM.DOM.update(this.domElem,t),this.reset(),this},getVal:function(){},reset:function(){this.dropElemCache()},_onItemEnter:function(t,e){this.setMod(t,"hovered","yes")},_onItemLeave:function(t,e){this.delMod(t,"hovered")},_onItemFocusin:function(t,e){this.setMod(t,"hovered","yes")},_onFocusout:function(t){this.__base.apply(this,arguments),this.delMod(this.elem("item","hovered","yes"),"hovered")},_onItemClick:function(t,e,i){this.trigger("click",{item:t,source:i.source})}},{live:function(){return this.liveBindTo("item","pointerover pointerout",function(t){var e=t.data.domElem;e[0].contains(t.relatedTarget)||("pointerover"===t.type?this._onItemEnter(e,t):this._onItemLeave(e,t))}).liveBindTo("item","pointerclick",function(t){var e=t.data.domElem;this._onItemClick(e,t,{source:"pointer"})}).liveBindTo("item","focusin",function(t){var e=t.data.domElem;this._onItemFocusin(e,t)}).liveBindTo("focusout",function(t){this._onFocusout(t)}),this.__base()}}),BEM.DOM.decl("menu",{onSetMod:{focused:{yes:function(){if(this.__base.apply(this,arguments),this.hasMod("type","navigation"))return!1;this.elem("item","hovered","yes").length||(this.setMod(this.elem("item").eq(0),"hovered","yes"),this._scrollToItem(this.elem("item").eq(0))),this.bindToDoc("keydown",this._onKeydown).bindToDoc("keyup",this._onKeyup).bindToDoc("keypress",this._onKeypress)},"":function(){this.__base.apply(this,arguments),this.unbindFromDoc("keydown keyup keypress").delMod(this.elem("item","hovered","yes"),"hovered")}}},hoverNext:function(t){for(var e,i,n=t?this.getItems().reverse():this.getItems(),s=0,o=!1;i=n[s];s++)if(!this.hasMod(i,"disabled"))if(this.hasMod(i,"hovered"))o=!0;else{if(o){e=i;break}e||(e=i)}e&&(this.setMod(e,"hovered","yes"),this._scrollToItem(e))},hoverText:function(t,e){for(var i,n=this.getItems(),s=n.length,o=this._normalizeText(t),r=e||0;r<s;){if(i=n[r],!this.hasMod(i,"disabled")&&0===this._normalizeText(i.text()).indexOf(o))return this.setMod(i,"hovered","yes"),void this._scrollToItem(i);++r===n.length&&(r=0,s=e)}},_normalizeText:function(t){return t.toLowerCase().replace(/ё/,"е")},reset:function(){this.__base.apply(this,arguments),this._dropSearchCache()},_dropSearchCache:function(){this._lastTime=this._lastChar=this._searchTerm=void 0},_scrollToItem:function(t){var e=this.domElem.offset().top,i=t.offset().top,n=0;i<e?n=i-e:(n=i+t.outerHeight()-e-this.domElem.outerHeight())<0&&(n=0),this.domElem.scrollTop(this.domElem.scrollTop()+n)},_onKeydown:function(t,e){var i=BEM.blocks.keycodes,n=t.keyCode;t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||((i.is(n,"UP","DOWN")||!e&&n===i.SPACE)&&t.preventDefault(),i.is(n,"UP","DOWN")&&(this.hoverNext(i.is(n,"UP")),this._dropSearchCache()))},_onKeyup:function(t){var e=BEM.blocks.keycodes,i=t.keyCode;t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||e.is(i,"ENTER","SPACE")&&this._onItemClick(this.elem("item","hovered","yes"),t,{source:"keyboard"})},_onKeypress:function(t){var e,i,n=Number(new Date),s=t.charCode,o=String.fromCharCode(s).toLowerCase(),r=o===this._lastChar&&1===this._searchTerm.length,a=this.getItems();s<=BEM.blocks.keycodes.SPACE||t.ctrlKey||t.altKey||t.metaKey?this._lastTime=n:(n-this._lastTime>this.SEARCH_TIMEOUT||r?this._searchTerm=o:this._searchTerm=(this._searchTerm||"")+o,this._lastChar=o,this._lastTime=n,e=this.elem("item","hovered","yes"),i=(i=$($.map(a,function(t){return t.get()})).index(e))>=0?i:0,r&&0===this._normalizeText(e.text()).indexOf(this._searchTerm)&&(i=i>=a.length-1?0:i+1),this.hoverText(this._searchTerm,i))},SEARCH_TIMEOUT:1500}),BEM.DOM.decl("favorites-iframe",{onSetMod:{js:{inited:function(){this.win=window,this._content=this.findElem("content"),this._data=null,this._cardData=null,this._modal=this.findBlockOn("modal","modal"),this._saved=!1;var t=this,e=this.params,i=this.params.withModal?"favorite:open-window":"favorite:open-popup";this.count=function(i,n){(BEM.blocks["favorites-counter"].count||function(){}).call(t,i,e.logged?"-authorized=1":"-authorized=0",n,e.counterParams)},this._modal.on("afterOpen",function(){BEM.channel("collections").trigger("iframe:open")}),this._modal.on("beforeClose",function(){this._saved||BEM.channel("collections").trigger("window:closed"),this._saved&&this._cardData&&BEM.channel("collections").trigger("window:saved",this._cardData),void 0!==this._rpcBridge&&this._rpcBridge.invokeMethod("pdb-close-outside")}.bind(this)),BEM.channel("collections").on(i,function(t,e){this._data=e,this._saved=!1,this._cardData=null,this._loadIframeFirstTime(),this._getModal().setMod("visible","yes")}.bind(this)),BEM.channel("collections").on("favorite:error",function(t,e){"Forbidden"===e.error&&(this._loadIframeFirstTime(e.url),this._getModal().setMod("visible","yes"))}.bind(this)),BEM.channel("collections").on("favorite:blur",function(t,e){this.close()}.bind(this))}}},getDefaultParams:function(){return{baseUrl:"https://yandex.ru/images/_crpd/hmiK30s10/3a2294DBBNSc/f1sZgUG29fpaWiHswyxKFuPk8-bYD723Uemj9SQAChsk_2bgzJ3A",loaderVersion:"v0.0.3",iframeOrigin:location.origin,iframePath:"/collections/add/?bus=2"}},ready:function(){this.setMod(this._content,"loaded","yes"),this._getSpin().delMod("progress"),this._data&&this._addCard(this._data),BEM.channel("collections").trigger("window:ready")},close:function(t){this._saveCard(t),this._getModal().delMod("visible")},cardSaved:function(t){this._saveCard(t)},_saveCard:function(t){t&&t.card&&t.card.board?(this._saved=!0,this._cardData=t):(this._saved=!1,this._cardData=void 0)},_addCard:function(t){void 0!==this._rpcBridge&&(this.params.withModal||(t.card&&t.card.task_id?this.count("1352.1544.487.2818","73311"):this.count("1352.1544.487.160","73310")),this._rpcBridge.invokeMethod("pdb-add-card",t))},_loadIframeFirstTime:function(t){if(this._currentIframeUrl&&(this._currentIframeUrl&&t&&this._currentIframeUrl!==t||!t&&this._currentIframeUrl!==this._getIframeUrl())&&this._removeIfame(),void 0!==this._rpcBridge)return this.ready();this._getSpin().setMod("progress","yes"),void 0===window.LegoIframeLoader?this._insertLoaderScript(this._loadIframe.bind(this,t)):this._loadIframe(t)},_removeIfame:function(){this._atom&&(this._rpcBridge.clean(),this._rpcBridge=void 0,this._currentIframeUrl=void 0,this._atom.removeIframe(),this._atom=void 0)},_insertLoaderScript:function(t){var e=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],i=document.createElement("script");i.setAttribute("src",this._getLoaderUrl()),i.onload=t,e.insertBefore(i,e.lastChild)},_loadIframe:function(t){var e={iframeUrl:t||this._getIframeUrl(),container:this._content.get(0)};this._atom=new window.LegoIframeLoader(e),this._currentIframeUrl=e.iframeUrl,this._rpcBridge=this._atom.getRPCBridge(this),this._rpcBridge.pushMessagesToStack=!0,this._atom.on("init",this._onIframeLoad.bind(this)),this._atom.init()},_onIframeLoad:function(t,e){this._rpcBridge.contrAgent.win=e.iframeWin,this._rpcBridge.onIframeLoad()},_getLoaderUrl:function(){return this.params.loaderUrl||this.params.baseUrl+"/iframe-loader/"+this.params.loaderVersion+"/index.min.js"},_getIframeUrl:function(){var t=this.params.source_type,e=this.params.iframeUrl||this.params.iframeOrigin+this.params.iframePath;return e+=t?"&source_type="+t:""},_getModal:function(){return void 0===this._modal&&(this._modal=this.findBlockOn("modal","modal")),this._modal},_getSpin:function(){return void 0===this._spin&&(this._spin=this.findBlockOn("spin","spin2")),this._spin}}),BEM.DOM.decl("favorites-iframe",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._page=BEM.DOM.blocks["b-page"].getInstance();var t=this._getModal();t.on("afterOpen",this._page.disableScroll.bind(this._page)),t.on("beforeClose",this._enableScroll.bind(this)),this._updateCounterParams()}}},_enableScroll:function(){this._page.enableScroll.call(this._page)},_updateCounterParams:function(){return this.__base.apply(this,arguments),BEM.blocks["i-global"].extendCounterParams(this.params.counterParams),this.params.counterParams},getDefaultParams:function(){var t=this.__base.apply(this,arguments);return BEM.blocks["i-global"].param("tablet")&&(t.iframePath="/collections/add/?bus=2&mobile=1"),t}}),BEM.DOM.decl("b-statcounter",{onSetMod:{js:{inited:function(){this.findElem("metrika").length<1||(this.location=BEM.blocks.location.getInstance().on("change",this._onChange,this),this.__self.on("hit",this.hitMetrika,this),this.__self.on("goal",this.reachGoal,this),this.trigger("hitAndGoalInited"),this.__base.apply(this,arguments))}}},destruct:function(){this.location.un("change",this._onChange,this),this.__self.un("hit",this.hitMetrika,this),this.__self.un("goal",this.reachGoal,this),this.__base.apply(this,arguments)},_onChange:function(){this.hitMetrika()},hitMetrika:function(t,e){e||(e={});var i=this.getMetrika();i&&i.hit(e.url||window.location.href,e.title,e.referer,e.params),BEM.blocks.counter.debug("metrika hit",JSON.stringify(e.params))},reachGoal:function(t,e){e||(e={});var i=this.getMetrika();i&&i.reachGoal(e.goal,e.params),BEM.blocks.counter.debug("metrika reachGoal",JSON.stringify(e))},getMetrika:function(){return this._mc||(this._mc=window["yaCounter"+this.elemParams("metrika").id])}},{hit:function(t){this.trigger("hit",t)},goal:function(t){this.trigger("goal",t)}}),BEM.DOM.decl("b-statcounter",{_onChange:$.noop}),BEM.DOM.decl("b-statcounter__metrika",{onSetMod:{js:{inited:function(){this.__self.loadMetrika(),this.addCounter(this.params)}}},addCounter:function(t){var e=window.Ya&&Ya.Metrika,i=window.yandex_metrika_callbacks||(window.yandex_metrika_callbacks=[]),n=function(){window["yaCounter"+t.id]=new Ya.Metrika(t)};if(!t.id)throw new Error(["Incorrect ID has been passed.","block: "+this.__self.getName(),"method: addCounter"].join("\n"));e?n():i.push(n)},getDefaultParams:function(){return{enableAll:!0}}},{loadMetrika:function(){var t=window.Ya&&Ya.Metrika,e="https:"===document.location.protocol?"https:":"http:";!t&&$.ajax({url:e+"//mc.yandex.ru/metrika/watch.js",dataType:"script",cache:!0}),this.loadMetrika=function(){}}}),BEM.DOM.decl("b-statcounter__metrika",{getDefaultParams:function(){return{clickmap:!0,trackLinks:!0}},addCounter:function(t){if(!t.id)throw new Error(this.getErrorMessage());this.__self.processMetrikaFn(this.__self.createYaCounter.bind(this,t))},getErrorMessage:function(){return["Incorrect ID has been passed.","block: "+this.__self.getName(),"method: addCounter"].join("\n")}},{loadMetrika:function(){var t="https:"===document.location.protocol?"https:":"http:",e=this.getScript();this.isMetrikaScriptLoaded()||this.loadMetrikaTransport(t+e),this.loadMetrika=function(){}},loadMetrikaTransport:function(t){$.ajax({url:t,dataType:"script",cache:!0})},getScript:function(){return BEM.blocks["i-global"].getFlag("enable_webvisor2")?"//mc.yandex.ru/metrika/tag.js":"//mc.yandex.ru/metrika/watch.js"},getMetrikaCallbacksPropName:function(){return BEM.blocks["i-global"].getFlag("enable_webvisor2")?"yandex_metrika_callbacks2":"yandex_metrika_callbacks"},isMetrikaScriptLoaded:function(){return BEM.blocks["i-global"].getFlag("enable_webvisor2")?Boolean(window.Ya&&Ya.Metrika2):Boolean(window.Ya&&Ya.Metrika)},processMetrikaFn:function(t){var e=this.getMetrikaCallbacksPropName();this.isMetrikaScriptLoaded()?t():(window[e]||(window[e]=[]),window[e].push(t))},createYaCounter:function(t){try{BEM.blocks["i-global"].getFlag("enable_webvisor2")?window["yaCounter"+t.id]=new Ya.Metrika2(t):window["yaCounter"+t.id]=new Ya.Metrika(t)}catch(t){}}}),BEM.DOM.decl("fade",{onSetMod:{progress:function(t,e){this.getSpin().setMod(t,e)}},getSpin:function(){return this._spin||(this._spin=this.findBlockInside("spin2")),this._spin},show:function(){this.setMod("progress","yes")},hide:function(){this.delMod("progress")}}),BEM.DOM.decl("fade",{coverPageLayout:function(){this.delMod("include")},coverTabs:function(){this.setMod("include","tabs")},coverHeader:function(){this.setMod("include","header")}}),BEM.decl("atom",{},{initStripe:function(t){return this._initAtomInstance(t).then(this._bindStripeEvents)},_bindStripeEvents:function(t){var e=BEM.channel("atom");t.on("will-show",function(t,i){e.trigger("stripe-will-show",i)}),t.on("show",function(t,i){e.trigger("stripe-show",i)}),t.on("will-hide",function(t,i){e.trigger("stripe-will-hide",i)}),t.on("hide",function(t,i){e.trigger("stripe-hide",i)})},initStripePad:function(t){return this._initAtomInstance("StripePad",t)},initSmartBanner:function(t){return this._initAtomInstance("SmartBanner",t)},_initAtomInstance:function(t,e){e=e||{},"object"==typeof(t=t||null)&&(e=t,t=null);var i=$.Deferred();return this._whenInited(function(){var n=new(t?Atom[t]:Atom)(e).init();i.resolve(n)}),i.promise()},_whenInited:function(t){window.Atom&&window.Atom.whenInited(t)}}),BEM.DOM.decl("i-device-info",{onSetMod:{js:{inited:function(){var t=this.params.forcedSzm;t?this.setSzmCookie(decodeURIComponent(t)):this.updateSzmCookie()}}},getScreenSize:function(){return this.validateScreenSize({w:screen.width,h:screen.height})},getViewportSize:function(){return{w:window.innerWidth,h:window.innerHeight}},getDevicePixelRatio:function(){return window.devicePixelRatio||1},getScreenParams:function(){return{screenSize:this.getScreenSize(),viewportSize:this.getViewportSize(),devicePixelRatio:this.getDevicePixelRatio()}},updateSzmCookie:function(){var t=this.getScreenParams(),e=this.parseSzmCookie(this.getSzmCookie());this.isSzmEqual(e,t)||this.setSzmCookie(this.stringifySzmCookie(t))},setSzmCookie:function(t){return BEM.blocks["i-cookie"].get().yp({name:"szm",value:t,encode:!1})},getSzmCookie:function(){return BEM.blocks["i-cookie"].get().yp("szm")},isSzmEqual:function(t,e){function i(t,e){return t.w===e.w&&t.h===e.h}return!(!t||!e)&&(t.devicePixelRatio===e.devicePixelRatio&&(!!i(t.screenSize,e.screenSize)&&!!i(t.viewportSize,e.viewportSize)))},validateScreenSize:function(t){return t},formatSzmSizeToString:function(t){if(t)return[t.w,t.h].join("x")},formatSzmSizeToObject:function(t){if(t)return t=t.split("x"),{w:Number(t[0]),h:Number(t[1])}},stringifySzmCookie:function(t){return[String(t.devicePixelRatio).replace(".","_"),this.formatSzmSizeToString(t.screenSize),this.formatSzmSizeToString(t.viewportSize)].join(":")},parseSzmCookie:function(t){if(t){var e=(t=t.split(":"))[0],i=t[1],n=t[2]||t[1];return{devicePixelRatio:Number(e.replace("_",".")),screenSize:this.formatSzmSizeToObject(i),viewportSize:this.formatSzmSizeToObject(n)}}}}),BEM.DOM.decl("page-layout",{},{getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance}}),BEM.DOM.decl("page-layout",{_shouldTrigger:!0,onSetMod:{layout:function(t,e){this._shouldTrigger&&this.trigger(t,e),this._shouldTrigger=!0}},disableTrigger:function(){return this._shouldTrigger=!1,this}}),BEM.DOM.decl("page-layout",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks.footer.on("distro",this._onDistroShow,this)}}},destruct:function(){BEM.blocks.footer.un("distro",this._onDistroShow,this),this.__base.apply(this,arguments)},_onDistroShow:function(t,e){this.setMod("distro-footer","yes")},changeHeight:function(t){return this.elem("content-wrapper").css("min-height","+="+t),this},getHeight:function(){return this.elem("content-wrapper").height()},setHeight:function(t){return this.elem("content-wrapper").css("min-height",t),this},setDefaultHeight:function(){return this.elem("content-wrapper").css("min-height",""),this}}),BEM.DOM.decl("page-layout",{toggleCBIRMode:function(t){return this.toggleMod("cbir","visible","",t)}}),BEM.DOM.decl("incut-controller",{onSetMod:{js:{inited:function(){BEM.blocks["b-page"].on("change",this._syncState,this),BEM.blocks.more.on("click",this._onMoreClick,this),BEM.blocks["serp-controller"].on("loaded",this._onListLoaded,this),this._syncState()}}},destruct:function(){BEM.blocks["b-page"].un("change",this._syncState,this),BEM.blocks.more.un("click",this._onMoreClick,this),BEM.blocks["serp-controller"].un("loaded",this._onListLoaded,this),this.__base.apply(this,arguments)},_syncState:function(){this._serpList=void 0,this._tryInitIncuts()},_onMoreClick:function(){this._resetLastPositionIncuts()},_onListLoaded:function(t,e){this._tryInitIncuts(e&&e.direction)},_triggerCompleted:function(t,e){this.trigger("completed",{dir:t,incuts:e||[]})},_tryInitIncuts:function(t){if(this._shouldNotShowIncuts())return this._triggerCompleted(t),this;var e,i=[],n=this;if(this.incuts=this.findBlocksInside("incut"),!this.incuts||!this.incuts.length)return this._triggerCompleted(t),this;for(var s=0;s<this.incuts.length;s++)if(e=this.incuts[s],this._shouldShowIncut(e)){var o=this.initIncut(e,t);o.hasMod("position","before-more")||i.push(o.getInitedIncutPromise())}return $.when.all(i).then(function(e){n._triggerCompleted(t,e)}).fail(function(){n._triggerCompleted(t)}),this},_resetLastPositionIncuts:function(){this.findBlocksInside({block:"incut",modName:"last",modVal:!0}).forEach(function(t){t.delMod("last")})},_shouldNotShowIncuts:function(){var t=this._getSerpList();return!(t&&t.getLastPageNumber()>=0)},_isIncutDisabled:function(t){var e,i=BEM.blocks["i-global"].param("isPornoQuery");return i?"direct"!==(e=t.params&&t.params.incutBlock||"")&&"wAA1LXNe7s8QDE2xboaU"!==e:i},_shouldShowIncut:function(t){if(this._isIncutInserted(t)||this._isIncutDisabled(t))return!1;var e=this._getSerpController(),i=this._getSerpList(),n=t.params,s=n.position,o=!1;switch(n.positionType){case"line":o=i&&(0===s||i.isRowVisible(s-1));break;case"middle":o=e.getListCount()%e.getScrollPagesCount()===s;break;case"page":o=e.getListCount()%(s-e.getInitialPageNum())==0;break;case"bottom":o=e.isCurrentPageLast()||e.getListCount()%e.getScrollPagesCount()==0;break;case"page-fixed":o=!t.hasMod("last");break;case"top":case"vertical":o=!0}return o},_isIncutInserted:function(t){return t.hasMod("inserted","yes")&&"middle"!==t.getPositionType()},initIncut:function(t,e){var i=this._getSerpList(),n=t.domElem,s=t.params;switch(s.positionType){case"line":i.appendToRow(s.position,n);break;case"middle":case"page":"prev"===e?i.prependIncutElem(n):i.appendIncutElem(n);break;case"top":i.prependIncutElem(n)}return t.show().setShown()},_getSerpList:function(){return this._serpList||(this._serpList=this.findBlockInside("serp-list"))},_getSerpController:function(){return this._serpController||(this._serpController=this.findBlockOn("serp-controller"))}}),void 0===jQuery.when.all&&(jQuery.when.all=function(t){return $.Deferred(function(e){$.when.apply(jQuery,t).then(function(){e.resolveWith(this,[Array.prototype.slice.call(arguments)])},function(){e.rejectWith(this,[Array.prototype.slice.call(arguments)])})})}),BEM.DOM.decl("distro",{destruct:function(){this._onResizeSubscribed&&BEM.blocks["b-page"].un("resize",this._onResize,this),this.__base.apply(this,arguments)},_onItemClick:function(t){t.preventDefault();var e=this.elemParams("item"),i=e.counter,n=e.url;BEM.create("chrome-webstore-item",{url:n}).on({installed:function(){c.hit({dtype:"iweb",path:i+"install",vars:"-app_url="+n})},installationFailed:function(t,e){c.hit({dtype:"iweb",path:i+"error",vars:"-app_url="+n+",-error_code="+e.errorCode})},installationCancelled:function(){c.hit({dtype:"iweb",path:i+"popup_close",vars:"-app_url="+n})}}).install()},show:function(){this.delMod("hidden"),this.setMod("shown","yes"),this._hitCounter(),this.notShownItems=this._getNotShownItems(this._initItems()),this.notShownItems.length>0&&(BEM.blocks["b-page"].on("resize",this._onResize,this),this._onResizeSubscribed=!0)},hide:function(){this.delMod("shown"),this.setMod("hidden","yes")},_getNotShownItems:function(t){return t.filter(function(t,e){var i=BEM.blocks["scroll-spy"].getElemVisibility(e).visible;return i&&this._countItemShown(e),!i}.bind(this))},_countItemShown:function(t){var e=BEM.DOM.extractParams(t[0]),i=e.link&&e.link.counterData;i&&cp({pid:i.pid,cid:i.cid,path:i.show.path,vars:i.show.vars})},_initItems:function(){return this.elem("item").map(function(t,e){return this.elemify(e,"item")}.bind(this))},_onResize:function(){this.notShownItems.length>0?this.notShownItems=this._getNotShownItems(this.notShownItems):(this._onResizeSubscribed=!1,BEM.blocks["b-page"].un("resize",this._onResize,this))},_hitCounter:function(){c.cpHitDelayed({pid:40,cid:72921,path:"image.serp.footer.show"})},_onLinkClick:function(t){var e=$(t).parents(this.buildSelector("link")).bem("link").params.counterData;cp({pid:e.pid,cid:e.cid,path:e.click.path,vars:e.click.vars})}},{live:function(){return this.liveBindTo({elem:"item",modName:"inline",modVal:"yes"},"click",function(t){this._onItemClick(t)}),this.liveBindTo("link","click",function(t){this._onLinkClick(t.target)}),!1}}),BEM.decl("chrome-webstore-item",{onSetMod:{js:function(){this.url=this.params.url}},install:function(){this.addLink(),chrome.webstore.install(this.url,this.onInstalled.bind(this),this.onInstallationFailed.bind(this))},addLink:function(){this.linkAdded||($(document.head).append($("<link />").attr({rel:"chrome-webstore-item",href:this.url})),this.linkAdded=!0)},onInstalled:function(){this.trigger("installed")},onInstallationFailed:function(t,e){var i="userCancelled"===e?"installationCancelled":"installationFailed";this.trigger(i,{errorMessage:t,errorCode:e})}}),BEM.DOM.decl({block:"serp-user",modName:"type",modVal:"enter"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=this.findBlockOn("login-popup","popup"),e=this.findBlockInside("promo-popup","popup2");t?this._initLoginPopup(t):e&&this._initPromoPopup(e),this.bindTo("login-link","pointerclick",this._updateLoginUrl),this.bindTo("registration-link","pointerclick",this._updateRegistrationUrl)}}},_initLoginPopup:function(t){var e=BEM.blocks["i-cookie"].get(),i=Math.round(new Date/1e3)+86400;e.yp("ln_pp")||(e.yp("ln_pp",!0,i),t.bindTo("close","click",function(){var t=(this.elemParams("login-popup").counters||{}).close;t&&window.Ya.counter.w(null,t),e.yp("ln_pp",!0,7*i)}.bind(this)),t.show({top:14,right:14}))},_initPromoPopup:$.noop,_updateRegistrationUrl:function(){var t=BEM.blocks.uri.parse(this._getPassportUrl()).path("/registration").build(),e=this.findBlockOn("registration-link","button2");e&&e.domElem.attr("href",t)},_updateLoginUrl:function(){var t=this.findBlockOn("login-link","button2");t&&t.setUrl(this._getPassportUrl())},_getPassportUrl:function(){var t=BEM.blocks.utils.getPassportUrl();return this.params.origin&&(t=BEM.blocks.uri.setParam(t,"origin",this.params.origin)),t}},{live:function(){return this.__base.apply(this,arguments),!1}}),BEM.DOM.decl({block:"popup",modName:"type",modVal:"modal"},{getDefaultParams:function(){var t=this.__base();return t.top="50%",t.left="50%",t},_isPercentVal:function(t){return"string"==typeof t&&t.indexOf("%")>0},show:function(t){return this._moveToContainer(),this.setMod("visibility","outside").setMod("adaptive","no"),this.repaint(t),this},repaint:function(t){this._moveToContainer(),t||(t={left:this.params.left,top:this.params.top});var e=this.getPopupSize();return this._isPercentVal(t.left)&&!t.marginLeft&&(t.marginLeft=e.width/(-100/parseInt(t.left,10))),this._isPercentVal(t.top)&&!t.marginTop&&(t.marginTop=e.height/(-100/parseInt(t.top,10))),this._show(t),this}}),BEM.DOM.decl("user2",{onSetMod:{js:{inited:function(){if(this._retpath=this.params._retpath,this._isAuthorized=Boolean(this.params._uid),!this._isAuthorized)return!0;this._currentAccount=this.findBlockOn("current-account","user-account"),this._popup=this.findBlockInside("light-popup"),this._menu=this.findBlockInside("menu"),this._exitItem=this.elem("menu-item","action","exit"),this._plusItem=this.elem("menu-item","action","plus"),this._addItem=this.elem("add-account"),this._accountsContainer=this.findElem(this._menu.domElem,"accounts-container"),this._menuCounter=this.findElem("menu-counter"),this.bindTo("menu-item","pointerclick",this._onMenuItemClick),this.bindTo(this._exitItem,"pointerclick",this._onLogout),BEM.blocks["user-account"].on(this._accountsContainer,"click",this._onAccountClick,this),BEM.blocks["user-account"].on(this._accountsContainer,"logout",this._processLogout,this)}},opened:{yes:function(){this.domElem.attr("aria-expanded",!0),this._popup.setMod("visible","yes").on("beforeClose",this._onPopupClose,this),this._setMaxHeight(),this.bindToWin("resize orientchange",this._setMaxHeight),this._popup.on("beforeOpen",function(){this._onPopupOpen(),this._popup.un("beforeOpen",this._onPopupOpen,this)},this)},"":function(){var t=this.trigger("beforeClose");if(t.isDefaultPrevented&&t.isDefaultPrevented())return!1;this.unbindFromWin("resize orientchange",this._setMaxHeight),this.domElem.attr("aria-expanded",!1),this._popup.delMod("visible").un("beforeClose",this._onPopupClose,this)}}},destruct:function(){return this._isAuthorized&&(BEM.blocks["user-account"].un(this._accountsContainer,"click",this._onAccountClick,this),BEM.blocks["user-account"].un(this._accountsContainer,"logout",this._processLogout,this)),this.__base.apply(this,arguments)},setUnreadCount:function(t){var e=this._menu.findBlockInside("user-account");return this._currentAccount.setCounter(t),e&&e.hasMod("has-ticker")&&e.setCounter(t),this._menuCounter&&(t>0?this.delMod(this._menuCounter,"state","empty"):this.setMod(this._menuCounter,"state","empty"),this._menuCounter[0].innerText=t),this},setRetpath:function(t){this._retpath=t;var e=encodeURIComponent(t);return $().add(this._menu&&this._menu.findElem("item")).add(this.findElem("current-account")).add(this.findElem("a11y-exit")).add(this.findElem("enter")).add(this._addItem).each(function(t,i){var n=$(i),s=n.attr("href");if(s){var o=s.replace(/([\&\?]retpath=)[^\&]*/,"$1"+e);o!==s&&n.attr("href",o)}}),this},getPopup:function(){return this._popup},getMenu:function(){return this._menu},getCurrentAccount:function(){return this._currentAccount},_changeUser:function(t){var e=this.params._passportHost+"/passport?mode=embeddedauth";$('<form method="POST" action="'+e+'"><input type="hidden" name="action"  value="change_default"><input type="hidden" name="uid"     value="'+t+'"><input type="hidden" name="retpath" value="'+this._retpath+'"><input type="hidden" name="yu"      value="'+this.params._yu+'"></form>').appendTo("body").submit()},_onCurrentAccountClick:function(t,e){t.block===this._currentAccount&&(e.domEvent.preventDefault(),this.toggleMod("opened","yes"),this.trigger("current-account-click"))},_onAccountClick:function(t,e){if(!e.isLogout){var i=this.elemParams(t.block.domElem).uid;this._changeUser(i)}},_onPopupClose:function(){this.delMod("opened")},_onPopupOpen:function(){this.trigger("beforeOpen")},_processLogout:function(t){var e=this.elemParams(t.target.domElem).uid;e&&this.trigger("logout-click",{uid:e,account:t.target})},_onMenuItemClick:function(){this.trigger("menu-item-click")},_onLogout:function(){this.trigger("logout")},_setMaxHeight:function(){var t=BEM.DOM.win,e=this.params.menuMaxHeight;e||(e=t.height()-this.domElem.offset().top+t.scrollTop()),this._menu.domElem.css("max-height",e)},getDefaultParams:function(){return{menuMaxHeight:0}}},{live:function(){this.liveInitOnBlockInsideEvent("init","user-account"),this.liveInitOnBlockInsideEvent("click","user-account",this.prototype._onCurrentAccountClick),this.liveBindTo("enter","pointerclick",function(){this.trigger("login")})}}),BEM.DOM.decl("user2",{onSetMod:{"hide-name":function(t,e){this._currentAccount.toggleMod("hide-name","yes",e)}},toggleCollapsed:function(t){this.toggleMod("hide-name","yes",t)}}),BEM.DOM.decl("user2",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._updateRetpath(this._getRetPath()),this._syncMenuCounterWithTicker(),BEM.channel("unread-letters-count").on("update",this._onUnreadLettersCountUpdate.bind(this))}}},_updateRetpath:function(t){this.setRetpath(t),BEM.blocks["i-global"].setParams({retpath:t})},_getRetPath:function(){return BEM.blocks.location.getInstance().getUri().replaceParam("ncrnd",Math.floor(1e4*Math.random())).toString()},_syncMenuCounterWithTicker:function(){this.setUnreadCount(this.findBlockInside("ticker").val())},_onUnreadLettersCountUpdate:function(t,e){this.setUnreadCount(e)}}),BEM.DOM.decl("user-account",{setCounter:function(t){var e=this.findBlockInside("ticker");e&&e.val(t)},_onClick:function(t){var e={domEvent:t};this.isLogoutClick&&(e.isLogout=!0,this.isLogoutClick=!1),this.trigger("click",e)},_onMouseOver:function(t){this.setMod("hovered","yes").bindTo("mouseleave",this._onMouseLeave)},_onMouseLeave:function(){this.delMod("hovered").unbindFrom("mouseleave")},_onFocusIn:function(t){this.trigger("focus").setMod("focused","yes").bindTo("focusout",this._onFocusOut)},_onFocusOut:function(){this.trigger("blur").delMod("focused").unbindFrom("focusout")},_onLogoutClick:function(){this.isLogoutClick=!0,this.trigger("logout")}},{live:function(){this.liveBindTo("pointerclick",this.prototype._onClick),this.liveBindTo("focusin",this.prototype._onFocusIn),this.liveBindTo("mouseover",this.prototype._onMouseOver),this.liveBindTo("logout","pointerclick",this.prototype._onLogoutClick)}}),BEM.DOM.decl("user-pic",{onSetMod:{js:{inited:function(){var t=this.elem("link")[0];t&&(t.href=this.params.cameraURL+"?retpath="+encodeURIComponent(window.location.href)+"&origin="+this.params.origin)}}},getDefaultParams:function(){return{origin:"userpic",cameraURL:"https://passport.yandex.ru/profile/public"}}}),BEM.DOM.decl({block:"user-account",modName:"has-ticker",modVal:"yes"},{getTicker:function(){return this.findBlockOn("ticker","ticker")}}),BEM.DOM.decl("ticker",{onSetMod:{js:{inited:function(){this._count=this.params.count}}},show:function(){return this.setMod("state","normal")},hide:function(){return this.setMod("state","empty")},val:function(t){if(!arguments.length)return this._count;var e=this.params.maxCount;return this._count=t,this.elem("value").attr("title",t).text(t>e?e:t),t?this.show():this.hide(),this}}),BEM.DOM.decl("ticker",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.channel("unread-letters-count").on("update",this._onUnreadLettersCountUpdate.bind(this))}}},_onUnreadLettersCountUpdate:function(t,e){e>=0&&this.val(e)}}),BEM.DOM.decl("light-popup",{onSetMod:{js:{inited:function(){this._moved=this.params.moved}},visible:{yes:function(){this.trigger("beforeOpen"),!this._moved&&this._moveToTarget()},"":function(){"yes"===this.getMod("animated")&&this.setMod("reverse-animation"),this.trigger("beforeClose")}}},_moveToTarget:function(){var t=this.findBlockOutside(this.params.target);this._owner=t.domElem||BEM.DOM.scope,this._owner.append(this.domElem),this._moved=!0},setContent:function(t){this._isUpdatedContent||(this._isUpdatedContent=!0,this.afterCurrentEvent(function(){delete this._isUpdatedContent}),BEM.DOM.update(this.domElem,t))},getDefaultParams:function(){return{moved:!1}}}),BEM.DOM.decl({block:"light-popup",modName:"autoclosable",modVal:"yes"},{onSetMod:{visible:{yes:function(){this.__self._visiblePopupsStack.unshift(this),this.afterCurrentEvent(function(){this.domElem&&this.hasMod("visible")&&this.bindToDoc("pointerdown",this._onDocClick)}),this.__base.apply(this,arguments)},"":function(){var t=this.__self._visiblePopupsStack;t.splice(t.indexOf(this),1),this.unbindFromDoc("pointerdown").__base.apply(this,arguments)}}},_onDocClick:function(t){this.hasMod("visible")&&!this.containsDomElem($(t.target))&&this.delMod("visible")}},{live:function(){return BEM.DOM.doc.on("keydown",this._onDocKeyPress.bind(this)),this.__base()},_visiblePopupsStack:[],_onDocKeyPress:function(t){BEM.blocks.keycodes.is(t.keyCode,"ESC")&&this._visiblePopupsStack.length&&this._visiblePopupsStack[0].delMod("visible")}}),BEM.DOM.decl("unread-letters-updater",{onSetMod:{js:function(){this._noticeRequest(this._noticeCheck.bind(this),function(){})}},_noticeCheck:function(t){t&&BEM.channel("unread-letters-count").trigger("update",parseInt(t.counters.unread,10))},_disableNotice:function(){var t=BEM.blocks["i-ua"].ie;return Boolean(t)&&t<10||!this.params.hasMailBox},_noticeRequest:function(t,e){this._disableNotice()||BEM.create("i-request_type_ajax",{url:"https://mail.yandex."+BEM.blocks["i-global"].param("tld")+"/api/v2/serp/counters?silent",dataType:"json",xhrFields:{withCredentials:!0},paramsToSettings:["xhrFields"]}).get({},t,e)}}),BEM.DOM.decl({block:"user2",modName:"fetch-accounts",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._accountsElem=this.findElem(this._menu.domElem,"accounts"),this._accountsSpin=this.findBlockInside(this._accountsElem,"spin2"),this._accountsDataProvider=BEM.create(this.params.accountsDataProvider,{callbackCtx:this,accountsUrl:this.params.accountsUrl}),this._fetchAccounts()}}},onElemSetMod:{accounts:{loading:function(t,e,i){this._accountsSpin.setMod("progress",i)}}},_fetchAccounts:function(){this.setMod(this._accountsElem,"loading","yes"),this._accountsDataProvider.get({yu:this.params._yu},function(t){this._hasOrganizations=t.accounts&&t.accounts.some(function(t){return t.attributes.has_organization})||!1;var e=!0,i=this._popup.findBlockInside({block:"user-account",modName:"template",modVal:"yes"});if(i){if(t.accounts){var n=this.params.accountsMax;t.accounts.forEach(function(e,s){e.uid!==t.default_uid&&s<=n&&this._accountsContainer[0].appendChild(this._renderAccount(e,s,i))},this),e=Boolean(t["can-add-more"])}var s=i.domElem.parent();i.destruct(),s.remove()}this.updateCounters&&this.updateCounters(),this.toggleMod(this.findElem(this._accountsElem,"add-account"),"hidden","","yes",e),this.delMod(this._accountsElem,"loading")})},_renderAccount:function(t,e,i){var n=t.defaultEmail||t.displayName.social,s=this.params._avatarHost||"https://avatars.mds.yandex.net",o=t.displayName.default_avatar,r=i.domElem.clone().bem("user-account"),a=JSON.parse(r.domElem.attr("data-bem"));n="object"==typeof n?{fb:"Facebook",tw:"Twitter",mr:"Mail.ru",gg:"Google",ok:"Odnoklassniki",vk:"Vkontakte",dz:"Deezer",fs:"Foursquare",ig:"Instagram",lf:"Last.FM",lj:"LiveJournal",in:"LinkedIn",mt:"МТС-Россия",ms:"Microsoft",yh:"Yahoo",ya:"Yandex",vf:"Vodafone-Украина",tg:"Telegram"}[n.provider]:n,a.user2__account={uid:t.uid,pos:e},r.domElem.attr("data-bem",JSON.stringify(a)),r.delMod("template"),r.elem("name-text").text(t.displayName.name),n&&(r.setMod("has-subname","yes"),r.elem("subname").text(n));var h=r.findBlockInside("user-pic"),c=s+"/get-yapic/"+o+"/islands-middle",l=s+"/get-yapic/"+o+"/islands-retina-middle";h.elem("image").attr("src",c),h.elem("image").attr("srcSet",c+" 1x, "+l+" 2x");var u=document.createElement("div");return u.className="menu__item",u.appendChild(r.domElem[0]),u},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{accountsDataProvider:"user2__accounts-provider",accountsMax:this._params.accountsMax||5,maxLength:this._params.maxLength||16})}}),BEM.decl({block:"user2__accounts-provider",baseBlock:"i-request_type_ajax"},{getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{url:this._params.accountsUrl,timeout:5e3,dataType:"json",xhrFields:{withCredentials:!0},cache:!1})}}),BEM.DOM.decl({block:"user2",modName:"fetch-unread",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._unreadDataProvider=BEM.create(this.params.unreadDataProvider,{callbackCtx:this,exportHost:this.params.exportHost}),this._fetchUnread()}}},_fetchUnread:function(){this._unreadDataProvider.get({key:this.params._yu},this._onFetchUnreadSuccess)},_onFetchUnreadSuccess:function(t){this.setUnreadCount(t.unread||0)},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{unreadDataProvider:"user2__unread-provider"})}}),BEM.decl({block:"user2__unread-provider",baseBlock:"i-request_type_ajax"},{getDefaultParams:function(){var t=this._params.exportHost||"https://export.yandex.ru";return $.extend(this.__base.apply(this,arguments),{url:t+"/for/unread.xml",cache:!1})}}),BEM.DOM.decl("i-keyrouter",{onSetMod:{js:{inited:function(){this.bindToDoc("keydown",function(t){if(this.__self.instance=this,!document.activeElement||!/(INPUT|TEXTAREA)/.test(document.activeElement.nodeName))return this._onKeydown(t)})}}},_onKeydown:function(t){switch(t.keyCode){case 37:case 65:case 72:this.__self.isSpecialKey(t)&&this._emitPress("left",t);break;case 39:case 68:case 76:this.__self.isSpecialKey(t)&&this._emitPress("right",t);break;case 32:this._emitPress("space",t);break;case 70:this._emitPress("f",t);break;case 79:this._emitPress("o",t);break;case 86:this._emitPress("v",t);break;case 34:this._emitPress("pagedown",t);break;case 33:this._emitPress("pageup",t);break;case 13:this._emitPress("enter",t);break;case 27:this._emitPress("esc",t),t.stopImmediatePropagation();break;case 8:this._emitPress("backspace",t);break;case 38:case 87:case 75:this.__self.isSpecialKey(t)&&this._emitPress("up",t);break;case 40:case 83:case 74:this.__self.isSpecialKey(t)&&this._emitPress("down",t)}return!t.isImmediatePropagationStopped()},_emitPress:function(t,e){this.trigger(t,e),BEM.channel("keyrouter").trigger(t,e)}},{get:function(){return this.instance},isSpecialKey:function(t){return!(t.ctrlKey||t.altKey||t.metaKey||t.shiftKey)}}),BEM.DOM.decl("i-keyrouter",{trigger:function(t,e){return window.Ya.reactBus&&window.Ya.reactBus.emit("i-keyrouter:"+t,e),this.__base.apply(this,arguments)}}),BEM.DOM.decl("cookies",{onSetMod:{js:{inited:function(){this.__self.save(this.params.cookies)}}}},{save:function(t){t&&t.forEach(function(t){document.cookie=t})}}),BEM.DOM.decl("b-page",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.channel("bundle-loaded").on("collections-daas",this.enableDaaS,this)}}},destruct:function(){BEM.channel("bundle-loaded").un("collections-daas",this.enableDaaS,this),this.__base.apply(this,arguments)},enableDaaS:function(){this.__base.apply(this,arguments),BEM.blocks["collections-controller"].enableDaaS()}}),function(t){t.decl("i-userinfo",{resolutions:[{width:240,height:320,ratio:{width:3,height:4}},{width:320,height:480,ratio:{width:2,height:3}},{width:480,height:800,ratio:{width:3,height:5}},{width:640,height:960,ratio:{width:2,height:3}},{width:600,height:1024,ratio:{width:3,height:5}},{width:768,height:1024,ratio:{width:3,height:4}},{width:1920,height:1080,ratio:{width:16,height:9}},{width:1680,height:1050,ratio:{width:16,height:10}},{width:1600,height:900,ratio:{width:16,height:9}},{width:1440,height:900,ratio:{width:16,height:10}},{width:1280,height:1024,ratio:{width:5,height:4}},{width:1366,height:768,ratio:{width:16,height:9}},{width:1280,height:800,ratio:{width:16,height:10}},{width:1152,height:864,ratio:{width:4,height:3}},{width:1024,height:768,ratio:{width:4,height:3}},{width:1200,height:800,ratio:{width:3,height:2}},{width:1280,height:720,ratio:{width:16,height:9}},{width:1280,height:768,ratio:{width:5,height:3}},{width:1280,height:960,ratio:{width:4,height:3}},{width:1366,height:768,ratio:{width:16,height:9}},{width:1400,height:1050,ratio:{width:4,height:3}},{width:1600,height:1200,ratio:{width:4,height:3}},{width:1680,height:945,ratio:{width:16,height:9}},{width:1920,height:1200,ratio:{width:16,height:10}},{width:2048,height:1152,ratio:{width:16,height:9}},{width:2048,height:1536,ratio:{width:4,height:3}},{width:2560,height:1440,ratio:{width:16,height:9}},{width:2560,height:1600,ratio:{width:16,height:10}}],getScreenSize:function(t){var e=this.getDefaultResolution(this.getDeviceInfo(t));if(!t)return e;var i=t.userInfo||{},n={width:i.sw||e.width,height:i.sh||e.height};return n.ratio=this.getRatio(n),n},getWindowSize:function(t){var e,i=this.getDefaultResolution(this.getDeviceInfo(t));return t?{width:(e=t.userInfo||{}).ww||i.width,height:e.wh||i.height}:i},getScreenResolution:function(t){var e=this.getScreenSize(t),i=this.getPixelDensity(t);return{width:Math.floor(e.width*i),height:Math.floor(e.height*i)}},getDeviceInfo:function(t){return{isTablet:t.isTablet,isMobile:t.isMobile,iOS7:t.iOS7,iOS:t.iOS,wp:t.isWindowsPhone}},getDefaultResolution:function(t){var e={width:1366,height:768};return t?(t.isTablet?e={width:1024,height:768}:t.isMobile&&(e={width:640,height:960}),e):e},getRatio:function(t){return{1.25:{width:5,height:4},1.33:{width:4,height:3},1.56:{width:3,height:2},1.6:{width:16,height:10},1.66:{width:5,height:3},1.77:{width:16,height:9},1:{width:1,height:1},.6:{width:3,height:5},.66:{width:2,height:3},.67:{width:2,height:3},.75:{width:3,height:4},.58:{width:3,height:5},.56:{width:9,height:16}}[this.calcRatio(t)]||{width:16,height:9}},getPixelDensity:function(t){return Number((t.userInfo||{}).pd)||1},isRetinaDisplay:function(t){return this.getPixelDensity(t)>1.5},parseResolution:function(t){var e=t.split("x");return{width:parseInt(e[0],10),height:parseInt(e[1],10)}},extendedScreenSize:function(t){var e=this.getDeviceInfo(t),i=this.getScreenResolution(t),n=i.width,s=i.height,o=e.isTablet,r=e.isMobile,a=e.iOS7,h=e.iOS,c=e.wp;return o&&a?n=s=2448:r&&a?(n=1040,s=1536):r&&!h&&!c||o?n=s=Math.max(n,s):h&&!a&&(n=640,s=1136),{width:n,height:s}},findAppropriateResolution:function(t,e,i){var n;return e||(e=this.resolutions),(n=e.map(function(e){return this.calcResolutionDelta(e,t)},this)).sort(this.compare),i?this.getResolutions(n,i):n[0].resolution},getResolutions:function(t,e){for(var i=new Array(e),n=0;n<e;n++)i[n]=t[n].resolution;return i},compare:function(t,e){var i=Math.abs(t.square),n=Math.abs(e.square);return t.ratio===e.ratio?t.square>=0&&e.square>=0?t.square<=e.square?-1:1:Math.min(i,n)<1e5?i<n?-1:1:t.square>e.square?-1:1:i===n?t.ratio<e.ratio?-1:1:i*t.ratio<=n*e.ratio?-1:1},calcResolutionDelta:function(t,e){var i=t.ratio||t;return{ratio:Math.abs(this.calcRatio(i)-this.calcRatio(e)),square:this.calcSquare(t)-this.calcSquare(e),resolution:t}},calcRatio:function(t){return Math.floor((t.width||t.w)/(t.height||t.h)*100)/100},calcSquare:function(t){return(t.width||t.w)*(t.height||t.h)}})}("undefined"!=typeof BEMPRIV?BEMPRIV:BEM),BEM.decl("i-userinfo",{getDefaultParams:function(){return{separator:"-"}},getScreenSize:function(){var t,e=this.getDeviceInfo(),i=window.screen,n={width:i.width,height:i.height,ratio:this.getRatio(i)};return e&&e.isTablet&&n.width<n.height&&(t=n.width,n.width=n.height,n.height=t),n},getDeviceInfo:function(){var t=BEM.blocks["i-global"],e=BEM.blocks["i-ua"];return{isTablet:t.param("tablet"),isMobile:t.param("mobile"),iOS:e.ios,iOS7:parseInt(e.ios,10)>=7,wp:e.wp}},getUserInfo:function(){var t=this.params.separator,e=this.getScreenSize(),i=this.getWindowSize();return[["sw",e.width].join(t),["sh",e.height].join(t),["ww",i.width].join(t),["wh",i.height].join(t),["pd",this.getPixelDensity()].join(t),["wp",this.getWP()].join(t)].join(t)},getWindowSize:function(){return{width:window.innerWidth,height:window.innerHeight}},getPixelDensity:function(){return BEM.DOM.win[0].devicePixelRatio||1},getWP:function(){var t=this.getScreenInfo();return t.ratio.width+"x"+t.ratio.height+"_"+t.width+"x"+t.height},getScreenInfo:function(){if(this._screen)return this._screen;var t=this.getScreenResolution(),e=this.findAppropriateResolution(t);return this._screen={width:e.width,height:e.height,ratio:e.ratio},this._screen}},{_instance:null,get:function(){return this._instance||(this._instance=BEM.create("i-userinfo"))}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_search-by-image",this._onCbirSearch,this),this},_onCbirSearch:function(t,e){this.checkCacheKey()&&this.loadPage(e,"search-by-image"),BEM.blocks.header.getSearch().updateCbirPage()}}),BEM.DOM.decl({block:"b-page",modName:"type",modVal:"search-by-image"},{buildCacheKey:function(){var t=this._location.getState(),e=this._getFilterParams().filter(function(t){return"img_url"!==t});return[t.block?t.block:"",t.type?t.type:"",BEM.blocks.uri.delParams(t.url,e)].join("_")}}),BEM.DOM.decl("b-page",{bindEvents:function(){return this.__base.apply(this,arguments),this._location.on("b-page_type_similar",this._onPageSimilar,this),this},_onPageSimilar:function(t,e){this.checkCacheKey()&&this.loadPage(e,"similar"),BEM.blocks.header.getSearch().updateCbirPage()}}),BEM.DOM.decl("feedback",{externalData:{},onSetMod:{js:{inited:function(){this.checkboxes=this.findBlocksInside("checkbox"),this.submit=this.findBlockInside({block:"button",modName:"type",modVal:"submit"}).on("press",this.submitFeedback,this),this.findBlockInside({block:"button",modName:"type",modVal:"close"}).on("press",function(){this.popup.hide()},this),this.popup=this.findBlockInside("popup").on("show",this.onShowPopup,this).on("hide",this.onHidePopup,this),this.popup.params.top=this.popup.params.top||"50%",this.setCheckboxEvent(),this._ajax=BEM.create("i-request_type_ajax",{url:this.params.abuseLink,cache:!1,dataType:"script",type:"POST"}),this.channel("feedback").on("show",this.showFeedback,this)}}},showFeedback:function(t,e){this.externalData=e,this.resetPopup(),this.popup.toggle()},resetPopup:function(){this.checkboxes.forEach(function(t){t.delMod("checked")}),this.popup.findBlockInside("radiobox").val("no"),this.popup.delMod("thanks"),this.popup.findElem("result").hide(),this.popup.findElem("complaint").show()},setCheckboxEvent:function(){var t=this.findBlocksInside("checkbox"),e=this;t&&t.map(function(t){t.on("change",e.checkboxChanged,e)})},checkboxChanged:function(){this.submit.setMod("disabled",this.hasCheckedItems()?"":"yes")},hasCheckedItems:function(){return this.checkboxes.filter(function(t){return t.isChecked()}).length>0},submitFeedback:function(){var t=this;this._ajax.params.url=this.externalData.abuseLink,this._ajax.get(t.getLogParams(),this.onSuccess),setTimeout(function(){t.popup.setMod("thanks","yes"),t.popup.findElem("result").show(),t.popup.findElem("complaint").hide()},200)},defaultParams:function(){var t=this.popup.findBlocksInside("checkbox").filter(function(t){return t.isChecked()}).map(function(t){return t.val()}).toString(),e=this.popup.findBlockInside("radiobox").val(),i=this.params&&this.params.request,n={"complaint-query":e,"reason-complaint":t};return i&&$.extend(n,i),n},getLogParams:function(){return this.defaultParams()},onShowPopup:function(){},onHidePopup:function(){var t=this.popup;t.setMod("modal","hide"),setTimeout(function(){t.delMod("visibility"),t.delMod("modal")},150)},onSuccess:function(){}}),BEM.DOM.decl("feedback",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({blockName:"button",modName:"type",modVal:"submit"}).domElem.attr("onmousedown",this.params.submitCounter)}},getLogParams:function(){return $.extend({},this.__base.apply(this,arguments),{query:BEM.blocks["i-global"].param("query"),lr:this.params.lr,service:[BEM.blocks["i-global"].param("id"),"yandex",BEM.blocks["i-global"].param("tld")].join("."),"url-complaint":this.externalData.url,reqid:BEM.blocks["i-global"].param("serpid")})}}),BEM.DOM.decl("feedback",{getLogParams:function(){var t=this.__base.apply(this,arguments),e=this.getExternalData();return this.clearUndefinedValues(Object.assign(t,e))},clearUndefinedValues:function(t){return Object.keys(t).reduce(function(e,i){var n=t[i];return void 0!==n&&(e[i]=n),e},{})},getExternalData:function(){return{"shows-urls":BEM.blocks["serp-list"].getUrls().join(";"),"shows-related-images":this.externalData["shows-related-images"],"shows-related-queries":this.externalData["shows-related-queries"],"related-query-complaint":this.externalData["related-query-complaint"],"related-image-complaint":this.externalData["related-image-complaint"],reqid:BEM.blocks["i-global"].param("reqid")}}},{showPopup:function(t){BEM.channel("feedback").trigger("show",{url:BEM.blocks["serp-item"].getUrls(t).join(";"),abuseLink:BEM.blocks["i-global"].param("abuseLink")})},live:function(){return this.__base.apply(this,arguments),window.Ya&&window.Ya.reactBus&&Ya.reactBus.on("feedback:show",function(t){BEM.channel("feedback").trigger("show",{url:t.urls.join(";"),abuseLink:BEM.blocks["i-global"].param("abuseLink")})},this),!1}}),BEM.DOM.decl("head-filter",{getDefaultParams:function(){return{reloadParams:["p","img_url","rpt","pos"],pagesToFilter:{"search-by-image":["rpt","img_url"],similar:["rpt","img_url"]},popupDelay:1e3}},onSetMod:{js:{inited:function(){this.hasMod("disabled","yes")||this.findBlocks().bindEvents()}},hovered:function(t,e){"yes"===e?this.setColorIcon():this.setBlackIcon()},menu:{hidden:function(){this.setBlackIcon(),this.tooltipOwner&&this.tooltipOwner.delMod("disabled"),BEM.blocks["i-keyrouter"]&&BEM.blocks["i-keyrouter"].un("esc",this._onEsc,this)},visible:function(){this.setBlackIcon(),this.bindTo("item","keypress",this._onItemSelect),this.tooltipOwner&&this.tooltipOwner.setMod("disabled",!0),BEM.blocks["i-keyrouter"]&&BEM.blocks["i-keyrouter"].on("esc",this._onEsc,this)}},type:function(t,e){this.params.selected=e,this.trigger("saved"),this.updatePage().updateTooltip().updateMenu().closeMenu()},disabled:function(t,e){this.button.setMod("disabled",e)}},destruct:function(){this.unbindEvents(),this.__base.apply(this,arguments)},findBlocks:function(){return this.infoPopup=this.findBlockInside({block:"popup",modName:"type",modVal:"info"}),this.tooltipOwner=this.findBlockOn("tooltip-owner"),this.dropdown=this.findBlockOn("dropdown-menu"),this.button=this.dropdown.findBlockInside("button2"),this.filterPopup=this.findBlockOn("menu","popup"),this.menu=this.filterPopup.findBlockInside("b-menu-vert"),this.elem("item"),this},bindEvents:function(){return this.filterPopup.on("show",this._onMenuShow,this).on("hide",this._onMenuHide,this),this.infoPopup.on("show",this._onInfoShow,this).on("hide",this._onInfoHide,this),BEM.blocks["b-page"].on("warning",this._onWarning,this),BEM.blocks.notice&&BEM.blocks.notice.on({"safe-search:turn-off":this.reloadPage},this),this.bindTo("mouseover mouseout",this._onMouseMove),this.menu.bindTo(this.menu.elem("item"),"click",this.changeThis(this._onItemClick)),this},unbindEvents:function(){this.filterPopup.un("show",this._onMenuShow,this).un("hide",this._onMenuHide,this),this.infoPopup.un("show",this._onInfoShow,this).un("hide",this._onInfoHide,this),BEM.blocks["b-page"].un("warning",this._onWarning,this),BEM.blocks.notice&&BEM.blocks.notice.un({"safe-search:turn-off":this.reloadPage},this)},_onItemSelect:function(t){this.selectItem($(t.target))},_onEsc:function(){this.filterPopup.hide(),this.domElem.focus()},_onWarning:function(t,e){this.params.warning=e.pornoWarning,e.onlyFamily?this.setMod("type","family").setMod("disabled","yes"):this.delMod("disabled")},_onMouseMove:function(t){this.hasMod("disabled","yes")||this.setMod("hovered","mouseover"===t.type?"yes":"")},_onItemClick:function(t){return this.selectItem($(t.target)),!1},_onMenuShow:function(){this.infoPopup.isShown()&&this.infoPopup.hide(),this.setMod("menu","visible")},_onMenuHide:function(){this.setMod("menu","hidden")},_onInfoShow:function(){this.closeMenu().setColorIcon().setMod("info","visible")},_onInfoHide:function(){this.delMod("info").setBlackIcon()},selectItem:function(t){var e=this.elemParams(t).value;e&&this.setMod("type",e),BEM.blocks["b-statcounter"].hit({params:{query:{safe:e}}})},updateMenu:function(){var t=this.getFilterData(this.params.selected),e=this.menu;return e.delMod(e.elem("item","selected","yes"),"selected").setMod(e.elem("item","type",t.type),"selected","yes"),this},updateTooltip:function(){if(!this.tooltipOwner)return this;var t=this.getFilterData(this.params.selected);return this.tooltipOwner.setContent(t.tooltip),this},updatePage:function(){var t=this.params,e=this.getFilterData(t.selected),i=BEM.blocks["i-global"],n=BEM.blocks.location.getInstance().getState().url.replace("/images/images/","/images/"),s=BEM.blocks.uri.delParams(n,this.getFilteredParams(i.param("page")));return this.saveFilter({save:1,retpath:t.needRefresh?s:t.retpath,yandexuid:i.param("yandexuid"),family:e.value}),this},saveFilter:function(t){var e=this.params,i=e.saveUrl;e.needRefresh?location.href=i+BEM.blocks.uri.buildRelativeUrl("",t):BEM.create("i-request_type_ajax",{url:i,type:"iframe",cache:!1,dataType:"html"}).get(t,this.reloadPage.bind(this),this.reloadPage.bind(this))},reloadPage:function(){var t=BEM.blocks["i-global"].param("page");return BEM.blocks.location.getInstance().change({url:BEM.blocks.uri.delParams(this.getFilteredParams(t)),params:{ncrnd:Math.floor(1e4*Math.random())},history:!1}),this.checkInfoMessage(!0)},checkInfoMessage:function(t){var e=this.params,i=this.getFilterData(e.selected).type;return this.infoPopup?(t&&"unlimited"===i&&this.showInfo(),this):this},showInfo:function(){return this.prepareInfo(),setTimeout(this.changeThis(this.showInfoPopup),this.params.popupDelay),this},prepareInfo:function(){var t=this.getFilterData(this.params.selected),e=this.infoPopup;return e.setMod("filter",t.type),e.elem("content-wrap").html(t.info),this},showInfoPopup:function(){return this.infoPopup.show(this.elem("icon")),this.setMod("info","visible")},closeMenu:function(){return this.filterPopup.isShown()&&this.filterPopup.hide(),this},getFilteredParams:function(t){var e={},i=this.params.reloadParams||[];return(this.params.pagesToFilter[t]||[]).forEach(function(t){e[t]=!0}),i.filter(function(t){return!e.hasOwnProperty(t)})},getFilterData:function(t){for(var e=this.params.filters,i=0,n=e.length;i<n;i++)if(e[i].type===t)return e[i]},setColorIcon:function(){return this.setMod("color","yes")},setBlackIcon:function(){return setTimeout(this.changeThis(function(){this.isActive()||this.setMod("color","no")}),150),this},isActive:function(){return this.hasMod("hovered","yes")||this.hasMod("menu","visible")||this.hasMod("info","visible")}}),BEM.DOM.decl({block:"dropdown-menu",baseBlock:"dropdown"}),BEM.DOM.decl("i-menu",{onElemSetMod:{item:{state:{current:function(t,e,i,n){if("disabled"===n)return!1;var s=this.elem("item","state","current");this.delMod(s,"state").trigger("current",{prev:s,current:t})}}}},onItemSelectorClick:function(t){var e=this._getItemByEvent(t);this.setMod(e,"state","current")},_getItemByEvent:function(t){return t.data.domElem.closest(this.buildSelector("item"))}},{live:function(){this.liveBindTo("item-selector","pointerclick",function(t){this.onItemSelectorClick(t)})}}),BEM.DOM.decl({block:"b-menu-vert",baseBlock:"i-menu"}),BEM.DOM.decl({name:"b-menu-horiz",baseBlock:"i-menu"}),BEM.DOM.decl({block:"serp-counter"},{_isSearchPage:function(){return"search"===BEM.blocks["i-global"].param("page")},_onTagClick:function(t){if(this._isSearchPage()){var e=["-pos=p"+t.pos,"-text="+t.query];(t.group||0===t.group)&&e.push("-group=p"+t.group),c.hit({dtype:"iweb",path:"/image/new/serp/tags",reqid:BEM.blocks["i-global"].param("reqid"),vars:e.join(",")},t)}}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("tag-click","tags",function(t,e){this._onTagClick(e)})}}),BEM.DOM.decl({block:"cbir-counter"},{_onCbirInputClick:function(){window.c.hit({dtype:"iweb",path:"/image/new/cbir/panel/open",vars:"-target=header"})},_onCbirPanelDragFile:function(t){window.c.hit({dtype:"iweb",path:"/image/new/cbir/panel/drag/file",vars:["-size="+(t.fileSize||""),"-type="+(t.fileType||"")].join(",")})},_onCbirPanelDragUrl:function(t){window.c.hit({dtype:"iweb",path:"/image/new/cbir/panel/drag/url",vars:"-img_url="+encodeURIComponent(t.url)})},_onImageUploadStart:function(t){window.c.hit({dtype:"iweb",path:"/image/new/cbir/upload_photo/start",vars:["-size="+(t.fileSize||""),"-type="+(t.fileType||"")].join(",")}),this.imageUploadStartTime=Date.now()},_onImageUploadSuccess:function(t){this.imageUploadStartTime&&window.c.hit({dtype:"iweb",path:"/image/new/cbir/upload_photo/success",vars:["-size="+(t.fileSize||""),"-type="+(t.fileType||""),"-time="+(Date.now()-this.imageUploadStartTime)].join(",")})},_onImageUploadError:function(t){this.imageUploadStartTime&&(window.c.hit({dtype:"iweb",path:"/image/new/cbir/upload_photo/error",vars:["-size="+(t.fileSize||""),"-type="+(t.fileType||""),"-status="+(t.statusCode||""),"-result="+(t.result?encodeURIComponent(t.result):""),"-time="+(Date.now()-this.imageUploadStartTime)].join(",")}),this.imageUploadStartTime=void 0)}},{live:function(){this.liveInitOnBlockInsideEvent("cbir-click","input",function(){this._onCbirInputClick()}).liveInitOnBlockInsideEvent("drag-file","cbir-panel",function(t,e){this._onCbirPanelDragFile(e)}).liveInitOnBlockInsideEvent("drag-url","cbir-panel",function(t,e){this._onCbirPanelDragUrl(e)}).liveInitOnBlockInsideEvent("image-upload-start","i-cbir-controller",function(t,e){this._onImageUploadStart(e)}).liveInitOnBlockInsideEvent("image-upload-success","i-cbir-controller",function(t,e){this._onImageUploadSuccess(e)}).liveInitOnBlockInsideEvent("image-upload-error","i-cbir-controller",function(t,e){this._onImageUploadError(e)})}}),BEM.DOM.decl("direct-counters",{_getPath:function(t,e){},_hitCounter:function(t,e){if(t){var i=[];void 0!==e.insertionPage&&i.push("-page="+e.insertionPage),void 0!==e.directId&&i.push("-direct_id="+e.directId),void 0!==e.withThumb&&i.push("-with_thumb="+Number(e.withThumb)),e.type&&i.push("-type="+e.type),c.hitDelayed({dtype:"iweb",path:t,reqid:this.params.reqid,vars:i.join(",")})}},_onDirectShow:function(t){var e=this._getPath("show",t.type);this._hitCounter(e,t)},_onDirectClick:function(t){var e=this._getPath(t.clickTypeMatch||"thumb",t.type);this._hitCounter(e,t)},_onDirectClose:function(t){var e=this._getPath("close",t.type);this._hitCounter(e,t)}},{live:function(){this.liveInitOnBlockInsideEvent("direct:show","direct",function(t,e){this._onDirectShow(e)}).liveInitOnBlockInsideEvent("direct:click","direct",function(t,e){this._onDirectClick(e)}).liveInitOnBlockInsideEvent("direct:close","direct",function(t,e){this._onDirectClose(e)})}}),BEM.DOM.decl("direct-counters",{_getPath:function(t,e){switch(e){case"search":return"/image/new/serp/bottom/commercial/incut/"+t+"/direct";case"between":return"/image/new/serp/page/commercial/incut/"+t+"/direct"}}});var engine=new bemhtml({production:!0});engine.compile(function(){block("incut").attrs()(function(){var t={},e=this.ctx.js;return e.position>=0&&e.positionType&&(t["data-position"]=e.position,t["data-position-type"]=e.positionType),e.posShift&&(t["data-position-shift"]=e.posShift),this.ctx.gridType&&(t["data-type"]=this.ctx.gridType),t}),block("rub")(tag()("span"),content()("&#8381;")),block("rub").mod("space","yes")(tag()("span"),content()("&thinsp;&#8381;")),block("dropdown")(js()(!0),("undefined"!=typeof addJs?addMix:mix)()(function(){return[{mods:{action:"closed"}}]}),elem("popup").replace()(function(){var t=this.ctx,e=[{block:"dropdown",elem:"popup"}];return t.mix&&(e=e.concat(t.mix)),{block:"popup",mix:e,mods:this.elemMods,underMods:t.underMods,attrs:t.attrs,js:t.js,content:[{elem:"tail"},{elem:"content",content:t.content}]}})),block("dropdown")(elem("text").tag()("span"),elem("switcher-text").tag()("span")),block("popup")(def().match(function(){return!this._popupDefaults})(function(){var t=this.ctx,e=this.mods;if(e.hasOwnProperty("theme")||(e.theme="ffffff"),e.hasOwnProperty("autoclosable")||(e.autoclosable="yes"),e.hasOwnProperty("adaptive")||(e.adaptive="yes"),e.hasOwnProperty("animate")||(e.animate="yes"),t.zIndex){var i=t.attrs||(t.attrs={});i.style=(i.style||"")+";z-index:"+t.zIndex+";"}return apply("default",{_popupDefaults:!0})}),content()(function(){return delete this._popupDefaults,[{elem:"under",elemMods:this.ctx.underMods},this.ctx.content]})),oninit(function(t){var e=t.BEMContext.prototype,i=t["i-global"]=e["i-global"]=e.extend({lang:"ru",tld:"ru","content-region":"ru","click-host":"//clck.yandex.ru","passport-host":"https://passport.yandex.ru","pass-host":"https://pass.yandex.ru","social-host":"https://social.yandex.ru","export-host":"https://export.yandex.ru",login:"","lego-static-host":"https://yandex.ru/images/_crpd/hmiK28s06/3a2294DBBNSc/f1sZgUG29fpaWiHswyxKFuIwU-bsCrlCgD2WESG0a7uEbJag"},e["i-global"]);i._public={id:!0,lang:!0,tld:!0,"content-region":!0,"user-region":!0,login:!0,displayName:!0,index:!0,yandexuid:!0,"passport-host":!0,"pass-host":!0,"passport-msg":!0,"static-host":!0,"lego-static-host":!0,"social-host":!0,clck:!0,"click-host":!0,"export-host":!0,"i-host":!0,"social-retpath":!0,"lego-path":!0,sid:!0,retpath:!0,uid:!0},i.makePublic=function(t,n){"object"!=typeof t?(void 0===n&&(n=!0),i._public[t]=n):i._public=e.extend(i._public,t)},i.isPublic=function(t){return Boolean(i._public[t])},i.setTld=function(t){var e="tr"===t?"yandex.com.tr":"yandex."+t,n=-1!==["ua","by","kz"].indexOf(t)?"yandex.ru":e;i.tld=t,i["content-region"]=t,i["click-host"]="//clck."+n,i["passport-host"]="https://passport."+n,i["pass-host"]="https://pass."+e,i["social-host"]="https://social."+e,i["export-host"]="https://export."+e},e._iGlobalBackup={_backup:null,exists:function(){return Boolean(this._backup)},save:function(){this._backup=e.extend({},i)},restore:function(){var t;for(t in i)delete i[t];for(t in this._backup)i[t]=this._backup[t]}}}),block("i-global")(tag()(""),def()(function(){var t=this.ctx.params||{},e=this["i-global"];for(var i in this._iGlobalBackup.exists()?!1!==this.ctx.reset&&this._iGlobalBackup.restore():this._iGlobalBackup.save(),t.tld&&t.tld!==e.tld&&e.setTld(t.tld),t)e[i]=t[i];return""})),oninit(function(t){var e=t["i-global"];["serpid","reqid","query","searchInputText","project","page","pageCounterPath","mobile","isYandexApp","isYandexAppIos","isYandexAppAndroid","isYandexLauncher","isHeaderDisabled","tablet","counterDebug","counterParams","seo","router","isOldBrowser","showRelevance","uid","ncrnd","isYandexNet","enableSamesiteSc","isPumpkin","isSpok","testId","serviceName","isUzkubr","expFlags","clck","abuseLink","pushBundleAsyncOnInit","pushBundleAsyncUrls","source","nonce","isPornoQuery","isIntegrationTest","filterIsForced","cm2","commRegion","platform","isCbirEnabled","lags","isPornoQuery","perfOpt","incutPosition","rimConfig","resizer","lr","tld","lang","loginNorm","metaReferrerContent"].forEach(function(t){e.makePublic(t)})}),block("i-ua")(bem()(!1),tag()("script"),("undefined"!=typeof addAttrs?addAttrs:attrs)()(function(){return{nonce:this.ctx.nonce||this["i-global"].nonce}}),content()(function(){return[{html:[";(function(d,e,c,r){","e=d.documentElement;",'c="className";','r="replace";','e[c]=e[c][r]("i-ua_js_no","i-ua_js_yes");','if(d.compatMode!="CSS1Compat")','e[c]=e[c][r]("i-ua_css_standart","i-ua_css_quirks")',"})(document);"].join("")}]})),block("i-ua").content()(function(){var t=[";(function(d,e,s,o,p){","e=d.documentElement;","s=e.style;",'o="object-fit";','p="OObjectFit";','e.className+=(o in s||p in s)?"":" i-ua_"+o+"_no"',"})(document);"].join("");return[].concat(applyNext(),{html:t})}),block("i-ua").content()(function(){var t=[";(function(w,e,s,c,x,l,p,d){",'c="className";','x="deviceXDPI";','l="logicalXDPI";','p="devicePixelRatio";',"d=x in s&&l in s&&s[x]/s[l]||p in w&&w[p];",'d>1&&(e[c]+=" i-ua_retina_yes")',"})(window,document.documentElement,screen);"].join("");return[].concat(applyNext(),{html:t})}),block("popup").elem("tail").tag()("i"),block("dropdown").mod("advanced","yes")(elem("hidden-value")(tag()("input"),attrs()(function(){return{type:"hidden",name:this.ctx.name,value:this.ctx.value||""}})),elem("title-text")(tag()("span"))),block("suggest2").elem("items").tag()("ul"),block("suggest2-item")(tag()("li"),("undefined"!=typeof addJs?addJs:js)()(!0),elem("text")(tag()(function(){return this.ctx.tag||"span"}),content()(function(){return console.assert(this.ctx.hasOwnProperty("text")!==this.ctx.hasOwnProperty("content"),"suggest2-item: Conflicting text and content fields."),this.ctx.text?Array.isArray(this.ctx.text)?this.ctx.text.map(function(t){return"string"==typeof t?t?{html:this.xmlEscape(t)}:"":t},this):this.ctx.text?{html:this.xmlEscape(this.ctx.text)}:"":Array.isArray(this.ctx.content)?this.ctx.content.map(function(t){return"string"==typeof t?t?{html:this.xmlEscape(t)}:"":t},this):this.ctx.content?{html:this.xmlEscape(this.ctx.content)}:""})),elem("fact").tag()("span")),block("suggest2-item")(elem("thumb")(match(function(){return!this.ctx.content})(content()(function(){return[{elem:"thumb-badge",attrs:{style:"background:"+(this.ctx.badgeColor||"#04b;color:#fff;")},content:this.ctx.badge}]}),("undefined"!=typeof addAttrs?addAttrs:attrs)()(function(){return{style:(this.ctx.color?"background-color:"+this.ctx.color+";":"")+(this.ctx.src?"background-image:url("+this.ctx.src+");":"")}}),def()(function(){return applyNext({"elemMods.badge":Boolean(this.ctx.badge)})})))),block("suggest2-item").elem("img").def()(function(){var t=this.ctx.attrs||{};return this.ctx.src&&(t.style="background-image: url('"+this.ctx.src+"');"+(t.style||"")),applyNext({"ctx.attrs":t})}),block("suggest2-item").elem("text").elemMod("type","title-url").tag()("div"),block("suggest2-item").elem("text").elemMod("type","green-url").tag()("div"),block("suggest2-item").elem("bullet")(tag()("span"),("undefined"!=typeof addAttrs?addAttrs:attrs)()({"aria-hidden":!0})),block("suggest2-item").elem("icon")(def()(function(){var t=BEM.blocks&&BEM.blocks["suggest2-detect"]&&BEM.blocks["suggest2-detect"],e=t&&t.isSupportInlineSVG()?"svg":"png";this.ctx.autoType&&(this.ctx[e]="//yandex.ru/images/_crpd/hmiK28s06/3a2294S0tAWM/e7_8MEGTJFoaXkDpc7xrAyO00_bY7-l3BQmz5VBg-rvkCsJw"+this.ctx.autoType+e);var i=this.ctx.png&&this.ctx.svg?this.ctx[e]:this.ctx.svg||this.ctx.png;return i&&(this.ctx.attrs=this.extend(Object(this.ctx.attrs),{style:'background-image:url("'+i+'");'+(Object(this.ctx.attrs).style||"")})),applyNext()}),tag()("span")),block("i-bem").elem("i18n").def()(function(){if(!this.ctx)return"";var t=this.ctx,e=t.keyset,i=t.key,n=t.params||{};return e||i?(t.content&&(n.content=this.reapply(t.content)),BEM.I18N(e,i,n)):""}),oninit(function(){!function(t,e){if(!e.I18N){t.BEM=e;var i=e.I18N=function(t,e){return e};i.keyset=function(){return i},i.key=function(t){return t},i.lang=function(){}}}(this,"undefined"==typeof BEM?{}:BEM)}),block("button2")(def()(function(){return void 0===this.mods.view&&(this.mods.view="classic"),this.mods.progress&&(this.mods.disabled="yes"),void 0===this.ctx.tabindex&&(this.ctx.tabindex="0"),applyNext()}),match(function(){return void 0===this.ctx.tag}).tag()("button"),("undefined"!=typeof addJs?addJs:js)()(function(){return{_tabindex:this.mods.disabled?this.ctx.tabindex:void 0}}),attrs()(function(){var t=this.ctx,e=Boolean(this.mods.disabled);return this.extend({type:"button",autocomplete:"off",id:t.id,title:t.title,name:t.name,value:t.val,tabindex:e?void 0:t.tabindex,disabled:e,"aria-disabled":e&&"true"},applyNext())}),match(function(){return!this.ctx.content}).content()(function(){var t=this.ctx;return[t.icon&&{elem:"icon",icon:t.icon},t.iconLeft&&{elem:"icon",elemMods:{side:"left"},icon:t.iconLeft},t.iconRight&&{elem:"icon",elemMods:{side:"right"},icon:t.iconRight},void 0!==t.text&&(this.isSimple(t.text)?{elem:"text",content:{html:this.xmlEscape(t.text)}}:this.extend(t.text,{elem:"text"}))].filter(Boolean)})),block("button2")(attrs()(function(){var t=applyNext()||{};return t["data-counter"]=this.ctx["data-counter"],t})),block("button2").elem("text").tag()("span"),block("suggest2-item").elem("highlight")(tag()("b"),bem()(!1),content()(function(){return this.xmlEscape(this.ctx.content)})),block("suggest2").elem("title").content()(function(){return[{elem:"a11y",content:BEM.I18N("suggest2","group")+": "},this.ctx.content]}),block("suggest2").elem("a11y").tag()("span"),block("suggest2-item").elem("fact")(match(function(){return this.ctx.color}).def()(function(){return this.ctx.attrs=this.extend(Object(this.ctx.attrs),{style:";color:"+this.ctx.color+";"+(Object(this.ctx.attrs).style||"")}),applyNext()}),content()(function(){return[{block:"suggest2",elem:"a11y",content:BEM.I18N("suggest2-item","quick-answer")+": "},this.ctx.content?{html:this.xmlEscape(this.ctx.content)}:""]})),block("suggest2-item").mod("type","nav").elem("fact").content()(function(){return this.xmlEscape(this.ctx.content)}),block("suggest2-item").mod("interact","link")(content()(function(){return{elem:"link",url:this.ctx.url,target:this.ctx.target||"_blank",content:this.ctx.content}}),match(function(){return"nav"===this.mods.type||"icon"===this.mods.type}).elem("text")["undefined"!=typeof addJs?"addMix":"mix"]()(function(){return{elemMods:{type:"url"}}})),block("suggest2-item").elem("link")(tag()("a"),("undefined"!=typeof addAttrs?addAttrs:attrs)()(function(){return{href:this.ctx.url,target:this.ctx.target}})),block("suggest2-item").elem("icon").match(function(){return this.elemMods.traffic}).def()(function(){return applyNext({"ctx.autoType":"traffic."+this.elemMods.traffic+"."})}),block("suggest2-item").elem("icon").match(function(){return this.elemMods.weather}).def()(function(){var t=this.elemMods.weather.replace("-","minus-").replace("+","plus-").replace(/_/g,"-");return applyNext({"ctx.autoType":"weather."+t+".","elemMods.weather":t})})});var BEMHTML={};engine.exportApply(BEMHTML),function(t){if("function"==typeof t.I18N&&t.I18N._proto)return t.I18N;"undefined"==typeof i18n&&(i18n={}),BEM=t;var e="_",i="__",n={},s=[],o=!1,r="undefined"!=typeof console&&"function"==typeof console.log;function a(t,e){if(o&&r){var i="keyset: "+e._keyset+" key: "+e._key+" (lang: "+e._lang+")";console.log(t,i)}}function h(){this._lang="",this._prj="lego",this._keyset="",this._key=""}h.prototype={lang:function(t){return this._lang=t,this},project:function(t){return this._prj=t,this},keyset:function(t,n){var o;return n&&function(t){t&&s.push(t)}(this._keyset),this._keyset="string"==typeof(o=t)?o:o.block+(o.elem?i+o.elem:"")+(o.modName?e+o.modName+e+o.modVal:""),this},key:function(t){return this._key=t,this},decl:function(t){var s=function(t){var n={};return t.split(i).forEach(function(t,i){var s=[i?"elem":"block","mod","val"];t.split(e).forEach(function(t,e){n[s[e]]=t})}),n}(this._keyset),o="i-tanker"===s.block?"tanker":this._prj,r=s.elem||this._keyset,a=this._key;(r=(o=i18n[o]||(i18n[o]={}))[r]||(o[r]={}))[a]="function"==typeof t?t:function(){return t};var h=n[this._lang]||(n[this._lang]={});(h[this._keyset]||(h[this._keyset]={}))[a]=t},val:function(t,e){var i=n[this._lang]&&n[this._lang][this._keyset];if(!i)return a("[I18N_NO_KEYSET] %s",this),"";var s=typeof(i=i[this._key]);return"undefined"===s?(a("[I18N_NO_VALUE] %s",this),""):"string"===s?i:i.call(e||this,t)},_cache:function(){return n}};var c=function(t,e,i){return c.keyset(t).key(e,i)};c._proto=new h,c.project=function(t){return this._proto.project(t),this},c.keyset=function(t){return this._proto.keyset(t,!0),this},c.key=function(t,e){var i,n,o=this._proto;return o.lang(this._lang).key(t),i=o.val(e,c),(n=s.length&&s.pop())&&o.keyset(n,!1),i},c.decl=function(t,e,i){var n,s=this._proto;for(n in i&&i.lang&&s.lang(i.lang),s.keyset(t),e)e.hasOwnProperty(n)&&s.key(n).decl(e[n]);return this},c.lang=function(t){return void 0!==t&&(this._lang=t),this._lang},c.debug=function(t){o=!!t},c.lang("ru"),t.I18N=c}("undefined"==typeof BEM?{}:BEM),"undefined"!=typeof BEM&&BEM.I18N&&(BEM.I18N.decl("adv-label",{"Реклама":"Реклама"},{lang:"ru"}),BEM.I18N.decl("advanced-search_spok_yes",{"Ещё":"Ещё","Обои":"Обои","Свежие":"Свежие","Товары":"Товары"},{lang:"ru"}),BEM.I18N.decl("b-statcounter__metrika",{JSERR_incorrectID:"Incorrect ID has been passed."},{lang:"ru"}),BEM.I18N.decl("boards",{"Ещё коллекции":"Ещё коллекции","Смотрите больше<br> на Яндекс.Коллекциях":"Смотрите больше<br> на Яндекс.Коллекциях"},{lang:"ru"}),BEM.I18N.decl("cbir-error_spok_yes",{"Закрыть":"Закрыть","Картинка не загрузилась, попробуйте загрузить другую.":"Картинка не загрузилась, попробуйте загрузить другую.","Ошибка":"Ошибка","Неправильный формат загружаемого файла. Попробуйте загрузить файл изображения.":"Неправильный формат загружаемого файла. Попробуйте загрузить файл изображения.","По указанному адресу не смогли найти картинку, попробуйте ввести другой адрес.":"По указанному адресу не смогли найти картинку, попробуйте ввести другой адрес.","Слишком большой файл, попробуйте загрузить другую картинку.":"Слишком большой файл, попробуйте загрузить другую картинку."},{lang:"ru"}),BEM.I18N.decl("cbir-intent_spok_yes",{"Загружаем картинку":"Загружаем картинку","Загруженная картинка":"Загруженная картинка","Закрыть":"Закрыть"},{lang:"ru"}),BEM.I18N.decl("cbir-panel_spok_yes",{"Введите адрес картинки":"Введите адрес картинки","Выберите файл":"Выберите файл","Найти":"Найти","Поиск по картинке":"Поиск по картинке","или перетащите его сюда":"или перетащите его сюда"},{lang:"ru"}),BEM.I18N.decl("collections-menu",{"Добавить карточку":"Добавить карточку","Ещё":"Ещё","Мне нравится":"Мне нравится","Мои коллекции":"Мои коллекции","Моя лента":"Моя лента","Темы":"Темы"},{lang:"ru"}),BEM.I18N.decl("competitors",{"Посмотреть «{query}» в других поисковых системах:":function(t){return"Посмотреть «"+t.query+"» в других поисковых системах:"},"Ссылки на поисковые системы скрыты, так как включен семейный фильтр":"Ссылки на поисковые системы скрыты, так как включен семейный фильтр"},{lang:"ru"}),BEM.I18N.decl("complain2",{"Пожаловаться":"Пожаловаться"},{lang:"ru"}),BEM.I18N.decl("copyright",{link:function(t){return"ООО «"+t.content+"»"},yandex:"ЯНДЕКС"},{lang:"ru"}),BEM.I18N.decl("custom-site_spok_yes",{"Адрес сайта":"Адрес сайта","На сайте":"На сайте","Отменить":"Отменить","Поиск картинок на сайте":"Поиск картинок на сайте"},{lang:"ru"}),BEM.I18N.decl("direct",{"Реклама":"Реклама"},{lang:"ru"}),BEM.I18N.decl("wAA1LXNe7s8QDE2xboaU",{"Контакты":"Контакты","Перейти":"Перейти","Юр.информация":"Юр.информация","Яндекс.Директ":"Яндекс.Директ","Контактная информация":"Контактная информация"},{lang:"ru"}),BEM.I18N.decl("favorites-button_spok_yes",{"Добавить в коллекцию":"Добавить в коллекцию","Перейти в коллекции":"Перейти в коллекции"},{lang:"ru"}),BEM.I18N.decl("feedback_spok_yes",{"Ваш отзыв будет использован алгоритмами Поиска.":"Ваш отзыв будет использован алгоритмами Поиска.","Вернуться на Яндекс":"Вернуться на Яндекс","На всю страницу":"На всю страницу","На этот результат":"На этот результат","Несоответствие запросу":"Несоответствие запросу","Пожаловаться":"Пожаловаться","Порнография":"Порнография","Причина жалобы":"Причина жалобы","Спасибо, что помогаете делать Яндекс лучше!":"Спасибо, что помогаете делать Яндекс лучше!","Шокирующая или неприятная информация":"Шокирующая или неприятная информация"},{lang:"ru"}),BEM.I18N.decl("footer",{about:"О компании","about-url":"//company.yandex.ru",advert:"Реклама","advert-url":"//advertising.yandex.ru/kupislova.xml?advertising",apps:"Мобильные приложения","apps-url":"//mobile.yandex.ru",stat:"Статистика",termsofuse:"Лицензия на поиск","termsofuse-url":"//legal.yandex.ru/termsofuse/"},{lang:"ru"}),BEM.I18N.decl("header-favorites-button",{"Коллекции":"Коллекции","Сохраняйте картинки, полезные ссылки, фотографии красивых мест и многое другое в Яндекс.Коллекции":"Сохраняйте картинки, полезные ссылки, фотографии красивых мест и многое другое в Яндекс.Коллекции","Подробнее":"Подробнее"},{lang:"ru"}),BEM.I18N.decl("i-services",{404:"404",adresa:"Адреса",advertising:"Реклама",afisha:"Афиша",all:"Все сервисы",api:"API",appmetrica:"AppMetrica",appsearch:"Приложения",audience:"Аудитории",auto:"Авто",autoru:"Авто.ру",avia:"Авиабилеты",aziada:"Азиада",ba:"Баян",backapv:"Партнер Я.Карт",balance:"Баланс",bar:"Бар","bar-ie":"Бар для ИЕ","bar-ie9":"Бар для ИЕ9",bayan:"Баннеры Яндекса",blogs:"Блоги",books:"Книги",browser:"Браузер",calendar:"Календарь",captcha:"ой...",catalogwdgt:"Каталог виджетов",chrome:"Хром с поиском Яндекса",city:"Города",cityday:"День города",clickhouse:"ClickHouse",collection:"Коллекция",company:"Компания",contest:"Contest",delivery:"Доставка",desktop:"Персональный поиск",direct:"Директ","direct.market":"Маркет",disk:"Диск",display:"Дисплей",ege:"ЕГЭ",ether:"Эфир",expert:"Эксперт",feedback:"Обратная связь",feedback2:"Обратная связь",ff:"ФФ с поиском Яндекса",fotki:"Фотки",fresh:"Свежее",games:"Игрушки",geocontext:"Геоконтекст",goroda:"Города",help:"Помощь",i:"Мои сервисы",ie:"ИЕ с поиском Яндекса",images:"Картинки","images-com":"Картинки",interests:"Интересы",internet:"Интернет",kassa:"Касса",keyboard:"Клавиатура",kraski:"Краски",kuda:"Куда все идут",large:"Яндекс для слабовидящих",legal:"Правовые документы",lenta:"Лента",libra:"Библиотека",literacy:"Неделя борьбы за грамотность",local:"Локальная сеть",lost:"Незабудки",love:"День взаимного тяготения — 13 августа",mail:"Почта",maps:"Карты","maps-wiki":"Народная карта",market:"Маркет","market.advertising":"Маркет",master:"Мастер",metrika:"Метрика",metro:"Метро",mirror:"Зеркало",mobile:"Мобильный",moikrug:"Мой Круг",money:"Деньги",museums:"Дни исторического и культурного наследия",music:"Музыка","music-partner":"Музыка: статистика",nahodki:"Мои находки",nano:"Нано",newhire:"Наниматор",news:"Новости",notifications:"Нотификационная панель",oauth:"Авторизация",online:"Онлайн",openid:"OpenID",opera:"Opera Software",opinion:"Цитаты",partners:"Рекламная сеть",partnersearch:"Поиск для партнеров",passport:"Паспорт",pdd:"Почта для домена",peoplesearch:"Люди",perevod:"Переводчик",plus:"Плюс",probki:"Пробки",pulse:"блоги: пульс",punto:"Punto switcher",pvo:"Ответы",rabota:"Работа",radar:"Радар",ramazan:"",rasp:"Расписания",realty:"Недвижимость",referats:"Рефераты",rk:"Есть вопросы?",root:"Яндекс.Олимпиада для Unix администраторов",school:"Школа",search:"Поиск",server:"Сервер",shtrafi:"Штрафы",site:"Поиск для сайта",slovari:"Словари",so:"Самооборона",social:"Социализм",soft:"Программы",sport:"Спорт",sprav:"Справочник",start:"Стартовая страница",stat:"Статистика",subs:"Подписки",taxi:"Такси",telephony:"Телефония",terms:"Разговорник",tests:"Тесты и опросы",tickets:"Билеты",time:"Яндекс.Время",toloka:"Яндекс.Толока",toster:"Тосты",translate:"Переводчик",tune:"Настройки",tv:"ТВ",ugc:"Отзывы",uslugi:"Услуги",video:"Видео","video-com":"Видео",vno:"ВНО",wdgt:"Виджеты",weather:"Погода",webmaster:"Вебмастер","webmaster-api":"API Вебмастера",widgets:"Виджеты",wordstat:"Статистика",wow:"Я.ру",www:"Поиск",xmlsearch:"XML",yaca:"Каталог",yamb:"Медийные баннеры",zakladki:"Закладки"},{lang:"ru"}),BEM.I18N.decl("i-tanker__dynamic",{gender:function(t){return function(t){return t[t.gender]}.call(this,t)},plural:function(t){return function(t){var e=isNaN(parseInt(t.count))?0:t.count,i=e%10,n=e%100;return 1==i&&11!=n?t.one:i>1&&i<5&&(n<10||n>20)?t.some:t.many}.call(this,t)},plural_adv:function(t){return function(t){return 0===(isNaN(parseInt(t.count))?0:t.count)?t.none:this.keyset("i-tanker__dynamic").key("plural",{count:t.count,one:t.one,some:t.some,many:t.many})}.call(this,t)},toggle:function(t){return function(t){return Boolean(t.condition)?t.true:t.false}.call(this,t)}},{lang:"ru"}),BEM.I18N.decl("input",{"Очистить":"Очистить","Расширенный поиск":"Расширенный поиск"},{lang:"ru"}),BEM.I18N.decl("lang-switcher",{all:"Ещё"},{lang:"ru"}),BEM.I18N.decl("logo_type_link",{yandex:"Яндекс"},{lang:"ru"}),BEM.I18N.decl("misspell",{"Дополнительная информация о запросе":"Дополнительная информация о запросе"},{lang:"ru"}),BEM.I18N.decl("notice",{"Материалы для взрослых скрыты и не показываются в результатах поиска":"Материалы для взрослых скрыты и не показываются в результатах поиска","Показать все результаты":"Показать все результаты","Согласен":"Согласен"},{lang:"ru"}),BEM.I18N.decl("polaroid2",{"Сохраняйте понравившиеся картинки в коллекции":"Сохраняйте понравившиеся картинки в коллекции"},{lang:"ru"}),BEM.I18N.decl("search2",{"search-button-text":"Найти","search-input-label":"Запрос","search-service-label":"Поиск по сервису","search-web-label":"Поиск в интернете"},{lang:"ru"}),BEM.I18N.decl("search2_spok_yes",{"Найти":"Найти"},{lang:"ru"}),BEM.I18N.decl("serp-controller_spok_yes",{"Результаты поиска":"Результаты поиска"},{lang:"ru"}),BEM.I18N.decl("serp-item",{"{price} на сайте магазина":function(t){return t.price+" на сайте магазина"},"Купить":"Купить"},{lang:"ru"}),BEM.I18N.decl("serp-url_spok_yes",{"Перейти на сайт":"Перейти на сайт"},{lang:"ru"}),BEM.I18N.decl("serp-user_spok_yes",{"{login}, это вы?":function(t){return t.login+", это вы?"},"Войти":"Войти","Вы сможете сохранять интересные видео":"Вы сможете сохранять интересные видео","Да, войти":"Да, войти","Другой аккаунт":"Другой аккаунт","Регистрация":"Регистрация"},{lang:"ru"}),BEM.I18N.decl("suggest2",{fact:"Факты",group:"Группа подсказок",nah:"Вы искали",nav:"Сайт",on_other_devices:"На других устройствах",text:"Поиск",traffic:"Пробки",weather:"Погода","Войти":"Войти и объединить историю поиска на своих устройствах"},{lang:"ru"}),BEM.I18N.decl("suggest2-item",{"quick-answer":"Быстрый ответ"},{lang:"ru"}),BEM.I18N.decl("ticker__text",{notifications:"Уведомлений"},{lang:"ru"}),BEM.I18N.decl("tooltip__close",{close:"Закрыть"},{lang:"ru"}),BEM.I18N.decl("under-menu",{"Показать фильтры":"Показать фильтры","Скрыть фильтры":"Скрыть фильтры"},{lang:"ru"}),BEM.I18N.decl("user2",{"add-account":"Добавить аккаунт","add-organization":"Создать организацию","add-organization2":"Добавить организацию","edit-accounts":"Редактировать список",enter:"Войти",exit:"Выйти",exit_title:"Выйти из аккаунта",help:"Помощь",mail:function(t){return this.keyset("i-tanker__dynamic").key("plural_adv",{count:t.count,one:"новое письмо",some:"новых письма",many:"новых писем",none:"Нет новых писем"})},mail_compose:"Написать письмо","modal-close":"Закрыть",organization:"Организация",passport:"Управление аккаунтом","pin-code":"PIN-код","pin-code-description":"Сообщите PIN-код сотруднику службы поддержки для доступа к вашему аккаунту","pin-code-error1":"Ошибка генерации PIN-кода.","pin-code-error2":"Попробуйте сгенерировать код позднее.","pin-code-gen":"Сгенерировать PIN-код",settings:"Настройки",upload_files:"Мой диск",ya_plus:"Получить Плюс",ya_plus_on:"активен",ya_plus_on_title:"Плюс активен",badge_lang:"ru"},{lang:"ru"}),BEM.I18N.decl("yaplus",{be_plus:"Будьте в Плюсе",btn_left:"Не сейчас",btn_right:"Интересно",btn_right_enabled:"Подробнее",enable:"Включить",tooltip_descr:"Скидки в Такси, полный доступ к Музыке и многое другое",tooltip_descr_enabled:"Теперь у вас есть скидки в Такси, полный доступ к Музыке и многое другое",tooltip_header:"Подписка Яндекс.Плюс"},{lang:"ru"}),BEM.I18N.lang("ru"))}